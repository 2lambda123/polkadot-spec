<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="description" content="The Official Polkadot and Kusama Protocol Specification">
<meta name="keywords" content="babe, blockchain, consensus, finality, grandpa, kusama, parachain, polkadot, relay-chain, runtime, spec, web3, w3f">
<meta name="author" content="Web 3.0 Technologies Foundation">
<link rel="icon" type="image/png" href="./favicon.png">
<title>Polkadot Protocol Specification</title>
<style>
/* Fetch Unbounded - Normal - Regular */
@import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@400&display=swap');
/* Fetch Work Sans - Normal + Italic - Regular + Bold */
@import url('https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap');
/* Fetch Asciidoctor Default Style Sheet */
@import url('https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css');

/* Base constants of theme */
:root {
	--font-header: 'Unbounded', cursive;
	--font-text: 'Work Sans', sans-serif;

	--black: #1E1E1E;
	--white: #FFFFFF;

	--dark-blue: #172026;
	--grey: #efefef;

	--pink: #E6007A;
	--purple: #670d35;
}


/* Apply some layout corrections */
html {
	height: 100%;
}

body {
	min-height: 100%;
  	display: flex;
  	flex-direction: column;
}

.partintro {
	margin-bottom: 1.25rem;
}

/* Render part intros just like other text */
.partintro div.content {
	line-height: 1.6;
	font-size: 1.0625rem;
	letter-spacing: -.01em;
	text-rendering: optimizeLegibility;
}

/* Set our custom font */
body {
	font-family: var(--font-text);
}

h1, h2, h3, h4, h5, h6,
#toctitle,
#toc ul.sectlevel0 > li > a,
.sidebarblock > .content > .title {
	font-family: var(--font-header);
	font-weight: 400;
}

#toc ul{
	font-family: var(--font-text);
}

/* Set base colors */
body {
	color: var(--black);
	background-color: var(--white);
}

/* Style all titles */
h1, h2, h3, h4, h5, h6,
#toctitle,
.subheader,
.title {
	color: var(--pink);
}

/* - could be replaced by !important in previous block */
.sidebarblock > .content > .title,
.admonitionblock td.content > .title,
.audioblock > .title,
.exampleblock > .title,
.imageblock > .title,
.listingblock > .title,
.literalblock > .title,
.stemblock > .title,
.openblock > .title,
.paragraph > .title,
.quoteblock > .title,
table.tableblock > .title,
.verseblock > .title,
.videoblock > .title,
.dlist > .title,
.olist > .title,
.ulist > .title,
.qlist > .title,
.hdlist > .title {
	color: inherit;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
    color: inherit;
}

/* Style all links */
a {
	color: var(--pink);
}

a:hover {
	color: var(--purple);
}

/* - same here, next two blocks or important above */
#content h1 > a.link,
h2 > a.link,
h3 > a.link, #toctitle > a.link,
h4 > a.link,
h5 > a.link,
h6 > a.link,
.sidebarblock > .content > .title > a.link {
	color: inherit;
}

#content h1 > a.link:hover,
h2 > a.link:hover,
h3 > a.link:hover,
h4 > a.link:hover,
h5 > a.link:hover,
h6 > a.link:hover,
#toctitle > a.link:hover,
.sidebarblock > .content > .title > a.link:hover {
	color: var(--purple);
}

/* Style header like toc on small screens */
@media screen and (max-width:768px) {
	#header {
		background-color: var(--dark-blue);
		max-width: none;
	}

	#header > h1:first-child {
  		color: var(--pink);
	}

	#header .details {
  		color: var(--white);
		border: none;
	}
}

/* Style table of content */
#toc.toc2 {
	background-color: var(--dark-blue);
	border: none;
}

#toc ul.sectlevel0 > li > a {
  font-weight: bold;
  font-style: normal;
  text-decoration: underline;
}

#toc a {
	color: var(--white);
}

#toc a code {
	color: inherit;
	background-color: inherit;
}

#toc a .toc-current,
#toc .tocify-focus a {
	color: var(--pink);
}

/* Tame SVG images */
.imageblock .content svg {
  max-width: 100%;
}

/* Style boxes */
.exampleblock > .content, 
.sidebarblock {
	background: var(--grey);
}

/* Style footer */
#footer {
	color: var(--white);
	background-color: var(--dark-blue);
}

/* CSS Ribbon */
.ribbon {
  position: absolute;
  width: 200px;
  height: 200px;
  overflow: hidden;
  z-index: 99999;
  top: 0px;
  right: 0px;
}

.ribbon a {
  display: inline-block;
  position: inherit;
  transform: rotate(45deg);
  width: 200px;
  top: 45px; 
  right: -40px;
  padding: 6px 0px;
  overflow: hidden;

  text-align: center;
  font-size: 12px;
  font-weight: bold;
  text-decoration: none;

  color: var(--white);
  background-color: var(--pink);
  background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
  border: 2px dotted var(--white);
  box-shadow: rgba(0, 0, 0, 0.5) 0px 2px 3px 0px;
}

/* MathJax v3 */
.stemblock mjx-container {
  text-align: center;
  display: block;
  width: 100%;
  margin: 1em 0em;
}

/* Pseudocode.js */
.ps-root {
  font-size: 1.2em !important;
}

/* Fix inline svg with fixed width or height. */
.imageblock .content svg {
  widht: auto;
  height: auto;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<style type="text/css">@import url(https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css);.ps-root{font-family:KaTeX_Main,'Times New Roman',Times,serif;font-size:1em;font-weight:100;-webkit-font-smoothing:antialiased!important}.ps-root .ps-algorithm{margin:.8em 0;border-top:3px solid #000;border-bottom:2px solid #000}.ps-root .ps-algorithm.with-caption>.ps-line:first-child{border-bottom:2px solid #000}.ps-root .katex{text-indent:0;font-size:1em}.ps-root .MathJax,.ps-root .MathJax_CHTML{text-indent:0;font-size:1em!important}.ps-root .ps-line{margin:0;padding:0;line-height:1.2}.ps-root .ps-funcname{font-family:KaTeX_Main,'Times New Roman',Times,serif;font-weight:400;font-variant:small-caps;font-style:normal;text-transform:none}.ps-root .ps-keyword{font-family:KaTeX_Main,'Times New Roman',Times,serif;font-weight:700;font-variant:normal;font-style:normal;text-transform:none}.ps-root .ps-comment{font-family:KaTeX_Main,'Times New Roman',Times,serif;font-weight:400;font-variant:normal;font-style:normal;text-transform:none}.ps-root .ps-linenum{font-size:.8em;line-height:1em;width:1.6em;text-align:right;display:inline-block;position:relative;padding-right:.3em}.ps-root .ps-algorithmic.with-linenum .ps-line.ps-code{text-indent:-1.6em}.ps-root .ps-algorithmic.with-linenum .ps-line.ps-code>span{text-indent:0}</style>
</head>
<body class="book toc2 toc-left">
<!-- Contribution Ribbon -->
<div class="ribbon"><a target="_blank" href="https://github.com/w3f/polkadot-spec">Contributions welcome!</a></div>
<div id="header">
<h1>Polkadot Protocol Specification</h1>
<div class="details">
<span id="author" class="author">Web 3.0 Technologies Foundation</span><br>
<span id="revnumber">version 0.2.1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#id-polkadot-protocol">Polkadot Protocol</a></li>
<li><a href="#part-polkadot-host">Polkadot Host</a>
<ul class="sectlevel1">
<li><a href="#chap-overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#sect-client-light">1.1. Light Client</a></li>
<li><a href="#sect-node-full">1.2. Full Node</a></li>
<li><a href="#sect-node-authoring">1.3. Authoring Node</a></li>
<li><a href="#sect-node-relaying">1.4. Relaying Node</a></li>
</ul>
</li>
<li><a href="#chap-state">2. States and Transitions</a>
<ul class="sectlevel2">
<li><a href="#id-introduction">2.1. Introduction</a></li>
<li><a href="#sect-state-replication">2.2. State Replication</a></li>
<li><a href="#sect-extrinsics">2.3. Extrinsics</a></li>
<li><a href="#sect-state-storage">2.4. State Storage Trie</a></li>
<li><a href="#sect-child-storages">2.5. Child Storage</a></li>
<li><a href="#sect-runtime-interaction">2.6. Runtime Interactions</a></li>
</ul>
</li>
<li><a href="#chap-sync">3. Synchronization</a>
<ul class="sectlevel2">
<li><a href="#sect-sync-warp">3.1. Warp Sync</a></li>
<li><a href="#sect-sync-fast">3.2. Fast Sync</a></li>
<li><a href="#id-full-sync">3.3. Full Sync</a></li>
<li><a href="#sect-block-validation">3.4. Importing and Validating Block</a></li>
</ul>
</li>
<li><a href="#chap-networking">4. Networking</a>
<ul class="sectlevel2">
<li><a href="#id-introduction-2">4.1. Introduction</a></li>
<li><a href="#sect-networking-external-docs">4.2. External Documentation</a></li>
<li><a href="#id-node-identities">4.3. Node Identities</a></li>
<li><a href="#sect-discovery-mechanism">4.4. Discovery mechanism</a></li>
<li><a href="#sect-connection-establishment">4.5. Connection establishment</a></li>
<li><a href="#sect-encryption-layer">4.6. Encryption Layer</a></li>
<li><a href="#sect-protocols-substreams">4.7. Protocols and Substreams</a></li>
<li><a href="#sect-network-messages">4.8. Network Messages</a></li>
</ul>
</li>
<li><a href="#sect-block-production">5. Block Production</a>
<ul class="sectlevel2">
<li><a href="#id-introduction-3">5.1. Introduction</a></li>
<li><a href="#sect-block-production-lottery">5.2. Block Production Lottery</a></li>
<li><a href="#sect-slot-number-calculation">5.3. Slot Number Calculation</a></li>
<li><a href="#block-production">5.4. Production Algorithm</a></li>
<li><a href="#sect-epoch-randomness">5.5. Epoch Randomness</a></li>
<li><a href="#sect-verifying-authorship">5.6. Verifying Authorship Right</a></li>
<li><a href="#sect-block-building">5.7. Block Building Process</a></li>
</ul>
</li>
<li><a href="#sect-finality">6. Finality</a>
<ul class="sectlevel2">
<li><a href="#id-introduction-4">6.1. Introduction</a></li>
<li><a href="#id-initiating-the-grandpa-state">6.2. Initiating the GRANDPA State</a></li>
<li><a href="#id-rejoining-the-same-voter-set">6.3. Rejoining the Same Voter Set</a></li>
<li><a href="#id-voting-process-in-round-r">6.4. Voting Process in Round \$r\$</a></li>
<li><a href="#sect-finality-forced-changes">6.5. Forced Authority Set Changes</a></li>
<li><a href="#sect-block-finalization">6.6. Block Finalization</a></li>
<li><a href="#sect-grandpa-beefy">6.7. Bridge design (BEEFY)</a></li>
</ul>
</li>
<li><a href="#sect-lightclient">7. Light Clients</a>
<ul class="sectlevel2">
<li><a href="#sect-requirements-lightclient">7.1. Requirements for Light Clients</a></li>
<li><a href="#sect-sync-warp-lightclient">7.2. Warp Sync for Light Clients</a></li>
<li><a href="#sect-runtime-environment-lightclient">7.3. Runtime Environment for Light Clients</a></li>
<li><a href="#sect-light-msg">7.4. Light Client Messages</a></li>
<li><a href="#sect-storage-lightclient">7.5. Storage for Light Clients</a></li>
</ul>
</li>
<li><a href="#chapter-anv">8. Availability &amp; Validity</a>
<ul class="sectlevel2">
<li><a href="#sect-collations">8.1. Collations</a></li>
<li><a href="#sect-candidate-backing">8.2. Candidate Backing</a></li>
<li><a href="#sect-candidate-validation">8.3. Candidate Validation</a></li>
<li><a href="#sect-availability">8.4. Availability</a></li>
<li><a href="#sect-approval-voting">8.5. Approval Voting</a></li>
<li><a href="#sect-disputes">8.6. Disputes</a></li>
<li><a href="#sect-anv-network-messages">8.7. Network Messages</a></li>
<li><a href="#sect-anv-definitions">8.8. Definitions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-polkadot-runtime">Polkadot Runtime</a>
<ul class="sectlevel1">
<li><a href="#id-extrinsics">9. Extrinsics</a>
<ul class="sectlevel2">
<li><a href="#id-introduction-5">9.1. Introduction</a></li>
<li><a href="#id-preliminaries-3">9.2. Preliminaries</a></li>
<li><a href="#id-extrinsics-body">9.3. Extrinsics Body</a></li>
</ul>
</li>
<li><a href="#id-weights">10. Weights</a>
<ul class="sectlevel2">
<li><a href="#id-motivation">10.1. Motivation</a></li>
<li><a href="#sect-assumptions">10.2. Assumptions</a></li>
<li><a href="#sect-runtime-primitives">10.3. Calculation of the weight function</a></li>
<li><a href="#sect-benchmarking">10.4. Benchmarking</a></li>
<li><a href="#sect-practical-examples">10.5. Practical examples</a></li>
<li><a href="#id-fees">10.6. Fees</a></li>
</ul>
</li>
<li><a href="#id-consensus">11. Consensus</a>
<ul class="sectlevel2">
<li><a href="#id-babe-digest-messages">11.1. BABE digest messages</a></li>
</ul>
</li>
<li><a href="#sect-metadata">12. Metadata</a>
<ul class="sectlevel2">
<li><a href="#sect-rtm-structure">12.1. Structure</a></li>
<li><a href="#sect-rtm-pallet-metadata">12.2. Pallet Metadata</a></li>
<li><a href="#sect-rtm-extrinsic-metadata">12.3. Extrinsic Metadata</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#id-cryptography-encoding">Appendix A: Cryptography &amp; Encoding</a>
<ul class="sectlevel2">
<li><a href="#chapter-crypto-algos">A.1. Cryptographic Algorithms</a></li>
<li><a href="#chapter-encoding">A.2. Auxiliary Encodings</a></li>
<li><a href="#chapter-genesis">A.3. Genesis State</a></li>
<li><a href="#chapter-erasure-encoding">A.4. Erasure Encoding</a></li>
</ul>
</li>
<li><a href="#chap-host-api">Appendix B: Host API</a>
<ul class="sectlevel2">
<li><a href="#id-preliminaries-4">B.1. Preliminaries</a></li>
<li><a href="#sect-storage-api">B.2. Storage</a></li>
<li><a href="#sect-child-storage-api">B.3. Child Storage</a></li>
<li><a href="#sect-crypto-api">B.4. Crypto</a></li>
<li><a href="#sect-hashing-api">B.5. Hashing</a></li>
<li><a href="#sect-offchain-api">B.6. Offchain</a></li>
<li><a href="#sect-trie-api">B.7. Trie</a></li>
<li><a href="#sect-misc-api">B.8. Miscellaneous</a></li>
<li><a href="#sect-allocator-api">B.9. Allocator</a></li>
<li><a href="#sect-logging-api">B.10. Logging</a></li>
</ul>
</li>
<li><a href="#chap-runtime-api">Appendix C: Runtime API</a>
<ul class="sectlevel2">
<li><a href="#id-general-information">C.1. General Information</a></li>
<li><a href="#id-runtime-constants">C.2. Runtime Constants</a></li>
<li><a href="#id-runtime-call-convention">C.3. Runtime Call Convention</a></li>
<li><a href="#sect-runtime-core-module">C.4. Module Core</a></li>
<li><a href="#sect-runtime-metadata-module">C.5. Module Metadata</a></li>
<li><a href="#sect-runtime-blockbuilder-module">C.6. Module BlockBuilder</a></li>
<li><a href="#sect-runtime-txqueue-module">C.7. Module TaggedTransactionQueue</a></li>
<li><a href="#sect-runtime-offchainapi-module">C.8. Module OffchainWorkerApi</a></li>
<li><a href="#sect-anv-runtime-api">C.9. Module ParachainHost</a></li>
<li><a href="#id-module-grandpaapi">C.10. Module GrandpaApi</a></li>
<li><a href="#id-module-babeapi">C.11. Module BabeApi</a></li>
<li><a href="#id-module-accountnonceapi">C.12. Module AccountNonceApi</a></li>
</ul>
</li>
<li><a href="#id-bibliography">Bibliography</a></li>
<li><a href="#id-glossary">Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="id-polkadot-protocol"><a class="anchor" href="#id-polkadot-protocol"></a><a class="link" href="#id-polkadot-protocol">Polkadot Protocol</a></h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This specification is <strong>Work-In-Progress</strong> and any content, structure,
design and/or hyper/anchor-link <strong>is subject to change</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Formally, Polkadot is a replicated sharded state machine designed to
resolve the scalability and interoperability among blockchains. In
Polkadot vocabulary, shards are called <em>parachains</em> and Polkadot <em>relay
chain</em> is part of the protocol ensuring global consensus among all the
parachains. The Polkadot relay chain protocol, henceforward called
<em>Polkadot protocol</em>, can itself be considered as a replicated state
machine on its own. As such, the protocol can be specified by
identifying the state machine and the replication strategy.</p>
</div>
<div class="paragraph">
<p>From a more technical point of view, the Polkadot protocol has been divided into
two parts, the <a href="#part-polkadot-runtime">Polkadot Runtime</a> and the <a href="#part-polkadot-host">Polkadot Host</a>. The Runtime comprises the state
transition logic for the Polkadot protocol and is designed and be upgradable via
the consensus engine without requiring hard forks of the blockchain. The
Polkadot Host provides the necessary functionality for the Runtime to execute
its state transition logic, such as an execution environment, I/O, consensus and
network interoperability between parachains. The Polkadot Host is planned to be
stable and mostly static for the lifetime duration of the Polkadot protocol, the
goal being that most changes to the protocol are primarily conducted by applying
Runtime updates and not having to coordinate with network participants on manual
software updates.</p>
</div>
</div>
</div>
<h1 id="part-polkadot-host" class="sect0"><a class="anchor" href="#part-polkadot-host"></a><a class="link" href="#part-polkadot-host">Polkadot Host</a></h1>
<div class="openblock partintro">
<div class="content">
With the current document, we aim to specify the Polkadot Host part of the
Polkadot protocol as a replicated state machine. After defining the different
types of hosts in <a href="#chap-overview">Chapter 1</a>, we proceed to specify the representation of a
valid state of the Protocol in <a href="#chap-state">Chapter 2</a>. We also identify the
protocol states, by explaining the Polkadot state transition and discussing the
detail based on which the Polkadot Host interacts with the state transition
function, i.e. Runtime in the same chapter. Following, we specify the input messages triggering the
state transition and the system behavior. In <a href="#chap-networking">Chapter 4</a>, we specify
the communication protocols and network messages required for the Polkadot Host
to communicate with other nodes in the network, such as exchanging blocks and
consensus messages. In <a href="#sect-block-production">Chapter 5</a> and <a href="#sect-finality">Chapter 6</a>, we specify the consensus protocol,
which is responsible for keeping all the replica in the same state. Finally, the
initial state of the machine is identified and discussed in <a href="#chapter-genesis">Section A.3</a>.
A Polkadot Host implementation which conforms with this part of the
specification should successfully be able to sync its states with the Polkadot
network.
</div>
</div>
<div class="sect1">
<h2 id="chap-overview"><a class="anchor" href="#chap-overview"></a><a class="link" href="#chap-overview">1. Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Polkadot Protocol differentiates between different classes of Polkadot Hosts. Each class differs in their trust roots and how active or passively they interact with the network.</p>
</div>
<div class="sect2">
<h3 id="sect-client-light"><a class="anchor" href="#sect-client-light"></a><a class="link" href="#sect-client-light">1.1. Light Client</a></h3>
<div class="paragraph">
<p>The light client is a mostly passive participant in the protocol. Light clients are designed to work in resource constrained environments like browsers, mobile devices or even on-chain. Its main objective is to follow the chain, make queries to the full node on specific information on recent state of the blockchain, and to add extrinsics (transactions). It does not maintain the full state, rather queries the full node on the latest finalized state and verifies the authenticity of the responses trustlessly. Details of specifications focused for Light Clients can be found in <a href="#sect-lightclient">Chapter 7</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-node-full"><a class="anchor" href="#sect-node-full"></a><a class="link" href="#sect-node-full">1.2. Full Node</a></h3>
<div class="paragraph">
<p>While the full node is still a mostly passive participant of the protocol, they follow the chain by receiving and verifying every block in the chain. It maintains full state of the blockchain by executing the extrinsics in blocks. Their role in consesus mechanism is limited to following the chain and not producing the blocks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Functional Requirements:</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The node must populate the state storage with the official genesis state,
elaborated further in <a href="#chapter-genesis">Section A.3</a>.</p>
</li>
<li>
<p>The node should maintain a set of around 50 active peers at any time. New
peers can be found using the discovery protocols (<a href="#sect-discovery-mechanism">Section 4.4</a>)</p>
</li>
<li>
<p>The node should open and maintain the various required streams
(<a href="#sect-protocols-substreams">Section 4.7</a>) with each of its active peers.</p>
</li>
<li>
<p>Furthermore, the node should send block requests (<a href="#sect-msg-block-request">Section 4.8.2</a>)
to these peers to receive all blocks in the chain and execute each of them.</p>
</li>
<li>
<p>The node should exchange neighbor packets (<a href="#sect-grandpa-neighbor-msg">Section 4.8.6.1</a>).</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-node-authoring"><a class="anchor" href="#sect-node-authoring"></a><a class="link" href="#sect-node-authoring">1.3. Authoring Node</a></h3>
<div class="paragraph">
<p>The authoring node covers all the features of the full node but instead of just passivly following the protocol, it is an active participant, producing blocks and voting in Grandpa.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Functional Requirements:</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the Host’s session key is included in the current Epoch’s
authority set (<a href="#sect-authority-set">Section 3.3.1</a>).</p>
</li>
<li>
<p>Run the BABE lottery (<a href="#sect-block-production">Chapter 5</a>) and wait for the next
assigned slot in order to produce a block.</p>
</li>
<li>
<p>Gossip any produced blocks to all connected peers
(<a href="#sect-msg-block-announce">Section 4.8.1</a>).</p>
</li>
<li>
<p>Run the catch-up protocol (<a href="#sect-grandpa-catchup">Section 6.6.1</a>) to make sure that the
node is participating in the current round and not a past round.</p>
</li>
<li>
<p>Run the GRANDPA rounds protocol (<a href="#sect-finality">Chapter 6</a>).</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-node-relaying"><a class="anchor" href="#sect-node-relaying"></a><a class="link" href="#sect-node-relaying">1.4. Relaying Node</a></h3>
<div class="paragraph">
<p>The relaying node covers all the features of the authoring node, but also participants in the availability and validity process to process new parachain blocks as described in <a href="#chapter-anv">Chapter 8</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-state"><a class="anchor" href="#chap-state"></a><a class="link" href="#chap-state">2. States and Transitions</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="id-introduction"><a class="anchor" href="#id-introduction"></a><a class="link" href="#id-introduction">2.1. Introduction</a></h3>
<div id="defn-state-machine" class="exampleblock">
<div class="title">Definition 1. <a href="#defn-state-machine">Discrete State Machine (DSM)</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>Discrete State Machine (DSM)</strong> is a state transition system that admits a
starting state and whose set of states and set of transitions are countable.
Formally, it is a tuple of</p>
</div>
<div class="stemblock">
<div class="content">
\$(\Sigma, S, s_0, \delta)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$\Sigma\$ is the countable set of all possible inputs.</p>
</li>
<li>
<p>\$S\$ is a countable set of all possible states.</p>
</li>
<li>
<p>\$s_0 in S\$ is the initial state.</p>
</li>
<li>
<p>\$\delta\$ is the state-transition function, known as <strong>Runtime</strong> in the
Polkadot vocabulary, such that</p>
</li>
</ul>
</div>
<div class="stemblock">
<div class="content">
\$\delta : S \times \Sigma \rightarrow S\$
</div>
</div>
</div>
</div>
<div id="defn-path-graph" class="exampleblock">
<div class="title">Definition 2. <a href="#defn-path-graph">Path Graph</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>path graph</strong> or a <strong>path</strong> of \$n\$ nodes formally referred to as <strong>\$P_n\$</strong>,
is a tree with two nodes of vertex degree 1 and the other n-2 nodes of vertex
degree 2. Therefore, \$P_n\$ can be represented by sequences of \$(v_1,
\ldots, v_n)\$ where \$e_i = (v_i, v_{i + 1})\$ for \$1 &lt;= i &lt;= n - 1\$ is
the edge which connect \$v_i\$ and \$v_{i + 1}\$.</p>
</div>
</div>
</div>
<div id="defn-blockchain" class="exampleblock">
<div class="title">Definition 3. <a href="#defn-blockchain">Blockchain</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>blockchain</strong> \$C\$ is a
<a href="https://en.wikipedia.org/wiki/Directed_graph">directed path graph</a>. Each node of
the graph is called <strong>Block</strong> and indicated by <strong>\$B\$</strong>. The unique sink of
\$C\$ is called <strong>Genesis Block</strong>, and the source is called the \$"Head"\$
of \$C\$. For any vertex \$(B_1, B_2)\$ where \$B_1 -&gt; B_2\$ we say
\$B_2\$ is the <strong>parent</strong> of \$B_1\$, which is the <strong>child</strong> of \$B_2\$,
respectively. We indicate that by:</p>
</div>
<div class="stemblock">
<div class="content">
\$B_2 := P(B_1)\$
</div>
</div>
<div class="paragraph">
<p>The parent refers to the child by its hash value (<a href="#defn-block-header">Definition 10</a>), making
the path graph tamper proof since any modifications to the child would result in
its hash value being changed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The term "blockchain" can also be used as a way to refer to the network or
system that interacts or maintains the directed path graph.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-block-tree"><a class="anchor" href="#id-block-tree"></a><a class="link" href="#id-block-tree">2.1.1. Block Tree</a></h4>
<div class="paragraph">
<p>In the course of formation of a (distributed) blockchain, it is possible
that the chain forks into multiple subchains in various block positions.
We refer to this structure as a <em>block tree</em>:</p>
</div>
<div id="defn-block-tree" class="exampleblock">
<div class="title">Definition 4. <a href="#defn-block-tree">Block </a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>block tree</strong> of a blockchain, denoted by \$BT\$ is the union of all
different versions of the blockchain observed by the Polkadot Host such that
every block is a node in the graph and \$B_1\$ is connected to \$B_2\$ if
\$B_1\$ is a parent of \$B_2\$.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When a block in the block tree gets finalized, there is an opportunity to prune
the block tree to free up resources into branches of blocks that do not contain
all of the finalized blocks or those that can never be finalized in the
blockchain (<a href="#sect-finality">Chapter 6</a>).</p>
</div>
<div id="defn-pruned-tree" class="exampleblock">
<div class="title">Definition 5. <a href="#defn-pruned-tree">Pruned Block Tree</a></div>
<div class="content">
<div class="paragraph">
<p>By <strong>Pruned Block Tree</strong>, denoted by \$"PBT"\$, we refer to a subtree of the block
tree obtained by eliminating all branches which do not contain the most recent
finalized blocks (<a href="#defn-finalized-block">Definition 90</a>). By <strong>pruning</strong>, we refer to the
procedure of \$BT larr "PBT"\$. When there is no risk of ambiguity and is safe
to prune BT, we use \$"BT"\$ to refer to \$"PBT"\$.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#defn-chain-subchain">Definition 6</a> gives the means to highlight various branches of the
block tree.</p>
</div>
<div id="defn-chain-subchain" class="exampleblock">
<div class="title">Definition 6. <a href="#defn-chain-subchain">Subchain</a></div>
<div class="content">
<div class="paragraph">
<p>Let \$G\$ be the root of the block tree and \$B\$ be one of its nodes. By
\$"Chain"(B)\$, we refer to the path graph from \$G\$ to \$B\$ in
\$"BT"\$. Conversely, for a chain \$C = "Chain"(B)\$, we define <strong>the
head of \$C\$</strong> to be \$B\$, formally noted as \$B := bar C\$. We define
\$|C|\$, the length of \$C\$ as a path graph.</p>
</div>
<div class="paragraph">
<p>If \$B'\$ is another node on \$"Chain"(B)\$, then by \$"SubChain"(B',
B)\$ we refer to the subgraph of \$"Chain"(B)\$ path graph which contains
\$B\$ and ends at \$B'\$ and by \$|"SubChain"(B', B)|\$ we refer to its
length.</p>
</div>
<div class="paragraph">
<p>Accordingly, \$bbb C_(B')(BT)\$ is the set of all subchains of \$BT\$
rooted at \$B'\$. The set of all chains of \$BT\$, \$bbb C_G(BT))\$ is
denoted by \$bbb C(BT)\$ or simply \$bbb C\$, for the sake of brevity.</p>
</div>
</div>
</div>
<div id="defn-longest-chain" class="exampleblock">
<div class="title">Definition 7. <a href="#defn-longest-chain">Longest Chain</a></div>
<div class="content">
<div class="paragraph">
<p>We define the following complete order over \$bbb C\$ as follows. For chains
\$C_1, C_2 in bbb C\$ we have that \$C_1 &gt; C_2\$ if either \$|C_1| &gt;
|C_2|\$ or \$|C_1| = |C_2|\$.</p>
</div>
<div class="paragraph">
<p>If \$|C_1| =| C_2|\$ we say \$C_1 &gt; C_2\$ if and only if the block arrival
time (<a href="#defn-block-time">Definition 67</a>) of \$bar C_1\$ is less than the block arrival time
of \$bar C_2\$, from the <em>subjective perspective</em> of the Host. We define the
\$"Longest-Chain"(BT)\$ to be the maximum chain given by this order.</p>
</div>
</div>
</div>
<div id="defn-longest-path" class="exampleblock">
<div class="title">Definition 8. <a href="#defn-longest-path">Longest Path</a></div>
<div class="content">
<div class="paragraph">
<p>\$"Longest-Path"(BT)\$ returns the path graph of \$BT\$ which is the
longest among all paths in \$BT\$ and has the earliest block arrival time
(<a href="#defn-block-time">Definition 67</a>). \$"Deepest-Leaf"(BT)\$ returns the head of \$"Longest-Path"(BT)\$ chain.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Because every block in the blockchain contains a reference to its parent, it is
easy to see that the block tree is de facto a tree. A block tree naturally
imposes partial order relationships on the blocks as follows:</p>
</div>
<div id="defn-descendant-ancestor" class="exampleblock">
<div class="title">Definition 9. <a href="#defn-descendant-ancestor">Descendant and Ancestor</a></div>
<div class="content">
<div class="paragraph">
<p>We say \$B\$ is <strong>descendant</strong> of \$B'\$, formally noted as \$B &gt; B'\$,
if \$(|B| &gt; |B'|) in C\$. Respectively, we say that \$B'\$ is an
<strong>ancestor</strong> of \$B\$, formally noted as \$B &lt; B'\$, if \$(|B| &lt; |B'|)
in C\$.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-state-replication"><a class="anchor" href="#sect-state-replication"></a><a class="link" href="#sect-state-replication">2.2. State Replication</a></h3>
<div class="paragraph">
<p>Polkadot nodes replicate each other’s state by syncing the history of the
extrinsics. This, however, is only practical if a large set of transactions are
batched and synced at the time. The structure in which the transactions are
journaled and propagated is known as a block of extrinsics
(<a href="#sect-block-format">Section 2.2.1</a>). Like any other replicated state machines, state
inconsistency can occure between Polkadot replicas.
<a href="#sect-managing-multiple-states">Section 2.4.5</a> gives an overview of how a Polkadot Host
node manages multiple variants of the state.</p>
</div>
<div class="sect3">
<h4 id="sect-block-format"><a class="anchor" href="#sect-block-format"></a><a class="link" href="#sect-block-format">2.2.1. Block Format</a></h4>
<div class="paragraph">
<p>A Polkadot block consists a <em>block header</em> (<a href="#defn-block-header">Definition 10</a>) and a <em>block
body</em> (<a href="#defn-block-body">Definition 13</a>). The <em>block body</em> in turn is made up out of
<em>extrinsics</em> , which represent the generalization of the concept of
<em>transactions</em>. <em>Extrinsics</em> can contain any set of external data the underlying
chain wishes to validate and track.</p>
</div>
<div id="block" class="imageblock">
<div class="content">
<svg width="403pt" height="140pt"
 viewBox="0.00 0.00 403.00 140.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 136)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-136 399,-136 399,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__block</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-13 8,-124 259,-124 259,-13 8,-13"/>
<text text-anchor="middle" x="133.5" y="-108.8" font-family="Times,serif" font-size="14.00">Block</text>
</g>
<!-- block__seq -->
<g id="node1" class="node">
<title>block__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-67 24.5,-88 55.5,-88 55.5,-67 24.5,-67"/>
<polygon fill="none" stroke="black" points="24.5,-67 24.5,-88 55.5,-88 55.5,-67 24.5,-67"/>
<text text-anchor="start" x="27.5" y="-73.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-67 55.5,-88 89.5,-88 89.5,-67 55.5,-67"/>
<polygon fill="none" stroke="black" points="55.5,-67 55.5,-88 89.5,-88 89.5,-67 55.5,-67"/>
<text text-anchor="start" x="58.5" y="-73.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-67 89.5,-88 187.5,-88 187.5,-67 89.5,-67"/>
<polygon fill="none" stroke="black" points="89.5,-67 89.5,-88 187.5,-88 187.5,-67 89.5,-67"/>
<text text-anchor="start" x="122.5" y="-73.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="187.5,-67 187.5,-88 243.5,-88 243.5,-67 187.5,-67"/>
<polygon fill="none" stroke="black" points="187.5,-67 187.5,-88 243.5,-88 243.5,-67 187.5,-67"/>
<text text-anchor="start" x="208.5" y="-73.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-46 24.5,-67 55.5,-67 55.5,-46 24.5,-46"/>
<text text-anchor="start" x="35" y="-52.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-46 55.5,-67 89.5,-67 89.5,-46 55.5,-46"/>
<text text-anchor="start" x="65.5" y="-52.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-46 89.5,-67 187.5,-67 187.5,-46 89.5,-46"/>
<text text-anchor="start" x="92.5" y="-52.8" font-family="Times,serif" font-size="14.00">BlockHeader</text>
<polygon fill="none" stroke="black" points="187.5,-46 187.5,-67 243.5,-67 243.5,-46 187.5,-46"/>
<text text-anchor="start" x="190.5" y="-52.8" font-family="Times,serif" font-size="14.00">header</text>
<polygon fill="none" stroke="black" points="24.5,-25 24.5,-46 55.5,-46 55.5,-25 24.5,-25"/>
<text text-anchor="start" x="33" y="-31.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-25 55.5,-46 89.5,-46 89.5,-25 55.5,-25"/>
<text text-anchor="start" x="65.5" y="-31.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-25 89.5,-46 187.5,-46 187.5,-25 89.5,-25"/>
<text text-anchor="start" x="100.5" y="-31.8" font-family="Times,serif" font-size="14.00">BlockBody</text>
<polygon fill="none" stroke="black" points="187.5,-25 187.5,-46 243.5,-46 243.5,-25 187.5,-25"/>
<text text-anchor="start" x="198" y="-31.8" font-family="Times,serif" font-size="14.00">body</text>
</g>
<!-- block_header__seq -->
<g id="node2" class="node">
<title>block_header__seq</title>
<g id="a_node2"><a xlink:href="#block_header" xlink:title="BlockHeader">
<text text-anchor="middle" x="341" y="-68.3" font-family="Times,serif" font-size="14.00">BlockHeader</text>
</a>
</g>
</g>
<!-- block__seq&#45;&gt;block_header__seq -->
<g id="edge1" class="edge">
<title>block__seq:header_type&#45;&gt;block_header__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M244.5,-56C255.01,-56 266.08,-56.95 276.82,-58.4"/>
<polygon fill="black" stroke="black" stroke-width="2" points="276.57,-61.9 286.97,-59.91 277.6,-54.97 276.57,-61.9"/>
</g>
<!-- block_body__seq -->
<g id="node3" class="node">
<title>block_body__seq</title>
<g id="a_node3"><a xlink:href="#block_body" xlink:title="BlockBody">
<text text-anchor="middle" x="341" y="-14.3" font-family="Times,serif" font-size="14.00">BlockBody</text>
</a>
</g>
</g>
<!-- block__seq&#45;&gt;block_body__seq -->
<g id="edge2" class="edge">
<title>block__seq:body_type&#45;&gt;block_body__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M244.5,-35C257.52,-35 271.39,-33.45 284.41,-31.28"/>
<polygon fill="black" stroke="black" stroke-width="2" points="285.41,-34.66 294.63,-29.43 284.17,-27.77 285.41,-34.66"/>
</g>
</g>
</svg>

</div>
</div>
<div id="defn-block-header" class="exampleblock">
<div class="title">Definition 10. <a href="#defn-block-header">Block Header</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>header of block B</strong>, \$H_h(B)\$, is a 5-tuple containing the following
elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>parent_hash:</strong> formally indicated as \$H_p\$, is the 32-byte Blake2b hash
(<a href="#sect-blake2">Section A.1.1.1</a>) of the SCALE encoded parent block header
(<a href="#defn-block-header-hash">Definition 12</a>).</p>
</li>
<li>
<p><strong>number:</strong> formally indicated as \$H_i\$, is an integer, which represents
the index of the current block in the chain. It is equal to the number of the
ancestor blocks. The genesis state has number 0.</p>
</li>
<li>
<p><strong>state_root:</strong> formally indicated as \$H_r\$, is the root of the Merkle trie,
whose leaves implement the storage for the system.</p>
</li>
<li>
<p><strong>extrinsics_root:</strong> is the field which is reserved for the Runtime to validate
the integrity of the extrinsics composing the block body. For example, it can
hold the root hash of the Merkle trie which stores an ordered list of the
extrinsics being validated in this block. The <span class="sans-serif">extrinsics_root</span> is
set by the runtime and its value is opaque to the Polkadot Host. This element is
formally referred to as \$H_e\$.</p>
</li>
<li>
<p><strong>digest:</strong> this field is used to store any chain-specific auxiliary data, which
could help the light clients interact with the block without the need of
accessing the full storage as well as consensus-related data including the block
signature. This field is indicated as \$H_d\$ (<a href="#defn-digest">Definition 11</a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div id="block_header" class="imageblock">
<div class="content">
<svg width="446pt" height="239pt"
 viewBox="0.00 0.00 446.00 239.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 235)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-235 442,-235 442,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__block_header</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-223 347,-223 347,-8 8,-8"/>
<text text-anchor="middle" x="177.5" y="-207.8" font-family="Times,serif" font-size="14.00">BlockHeader</text>
</g>
<!-- block_header__seq -->
<g id="node1" class="node">
<title>block_header__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-167 24.5,-188 55.5,-188 55.5,-167 24.5,-167"/>
<polygon fill="none" stroke="black" points="24.5,-167 24.5,-188 55.5,-188 55.5,-167 24.5,-167"/>
<text text-anchor="start" x="27.5" y="-173.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-167 55.5,-188 89.5,-188 89.5,-167 55.5,-167"/>
<polygon fill="none" stroke="black" points="55.5,-167 55.5,-188 89.5,-188 89.5,-167 55.5,-167"/>
<text text-anchor="start" x="58.5" y="-173.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-167 89.5,-188 226.5,-188 226.5,-167 89.5,-167"/>
<polygon fill="none" stroke="black" points="89.5,-167 89.5,-188 226.5,-188 226.5,-167 89.5,-167"/>
<text text-anchor="start" x="142" y="-173.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226.5,-167 226.5,-188 331.5,-188 331.5,-167 226.5,-167"/>
<polygon fill="none" stroke="black" points="226.5,-167 226.5,-188 331.5,-188 331.5,-167 226.5,-167"/>
<text text-anchor="start" x="272" y="-173.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-146 24.5,-167 55.5,-167 55.5,-146 24.5,-146"/>
<text text-anchor="start" x="35" y="-152.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-146 55.5,-167 89.5,-167 89.5,-146 55.5,-146"/>
<text text-anchor="start" x="63" y="-152.8" font-family="Times,serif" font-size="14.00">32</text>
<polygon fill="none" stroke="black" points="89.5,-146 89.5,-167 226.5,-167 226.5,-146 89.5,-146"/>
<polygon fill="none" stroke="black" points="226.5,-146 226.5,-167 331.5,-167 331.5,-146 226.5,-146"/>
<text text-anchor="start" x="235" y="-152.8" font-family="Times,serif" font-size="14.00">parent_hash</text>
<polygon fill="none" stroke="black" points="24.5,-125 24.5,-146 55.5,-146 55.5,-125 24.5,-125"/>
<text text-anchor="start" x="30.5" y="-131.8" font-family="Times,serif" font-size="14.00">32</text>
<polygon fill="none" stroke="black" points="55.5,-125 55.5,-146 89.5,-146 89.5,-125 55.5,-125"/>
<text text-anchor="start" x="65.5" y="-131.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-125 89.5,-146 226.5,-146 226.5,-125 89.5,-125"/>
<text text-anchor="start" x="92.5" y="-131.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226.5,-125 226.5,-146 331.5,-146 331.5,-125 226.5,-125"/>
<text text-anchor="start" x="251" y="-131.8" font-family="Times,serif" font-size="14.00">number</text>
<polygon fill="none" stroke="black" points="24.5,-104 24.5,-125 55.5,-125 55.5,-104 24.5,-104"/>
<text text-anchor="start" x="33" y="-110.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-104 55.5,-125 89.5,-125 89.5,-104 55.5,-104"/>
<text text-anchor="start" x="63" y="-110.8" font-family="Times,serif" font-size="14.00">32</text>
<polygon fill="none" stroke="black" points="89.5,-104 89.5,-125 226.5,-125 226.5,-104 89.5,-104"/>
<polygon fill="none" stroke="black" points="226.5,-104 226.5,-125 331.5,-125 331.5,-104 226.5,-104"/>
<text text-anchor="start" x="242.5" y="-110.8" font-family="Times,serif" font-size="14.00">state_root</text>
<polygon fill="none" stroke="black" points="24.5,-83 24.5,-104 55.5,-104 55.5,-83 24.5,-83"/>
<text text-anchor="start" x="33" y="-89.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-83 55.5,-104 89.5,-104 89.5,-83 55.5,-83"/>
<text text-anchor="start" x="63" y="-89.8" font-family="Times,serif" font-size="14.00">32</text>
<polygon fill="none" stroke="black" points="89.5,-83 89.5,-104 226.5,-104 226.5,-83 89.5,-83"/>
<polygon fill="none" stroke="black" points="226.5,-83 226.5,-104 331.5,-104 331.5,-83 226.5,-83"/>
<text text-anchor="start" x="229.5" y="-89.8" font-family="Times,serif" font-size="14.00">extrinsic_root</text>
<polygon fill="none" stroke="black" points="24.5,-62 24.5,-83 55.5,-83 55.5,-62 24.5,-62"/>
<text text-anchor="start" x="33" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-62 55.5,-83 89.5,-83 89.5,-62 55.5,-62"/>
<text text-anchor="start" x="65.5" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-62 89.5,-83 226.5,-83 226.5,-62 89.5,-62"/>
<text text-anchor="start" x="92.5" y="-68.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226.5,-62 226.5,-83 331.5,-83 331.5,-62 226.5,-62"/>
<text text-anchor="start" x="233.5" y="-68.8" font-family="Times,serif" font-size="14.00">num_digests</text>
<polygon fill="none" stroke="black" points="24.5,-41 24.5,-62 55.5,-62 55.5,-41 24.5,-41"/>
<text text-anchor="start" x="33" y="-47.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-41 55.5,-62 89.5,-62 89.5,-41 55.5,-41"/>
<text text-anchor="start" x="65.5" y="-47.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-41 89.5,-62 226.5,-62 226.5,-41 89.5,-41"/>
<text text-anchor="start" x="134.5" y="-47.8" font-family="Times,serif" font-size="14.00">Digest</text>
<polygon fill="none" stroke="black" points="226.5,-41 226.5,-62 331.5,-62 331.5,-41 226.5,-41"/>
<text text-anchor="start" x="253" y="-47.8" font-family="Times,serif" font-size="14.00">digests</text>
<polygon fill="none" stroke="black" points="24.5,-20 24.5,-41 331.5,-41 331.5,-20 24.5,-20"/>
<text text-anchor="start" x="63.5" y="-26.8" font-family="Times,serif" font-size="14.00">repeat num_digests.value times</text>
</g>
<!-- digest__seq -->
<g id="node2" class="node">
<title>digest__seq</title>
<g id="a_node2"><a xlink:href="#digest" xlink:title="Digest">
<text text-anchor="middle" x="406.5" y="-47.3" font-family="Times,serif" font-size="14.00">Digest</text>
</a>
</g>
</g>
<!-- block_header__seq&#45;&gt;digest__seq -->
<g id="edge1" class="edge">
<title>block_header__seq:digests_type&#45;&gt;digest__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M332.5,-51C342.96,-51 354.25,-51 364.77,-51"/>
<polygon fill="black" stroke="black" stroke-width="2" points="364.95,-54.5 374.95,-51 364.95,-47.5 364.95,-54.5"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 1. Block Header</div>
</div>
<div id="defn-digest" class="exampleblock">
<div class="title">Definition 11. <a href="#defn-digest">Header Digest</a></div>
<div class="content">
<div class="paragraph">
<p>The header <strong>digest</strong> of block \$B\$ formally referred to by \$H_d (B)\$ is
an array of <strong>digest items</strong> \$H_d^i\$’s, known as digest items of varying data
type (<a href="#defn-varrying-data-type">Definition 188</a>) such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$H_d(B) := H_d^1, ..., H_d^n\$
</div>
</div>
<div class="paragraph">
<p>where each digest item can hold one of the following type identifiers:</p>
</div>
<div class="stemblock">
<div class="content">
\$H_d^i = {
	(4, to, (t, "id", m)),
	(5, to, (t, "id", m)),
	(6, to, (t, "id", m)),
	(8, to, (t))
:}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"id"\$ is a 4-byte ASCII encoded consensus engine identifier</p>
</li>
<li>
<p>\$"m"\$ is a scale encoded byte array containing the message payload</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
\$t = 4\$
</td>
<td class="hdlist2">
<p><strong>Consensus Message</strong>, contains scale-encoded message  \$m\$ from the Runtime to the consensus engine. The receiving engine is determined by the \$"id"\$ identifier:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">\$"id" = tt "BABE"\$</dt>
<dd>
<p>a message to BABE engine (<a href="#defn-consensus-message-babe">Definition 58</a>)</p>
</dd>
<dt class="hdlist1">\$"id" = tt "FRNK"\$</dt>
<dd>
<p>a message to GRANDPA engine (<a href="#defn-consensus-message-grandpa">Definition 86</a>)</p>
</dd>
<dt class="hdlist1">\$"id" = tt "BEEF"\$</dt>
<dd>
<p>a message to BEEFY engine (<a href="#defn-consensus-message-beefy">Definition 87</a>)</p>
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
\$t = 5\$
</td>
<td class="hdlist2">
<p><strong>Seal</strong>, is produced by the consensus engine and proves
the authorship of the block producer. The engine used for this is provided through \$"id"\$ (at the moment <code>BABE</code>), while \$m\$ contains the scale-encoded signature (<a href="#defn-block-signature">Definition 70</a>) of the block producer. In particular, the
Seal digest item must be the last item in the digest array and must be stripped
off by the Polkadot Host before the block is submitted to any Runtime function
including for validation. The Seal must be added back to the digest afterward.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
\$t = 6\$
</td>
<td class="hdlist2">
<p><strong>Pre-Runtime</strong> digest, contains messages from the consensus engines to the runtime.
Currently only used by BABE to pass the scale encoded BABE Header (<a href="#defn-babe-header">Definition 69</a>) in \$m\$ with \$"id" = tt "BABE"\$</p>
</td>
</tr>
<tr>
<td class="hdlist1">
\$t = 8\$
</td>
<td class="hdlist2">
<p><strong>Runtime Environment Updated</strong> digest, indicates that
changes regarding the Runtime code or heap pages (<a href="#sect-memory-management">Section 2.6.3.1</a>)
occurred. No additional data is provided.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="digest" class="imageblock">
<div class="content">
<svg width="889pt" height="495pt"
 viewBox="0.00 0.00 889.00 495.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 491)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-491 885,-491 885,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__digest</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-479 873,-479 873,-8 8,-8"/>
<text text-anchor="middle" x="440.5" y="-463.8" font-family="Times,serif" font-size="14.00">Digest</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__pre_runtime</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="612,-337 612,-448 865,-448 865,-337 612,-337"/>
<text text-anchor="middle" x="738.5" y="-432.8" font-family="Times,serif" font-size="14.00">Digest::PreRuntime</text>
</g>
<g id="clust3" class="cluster">
<title>cluster__post_runtime</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="612,-218 612,-329 865,-329 865,-218 612,-218"/>
<text text-anchor="middle" x="738.5" y="-313.8" font-family="Times,serif" font-size="14.00">Digest::PostRuntime</text>
</g>
<g id="clust4" class="cluster">
<title>cluster__seal</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="612,-99 612,-210 865,-210 865,-99 612,-99"/>
<text text-anchor="middle" x="738.5" y="-194.8" font-family="Times,serif" font-size="14.00">Digest::Seal</text>
</g>
<g id="clust5" class="cluster">
<title>cluster__empty</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="661,-16 661,-91 816,-91 816,-16 661,-16"/>
<text text-anchor="middle" x="738.5" y="-75.8" font-family="Times,serif" font-size="14.00">Digest::Empty</text>
</g>
<!-- digest__seq -->
<g id="node1" class="node">
<title>digest__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24,-246 24,-267 55,-267 55,-246 24,-246"/>
<polygon fill="none" stroke="black" points="24,-246 24,-267 55,-267 55,-246 24,-246"/>
<text text-anchor="start" x="27" y="-252.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55,-246 55,-267 89,-267 89,-246 55,-246"/>
<polygon fill="none" stroke="black" points="55,-246 55,-267 89,-267 89,-246 55,-246"/>
<text text-anchor="start" x="58" y="-252.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89,-246 89,-267 189,-267 189,-246 89,-246"/>
<polygon fill="none" stroke="black" points="89,-246 89,-267 189,-267 189,-246 89,-246"/>
<text text-anchor="start" x="123" y="-252.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="189,-246 189,-267 234,-267 234,-246 189,-246"/>
<polygon fill="none" stroke="black" points="189,-246 189,-267 234,-267 234,-246 189,-246"/>
<text text-anchor="start" x="204.5" y="-252.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-225 24,-246 55,-246 55,-225 24,-225"/>
<text text-anchor="start" x="34.5" y="-231.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55,-225 55,-246 89,-246 89,-225 55,-225"/>
<text text-anchor="start" x="67" y="-231.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-225 89,-246 189,-246 189,-225 89,-225"/>
<text text-anchor="start" x="99.5" y="-231.8" font-family="Times,serif" font-size="14.00">u1→TypeId</text>
<polygon fill="none" stroke="black" points="189,-225 189,-246 234,-246 234,-225 189,-225"/>
<text text-anchor="start" x="195.5" y="-231.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="24,-204 24,-225 55,-225 55,-204 24,-204"/>
<text text-anchor="start" x="34.5" y="-210.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="55,-204 55,-225 89,-225 89,-204 55,-204"/>
<text text-anchor="start" x="65" y="-210.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-204 89,-225 189,-225 189,-204 89,-204"/>
<text text-anchor="start" x="92" y="-210.8" font-family="Times,serif" font-size="14.00">switch (type)</text>
<polygon fill="none" stroke="black" points="189,-204 189,-225 234,-225 234,-204 189,-204"/>
<text text-anchor="start" x="192" y="-210.8" font-family="Times,serif" font-size="14.00">value</text>
</g>
<!-- digest__seq&#45;&gt;digest__seq -->
<g id="edge6" class="edge">
<title>digest__seq:type_type&#45;&gt;digest__seq:value_type</title>
<path fill="none" stroke="#404040" d="M188.91,-241.83C137.5,-260.8 145.2,-289.5 212,-289.5 275.04,-289.5 285.44,-249.3 243.21,-225.65"/>
<polygon fill="#404040" stroke="#404040" points="244.58,-222.42 234.06,-221.15 241.5,-228.7 244.58,-222.42"/>
</g>
<!-- digest__seq_value_switch -->
<g id="node2" class="node">
<title>digest__seq_value_switch</title>
<polygon fill="#f0f2e4" stroke="transparent" points="286,-245 286,-266 478,-266 478,-245 286,-245"/>
<polygon fill="none" stroke="black" points="286,-245 286,-266 478,-266 478,-245 286,-245"/>
<text text-anchor="start" x="366" y="-251.8" font-family="Times,serif" font-size="14.00">case</text>
<polygon fill="#f0f2e4" stroke="transparent" points="478,-245 478,-266 576,-266 576,-245 478,-245"/>
<polygon fill="none" stroke="black" points="478,-245 478,-266 576,-266 576,-245 478,-245"/>
<text text-anchor="start" x="511" y="-251.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="286,-224 286,-245 478,-245 478,-224 286,-224"/>
<text text-anchor="start" x="306.5" y="-230.8" font-family="Times,serif" font-size="14.00">:type_id_pre_runtime</text>
<polygon fill="none" stroke="black" points="478,-224 478,-245 576,-245 576,-224 478,-224"/>
<text text-anchor="start" x="484" y="-230.8" font-family="Times,serif" font-size="14.00">PreRuntime</text>
<polygon fill="none" stroke="black" points="286,-203 286,-224 478,-224 478,-203 286,-203"/>
<text text-anchor="start" x="303" y="-209.8" font-family="Times,serif" font-size="14.00">:type_id_post_runtime</text>
<polygon fill="none" stroke="black" points="478,-203 478,-224 576,-224 576,-203 478,-203"/>
<text text-anchor="start" x="481" y="-209.8" font-family="Times,serif" font-size="14.00">PostRuntime</text>
<polygon fill="none" stroke="black" points="286,-182 286,-203 478,-203 478,-182 286,-182"/>
<text text-anchor="start" x="336" y="-188.8" font-family="Times,serif" font-size="14.00">:type_id_seal</text>
<polygon fill="none" stroke="black" points="478,-182 478,-203 576,-203 576,-182 478,-182"/>
<text text-anchor="start" x="511.5" y="-188.8" font-family="Times,serif" font-size="14.00">Seal</text>
<polygon fill="none" stroke="black" points="286,-161 286,-182 478,-182 478,-161 286,-161"/>
<text text-anchor="start" x="289" y="-167.8" font-family="Times,serif" font-size="14.00">:type_id_runtime_updated</text>
<polygon fill="none" stroke="black" points="478,-161 478,-182 576,-182 576,-161 478,-161"/>
<text text-anchor="start" x="503" y="-167.8" font-family="Times,serif" font-size="14.00">Empty</text>
</g>
<!-- digest__seq&#45;&gt;digest__seq_value_switch -->
<g id="edge1" class="edge">
<title>digest__seq:value_type&#45;&gt;digest__seq_value_switch</title>
<path fill="none" stroke="black" stroke-width="2" d="M235,-214C245.63,-214 256.58,-214 267.62,-214"/>
<polygon fill="black" stroke="black" stroke-width="2" points="267.77,-217.5 277.77,-214 267.77,-210.5 267.77,-217.5"/>
</g>
<!-- pre_runtime__seq -->
<g id="node3" class="node">
<title>pre_runtime__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="628.5,-391 628.5,-412 659.5,-412 659.5,-391 628.5,-391"/>
<polygon fill="none" stroke="black" points="628.5,-391 628.5,-412 659.5,-412 659.5,-391 628.5,-391"/>
<text text-anchor="start" x="631.5" y="-397.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="659.5,-391 659.5,-412 693.5,-412 693.5,-391 659.5,-391"/>
<polygon fill="none" stroke="black" points="659.5,-391 659.5,-412 693.5,-412 693.5,-391 659.5,-391"/>
<text text-anchor="start" x="662.5" y="-397.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="693.5,-391 693.5,-412 787.5,-412 787.5,-391 693.5,-391"/>
<polygon fill="none" stroke="black" points="693.5,-391 693.5,-412 787.5,-412 787.5,-391 693.5,-391"/>
<text text-anchor="start" x="724.5" y="-397.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="787.5,-391 787.5,-412 849.5,-412 849.5,-391 787.5,-391"/>
<polygon fill="none" stroke="black" points="787.5,-391 787.5,-412 849.5,-412 849.5,-391 787.5,-391"/>
<text text-anchor="start" x="811.5" y="-397.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="628.5,-370 628.5,-391 659.5,-391 659.5,-370 628.5,-370"/>
<text text-anchor="start" x="639" y="-376.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="659.5,-370 659.5,-391 693.5,-391 693.5,-370 659.5,-370"/>
<text text-anchor="start" x="671.5" y="-376.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="693.5,-370 693.5,-391 787.5,-391 787.5,-370 693.5,-370"/>
<text text-anchor="start" x="704.5" y="-376.8" font-family="Times,serif" font-size="14.00">str(ASCII)</text>
<polygon fill="none" stroke="black" points="787.5,-370 787.5,-391 849.5,-391 849.5,-370 787.5,-370"/>
<text text-anchor="start" x="794" y="-376.8" font-family="Times,serif" font-size="14.00">engine</text>
<polygon fill="none" stroke="black" points="628.5,-349 628.5,-370 659.5,-370 659.5,-349 628.5,-349"/>
<text text-anchor="start" x="639" y="-355.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="659.5,-349 659.5,-370 693.5,-370 693.5,-349 659.5,-349"/>
<text text-anchor="start" x="669.5" y="-355.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="693.5,-349 693.5,-370 787.5,-370 787.5,-349 693.5,-349"/>
<text text-anchor="start" x="696.5" y="-355.8" font-family="Times,serif" font-size="14.00">Scale::Bytes</text>
<polygon fill="none" stroke="black" points="787.5,-349 787.5,-370 849.5,-370 849.5,-349 787.5,-349"/>
<text text-anchor="start" x="790.5" y="-355.8" font-family="Times,serif" font-size="14.00">payload</text>
</g>
<!-- digest__seq_value_switch&#45;&gt;pre_runtime__seq -->
<g id="edge2" class="edge">
<title>digest__seq_value_switch:case0&#45;&gt;pre_runtime__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M577,-235C623.25,-235 579.66,-299.93 612,-333 614.06,-335.11 616.23,-337.13 618.49,-339.06"/>
<polygon fill="black" stroke="black" stroke-width="2" points="616.43,-341.9 626.47,-345.3 620.74,-336.38 616.43,-341.9"/>
</g>
<!-- post_runtime__seq -->
<g id="node4" class="node">
<title>post_runtime__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="628.5,-272 628.5,-293 659.5,-293 659.5,-272 628.5,-272"/>
<polygon fill="none" stroke="black" points="628.5,-272 628.5,-293 659.5,-293 659.5,-272 628.5,-272"/>
<text text-anchor="start" x="631.5" y="-278.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="659.5,-272 659.5,-293 693.5,-293 693.5,-272 659.5,-272"/>
<polygon fill="none" stroke="black" points="659.5,-272 659.5,-293 693.5,-293 693.5,-272 659.5,-272"/>
<text text-anchor="start" x="662.5" y="-278.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="693.5,-272 693.5,-293 787.5,-293 787.5,-272 693.5,-272"/>
<polygon fill="none" stroke="black" points="693.5,-272 693.5,-293 787.5,-293 787.5,-272 693.5,-272"/>
<text text-anchor="start" x="724.5" y="-278.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="787.5,-272 787.5,-293 849.5,-293 849.5,-272 787.5,-272"/>
<polygon fill="none" stroke="black" points="787.5,-272 787.5,-293 849.5,-293 849.5,-272 787.5,-272"/>
<text text-anchor="start" x="811.5" y="-278.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="628.5,-251 628.5,-272 659.5,-272 659.5,-251 628.5,-251"/>
<text text-anchor="start" x="639" y="-257.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="659.5,-251 659.5,-272 693.5,-272 693.5,-251 659.5,-251"/>
<text text-anchor="start" x="671.5" y="-257.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="693.5,-251 693.5,-272 787.5,-272 787.5,-251 693.5,-251"/>
<text text-anchor="start" x="704.5" y="-257.8" font-family="Times,serif" font-size="14.00">str(ASCII)</text>
<polygon fill="none" stroke="black" points="787.5,-251 787.5,-272 849.5,-272 849.5,-251 787.5,-251"/>
<text text-anchor="start" x="794" y="-257.8" font-family="Times,serif" font-size="14.00">engine</text>
<polygon fill="none" stroke="black" points="628.5,-230 628.5,-251 659.5,-251 659.5,-230 628.5,-230"/>
<text text-anchor="start" x="639" y="-236.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="659.5,-230 659.5,-251 693.5,-251 693.5,-230 659.5,-230"/>
<text text-anchor="start" x="669.5" y="-236.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="693.5,-230 693.5,-251 787.5,-251 787.5,-230 693.5,-230"/>
<text text-anchor="start" x="696.5" y="-236.8" font-family="Times,serif" font-size="14.00">Scale::Bytes</text>
<polygon fill="none" stroke="black" points="787.5,-230 787.5,-251 849.5,-251 849.5,-230 787.5,-230"/>
<text text-anchor="start" x="790.5" y="-236.8" font-family="Times,serif" font-size="14.00">payload</text>
</g>
<!-- digest__seq_value_switch&#45;&gt;post_runtime__seq -->
<g id="edge3" class="edge">
<title>digest__seq_value_switch:case1&#45;&gt;post_runtime__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M577,-213C599.23,-213 622.47,-217.35 644.14,-223.47"/>
<polygon fill="black" stroke="black" stroke-width="2" points="643.4,-226.9 653.98,-226.39 645.39,-220.19 643.4,-226.9"/>
</g>
<!-- seal__seq -->
<g id="node5" class="node">
<title>seal__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="628.5,-153 628.5,-174 659.5,-174 659.5,-153 628.5,-153"/>
<polygon fill="none" stroke="black" points="628.5,-153 628.5,-174 659.5,-174 659.5,-153 628.5,-153"/>
<text text-anchor="start" x="631.5" y="-159.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="659.5,-153 659.5,-174 693.5,-174 693.5,-153 659.5,-153"/>
<polygon fill="none" stroke="black" points="659.5,-153 659.5,-174 693.5,-174 693.5,-153 659.5,-153"/>
<text text-anchor="start" x="662.5" y="-159.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="693.5,-153 693.5,-174 787.5,-174 787.5,-153 693.5,-153"/>
<polygon fill="none" stroke="black" points="693.5,-153 693.5,-174 787.5,-174 787.5,-153 693.5,-153"/>
<text text-anchor="start" x="724.5" y="-159.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="787.5,-153 787.5,-174 849.5,-174 849.5,-153 787.5,-153"/>
<polygon fill="none" stroke="black" points="787.5,-153 787.5,-174 849.5,-174 849.5,-153 787.5,-153"/>
<text text-anchor="start" x="811.5" y="-159.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="628.5,-132 628.5,-153 659.5,-153 659.5,-132 628.5,-132"/>
<text text-anchor="start" x="639" y="-138.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="659.5,-132 659.5,-153 693.5,-153 693.5,-132 659.5,-132"/>
<text text-anchor="start" x="671.5" y="-138.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="693.5,-132 693.5,-153 787.5,-153 787.5,-132 693.5,-132"/>
<text text-anchor="start" x="704.5" y="-138.8" font-family="Times,serif" font-size="14.00">str(ASCII)</text>
<polygon fill="none" stroke="black" points="787.5,-132 787.5,-153 849.5,-153 849.5,-132 787.5,-132"/>
<text text-anchor="start" x="794" y="-138.8" font-family="Times,serif" font-size="14.00">engine</text>
<polygon fill="none" stroke="black" points="628.5,-111 628.5,-132 659.5,-132 659.5,-111 628.5,-111"/>
<text text-anchor="start" x="639" y="-117.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="659.5,-111 659.5,-132 693.5,-132 693.5,-111 659.5,-111"/>
<text text-anchor="start" x="669.5" y="-117.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="693.5,-111 693.5,-132 787.5,-132 787.5,-111 693.5,-111"/>
<text text-anchor="start" x="696.5" y="-117.8" font-family="Times,serif" font-size="14.00">Scale::Bytes</text>
<polygon fill="none" stroke="black" points="787.5,-111 787.5,-132 849.5,-132 849.5,-111 787.5,-111"/>
<text text-anchor="start" x="790.5" y="-117.8" font-family="Times,serif" font-size="14.00">payload</text>
</g>
<!-- digest__seq_value_switch&#45;&gt;seal__seq -->
<g id="edge4" class="edge">
<title>digest__seq_value_switch:case2&#45;&gt;seal__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M577,-192C599.23,-192 622.47,-187.65 644.14,-181.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="645.39,-184.81 653.98,-178.61 643.4,-178.1 645.39,-184.81"/>
</g>
<!-- empty__seq -->
<g id="node6" class="node">
<title>empty__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="677.5,-31 677.5,-52 708.5,-52 708.5,-31 677.5,-31"/>
<polygon fill="none" stroke="black" points="677.5,-31 677.5,-52 708.5,-52 708.5,-31 677.5,-31"/>
<text text-anchor="start" x="680.5" y="-37.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="708.5,-31 708.5,-52 742.5,-52 742.5,-31 708.5,-31"/>
<polygon fill="none" stroke="black" points="708.5,-31 708.5,-52 742.5,-52 742.5,-31 708.5,-31"/>
<text text-anchor="start" x="711.5" y="-37.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="742.5,-31 742.5,-52 780.5,-52 780.5,-31 742.5,-31"/>
<polygon fill="none" stroke="black" points="742.5,-31 742.5,-52 780.5,-52 780.5,-31 742.5,-31"/>
<text text-anchor="start" x="745.5" y="-37.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="780.5,-31 780.5,-52 800.5,-52 800.5,-31 780.5,-31"/>
<polygon fill="none" stroke="black" points="780.5,-31 780.5,-52 800.5,-52 800.5,-31 780.5,-31"/>
<text text-anchor="start" x="783.5" y="-37.8" font-family="Times,serif" font-size="14.00">id</text>
</g>
<!-- digest__seq_value_switch&#45;&gt;empty__seq -->
<g id="edge5" class="edge">
<title>digest__seq_value_switch:case3&#45;&gt;empty__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M577,-171C614.19,-171 585.29,-120.87 612,-95 625.55,-81.88 642.83,-71.79 660.21,-64.12"/>
<polygon fill="black" stroke="black" stroke-width="2" points="661.96,-67.18 669.85,-60.1 659.27,-60.72 661.96,-67.18"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 2. Block Header Digest</div>
</div>
<div id="defn-block-header-hash" class="exampleblock">
<div class="title">Definition 12. <a href="#defn-block-header-hash">Header Hash</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>block header hash of block \$B\$</strong>, \$H_h(B)\$, is the hash of the
header of block \$B\$ encoded by simple codec:</p>
</div>
<div class="stemblock">
<div class="content">
\$H_h(B) := "Blake2b"("Enc"_(SC)("Head"(B)))\$
</div>
</div>
</div>
</div>
<div id="defn-block-body" class="exampleblock">
<div class="title">Definition 13. <a href="#defn-block-body">Block Body</a></div>
<div class="content">
<div class="paragraph">
<p>The block body consists of an sequence of extrinsics, each encoded as a byte
array. The content of an extrinsic is completely opaque to the Polkadot Host. As
such, from the point of the Polkadot Host, and is simply a SCALE encoded array
of byte arrays. The <strong>body of Block</strong> \$B\$ represented as \$"Body"(B)\$ is
defined to be:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Body"(B) := "Enc"_(SC)(E_1,...,E_n)\$
</div>
</div>
<div class="paragraph">
<p>Where each \$E_i in bbb B\$ is a SCALE encoded extrinsic.</p>
</div>
<div id="block_body" class="imageblock">
<div class="content">
<svg width="795pt" height="174pt"
 viewBox="0.00 0.00 795.00 174.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 170)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-170 791,-170 791,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__block_body</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-158 779,-158 779,-8 8,-8"/>
<text text-anchor="middle" x="393.5" y="-142.8" font-family="Times,serif" font-size="14.00">BlockBody</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__transaction</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="395,-16 395,-127 771,-127 771,-16 395,-16"/>
<text text-anchor="middle" x="583" y="-111.8" font-family="Times,serif" font-size="14.00">BlockBody::Transaction</text>
</g>
<!-- block_body__seq -->
<g id="node1" class="node">
<title>block_body__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-92 24.5,-113 55.5,-113 55.5,-92 24.5,-92"/>
<polygon fill="none" stroke="black" points="24.5,-92 24.5,-113 55.5,-113 55.5,-92 24.5,-92"/>
<text text-anchor="start" x="27.5" y="-98.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-92 55.5,-113 89.5,-113 89.5,-92 55.5,-92"/>
<polygon fill="none" stroke="black" points="55.5,-92 55.5,-113 89.5,-113 89.5,-92 55.5,-92"/>
<text text-anchor="start" x="58.5" y="-98.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-92 89.5,-113 226.5,-113 226.5,-92 89.5,-92"/>
<polygon fill="none" stroke="black" points="89.5,-92 89.5,-113 226.5,-113 226.5,-92 89.5,-92"/>
<text text-anchor="start" x="142" y="-98.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226.5,-92 226.5,-113 359.5,-113 359.5,-92 226.5,-92"/>
<polygon fill="none" stroke="black" points="226.5,-92 226.5,-113 359.5,-113 359.5,-92 226.5,-92"/>
<text text-anchor="start" x="286" y="-98.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-71 24.5,-92 55.5,-92 55.5,-71 24.5,-71"/>
<text text-anchor="start" x="35" y="-77.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-71 55.5,-92 89.5,-92 89.5,-71 55.5,-71"/>
<text text-anchor="start" x="65.5" y="-77.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-71 89.5,-92 226.5,-92 226.5,-71 89.5,-71"/>
<text text-anchor="start" x="92.5" y="-77.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226.5,-71 226.5,-92 359.5,-92 359.5,-71 226.5,-71"/>
<text text-anchor="start" x="229.5" y="-77.8" font-family="Times,serif" font-size="14.00">num_transactions</text>
<polygon fill="none" stroke="black" points="24.5,-50 24.5,-71 55.5,-71 55.5,-50 24.5,-50"/>
<text text-anchor="start" x="33" y="-56.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-50 55.5,-71 89.5,-71 89.5,-50 55.5,-50"/>
<text text-anchor="start" x="65.5" y="-56.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-50 89.5,-71 226.5,-71 226.5,-50 89.5,-50"/>
<text text-anchor="start" x="115.5" y="-56.8" font-family="Times,serif" font-size="14.00">Transaction</text>
<polygon fill="none" stroke="black" points="226.5,-50 226.5,-71 359.5,-71 359.5,-50 226.5,-50"/>
<text text-anchor="start" x="248.5" y="-56.8" font-family="Times,serif" font-size="14.00">transactions</text>
<polygon fill="none" stroke="black" points="24.5,-29 24.5,-50 359.5,-50 359.5,-29 24.5,-29"/>
<text text-anchor="start" x="59.5" y="-35.8" font-family="Times,serif" font-size="14.00">repeat num_transactions.value times</text>
</g>
<!-- transaction__seq -->
<g id="node2" class="node">
<title>transaction__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="411,-70 411,-91 442,-91 442,-70 411,-70"/>
<polygon fill="none" stroke="black" points="411,-70 411,-91 442,-91 442,-70 411,-70"/>
<text text-anchor="start" x="414" y="-76.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="442,-70 442,-91 551,-91 551,-70 442,-70"/>
<polygon fill="none" stroke="black" points="442,-70 442,-91 551,-91 551,-70 442,-70"/>
<text text-anchor="start" x="482.5" y="-76.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="551,-70 551,-91 688,-91 688,-70 551,-70"/>
<polygon fill="none" stroke="black" points="551,-70 551,-91 688,-91 688,-70 551,-70"/>
<text text-anchor="start" x="603.5" y="-76.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="688,-70 688,-91 755,-91 755,-70 688,-70"/>
<polygon fill="none" stroke="black" points="688,-70 688,-91 755,-91 755,-70 688,-70"/>
<text text-anchor="start" x="714.5" y="-76.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="411,-49 411,-70 442,-70 442,-49 411,-49"/>
<text text-anchor="start" x="421.5" y="-55.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="442,-49 442,-70 551,-70 551,-49 442,-49"/>
<text text-anchor="start" x="489.5" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="551,-49 551,-70 688,-70 688,-49 551,-49"/>
<text text-anchor="start" x="554" y="-55.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="688,-49 688,-70 755,-70 755,-49 688,-49"/>
<text text-anchor="start" x="691" y="-55.8" font-family="Times,serif" font-size="14.00">len_data</text>
<polygon fill="none" stroke="black" points="411,-28 411,-49 442,-49 442,-28 411,-28"/>
<text text-anchor="start" x="419.5" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="442,-28 442,-49 551,-49 551,-28 442,-28"/>
<text text-anchor="start" x="445" y="-34.8" font-family="Times,serif" font-size="14.00">len_data.value</text>
<polygon fill="none" stroke="black" points="551,-28 551,-49 688,-49 688,-28 551,-28"/>
<polygon fill="none" stroke="black" points="688,-28 688,-49 755,-49 755,-28 688,-28"/>
<text text-anchor="start" x="705.5" y="-34.8" font-family="Times,serif" font-size="14.00">data</text>
</g>
<!-- block_body__seq&#45;&gt;transaction__seq -->
<g id="edge1" class="edge">
<title>block_body__seq:transactions_type&#45;&gt;transaction__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M360.5,-60C371.03,-60 381.83,-60 392.74,-60"/>
<polygon fill="black" stroke="black" stroke-width="2" points="392.78,-63.5 402.78,-60 392.78,-56.5 392.78,-63.5"/>
</g>
</g>
</svg>

</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-extrinsics"><a class="anchor" href="#sect-extrinsics"></a><a class="link" href="#sect-extrinsics">2.3. Extrinsics</a></h3>
<div class="paragraph">
<p>The block body consists of an array of extrinsics. In a broad sense,
extrinsics are data from outside of the state which can trigger state transitions. This section describes extrinsics and their inclusion into blocks.</p>
</div>
<div class="sect3">
<h4 id="id-preliminaries"><a class="anchor" href="#id-preliminaries"></a><a class="link" href="#id-preliminaries">2.3.1. Preliminaries</a></h4>
<div class="paragraph">
<p>The extrinsics are divided into two main categories defined as follows:</p>
</div>
<div class="paragraph">
<p><strong>Transaction extrinsics</strong> are extrinsics which are signed using either of the key
types (<a href="#sect-cryptographic-keys">Section A.1.4</a>) and broadcasted between the nodes. <strong>Inherent
extrinsics</strong> are unsigned extrinsics which are generated by Polkadot Host and
only included in the blocks produced by the node itself. They are broadcasted as
part of the produced blocks rather than being gossiped as individual extrinsics.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host does not specify or limit the internals of each extrinsics and
those are defined and dealt with by the Runtime (<a href="#defn-state-machine">Definition 1</a>). From the
Polkadot Host point of view, each extrinsics is simply a SCALE-encoded blob
(<a href="#sect-scale-codec">Section A.2.2</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="id-transactions"><a class="anchor" href="#id-transactions"></a><a class="link" href="#id-transactions">2.3.2. Transactions</a></h4>
<div class="paragraph">
<p>Transaction are submitted and exchanged through <em>Transactions</em> network messages
(<a href="#sect-msg-transactions">Section 4.8.5</a>). Upon receiving a Transactions message, the Polkadot
Host decodes the SCALE-encoded blob and splits it into individually
SCALE-encoded transactions.</p>
</div>
<div class="paragraph">
<p>Alternative transaction can be submitted to the host by offchain worker through
the Host API (<a href="#sect-ext-offchain-submit-transaction">Section B.6.2</a>).</p>
</div>
<div class="paragraph">
<p>Any new transaction should be submitted to the Runtime
(<a href="#sect-rte-validate-transaction">Section C.7.1</a>). This will allow the Polkadot Host to check
the validity of the received transaction against the current stat and if it
should be gossiped to other peers. If it considers the submitted transaction as
valid, the Polkadot Host should store it for inclusion in future blocks. The
whole process of handling new transactions is described in more detail by
<a href="#algo-validate-transactions">Algorithm 1</a>.</p>
</div>
<div class="paragraph">
<p>Additionally valid transactions that are supposed to be gossiped are
propagated to connected peers of the Polkadot Host. While doing so the
Polkadot Host should keep track of peers already aware of each
transaction. This includes peers which have already gossiped the
transaction to the node as well as those to whom the transaction has
already been sent. This behavior is mandated to avoid resending
duplicates and unnecessarily overloading the network. To that aim, the
Polkadot Host should keep a <em>transaction pool</em> and a <em>transaction queue</em>
defined as follows:</p>
</div>
<div id="defn-transaction-queue" class="exampleblock">
<div class="title">Definition 14. <a href="#defn-transaction-queue">Transaction Queue</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Transaction Queue</strong> of a block producer node, formally referred to as
\$TQ\$ is a data structure which stores the transactions ready to be included
in a block sorted according to their priorities (<a href="#sect-msg-transactions">Section 4.8.5</a>). The
<strong>Transaction Pool</strong>, formally referred to as \$TP\$, is a hash table in which
the Polkadot Host keeps the list of all valid transactions not in the
transaction queue.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Furthermore <a href="#algo-validate-transactions">Algorithm 1</a> updates the transaction pool and
the transaction queue according to the received message:</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-validate-transactions" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 1 </span><span style="font-style:normal;font-variant:small-caps;">Validate-Transactions-and-Store</span></p>
<div class="ps-algorithmic with-linenum">
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>←</mo><mi>D</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>S</mi><mi>C</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>M</mi><mi>T</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L \leftarrow Dec_{SC}(M_T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">De</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">SC</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for all </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>T</mi><mo>∈</mo><mi>L</mi><mo>∣</mo><mi>T</mi><mo mathvariant="normal">∉</mo><mi>T</mi><mi>Q</mi><mo>∣</mo><mi>T</mi><mo mathvariant="normal">∉</mo><mi>T</mi><mi>P</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{T \in L \mid T \notin TQ \mid T \notin TP\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">TQ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">TP</span><span class="mclose">}</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>d</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">B_d \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Head</span>(<span class="ps-funcname">Longest-Chain</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">BT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">BT</span></span></span></span>))</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>←</mo><msub><mi>H</mi><mi>n</mi></msub><mo stretchy="false">(</mo><msub><mi>B</mi><mi>d</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N \leftarrow H_n(B_d)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">R \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">TaggedTransactionQueue_validate_transaction</mtext><mo separator="true">,</mo><mi>N</mi><mo separator="true">,</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">\texttt{TaggedTransactionQueue\_validate\_transaction}, N, T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9055em;vertical-align:-0.2222em;"></span><span class="mord text"><span class="mord texttt">TaggedTransactionQueue_validate_transaction</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="ps-keyword">if </span><span class="ps-funcname">Valid</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>)<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="ps-keyword">if </span><span class="ps-funcname">Requires</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊂</mo><msub><mo>⋃</mo><mrow><mi mathvariant="normal">∀</mi><mi>T</mi><mo>∈</mo><mo stretchy="false">(</mo><mi>T</mi><mi>Q</mi><mtext> </mtext><mo>∪</mo><mtext> </mtext><msub><mi>B</mi><mi>i</mi></msub><mo>∣</mo><mi mathvariant="normal">∃</mi><mi>i</mi><mo>&lt;</mo><mi>d</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex"> \subset \bigcup_{\forall T \in (TQ~\cup~B_i \mid \exists i &lt; d)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">⊂</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2247em;vertical-align:-0.4747em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2253em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∀</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mrel mtight">∈</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">TQ</span><span class="mspace nobreak mtight"><span class="mtight"> </span></span><span class="mbin mtight">∪</span><span class="mspace nobreak mtight"><span class="mtight"> </span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0502em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mtight">∃</span><span class="mord mathnormal mtight">i</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4747em;"><span></span></span></span></span></span></span></span></span></span> <span class="ps-funcname">Provided-Tags</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>)<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-4.5em;">8:</span><span class="ps-funcname">Insert-At</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>Q</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">TQ, T, </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">TQ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span></span></span></span><span class="ps-funcname">Requires</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">, </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span></span></span></span><span class="ps-funcname">Priority</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>))</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">9:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-4.5em;">10:</span><span class="ps-funcname">Add-To</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>P</mi><mo separator="true">,</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">TP,T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">TP</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">11:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">12:</span><span class="ps-funcname">Maintain-Transaction-Pool</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">13:</span><span class="ps-keyword">if </span><span class="ps-funcname">ShouldPropagate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>)<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-4.5em;">14:</span><span class="ps-funcname">Propagate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">15:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">16:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">17:</span><span class="ps-keyword">end for</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 1. <a href="#algo-validate-transactions">Validate-Transactions-and-Store</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M_T\$ is the transaction message (offchain transactions?)</p>
</li>
<li>
<p>\$"Dec"_(SC)\$ decodes the SCALE encoded message.</p>
</li>
<li>
<p>\$"Longest-Chain"\$ is defined in <a href="#defn-longest-chain">Definition 7</a>.</p>
</li>
<li>
<p>\$tt "TaggedTransactionQueue_validate_transaction"\$ is a Runtime entrypoint
specified in <a href="#sect-rte-validate-transaction">Section C.7.1</a> and \$Requires(R)\$,
\$Priority(R)\$ and \$Propagate(R)\$ refer to the corresponding fields in
the tuple returned by the entrypoint when it deems that \$T\$ is valid.</p>
</li>
<li>
<p>\$"Provided-Tags"(T)\$ is the list of tags that transaction \$T\$
provides. The Polkadot Host needs to keep track of tags that transaction
\$T\$ provides as well as requires after validating it.</p>
</li>
<li>
<p>\$"Insert-At"(TQ,T,"Requires"(R),"Priority"(R))\$ places \$T\$
into \$TQ\$ approperietly such
that the transactions providing the tags which \$T\$ requires
or have higher priority than \$T\$ are ahead of
\$T\$.</p>
</li>
<li>
<p>\$"Maintain-Transaction-Pool"\$ is described in <a href="#algo-maintain-transaction-pool">Algorithm 2</a>.</p>
</li>
<li>
<p>\$"ShouldPropagate"\$ indictes whether the transaction should be propagated
based on the <code>Propagate</code> field in the <code>ValidTransaction</code> type as defined in
<a href="#defn-valid-transaction">Definition 225</a>, which is returned by \$tt
"TaggedTransactionQueue_validate_transaction"\$.</p>
</li>
<li>
<p>\$"Propagate"(T)\$ sends \$T\$ to all connected
peers of the Polkadot Host who are not already aware of \$T\$.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-maintain-transaction-pool" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 2 </span><span style="font-style:normal;font-variant:small-caps;">Maintain-Transaction-Pool</span></p>
<div class="ps-algorithmic with-linenum">
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span>Scan the pool for ready transactions</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span>Move them to the transaction queue</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span>Drop invalid transactions</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 2. <a href="#algo-maintain-transaction-pool">Maintain-Transaction-Pool</a></div>
          </div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This has not been defined yet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-inherents"><a class="anchor" href="#sect-inherents"></a><a class="link" href="#sect-inherents">2.3.3. Inherents</a></h4>
<div class="paragraph">
<p>Inherents are unsigned extrinsics inserted into a block by the block author and
as a result are not stored in the transaction pool or gossiped across the
network. Instead they are generated by the Polkadot Host by passing the required
inherent data, as listed in <a href="#tabl-inherent-data">Table 1</a>, to the Runtime method
\$tt "BlockBuilder_inherent_extrinsics"\$
(<a href="#defn-rt-builder-inherent-extrinsics">Section C.6.3</a>). Then the returned extrinsics should
be included in the current block as explained in <a href="#algo-build-block">Algorithm 12</a>.</p>
</div>
<table id="tabl-inherent-data" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Inherent Data</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Identifier</th>
<th class="tableblock halign-left valign-top">Value Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timstap0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unix epoch time (<a href="#defn-unix-time">Definition 181</a>)</p></td>
</tr>
</tbody>
</table>
<div id="defn-inherent-data" class="exampleblock">
<div class="title">Definition 15. <a href="#defn-inherent-data">Inherent Data</a></div>
<div class="content">
<div class="paragraph">
<p><code>Inherent-Data</code> is a hashtable (<a href="#defn-scale-list">Definition 192</a>), an array of key-value
pairs consisting of the inherent 8-byte identifier and its value, representing
the totality of inherent extrinsics included in each block. The entries of this
hash table which are listed in <a href="#tabl-inherent-data">Table 1</a> are collected or generated
by the Polkadot Host and then handed to the Runtime for inclusion
(<a href="#algo-build-block">Algorithm 12</a>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-state-storage"><a class="anchor" href="#sect-state-storage"></a><a class="link" href="#sect-state-storage">2.4. State Storage Trie</a></h3>
<div class="paragraph">
<p>For storing the state of the system, Polkadot Host implements a hash table
storage where the keys are used to access each data entry. There is no
assumption either on the size of the key nor on the size of the data stored
under them, besides the fact that they are byte arrays with specific upper
limits on their length. The limit is imposed by the encoding algorithms to store
the key and the value in the storage trie
(<a href="#sect-sc-length-and-compact-encoding">Section A.2.2.1</a>).</p>
</div>
<div class="sect3">
<h4 id="id-accessing-system-storage"><a class="anchor" href="#id-accessing-system-storage"></a><a class="link" href="#id-accessing-system-storage">2.4.1. Accessing System Storage</a></h4>
<div class="paragraph">
<p>The Polkadot Host implements various functions to facilitate access to the
system storage for the Runtime (<a href="#sect-entrypoints-into-runtime">Section 2.6.1</a>). Here we
formalize the access to the storage when it is being directly accessed by the
Polkadot Host (in contrast to Polkadot runtime).</p>
</div>
<div id="defn-stored-value" class="exampleblock">
<div class="title">Definition 16. <a href="#defn-stored-value">Stored Value</a></div>
<div class="content">
<div class="paragraph">
<p>The \$sf "StoredValue"\$ function retrieves the value stored under a specific
key in the state storage and is formally defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$sf "StoredValue" ": "cc K -&gt; cc V\$
\$k -&gt; {(v,"if " (k,v), "exists in state storage"),(phi,,"otherwise"):}\$
</div>
</div>
<div class="paragraph">
<p>where \$cc K sub bbb B\$ and \$cc V sub bbb B\$ are respectively the set of all
keys and values stored in the state storage. \$cc V\$ can be an empty value.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-general-structure"><a class="anchor" href="#id-general-structure"></a><a class="link" href="#id-general-structure">2.4.2. General Structure</a></h4>
<div class="paragraph">
<p>In order to ensure the integrity of the state of the system, the stored data
needs to be re-arranged and hashed in a <em>radix tree</em>, which
hereafter we refer to as the <strong><em>State Trie</em></strong> or just <strong><em>Trie</em></strong>. This rearrangment
is necessary to be able to compute the Merkle hash of the whole or part of the
state storage, consistently and efficiently at any given time.</p>
</div>
<div class="paragraph">
<p>The trie is used to compute the <em>merkle root</em> (<a href="#sect-merkl-proof">Section 2.4.4</a>) of the
state, \$H_r\$ (<a href="#defn-block-header">Definition 10</a>), whose purpose is to authenticate the
validity of the state database. Thus, the Polkadot Host follows a rigorous
encoding algorithm to compute the values stored in the trie nodes to ensure that
the computed Merkle hash, \$H_r\$, matches across the Polkadot Host
implementations.</p>
</div>
<div class="paragraph">
<p>The trie is a <em>radix-16</em> tree (<a href="#defn-radix-tree">Definition 17</a>). Each key value identifies a
unique node in the tree. However, a node in a tree might or might not be
associated with a key in the storage.</p>
</div>
<div id="defn-radix-tree" class="exampleblock">
<div class="title">Definition 17. <a href="#defn-radix-tree">Radix-r Tree</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong><em>Radix-r tree</em></strong> is a variant of a trie in which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every node has at most \$r\$ children where \$r = 2^x\$ for some
\$x\$;</p>
</li>
<li>
<p>Each node that is the only child of a parent, which does not
represent a valid key is merged with its parent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, in a radix tree, any path whose interior vertices all have only one
child and does not represent a valid key in the data set, is compressed into a
single edge. This improves space efficiency when the key space is sparse.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When traversing the trie to a specific node, its key can be reconstructed by
concatenating the subsequences of the keys which are stored either explicitly in
the nodes on the path or implicitly in their position as a child of their
parent.</p>
</div>
<div class="paragraph">
<p>To identify the node corresponding to a key value, \$k\$, first we need to
encode \$k\$ in a way consistent with the trie structure. Because each node
in the trie has at most 16 children, we represent the key as a sequence of 4-bit
nibbles:</p>
</div>
<div id="defn-trie-key-encode" class="exampleblock">
<div class="title">Definition 18. <a href="#defn-trie-key-encode">Key Encode</a></div>
<div class="content">
<div class="paragraph">
<p>For the purpose of labeling the branches of the trie, the key \$k\$ is
encoded to \$k_("enc")\$ using \$sf "KeyEncode"\$ functions:</p>
</div>
<div class="stemblock">
<div class="content">
\$k_("enc") := (k_("enc"_1), ..., k_("enc"_(2n))) := sf "KeyEncode"(k)\$
</div>
</div>
<div class="paragraph">
<p>such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$sf "KeyEncode": bbb B -&gt; "Nibbles"^4\$
\$k |-&gt; (k_("enc"_1),...,k_("enc"_(2n)))\$
\$(b_1,...,b_n) |-&gt; (b_1^(1),b_1^2,b_2^1,b_2^2,...,b_n^1,b_n^2    )\$
</div>
</div>
<div class="paragraph">
<p>where \$"Nibble"^4\$ is the set of all nibbles of 4-bit arrays and
\$b_i^1\$ and \$b_i^2\$ are 4-bit nibbles, which are the big endian
representations of \$b_i\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$k_("enc"_i) := (b_i^1,b_i^2) := (b_i -: 16,b_i mod 16)\$
</div>
</div>
<div class="paragraph">
<p>where \$mod\$ is the remainder and \$-:\$ is the integer division operators.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>By looking at \$k_("enc")\$ as a sequence of nibbles, one can walk the radix
tree to reach the node identifying the storage value of \$k\$.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-state-storage-trie-structure"><a class="anchor" href="#sect-state-storage-trie-structure"></a><a class="link" href="#sect-state-storage-trie-structure">2.4.3. Trie Structure</a></h4>
<div class="paragraph">
<p>In this subsection, we specify the structure of the nodes in the trie as
well as the trie structure:</p>
</div>
<div id="defn-trie-nodeset" class="exampleblock">
<div class="title">Definition 19. <a href="#defn-trie-nodeset">Set of Nodes</a></div>
<div class="content">
<div class="paragraph">
<p>We refer to the <strong>set of the nodes of Polkadot state trie</strong> by \$cc N\$. By
\$N in cc N\$ to refer to an individual node in the trie.</p>
</div>
</div>
</div>
<div id="defn-nodetype" class="exampleblock">
<div class="title">Definition 20. <a href="#defn-nodetype">State Trie</a></div>
<div class="content">
<div class="paragraph">
<p>The state trie is a radix-16 tree (<a href="#defn-radix-tree">Definition 17</a>). Each node in the trie is identified with a
unique key \(k_N\) such that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$k_N\$ is the shared prefix of the key of all the
descendants of \$N\$ in the trie.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and, at least one of the following statements holds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$(k_N, v)\$ corresponds to an existing entry in the State Storage.</p>
</li>
<li>
<p>\$N\$ has more than one child.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Conversely, if \$(k, v)\$ is an entry in the state trie then there is a node
\$N in cc N\$ such that \$k_N = k\$.</p>
</div>
</div>
</div>
<div id="defn-trie-branch" class="exampleblock">
<div class="title">Definition 21. <a href="#defn-trie-branch">Branch</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>branch</strong> node \$N_b in cc N_b\$ is a node which has one child or more. A branch node can have at
most 16 children. A <strong>leaf</strong> node \$N_l in cc N_l\$ is a childless node. Accordingly:</p>
</div>
<div class="stemblock">
<div class="content">
\$cc N_b := {N_b in cc N | N_b " is a branch node"}\$
\$cc N_l := {N_l in cc N | N_l " is a leaf node"}\$
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For each node, part of \$k_N\$ is built while the trie is traversed from the root
to \$N\$ and another part of \$k_N\$ is stored in \$N\$ (<a href="#defn-node-key">Definition 22</a>).</p>
</div>
<div id="defn-node-key" class="exampleblock">
<div class="title">Definition 22. <a href="#defn-node-key">Aggregated Prefix Key</a></div>
<div class="content">
<div class="paragraph">
<p>For any \$N in cc N\$, its key \$k_N\$ is divided into an <strong>aggregated
prefix key, \$"pk"_N^("Agr")\$</strong>, aggregated by <a href="#algo-aggregate-key">Algorithm 3</a> and a
<strong>partial key</strong>, <strong>\$"pk"_N\$</strong> of length \$0 &lt;= l_("pk"_N)\$ in nibbles such
that:</p>
</div>
<div class="stemblock">
<div class="content">
\$"pk"_N := (k_("enc"_i),...,k_("enc"_(i+l_("pk"_N))))\$
</div>
</div>
<div class="paragraph">
<p>where \$"pk"_N^("Agr")\$ is a prefix subsequence of \$k_N\$; \$i\$ is the length
of \$"pk"_N^("Agr")\$ in nibbles and so we have:</p>
</div>
<div class="stemblock">
<div class="content">
\$sf "KeyEncode"(k_N) = "pk"_N^("Agr") || "pk"_N = (k_("enc"_1), ..., k_("enc"_(i-1)),k_("enc"_i),k_("enc"_(i+l_("pk"_N))))\$
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Part of \$"pk"_N^("Agr")\$ is explicitly stored in \$N\$’s ancestors.
Additionally, for each ancestor, a single nibble is implicitly derived while
traversing from the ancestor to its child included in the traversal path using
the \$"Index"_N\$ function (<a href="#defn-index-function">Definition 23</a>).</p>
</div>
<div id="defn-index-function" class="exampleblock">
<div class="title">Definition 23. <a href="#defn-index-function">Index</a></div>
<div class="content">
<div class="paragraph">
<p>For \$N in cc N_b\$ and \$N_c\$ child of \$N\$, we define
\$sf "Index"_N\$ function as:</p>
</div>
<div class="stemblock">
<div class="content">
\$sf "Index"_N: {N_C in cc N | N_c " is a child of " N} -&gt; "Nibbles"_1^4\$
\$N_c -&gt; i\$
</div>
</div>
<div class="paragraph">
<p>such that</p>
</div>
<div class="stemblock">
<div class="content">
\$k_(N_c) = k_N || i || "pk"_(N_c)\$
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-aggregate-key" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 3 </span><span style="font-style:normal;font-variant:small-caps;">Aggregate-Key</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>N</mi></msub><mo><mi mathvariant="normal">≔</mi></mo><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">P_N \coloneqq (</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mop" style="position:relative;top:-0.0347em;">:</span></span><span class="mrel"><span class="mspace" style="margin-right:-0.0667em;"></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span></span></span></span><span style="font-style:normal;font-variant:small-caps;">TrieRoot</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><msub><mi>N</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>N</mi><mi>j</mi></msub><mo>=</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> = N_1, \dots, N_j = N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><msubsup><mi>k</mi><mi>N</mi><mrow><mi>A</mi><mi>g</mi><mi>r</mi></mrow></msubsup><mo>←</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">pk^{Agr}_N \leftarrow \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2528em;vertical-align:-0.2935em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4065em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>←</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i \leftarrow 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-keyword">for all </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>i</mi></msub><mo>∈</mo><msub><mi>P</mi><mi>N</mi></msub></mrow><annotation encoding="application/x-tex">N_i \in P_N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><msubsup><mi>k</mi><mi>N</mi><mrow><mi>A</mi><mi>g</mi><mi>r</mi></mrow></msubsup><mo>←</mo><mi>p</mi><msubsup><mi>k</mi><mi>N</mi><mrow><mi>A</mi><mi>g</mi><mi>r</mi></mrow></msubsup><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>p</mi><msub><mi>k</mi><msub><mi>N</mi><mi>i</mi></msub></msub><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mtext>Index</mtext><msub><mi>N</mi><mi>i</mi></msub></msub><mo stretchy="false">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">pk^{Agr}_N \leftarrow pk^{Agr}_N || pk_{N_i} || \textrm{Index}_{N_i}(N_{i + 1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2528em;vertical-align:-0.2935em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4065em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2528em;vertical-align:-0.2935em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4065em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mord"><span class="mord text"><span class="mord textrm">Index</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><msubsup><mi>k</mi><mi>N</mi><mrow><mi>A</mi><mi>g</mi><mi>r</mi></mrow></msubsup><mo>←</mo><mi>p</mi><msubsup><mi>k</mi><mi>N</mi><mrow><mi>A</mi><mi>g</mi><mi>r</mi></mrow></msubsup><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>p</mi><msub><mi>k</mi><msub><mi>N</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">pk^{Agr}_N \leftarrow pk^{Agr}_N || pk_{N_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2528em;vertical-align:-0.2935em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4065em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2528em;vertical-align:-0.2935em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4065em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><msubsup><mi>k</mi><mi>N</mi><mrow><mi>A</mi><mi>g</mi><mi>r</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">pk^{Agr}_N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2528em;vertical-align:-0.2935em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4065em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 3. <a href="#algo-aggregate-key">Aggregate-Key</a></div>
          </div>
<div class="paragraph">
<p>Assuming that \$P_N\$ is the path (<a href="#defn-path-graph">Definition 2</a>) from the trie root to
node \$N\$, <a href="#algo-aggregate-key">Algorithm 3</a> rigorously demonstrates how to build
\$"pk"_N^("Agr")\$ while traversing \$P_N\$.</p>
</div>
</div>
</div>
<div id="defn-node-value" class="exampleblock">
<div class="title">Definition 24. <a href="#defn-node-value">Node Value</a></div>
<div class="content">
<div class="paragraph">
<p>A node \$N in cc N\$ stores the <strong>node value</strong>, \$v_N\$, which consists of
the following concatenated data:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Node Header"||"Partial Key"||"Node Subvalue"\$
</div>
</div>
<div class="paragraph">
<p>Formally noted as:</p>
</div>
<div class="stemblock">
<div class="content">
\$v_N := "Head"_N||"Enc"_"HE"(pk_N)||sv_N\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"Head"_N\$ is the node header from <a href="#defn-node-header">Definition 25</a></p>
</li>
<li>
<p>\$pk_N\$ is the partial key from <a href="#defn-node-key">Definition 22</a></p>
</li>
<li>
<p>\$"Enc"_"HE"\$ is hex encoding (<a href="#defn-hex-encoding">Definition 199</a>)</p>
</li>
<li>
<p>\$sv_N\$ is the node subvalue from <a href="#defn-node-subvalue">Definition 27</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-node-header" class="exampleblock">
<div class="title">Definition 25. <a href="#defn-node-header">Node Header</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>node header</strong>, consisting of \$&gt;= 1\$ bytes, \$N_1...N_n\$, specifies
the node variant and the partial key length (<a href="#defn-node-key">Definition 22</a>).
Both pieces of information can be represented in bits within a
single byte, \$N_1\$, where the amount of bits of the variant, \$v\$, and
the bits of the partial key length, \$p_l\$ varies.</p>
</div>
<div class="stemblock">
<div class="content">
\$v = {
    (01, "Leaf", p_l = 2^6),
    (10, "Branch Node with " k_N !in cc K, p_l = 2^6),
    (11, "Branch Node with " k_N in cc K, p_l = 2^6),
    (001, "Leaf containing a hashed subvalue", p_l = 2^5),
    (0001, "Branch containing a hashed subvalue", p_l = 2^4),
    (0000 0000, "Empty", p_l = 0),
    (0000 0001, "Reserved for compact encoding",)
    :}\$
</div>
</div>
<div class="paragraph">
<p>If the value of \$p_l\$ is equal to the maximum possible value the bits can
hold, such as 63 (\$2^6-1\$) in case of the \$01\$ variant, then the value
of the next 8 bits (\$N_2\$) are added the the length. This process is
repeated for every \$N_n\$ where \$N_n = 2^8-1\$. Any value smaller than
the maximum possible value of \$N_n\$ implies that the next value of
\$N_(n+1)\$ should not be added to the length. The hashed subvalue for
variants \$001\$ and \$0001\$ is described in <a href="#defn-hashed-subvalue">Definition 28</a>.</p>
</div>
<div class="paragraph">
<p>Formally, the length of the partial key, \$"pk"_N^l\$, is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"pk"_N^l = p_l + N_n + N_(n+x) + ... + N_(n+x+y)\$
</div>
</div>
<div class="paragraph">
<p>as long as \$p_l = m\$, \$N_(n+x) = 2^8-1\$ and
\$N_(n+x+y) &lt; 2^8-1\$, where \$m\$ is the maximum possible value
that \$p_l\$ can hold.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-merkl-proof"><a class="anchor" href="#sect-merkl-proof"></a><a class="link" href="#sect-merkl-proof">2.4.4. Merkle Proof</a></h4>
<div class="paragraph">
<p>To prove the consistency of the state storage across the network and its
modifications both efficiently and effectively, the trie implements a
Merkle tree structure. The hash value corresponding to each node needs
to be computed rigorously to make the inter-implementation data
integrity possible.</p>
</div>
<div class="paragraph">
<p>The Merkle value of each node should depend on the Merkle value of all its
children as well as on its corresponding data in the state storage. This
recursive dependency is encompassed into the subvalue part of the node value
which recursively depends on the Merkle value of its children. Additionally, as
<a href="#sect-child-trie-structure">Section 2.5.1</a> clarifies, the Merkle proof of each <strong>child trie</strong>
must be updated first before the final Polkadot state root can be calculated.</p>
</div>
<div class="paragraph">
<p>We use the auxiliary function introduced in <a href="#defn-children-bitmap">Definition 26</a> to encode
and decode information stored in a branch node.</p>
</div>
<div id="defn-children-bitmap" class="exampleblock">
<div class="title">Definition 26. <a href="#defn-children-bitmap">Children Bitmap</a></div>
<div class="content">
<div class="paragraph">
<p>Suppose \$N_b, N_c in cc N\$ and \$N_c\$ is a child of \$N_b\$. We
define bit \$b_i : = 1\$ if and only if \$N\$ has a child with partial key
\$i\$, therefore we define <strong>ChildrenBitmap</strong> functions as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"ChildrenBitmap:"\$
\$cc N_b -&gt; bbb B_2\$
\$N -&gt; (b_(15), ...,b_8,b_7,...,b_0)_2\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="stemblock">
<div class="content">
\$b_i := {(1, EE N_c in cc N: k_(N_c) = k_(N_b)||i||pk_(N_c)),(0, "otherwise"):}\$
</div>
</div>
</div>
</div>
<div id="defn-node-subvalue" class="exampleblock">
<div class="title">Definition 27. <a href="#defn-node-subvalue">Subvalue</a></div>
<div class="content">
<div class="paragraph">
<p>For a given node \$N\$, the <strong>subvalue</strong> of \$N\$, formally referred to as
\$sv_N\$, is determined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$sv_N := {("StoredValue"_("SC")),("Enc"_("SC")("ChildrenBitmap"(N)||"StoredValue"_("SC")||"Enc"_("SC")(H(N_(C_1))),...,"Enc"_("SC")(H(N_(C_n))))):}\$
</div>
</div>
<div class="paragraph">
<p>where the first variant is a leaf node and the second variant is a branch node.</p>
</div>
<div class="stemblock">
<div class="content">
\$"StoredValue"_("SC") := {("Enc"_("SC")("StoredValue"(k_N)),"if StoredValue"(k_N) = v),(phi,"if StoredValue"(k_N) = phi):}\$
</div>
</div>
<div class="paragraph">
<p>\$N_(C_1) ... N_(C_n)\$ with \$n &lt;= 16\$ are the children nodes of the
branch node \$N\$.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$"Enc"_("SC")\$ is defined in <a href="#sect-scale-codec">Section A.2.2</a>.</p>
</li>
<li>
<p>\$"StoredValue"\$, where \$v\$ can be empty, is defined in <a href="#defn-stored-value">Definition 16</a>.</p>
</li>
<li>
<p>\$H\$ is defined in <a href="#defn-merkle-value">Definition 29</a>.</p>
</li>
<li>
<p>\$"ChildrenBitmap"(N)\$ is defined in <a href="#defn-children-bitmap">Definition 26</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The trie deviates from a traditional Merkle tree in that the node value
(<a href="#defn-node-value">Definition 24</a>), \$v_N\$, is presented instead of its hash if it
occupies less space than its hash.</p>
</div>
</div>
</div>
<div id="defn-hashed-subvalue" class="exampleblock">
<div class="title">Definition 28. <a href="#defn-hashed-subvalue">Hashed Subvalue</a></div>
<div class="content">
<div class="paragraph">
<p>To increase performance, a merkle proof can be generated by inserting the hash of
a value into the trie rather than the value itself (which can be quite
large). If merkle proof computation with node hashing is explicitly executed via
the Host API (<a href="#sect-ext-storage-root-version-2">Section B.2.8.2</a>), then any value larger than
32 bytes is hashed, resulting in that hash being used as the subvalue
(<a href="#defn-node-subvalue">Definition 27</a>) under the corresponding key. The node header must
specify the variant \$001\$ and \$0001\$ respectively for leaves
containing a hash as their subvalue and for branches containing a hash
as their subvalue (<a href="#defn-node-header">Definition 25</a>).</p>
</div>
</div>
</div>
<div id="defn-merkle-value" class="exampleblock">
<div class="title">Definition 29. <a href="#defn-merkle-value">Merkle Value</a></div>
<div class="content">
<div class="paragraph">
<p>For a given node \$N\$, the <strong>Merkle value</strong> of \$N\$, denoted by
\$H(N)\$ is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$H: bbb B -&gt; U_(i -&gt; 0)^(32) bbb B_32\$
\$H(N): {(v_N,||v_N|| &lt; 32 " and " N != R),("Blake2b"(v_n),||v_N|| &gt;= 32 " or " N = R):}\$
</div>
</div>
<div class="paragraph">
<p>Where \$v_N\$ is the node value of \$N\$ (<a href="#defn-node-value">Definition 24</a>) and
\$R\$ is the root of the trie. The <strong>Merkle hash</strong> of the trie is defined to be
\(H(R)\).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-managing-multiple-states"><a class="anchor" href="#sect-managing-multiple-states"></a><a class="link" href="#sect-managing-multiple-states">2.4.5. Managing Multiple Variants of State</a></h4>
<div class="paragraph">
<p>Unless a node is committed to only update its state according to the finalized
block (<a href="#defn-finalized-block">Definition 90</a>), it is inevitable for the node to store
multiple variants of the state (one for each block). This is, for example,
necessary for nodes participating in the block production and finalization.</p>
</div>
<div class="paragraph">
<p>While the state trie structure (<a href="#sect-state-storage-trie-structure">Section 2.4.3</a>)
facilitates and optimizes storing and switching between multiple variants of the
state storage, the Polkadot Host does not specify how a node is required to
accomplish this task. Instead, the Polkadot Host is required to implement
\$"Set-State-At"\$ (<a href="#defn-set-state-at">Definition 30</a>):</p>
</div>
<div id="defn-set-state-at" class="exampleblock">
<div class="title">Definition 30. <a href="#defn-set-state-at">Set State At Block</a></div>
<div class="content">
<div class="paragraph">
<p>The function:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Set-State-At"(B)\$
</div>
</div>
<div class="paragraph">
<p>in which \$B\$ is a block in the block tree (<a href="#defn-block-tree">Definition 4</a>), sets the
content of state storage equal to the resulting state of executing all
extrinsics contained in the branch of the block tree from genesis till block B
including those recorded in Block \$B\$.</p>
</div>
<div class="paragraph">
<p>For the definition of the state storage see <a href="#sect-state-storage">Section 2.4</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-child-storages"><a class="anchor" href="#sect-child-storages"></a><a class="link" href="#sect-child-storages">2.5. Child Storage</a></h3>
<div class="paragraph">
<p>As clarified in <a href="#sect-state-storage">Section 2.4</a>, the Polkadot state storage implements a
hash table for inserting and reading key-value entries. The child storage works
the same way but is stored in a separate and isolated environment. Entries in
the child storage are not directly accessible via querying the main state
storage.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host supports as many child storages as required by Runtime
and identifies each separate child storage by its unique identifying
key. Child storages are usually used in situations where Runtime deals
with multiple instances of a certain type of objects such as Parachains
or Smart Contracts. In such cases, the execution of the Runtime entrypoint
might result in generating repeated keys across multiple instances of
certain objects. Even with repeated keys, all such instances of
key-value pairs must be able to be stored within the Polkadot state.</p>
</div>
<div class="paragraph">
<p>In these situations, the child storage can be used to provide the isolation
necessary to prevent any undesired interference between the state of separated
instances. The Polkadot Host makes no assumptions about how child storages are
used, but provides the functionality for it via the Host API
(<a href="#sect-child-storage-api">Section B.3</a>).</p>
</div>
<div class="sect3">
<h4 id="sect-child-trie-structure"><a class="anchor" href="#sect-child-trie-structure"></a><a class="link" href="#sect-child-trie-structure">2.5.1. Child Tries</a></h4>
<div class="paragraph">
<p>The child trie specification is the same as the one described in
<a href="#sect-state-storage-trie-structure">Section 2.4.3</a>. Child tries have their own isolated
environment. Nonetheless, the main Polkadot state trie depends on them by
storing a node (\$K_N, V_N\$) which corresponds to an individual child trie.
Here, \$K_N\$ is the child storage key associated to the child trie, and
\$V_N\$ is the Merkle value of its corresponding child trie computed
according to the procedure described in <a href="#sect-merkl-proof">Section 2.4.4</a>.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host API (<a href="#sect-child-storage-api">Section B.3</a>) allows the Runtime to provide
the key \$K_N\$ in order to identify the child trie, followed by a second key
in order to identify the value within that child trie. Every time a child trie
is modified, the Merkle proof \$V_N\$ of the child trie stored in the
Polkadot state must be updated first. After that, the final Merkle proof of the
Polkadot state can be computed. This mechanism provides a proof of the full
Polkadot state including all its child states.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-interaction"><a class="anchor" href="#sect-runtime-interaction"></a><a class="link" href="#sect-runtime-interaction">2.6. Runtime Interactions</a></h3>
<div class="paragraph">
<p>Like any transaction-based transition system, Polkadot’s state is changed by
executing an ordered set of instructions. These instructions are known as
<em>extrinsics</em>. In Polkadot, the execution logic of the state transition function
is encapsulated in a Runtime (<a href="#defn-state-machine">Definition 1</a>). For easy upgradability
this Runtime is presented as a Wasm blob. Nonetheless, the Polkadot Host needs
to be in constant interaction with the Runtime (<a href="#sect-entrypoints-into-runtime">Section 2.6.1</a>).</p>
</div>
<div class="paragraph">
<p>In <a href="#sect-extrinsics">Section 2.3</a>, we specify the procedure of the process where the
extrinsics are submitted, pre-processed and validated by Runtime and queued to
be applied to the current state.</p>
</div>
<div class="paragraph">
<p>To make state replication feasible, Polkadot journals and batches series of its
extrinsics together into a structure known as a <em>block</em>, before propagating them
to other nodes, similar to most other prominent distributed ledger systems. The
specification of the Polkadot block as well as the process of verifying its
validity are both explained in <a href="#sect-state-replication">Section 2.2</a>.</p>
</div>
<div class="sect3">
<h4 id="sect-entrypoints-into-runtime"><a class="anchor" href="#sect-entrypoints-into-runtime"></a><a class="link" href="#sect-entrypoints-into-runtime">2.6.1. Interacting with the Runtime</a></h4>
<div class="paragraph">
<p>The Runtime (<a href="#defn-state-machine">Definition 1</a>) is the code implementing the logic of the chain.
This code is decoupled from the Polkadot Host to make the the logic of the chain
easily upgradable without the need to upgrade the Polkadot Host itself. The
general procedure to interact with the Runtime is described by <a href="#algo-runtime-interaction">Algorithm 4</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-runtime-interaction" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 4 </span><span style="font-style:normal;font-variant:small-caps;">Interact-With-Runtime</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo separator="true">,</mo><msub><mi>H</mi><mi>b</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>A</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F, H_b(B),(A_1,\ldots,A_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">S</mi><mi>B</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{S}_B \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.075em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Set-State-At</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>b</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H_b(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>←</mo><mi>E</mi><mi>n</mi><msub><mi>c</mi><mrow><mi>S</mi><mi>C</mi></mrow></msub><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>A</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A \leftarrow Enc_{SC}((A_1, \ldots, A_n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">SC</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">((</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">))</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-funcname">Call-Runtime-Entrypoint</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>B</mi></msub><mo separator="true">,</mo><msub><mrow><mi mathvariant="script">R</mi><mi mathvariant="script">E</mi></mrow><mi>B</mi></msub><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>A</mi><mo separator="true">,</mo><msub><mi>A</mi><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">R_B, \mathcal{RE}_B, F, A, A_{len}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">R</span><span class="mord mathcal" style="margin-right:0.08944em;">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 4. <a href="#algo-runtime-interaction">Interact-With-Runtime</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$F\$ is the runtime entrypoint call.</p>
</li>
<li>
<p>\$H_b(B)\$ is the block hash indicating the state at the end of \$B\$.</p>
</li>
<li>
<p>\$A_1,...,A_n\$ are arguments to be passed to the runtime entrypoint.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>In this section, we describe the details upon which the Polkadot Host is
interacting with the Runtime. In particular, \$"Set-State-At"\$ and
\$"Call-Runtime-Entrypoint"\$ procedures called by <a href="#algo-runtime-interaction">Algorithm 4</a>
are explained in <a href="#defn-call-into-runtime">Definition 32</a> and
<a href="#defn-set-state-at">Definition 30</a> respectively. \$R_B\$ is the Runtime code loaded from
\$S_B\$, as described in <a href="#defn-runtime-code-at-state">Definition 31</a>, and \$RE_B\$ is
the Polkadot Host API, as described in <a href="#defn-host-api-at-state">Definition 201</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-loading-runtime-code"><a class="anchor" href="#sect-loading-runtime-code"></a><a class="link" href="#sect-loading-runtime-code">2.6.2. Loading the Runtime Code</a></h4>
<div class="paragraph">
<p>The Polkadot Host expects to receive the code for the Runtime of the
chain as a compiled WebAssembly (Wasm) Blob. The current runtime is
stored in the state database under the key represented as a byte array:</p>
</div>
<div class="stemblock">
<div class="content">
\$b := "3A,63,6F,64,65"\$
</div>
</div>
<div class="paragraph">
<p>which is the ASCII byte representation of the string <code>:code</code>
(<a href="#chapter-genesis">Section A.3</a>). As a result of storing the Runtime as part of the state,
the Runtime code itself becomes state sensitive and calls to Runtime can change
the Runtime code itself. Therefore the Polkadot Host needs to always make sure
to provide the Runtime corresponding to the state in which the entrypoint has been
called. Accordingly, we define \$R_B\$ (<a href="#defn-runtime-code-at-state">Definition 31</a>).</p>
</div>
<div class="paragraph">
<p>The initial Runtime code of the chain is provided as part of the genesis state
(<a href="#chapter-genesis">Section A.3</a>) and subsequent calls to the Runtime have the ability to,
in turn, upgrade the Runtime by replacing this Wasm blob with the help of the
storage API (<a href="#sect-storage-api">Section B.2</a>). Therefore, the executor <strong>must always</strong> load
the latest Runtime from storage - or preferably detect Runtime upgrades
(<a href="#defn-digest">Definition 11</a>) - either based on the parent block when importing blocks or
the best/highest block when creating new blocks.</p>
</div>
<div id="defn-runtime-code-at-state" class="exampleblock">
<div class="title">Definition 31. <a href="#defn-runtime-code-at-state">Runtime Code at State</a></div>
<div class="content">
<div class="paragraph">
<p>By \$R_B\$, we refer to the Runtime code stored in the state storage at the
end of the execution of block \$B\$.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-code-executor"><a class="anchor" href="#sect-code-executor"></a><a class="link" href="#sect-code-executor">2.6.3. Code Executor</a></h4>
<div class="paragraph">
<p>The Polkadot Host executes the calls of Runtime entrypoints inside a Wasm
Virtual Machine (VM), which in turn provides the Runtime with access to
the Polkadot Host API. This part of the Polkadot Host is referred to as
the <em>Executor</em>.</p>
</div>
<div class="paragraph">
<p><a href="#defn-call-into-runtime">Definition 32</a> introduces the notation for calling the runtime entrypoint
which is used whenever an algorithm of the Polkadot Host needs to access the
runtime.</p>
</div>
<div class="paragraph">
<p>It is acceptable behavior that the Runtime panics during execution of a
function in order to indicate an error. The Polkadot Host must be able
to catch that panic and recover from it.</p>
</div>
<div class="paragraph">
<p>In this section, we specify the general setup for an Executor that calls into
the Runtime. In <a href="#chap-runtime-api">Appendix C</a> we specify the parameters and return values
for each Runtime entrypoint separately.</p>
</div>
<div id="defn-call-into-runtime" class="exampleblock">
<div class="title">Definition 32. <a href="#defn-call-into-runtime">Call Runtime Entrypoint</a></div>
<div class="content">
<div class="paragraph">
<p>By</p>
</div>
<div class="stemblock">
<div class="content">
\$"Call-Runtime-Entrypoint"(R,RE,"Runtime-Entrypoint",A,A_len)\$
</div>
</div>
<div class="paragraph">
<p>we refer to the task using the executor to invoke the while passing an
\$A_1, ..., A_n\$ argument to it and using the encoding described in
<a href="#sect-runtime-send-args-to-runtime-enteries">Section 2.6.3.2</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-memory-management"><a class="anchor" href="#sect-memory-management"></a><a class="link" href="#sect-memory-management">2.6.3.1. Memory Management</a></h5>
<div class="paragraph">
<p>The Polkadot Host is responsible for managing the WASM heap memory starting at
the exported symbol as a part of implementing the allocator Host API
(<a href="#sect-allocator-api">Section B.9</a>) and the same allocator should be used for any other
heap allocation to be used by the Polkadot Runtime.</p>
</div>
<div class="paragraph">
<p>The size of the provided WASM memory should be based on the value of the
storage key (an unsigned 64-bit integer), where each page has the size
of 64KB. This memory should be made available to the Polkadot Runtime
for import under the symbol name <code>memory</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sect-runtime-send-args-to-runtime-enteries"><a class="anchor" href="#sect-runtime-send-args-to-runtime-enteries"></a><a class="link" href="#sect-runtime-send-args-to-runtime-enteries">2.6.3.2. Sending Data to a Runtime Entrypoint</a></h5>
<div class="paragraph">
<p>In general, all data exchanged between the Polkadot Host and the Runtime is
encoded using SCALE codec described in <a href="#sect-scale-codec">Section A.2.2</a>. Therefore all
runtime entrypoints have the following identical Wasm function signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="wat">(func $runtime_entrypoint (param $data i32) (param $len i32) (result i64))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In each invocation of a Runtime entrypoints, the argument(s) which are supposed to be
sent to the entrypoint, need to be SCALE encoded into a byte array \$B\$
(<a href="#sect-scale-codec">Section A.2.2</a>) and copied into a section of Wasm shared memory managed
by the shared allocator described in <a href="#sect-memory-management">Section 2.6.3.1</a>.</p>
</div>
<div class="paragraph">
<p>When the Wasm method, corresponding to the entrypoint, is invoked, two
integers are passed as arguments. The first argument is set to the
memory address of the byte array \$B\$ in Wasm memory. The
second argument sets the length of the encoded data stored in
\$B\$.</p>
</div>
</div>
<div class="sect4">
<h5 id="sect-runtime-return-value"><a class="anchor" href="#sect-runtime-return-value"></a><a class="link" href="#sect-runtime-return-value">2.6.3.3. Receiving Data from a Runtime Entrypoint</a></h5>
<div class="paragraph">
<p>The value which is returned from the invocation is an integer,
representing two consecutive integers in which the least significant one
indicates the pointer to the offset of the result returned by the entrypoint
encoded in SCALE codec in the memory buffer. The most significant one
provides the size of the blob.</p>
</div>
</div>
<div class="sect4">
<h5 id="sect-runtime-version-custom-section"><a class="anchor" href="#sect-runtime-version-custom-section"></a><a class="link" href="#sect-runtime-version-custom-section">2.6.3.4. Runtime Version Custom Section</a></h5>
<div class="paragraph">
<p>For newer Runtimes, the Runtime version (<a href="#defn-rt-core-version">Section C.4.1</a>) can be read
directly from the
<a href="https://webassembly.github.io/spec/core/appendix/custom.html">Wasm custom
section</a> with the name <code>runtime_version</code>. The content is a SCALE encoded
structure as described in <a href="#defn-rt-core-version">Section C.4.1</a>.</p>
</div>
<div class="paragraph">
<p>Retrieving the Runtime version this way is preferred over calling the
<code>Core_version</code> entrypoint since it involves significantly less overhead.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-sync"><a class="anchor" href="#chap-sync"></a><a class="link" href="#chap-sync">3. Synchronization</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many applications that interact with the Polkadot network to some extent must be
able to retrieve certain information about the network. Depending on the
utility, this includes validators that interact with Polkadot&#8217;s consensus and
need access to the full state, either from the past or just the most up-to-date
state, or light clients that are only interest in the minimum information
required in order to verify some claims about the state of the network, such as
the balance of a specific account. To allow implemenations to quickly retrieve
the required information, different types of synchronization protocols are
available, respectivel Full, Fast and Warp sync suited for different needs.</p>
</div>
<div class="paragraph">
<p>The associated network messages are specified in <a href="#sect-network-messages">Section 4.8</a>.</p>
</div>
<div class="sect2">
<h3 id="sect-sync-warp"><a class="anchor" href="#sect-sync-warp"></a><a class="link" href="#sect-sync-warp">3.1. Warp Sync</a></h3>
<div class="paragraph">
<p>Warp sync (<a href="#sect-msg-warp-sync">Section 4.8.4</a>) only downloads the block headers where authority set changes occurred, so called fragments (<a href="#defn-warp-sync-proof">Definition 41</a>), and by verifying the GRANDPA justifications (<a href="#defn-grandpa-justifications-compact">Definition 45</a>). This protocols allows nodes to arrive at the desired state much faster than fast sync.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-sync-fast"><a class="anchor" href="#sect-sync-fast"></a><a class="link" href="#sect-sync-fast">3.2. Fast Sync</a></h3>
<div class="paragraph">
<p>Fast sync works by downloading the block header history and validating the
auhtority set changes (<a href="#sect-authority-set">Section 3.3.1</a>) in order to arrive at a specific
(usually the most recent) header. After the desired header has been reached and
verified, the state can be downloaded and imported (<a href="#sect-msg-state-request">Section 4.8.3</a>).
Once this process has been completed, the node can proceed with a full sync.</p>
</div>
</div>
<div class="sect2">
<h3 id="id-full-sync"><a class="anchor" href="#id-full-sync"></a><a class="link" href="#id-full-sync">3.3. Full Sync</a></h3>
<div class="paragraph">
<p>The full sync protocols is the "default" protocol that&#8217;s suited for many types
of implementations, such as archive nodes (nodes that store everything),
validators that participate in Polkadots consensus and light clients that only
verify claims about the state of the network. Full sync works by listening to
announced blocks (<a href="#sect-msg-block-announce">Section 4.8.1</a>) and requesting the blocks from
the announcing peers, or just the block headers in case of light clients.</p>
</div>
<div class="paragraph">
<p>The full sync protocol usually downloads the entire chain, but no such
requirements must be met. If an implemenation only wants the latest, finalized
state, it can combine it with protocols such as fast sync (<a href="#sect-sync-fast">Section 3.2</a>)
and/or warp sync (<a href="#sect-sync-warp">Section 3.1</a>) to make synchronization as fast as
possible.</p>
</div>
<div class="sect3">
<h4 id="sect-authority-set"><a class="anchor" href="#sect-authority-set"></a><a class="link" href="#sect-authority-set">3.3.1. Consensus Authority Set</a></h4>
<div class="paragraph">
<p>Because Polkadot is a proof-of-stake protocol, each of its consensus engines has
its own set of nodes represented by known public keys, which have the authority
to influence the protocol in pre-defined ways explained in this Section. To
verify the validity of each block, the Polkadot node must track the current list
of authorities (<a href="#defn-authority-list">Definition 33</a>) for that block.</p>
</div>
<div id="defn-authority-list" class="exampleblock">
<div class="title">Definition 33. <a href="#defn-authority-list">Authority List</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>authority list</strong> of block \$B\$ for consensus engine \$C\$ noted as
\$"Auth"_C(B)\$ is an array that contains the following pair of types for
each of its authorities \$A in "Auth"_C(B)\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$(pk_A,w_A)\$
</div>
</div>
<div class="paragraph">
<p>\$pk_A\$ is the session public key (<a href="#defn-session-key">Definition 180</a>) of authority
\$A\$. And \$w_A\$ is an unsigned 64-bit integer indicating the authority
weight. The value of \$"Auth"_C(B)\$ is part of the Polkadot state. The value
for \$"Auth"_C(B_0)\$ is set in the genesis state (<a href="#chapter-genesis">Section A.3</a>) and
can be retrieved using a runtime entrypoint corresponding to consensus engine
\$C\$.</p>
</div>
<div class="paragraph">
<p>The authorities and their corresponding weights can be retrieved from the
Runtime (<a href="#sect-rte-grandpa-auth">Section C.10.1</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-consensus-message-digest"><a class="anchor" href="#sect-consensus-message-digest"></a><a class="link" href="#sect-consensus-message-digest">3.3.2. Runtime-to-Consensus Engine Message</a></h4>
<div class="paragraph">
<p>The authority list (<a href="#defn-authority-list">Definition 33</a>) is part of the Polkadot state and
the Runtime has the authority to update this list in the course of any state
transitions. The Runtime informs the corresponding consensus engine about the
changes in the authority set by adding the appropriate consensus message in the
form of a digest item (<a href="#defn-digest">Definition 11</a>) to the block header of block \$B\$
which caused the transition in the authority set.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host must inspect the digest header of each block and delegate
consensus messages to their consensus engines. The BABE and GRANDPA consensus
engine must react based on the type of consensus messages it receives. The
active GRANDPA authorities can only vote for blocks that occurred after the
finalized block in which they were selected. Any votes for blocks before the
came into effect would get rejected.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-block-validation"><a class="anchor" href="#sect-block-validation"></a><a class="link" href="#sect-block-validation">3.4. Importing and Validating Block</a></h3>
<div class="paragraph">
<p>Block validation is the process by which a node asserts that a block is fit to
be added to the blockchain. This means that the block is consistent with the
current state of the system and transitions to a new valid state.</p>
</div>
<div class="paragraph">
<p>New blocks can be received by the Polkadot Host via other peers
(<a href="#sect-msg-block-request">Section 4.8.2</a>) or from the Host’s own consensus engine
(<a href="#sect-block-production">Chapter 5</a>). Both the Runtime and the Polkadot Host then need to
work together to assure block validity. A block is deemed valid if the block
author had authorship rights for the slot in which the block was produce as well
as if the transactions in the block constitute a valid transition of states. The
former criterion is validated by the Polkadot Host according to the block
production consensus protocol. The latter can be verified by the Polkadot Host
invoking entry into the Runtime as (<a href="#sect-rte-core-execute-block">Section C.4.2</a>) as a part
of the validation process. Any state changes created by this function on
successful execution are persisted.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host implements <a href="#algo-import-and-validate-block">Algorithm 5</a> to assure the
validity of the block.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-import-and-validate-block" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 5 </span><span style="font-style:normal;font-variant:small-caps;">Import-and-Validate-Block</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo separator="true">,</mo><mtext>Just</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B, \text{Just}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Just</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-funcname">Set-Storage-State-At</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Just</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo mathvariant="normal">≠</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\text{Just}(B) \neq \emptyset</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Just</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">∅</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="ps-funcname">Verify-Block-Justification</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo separator="true">,</mo><mtext>Just</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B, \text{Just}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Just</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mtext> </mtext><mtext mathvariant="bold">is</mtext><mtext> Finalized </mtext><mtext mathvariant="bold">and</mtext><mtext> </mtext><mi>P</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mtext> </mtext><mrow><mtext mathvariant="bold">is</mtext><mtext> </mtext><mtext mathvariant="bold">not</mtext></mrow><mtext> Finalized</mtext></mrow><annotation encoding="application/x-tex">B~\textbf{is}~\text{Finalized}~\textbf{and}~P(B)~\textbf{is not}~\text{Finalized}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">is</span></span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord">Finalized</span></span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">and</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">is not</span></span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord">Finalized</span></span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">5:</span><span class="ps-funcname">Mark-as-Final</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">8:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo mathvariant="normal">∉</mo><mi>P</mi><mi>B</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">H_p(B) \notin PBT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">PBT</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">9:</span><span class="ps-keyword">return </span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">10:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="ps-funcname">Verify-Authorship-Right</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Head</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Head}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Head</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">12:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">B \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Remove-Seal</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">13:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">R \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">Core_execute_block</mtext><mo separator="true">,</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">\texttt{Core\_execute\_block}, B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord texttt">Core_execute_block</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">14:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">B \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Add-Seal</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">15:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">R =</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">True</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">16:</span><span class="ps-funcname">Persist-State</span>()</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">17:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 5. <a href="#algo-import-and-validate-block">Import-and-Validate-Block</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"Remove-Seal"\$ removes the Seal digest from the block (<a href="#defn-digest">Definition 11</a>)
before submitting it to the Runtime.</p>
</li>
<li>
<p>\$"Add-Seal"\$ adds the Seal digest back to the block (<a href="#defn-digest">Definition 11</a>) for
later propagation.</p>
</li>
<li>
<p>\$"Persist-State"\$ implies the persistence of any state changes created by
\$tt "Core_execute_block"\$ (<a href="#sect-rte-core-execute-block">Section C.4.2</a>) on successful
execution.</p>
</li>
<li>
<p>\$"PBT"\$ is the pruned block tree (<a href="#defn-block-tree">Definition 4</a>).</p>
</li>
<li>
<p>\$"Verify-Authorship-Right"\$ is part of the block production consensus
protocol and is described in <a href="#algo-verify-authorship-right">Algorithm 10</a>.</p>
</li>
<li>
<p><em>Finalized block</em> and <em>finality</em> are defined in <a href="#sect-finality">Chapter 6</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-networking"><a class="anchor" href="#chap-networking"></a><a class="link" href="#chap-networking">4. Networking</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This chapter in its current form is incomplete and considered work in progress.
Authors appreciate receiving request for clarification or any reports regarding
deviation from the current Polkadot network protocol. This can be done through
filing an issue in <a href="https://github.com/w3f/polkadot-spec">Polkadot Specification
repository</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="id-introduction-2"><a class="anchor" href="#id-introduction-2"></a><a class="link" href="#id-introduction-2">4.1. Introduction</a></h3>
<div class="paragraph">
<p>The Polkadot network is decentralized and does not rely on any central authority
or entity for achieving its fullest potential of provided functionality. The
networking protocol is based on a family of open protocols, including protocol
implemented <em>libp2p</em> e.g. the distributed Kademlia hash table which is used for
peer discovery.</p>
</div>
<div class="paragraph">
<p>This chapter walks through the behavior of the networking implementation of the
Polkadot Host and defines the network messages. The implementation details of
the <em>libp2p</em> protocols used are specified in external sources as described in
<a href="#sect-networking-external-docs">Section 4.2</a></p>
</div>
</div>
<div class="sect2">
<h3 id="sect-networking-external-docs"><a class="anchor" href="#sect-networking-external-docs"></a><a class="link" href="#sect-networking-external-docs">4.2. External Documentation</a></h3>
<div class="paragraph">
<p>Complete specification of the Polkadot networking protocol relies on the
following external protocols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/libp2p/specs">libp2p</a> - <em>libp2p</em> is a modular peer-to-peer
networking stack composed of many modules and different parts. includes the
multiplexing protocols and .</p>
</li>
<li>
<p><a href="https://docs.libp2p.io/concepts/addressing/">libp2p addressing</a> - The Polkadot
Host uses the <em>libp2p</em> addressing system to identify and connect to peers.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Kademlia">Kademlia</a> - <em>Kademlia</em> is a distributed
hash table for decentralized peer-to-peer networks. The Polkadot Host uses
Kademlia for peer discovery.</p>
</li>
<li>
<p><a href="https://noiseprotocol.org/">Noise</a> - The <em>Noise</em> protocol is a framework for
building cryptographic protocols. The Polkadot Host uses Noise to establish the
encryption layer to remote peers.</p>
</li>
<li>
<p><a href="https://docs.libp2p.io/concepts/stream-multiplexing/#yamux">yamux</a> - <em>yamux</em> is
a multiplexing protocol developed by HashiCorp. It is the de-facto standard for
the Polkadot Host. <a href="#sect-protocols-substreams">Section 4.7</a> describes the subprotocol in
more detail.</p>
</li>
<li>
<p><a href="https://developers.google.com/protocol-buffers/docs/reference/proto3-spec">Protocol
Buffers</a> - Protocol Buffers is a language-neutral, platform-neutral mechanism
for serializing structured data and is developed by Google. The Polkadot Host
uses Protocol Buffers to serialize specific messages, as clarified in
<a href="#sect-network-messages">Section 4.8</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="id-node-identities"><a class="anchor" href="#id-node-identities"></a><a class="link" href="#id-node-identities">4.3. Node Identities</a></h3>
<div class="paragraph">
<p>Each Polkadot Host node maintains an ED25519 key pair which is used to
identify the node. The public key is shared with the rest of the network
allowing the nodes to establish secure communication channels.</p>
</div>
<div class="paragraph">
<p>Each node must have its own unique ED25519 key pair. If two or more nodes use
the same key, the network will interpret those nodes as a single node, which
will result in unspecified behavior. Furthermore, the node’s <em>PeerId</em> as
defined in <a href="#defn-peer-id">Definition 34</a> is derived from its public key. <em>PeerId</em> is used
to identify each node when they are discovered in the course of the discovery
mechanism described in <a href="#sect-discovery-mechanism">Section 4.4</a>.</p>
</div>
<div id="defn-peer-id" class="exampleblock">
<div class="title">Definition 34. <a href="#defn-peer-id">PeerId</a></div>
<div class="content">
<div class="paragraph">
<p>The Polkadot node’s PeerId, formally referred to as \$P_(id)\$, is derived
from the ED25519 public key and is structured based on the
<a href="https://docs.libp2p.io/concepts/peer-id/">libp2p specification</a>, but does not
fully conform to the specification. Specifically, it does not support
<a href="https://github.com/multiformats/cid">CID</a> and the only supported key type is
ED25519.</p>
</div>
<div class="paragraph">
<p>The byte representation of the PeerId is always of the following bytes in this
exact order:</p>
</div>
<div class="stemblock">
<div class="content">
\$b_0 = 0\$
\$b_1 = 36\$
\$b_2 = 8\$
\$b_3 = 1\$
\$b_4 = 18\$
\$b_5 = 32\$
\$b_(6..37) = ...\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$b_0\$ is the <a href="https://github.com/multiformats/multihash#multihash">multihash prefix</a>
of value \$0\$ (implying no hashing is used).</p>
</li>
<li>
<p>\$b_1\$ the length of the PeerId (remaining bytes).</p>
</li>
<li>
<p>\$b_2\$ and \$b_3\$ are a protobuf encoded field-value pair
<a href="https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md#keys">indicating
the used key type</a> (field \$1\$ of value \$1\$ implies <em>ED25519</em>).</p>
</li>
<li>
<p>\$b_4\$, \$b_5\$ and \$b_(6..37)\$ are a protobuf encoded field-value
pair where \$b_5\$ indicates the length of the public key followed by the the
raw ED25519 public key itself, which varies for each Polkadot Host and is always
32 bytes (field \$2\$ contains the public key, which has a field value length prefix).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-discovery-mechanism"><a class="anchor" href="#sect-discovery-mechanism"></a><a class="link" href="#sect-discovery-mechanism">4.4. Discovery mechanism</a></h3>
<div class="paragraph">
<p>The Polkadot Host uses various mechanisms to find peers within the
network, to establish and maintain a list of peers and to share that
list with other peers from the network as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bootstrap nodes</strong> are hard-coded node identities and addresses provided by the
genesis state (<a href="#chapter-genesis">Section A.3</a>).</p>
</li>
<li>
<p><strong>mDNS</strong> is a protocol that performs a broadcast to the local network. Nodes
that might be listening can respond to the broadcast.
<a href="https://github.com/libp2p/specs/blob/master/discovery/mdns.md">The libp2p mDNS
specification</a> defines this process in more detail. This protocol is an optional
implementation detail for Polkadot Host implementers and is not required to
participate in the Polkadot network.</p>
</li>
<li>
<p><strong>Kademlia requests</strong> invoking Kademlia requests, where nodes respond with their
list of available peers. Kademlia requests are performed on a specific substream
as described in <a href="#sect-protocols-substreams">Section 4.7</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-connection-establishment"><a class="anchor" href="#sect-connection-establishment"></a><a class="link" href="#sect-connection-establishment">4.5. Connection establishment</a></h3>
<div class="paragraph">
<p>Polkadot nodes connect to peers by establishing a TCP connection. Once
established, the node initiates a handshake with the remote peers on the
encryption layer. An additional layer on top of the encryption layer, known as
the multiplexing layer, allows a connection to be split into substreams, as
described by the
<a href="https://docs.libp2p.io/concepts/stream-multiplexing/#yamux">yamux specification</a>,
either by the local or remote node.</p>
</div>
<div class="paragraph">
<p>The Polkadot node supports two types of substream protocols.
<a href="#sect-protocols-substreams">Section 4.7</a> describes the usage of each type in more detail:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Request-Response substreams</strong>: After the protocol is negotiated by the
multiplexing layer, the initiator sends a single message containing a request.
The responder then sends a response, after which the substream is then
immediately closed. The requests and responses are prefixed with their
<a href="https://en.wikipedia.org/wiki/LEB128">LEB128</a> encoded length.</p>
</li>
<li>
<p><strong>Notification substreams</strong>. After the protocol is negotiated, the initiator
sends a single handshake message. The responder can then either accept the
substream by sending its own handshake or reject it by closing the substream.
After the substream has been accepted, the initiator can send an unbound number
of individual messages. The responder keeps its sending side of the substream
open, despite not sending anything anymore, and can later close it in order to
signal to the initiator that it no longer wishes to communicate.</p>
<div class="paragraph">
<p>Handshakes and messages are prefixed with their
<a href="https://en.wikipedia.org/wiki/LEB128">LEB128</a> encoded lengths. A handshake can be
empty, in which case the length prefix would be <em>0</em>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Connections are established by using the following protocols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/noise</code> - a protocol that is announced when a connection to a peer is
established.</p>
</li>
<li>
<p><code>/multistream/1.0.0</code> - a protocol that is announced when negotiating an
encryption protocol or a substream.</p>
</li>
<li>
<p><code>/yamux/1.0.0</code> - a protocol used during <em>yamux</em> negotiation. See
<a href="#sect-protocols-substreams">Section 4.7</a> for more information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Polkadot Host can establish a connection with any peer of which it
knows the address. The Polkadot Host supports multiple networking
protocols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>TCP/IP</strong> with addresses in the form of <code>/ip4/1.2.3.4/tcp/30333</code> to establish a TCP
connection and negotiate encryption and a multiplexing layer.</p>
</li>
<li>
<p><strong>WebSocket</strong> with addresses in the form of <code>/ip4/1.2.3.4/tcp/30333/ws</code> to establish a
TCP connection and negotiate the WebSocket protocol within the connection.
Additionally, encryption and multiplexing layer is negotiated within the
WebSocket connection.</p>
</li>
<li>
<p><strong>DNS</strong> addresses in form of <code>/dns/example.com/tcp/30333</code> and <code>/dns/example.com/tcp/30333/ws</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The addressing system is described in the
<a href="https://docs.libp2p.io/concepts/addressing/">libp2p addressing</a> specification.
After a base-layer protocol is established, the Polkadot Host will apply the
Noise protocol to establish the encryption layer as described in
<a href="#sect-encryption-layer">Section 4.6</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-encryption-layer"><a class="anchor" href="#sect-encryption-layer"></a><a class="link" href="#sect-encryption-layer">4.6. Encryption Layer</a></h3>
<div class="paragraph">
<p>Polkadot protocol uses the <em>libp2p</em> Noise framework to build an encryption
protocol. The Noise protocol is a framework for building encryption protocols.
<em>libp2p</em> utilizes that protocol for establishing encrypted communication
channels. Refer to the <a href="https://github.com/libp2p/specs/tree/master/noise">libp2p
Secure Channel Handshake</a> specification for a detailed description.</p>
</div>
<div class="paragraph">
<p>Polkadot nodes use the <a href="https://noiseexplorer.com/patterns/XX/">XX handshake
pattern</a> to establish a connection between peers. The three following steps are
required to complete the handshake process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The initiator generates a keypair and sends the public key to the responder.
The <a href="https://github.com/libp2p/specs/tree/master/noise">Noise specification</a> and
the <a href="https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md">libp2p
PeerId specification</a> describe keypairs in more detail.</p>
</li>
<li>
<p>The responder generates its own key pair and sends its public key back to the
initiator. After that, the responder derives a shared secret and uses it to
encrypt all further communication. The responder now sends its static Noise
public key (which may change anytime and does not need to be persisted on disk),
its <em>libp2p</em> public key and a signature of the static Noise public key signed
with the <em>libp2p</em> public key.</p>
</li>
<li>
<p>The initiator derives a shared secret and uses it to encrypt all further
communication. It also sends its static Noise public key, <em>libp2p</em> public key
and signature to the responder.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After these three steps, both the initiator and responder derive a new shared
secret using the static and session-defined Noise keys, which are used to
encrypt all further communication.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-protocols-substreams"><a class="anchor" href="#sect-protocols-substreams"></a><a class="link" href="#sect-protocols-substreams">4.7. Protocols and Substreams</a></h3>
<div class="paragraph">
<p>After the node establishes a connection with a peer, the use of multiplexing
allows the Polkadot Host to open substreams. <em>libp2p</em> uses the
<a href="https://docs.libp2p.io/concepts/stream-multiplexing/#yamux"><em>yamux protocol</em></a> to
manage substreams and to allow the negotiation of <em>application-specific
protocols</em>, where each protocol serves a specific utility.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host uses multiple substreams whose usage depends on a specific
purpose. Each substream is either a <em>Request-Response substream</em> or a
<em>Notification substream</em>, as described in
<a href="#sect-connection-establishment">Section 4.5</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The prefixes on those substreams are known as protocol identifiers and are
used to segregate communications to specific networks. This prevents any
interference with other networks. <code>dot</code> is used exclusively for Polkadot.
Kusama, for example, uses the protocol identifier <code>ksmcc3</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/ipfs/ping/1.0.0</code> - Open a standardized substream <em>libp2p</em> to a peer and
initialize a ping to verify if a connection is still alive. If the peer does not
respond, the connection is dropped. This is a <em>Request-Response substream</em>.</p>
<div class="paragraph">
<p>Further specification and reference implementation are available in the
<a href="https://docs.libp2p.io/concepts/protocols/#ping">libp2p documentation</a>.</p>
</div>
</li>
<li>
<p><code>/ipfs/id/1.0.0</code> - Open a standardized <em>libp2p</em> substream to a peer to ask for
information about that peer. This is a <em>Request-Response substream</em>, but the
initiator does <strong>not</strong> send any message to the responder and only waits for the
response.</p>
<div class="paragraph">
<p>Further specification and reference implementation are available in the
<a href="https://docs.libp2p.io/concepts/protocols/#identify">libp2p documentation</a>.</p>
</div>
</li>
<li>
<p><code>/dot/kad</code> - Open a standardized substream for Kademlia <code>FIND_NODE</code> requests.
This is a <em>Request-Response substream</em>, as defined by the <em>libp2p</em> standard.</p>
<div class="paragraph">
<p>Further specification and reference implementation are available on
<a href="https://en.wikipedia.org/wiki/Kademlia">Wikipedia</a> respectively the
<a href="https://github.com/libp2p/go-libp2p-kad-dht">golang Github repository</a>.</p>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/light/2</code> - a request and response protocol that allows a light client to
request information about the state. This is a <em>Request-Response substream</em>.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-light-msg">Section 7.4</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/dot/light/2</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/block-announces/1</code> - a substream/notification protocol which sends
blocks to connected peers. This is a <em>Notification substream</em>.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-msg-block-announce">Section 4.8.1</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/dot/block-announces/1</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/sync/2</code> - a request and response protocol that allows the Polkadot Host
to request information about blocks. This is a <em>Request-Response substream</em>.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-msg-block-request">Section 4.8.2</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/dot/sync/2</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/sync/warp</code> - a request and response protocol that allows the Polkadot Host
to perform a warp sync request. This is a <em>Request-Response substream</em>.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-msg-warp-sync">Section 4.8.4</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/dot/sync/warp</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/transactions/1</code> - a substream/notification protocol which sends
transactions to connected peers. This is a <em>Notification substream</em>.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-msg-transactions">Section 4.8.5</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/dot/transactions/1</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/grandpa/1</code> - a substream/notification protocol that sends GRANDPA
votes to connected peers. This is a <em>Notification substream</em>.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-msg-grandpa">Section 4.8.6</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/paritytech/grandpa/1</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>/91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3/beefy/1</code> - a substream/notification protocol which sends signed
BEEFY statements, as described in <a href="#sect-grandpa-beefy">Section 6.7</a>, to connected peers.
This is a <em>Notification</em> substream.</p>
<div class="paragraph">
<p>The messages are specified in <a href="#sect-msg-grandpa-beefy">Section 4.8.7</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backwards compatibility reasons, <code>/paritytech/beefy/1</code> is also a valid substream for those messages.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-network-messages"><a class="anchor" href="#sect-network-messages"></a><a class="link" href="#sect-network-messages">4.8. Network Messages</a></h3>
<div class="paragraph">
<p>The Polkadot Host must actively communicate with the network in order to
participate in the validation process or act as a full node.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Polkadot network originally only used SCALE encoding for all message
formats. Meanwhile, Protobuf has been adopted for certain messages. The encoding
of each listed message is always SCALE encoded unless Protobuf is explicitly
mentioned. Encoding and message formats are subject to change.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sect-msg-block-announce"><a class="anchor" href="#sect-msg-block-announce"></a><a class="link" href="#sect-msg-block-announce">4.8.1. Announcing blocks</a></h4>
<div class="paragraph">
<p>When the node creates or receives a new block, it must be announced to the
network. Other nodes within the network will track this announcement and can
request information about this block. The mechanism for tracking announcements
and requesting the required data is implementation-specific.</p>
</div>
<div class="paragraph">
<p>Block announcements, requests and responses are sent over the substream as
described in <a href="#defn-block-announce-handshake">Definition 35</a>.</p>
</div>
<div id="defn-block-announce-handshake" class="exampleblock">
<div class="title">Definition 35. <a href="#defn-block-announce-handshake">Block Announce Handshake</a></div>
<div class="content">
<div class="paragraph">
<p>The <code>BlockAnnounceHandshake</code> initializes a substream to a remote peer. Once
established, all <code>BlockAnounce</code> messages (<a href="#defn-block-announce">Definition 36</a>) created by
the node are sent to the <code>/dot/block-announces/1</code> substream.</p>
</div>
<div class="paragraph">
<p>The <code>BlockAnnounceHandshake</code> is a structure of the following
format:</p>
</div>
<div class="stemblock">
<div class="content">
\$BA_h = "Enc"_("SC")(R, N_B, h_B, h_G)\$
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(1,"The node is a full node"),(2,"The node is a light client"),(4,"The node is a validator"):}\$
\$N_B = "Best block number according to the node"\$
\$h_B = "Best block hash according to the node"\$
\$h_G = "Genesis block hash according to the node"\$
</div>
</div>
</div>
</div>
<div id="defn-block-announce" class="exampleblock">
<div class="title">Definition 36. <a href="#defn-block-announce">Block Announce</a></div>
<div class="content">
<div class="paragraph">
<p>The <code>BlockAnnounce</code> message is sent to the specified substream and indicates to
remote peers that the node has either created or received a new block.</p>
</div>
<div class="paragraph">
<p>The message is a structure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$BA = "Enc"_("SC")("Head"(B),b)\$
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Head"(B) = "Header of the announced block"\$
\$b = {(0,"Is not part of the best chain"),(1,"Is the best block according to the node"):}\$
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-msg-block-request"><a class="anchor" href="#sect-msg-block-request"></a><a class="link" href="#sect-msg-block-request">4.8.2. Requesting Blocks</a></h4>
<div class="paragraph">
<p>Block requests can be used to retrieve a range of blocks from peers. Those
messages are sent over the <code>/dot/sync/2</code> substream.</p>
</div>
<div id="defn-msg-block-request" class="exampleblock">
<div class="title">Definition 37. <a href="#defn-msg-block-request">Block Request</a></div>
<div class="content">
<div class="paragraph">
<p>The <code>BlockRequest</code> message is a Protobuf serialized structure of the following format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bits of block data to request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$B_f\$</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oneof</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start from this block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$B_s\$</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Direction</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sequence direction, interpreted as Id <em>0</em> (ascending) if missing.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum amount (<em>optional</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$B_m\$</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$B_f\$ indicates all the fields that should be included in the request.
its <strong>big-endian</strong> encoded bitmask that applies to all desired fields with bitwise
OR operations. For example, the \$B_f\$ value to request <em>Header</em> and
<em>Justification</em> is <em>0001 0001</em> (17).</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000 0001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000 0010</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001 0000</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>\$B_s\$ is a Protobuf structure indicating a varying data
type (enum) of the following values:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The block hash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The block number</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><em>Direction</em> is a Protobuf structure indicating the sequence direction of the
requested blocks. The structure is a varying data type (enum) of the following
format:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate in ascending order (from child to parent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate in descending order (from parent to canonical child)</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>\$B_m\$ is the number of blocks to be returned. An implementation defined
maximum is used when unspecified.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-msg-block-response" class="exampleblock">
<div class="title">Definition 38. <a href="#defn-msg-block-response">Block Response</a></div>
<div class="content">
<div class="paragraph">
<p>The <code>BlockResponse</code> message is received after sending a <code>BlockRequest</code> message
to a peer. The message is a Protobuf serialized structure of the following
format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repeated <em>BlockData</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block data for the requested sequence</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>where <em>BlockData</em> is a Protobuf structure containing the requested blocks. Do
note that the optional values are either present or absent depending on the
requested fields (bitmask value). The structure has the following format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 45.4545%;">
<col style="width: 27.2728%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block header hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#defn-block-header-hash">Definition 12</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block header (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#defn-block-header">Definition 10</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repeated <code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block body (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#defn-block-body">Definition 13</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block receipt (optional)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block message queue (optional)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justification (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#defn-grandpa-justification">Definition 78</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the justification is empty (i.e. should be ignored)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-msg-state-request"><a class="anchor" href="#sect-msg-state-request"></a><a class="link" href="#sect-msg-state-request">4.8.3. Requesting States</a></h4>
<div class="paragraph">
<p>The Polkadot Host can request the state in form of a key/value list at a
specified block.</p>
</div>
<div class="paragraph">
<p>When receiving state entries from the state response messages
(<a href="#defn-msg-state-response">Definition 40</a>), the node can verify the entries with the entry
proof (id <em>1</em> in <em>KeyValueStorage</em>) against the merkle root in the block header
(of the block specified in <a href="#defn-msg-state-request">Definition 39</a>). Once the state response
message claims that all entries have been sent (id <em>3</em> in <em>KeyValueStorage</em>),
the node can use all collected entry proofs and validate it against the merkle
root to confirm that claim.</p>
</div>
<div class="paragraph">
<p>See the the synchronization chapter for more information (<a href="#chap-sync">Chapter 3</a>).</p>
</div>
<div id="defn-msg-state-request" class="exampleblock">
<div class="title">Definition 39. <a href="#defn-msg-state-request">State Request</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>state request</strong> is sent to a peer to request the state at a specified block.
The message is a single 32-byte Blake2 hash which indicates the block from which
the sync should start.</p>
</div>
<div class="paragraph">
<p>Depending on what substream is used, he remote peer either sends back a state
response (<a href="#defn-msg-state-response">Definition 40</a>) on the <code>/dot/sync/2</code> substream or a warp
sync proof (<a href="#defn-warp-sync-proof">Definition 41</a>) on the <code>/dot/sync/warp</code>.</p>
</div>
</div>
</div>
<div id="defn-msg-state-response" class="exampleblock">
<div class="title">Definition 40. <a href="#defn-msg-state-response">State Response</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>state response</strong> is sent to the peer that initialized the state request
(<a href="#defn-msg-state-request">Definition 39</a>) and contains a list of key/value entries with an
associated proof. This response is sent continuously until all key/value pairs
have been submitted.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repeated KeyValueStateEntry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State entries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State proof</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>where <em>KeyValueStateEntry</em> is of the following format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root of the entry, empty if top level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repeated StateEntry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of key/values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal 'true' if there are no more keys to return.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>and <em>StateEntry</em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the entry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the entry</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-msg-warp-sync"><a class="anchor" href="#sect-msg-warp-sync"></a><a class="link" href="#sect-msg-warp-sync">4.8.4. Warp Sync</a></h4>
<div class="paragraph">
<p>The warp sync protocols allows nodes to retrieve blocks from remote peers where
authority set changes occurred. This can be used to speed up synchronization to
the latest state.</p>
</div>
<div class="paragraph">
<p>See the the synchronization chapter for more information (<a href="#chap-sync">Chapter 3</a>).</p>
</div>
<div id="defn-warp-sync-proof" class="exampleblock">
<div class="title">Definition 41. <a href="#defn-warp-sync-proof">Warp Sync Proof</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>warp sync proof</strong> message, \$P\$, is sent to the peer that initialized
the state request (<a href="#defn-msg-state-request">Definition 39</a>) on the <code>/dot/sync/warp</code> substream
and contains accumulated proof of multiple authority set changes
(<a href="#sect-consensus-message-digest">Section 3.3.2</a>). It&#8217;s a datastructure of the following
format:</p>
</div>
<div class="stemblock">
<div class="content">
\$P = (f_x...f_y, c)\$
</div>
</div>
<div class="paragraph">
<p>\$f_x...f_y\$ is an array consisting of warp sync fragments of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$f_x = (B_h, J^(r,"stage")(B))\$
</div>
</div>
<div class="paragraph">
<p>where \$B_h\$ is the last block header containing a digest item
(<a href="#defn-digest">Definition 11</a>) signaling an authority set change from which the next
authority set change can be fetched from. \$J^(r,"stage")(B)\$ is the GRANDPA
justification (<a href="#defn-grandpa-justification">Definition 78</a>) and \$c\$ is a boolean that
indicates whether the warp sync has been completed.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-msg-transactions"><a class="anchor" href="#sect-msg-transactions"></a><a class="link" href="#sect-msg-transactions">4.8.5. Transactions</a></h4>
<div class="paragraph">
<p>Transactions (<a href="#sect-extrinsics">Section 2.3</a>) are sent directly to peers with which the
Polkadot Host has an open transaction substream (<a href="#defn-transactions-message">Definition 42</a>).
Polkadot Host implementers should implement a mechanism that only sends a
transaction once to each peer and avoids sending duplicates. Sending duplicate
transactions might result in undefined consequences such as being blocked for
bad behavior by peers.</p>
</div>
<div class="paragraph">
<p>The mechanism for managing transactions is further described in Section
<a href="#sect-extrinsics">Section 2.3</a>.</p>
</div>
<div id="defn-transactions-message" class="exampleblock">
<div class="title">Definition 42. <a href="#defn-transactions-message">Transaction Message</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>transactions message</strong> is the structure of how the transactions are sent
over the network. It is represented by \$M_T\$ and is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_T := "Enc"_("SC")(C_1,...,C_n)\$
</div>
</div>
<div class="paragraph">
<p>in which:</p>
</div>
<div class="stemblock">
<div class="content">
\$C_i := "Enc"_("SC")(E_i)\$
</div>
</div>
<div class="paragraph">
<p>Where each \$E_i\$ is a byte array and represents a separate
extrinsic. The Polkadot Host is agnostic about the content of an
extrinsic and treats it as a blob of data.</p>
</div>
<div class="paragraph">
<p>Transactions are sent over the <code>/dot/transactions/1</code> substream.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-msg-grandpa"><a class="anchor" href="#sect-msg-grandpa"></a><a class="link" href="#sect-msg-grandpa">4.8.6. GRANDPA Messages</a></h4>
<div class="paragraph">
<p>The exchange of GRANDPA messages is conducted on the substream. The process for
the creation and distributing these messages is described in <a href="#sect-finality">Chapter 6</a>.
The underlying messages are specified in this section.</p>
</div>
<div id="defn-gossip-message" class="exampleblock">
<div class="title">Definition 43. <a href="#defn-gossip-message">Grandpa Gossip Message</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA gossip message</strong>, \$M\$, is a varying datatype
(<a href="#defn-varrying-data-type">Definition 188</a>) which identifies the message type that is cast by
a voter followed by the message itself.</p>
</div>
<div class="stemblock">
<div class="content">
\$M = {(0,"Vote message", V_m),(1,"Commit message", C_m),(2,"Neighbor message", N_m),(3,"Catch-up request message",R_m),(4,"Catch-up message",U_m):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$V_m\$ is defined in <a href="#defn-grandpa-vote-msg">Definition 44</a>.</p>
</li>
<li>
<p>\$C_m\$ is defined in <a href="#defn-grandpa-commit-msg">Definition 46</a>.</p>
</li>
<li>
<p>\$N_m\$ is defined in <a href="#defn-grandpa-neighbor-msg">Definition 47</a>.</p>
</li>
<li>
<p>\$R_m\$ is defined in <a href="#defn-grandpa-catchup-request-msg">Definition 48</a>.</p>
</li>
<li>
<p>\$U_M\$ is defined in <a href="#defn-grandpa-catchup-response-msg">Definition 49</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-grandpa-vote-msg" class="exampleblock">
<div class="title">Definition 44. <a href="#defn-grandpa-vote-msg">GRANDPA Vote Messages</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA vote message</strong> by voter \$v\$, \$M_v^(r,"stage")\$, is gossip to
the network by voter \$v\$ with the following structure:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_v^(r,"stage")(B) := "Enc"_("SC")(r,"id"_(bbb V),"SigMsg")\$
\$"SigMsg" := ("msg","Sig"_(v_i)^(r,"stage"),v_("id"))\$
\$"msg" := "Enc"_("SC")("stage",V_v^(r,"stage")(B))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$r\$ is an unsigned 64-bit integer indicating the Grandpa round number
(<a href="#defn-voting-rounds">Definition 76</a>).</p>
</li>
<li>
<p>\$"id"_(bbb V)\$ is an unsigned 64-bit integer indicating the authority Set Id (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$"Sig"_(v_i)^(r,"stage")\$ is a 512-bit byte array containing the
signature of the authority (<a href="#defn-sign-round-vote">Definition 77</a>).</p>
</li>
<li>
<p>\$v_(id)\$ is a 256-bit byte array containing the <em>ed25519</em> public key of the authority.</p>
</li>
<li>
<p>\$"stage"\$ is a 8-bit integer of value <em>0</em> if it&#8217;s a pre-vote sub-round, <em>1</em> if it&#8217;s a pre-commit sub-round or <em>2</em> if it&#8217;s a primary proposal message.</p>
</li>
<li>
<p>\$V_v^(r,"stage")(B)\$ is the GRANDPA vote for block \$B\$ (<a href="#defn-voting-rounds">Definition 76</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This message is the sub-component of the GRANDPA gossip message
(<a href="#defn-gossip-message">Definition 43</a>) of type Id 0.</p>
</div>
</div>
</div>
<div id="defn-grandpa-justifications-compact" class="exampleblock">
<div class="title">Definition 45. <a href="#defn-grandpa-justifications-compact">GRANDPA Compact Justification Format</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>GRANDPA compact justification format</strong> is an optimized data structure to
store a collection of pre-commits and their signatures to be submitted as part
of a commit message. Instead of storing an array of justifications, it uses the
following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$J_(v_(0,...n))^(r,"comp") := ({V_(v_0)^(r,pc),... V_(v_n)^(r,pc)},{("Sig"_(v_0)^(r,pc),v_("id"_0)), ... ("Sig"_(v_n)^(r,pc),v_("id"_n))})\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$V_(v_i)^(r,pc)\$ is a 256-bit byte array containing the pre-commit vote of authority \$v_i\$ (<a href="#defn-voting-rounds">Definition 76</a>).</p>
</li>
<li>
<p>\$"Sig"_(v_i)^(r,pc)\$ is a 512-bit byte array containing the pre-commit
signature of authority \$v_i\$ (<a href="#defn-sign-round-vote">Definition 77</a>).</p>
</li>
<li>
<p>\$v_("id"_n)\$ is a 256-bit byte array containing the public key of authority \$v_i\$.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-grandpa-commit-msg" class="exampleblock">
<div class="title">Definition 46. <a href="#defn-grandpa-commit-msg">GRANDPA Commit Message</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA commit message</strong> for block \$B\$ in round \$r\$,
\$M_v^(r,"Fin")(B)\$, is a message broadcasted by voter \$v\$ to the
network indicating that voter \$v\$ has finalized block \$B\$ in round
\$r\$. It has the following structure:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_v^(r,"Fin")(B) := "Enc"_("SC")(r,"id"_(bbb V),V_v^r(B),J_(v_(0,...n))^(r,"comp"))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$r\$ is an unsigned 64-bit integer indicating the round number (<a href="#defn-voting-rounds">Definition 76</a>).</p>
</li>
<li>
<p>\$id_(bbb V)\$ is the authority set Id (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$V_v^r(B)\$ is a 256-bit array containing the GRANDPA vote for block
\$B\$ (<a href="#defn-vote">Definition 75</a>).</p>
</li>
<li>
<p>\$J_(v_(0,...n))^(r,"comp")\$ is the compacted GRANDPA justification
containing observed pre-commit of authorities \$v_0\$ to \$v_n\$
(<a href="#defn-grandpa-justifications-compact">Definition 45</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This message is the sub-component of the GRANDPA gossip message
(<a href="#defn-gossip-message">Definition 43</a>) of type Id <em>1</em>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-grandpa-neighbor-msg"><a class="anchor" href="#sect-grandpa-neighbor-msg"></a><a class="link" href="#sect-grandpa-neighbor-msg">4.8.6.1. GRANDPA Neighbor Messages</a></h5>
<div class="paragraph">
<p>Neighbor messages are sent to all connected peers but they are not
repropagated on reception. A message should be send whenever the
messages values change and at least every 5 minutes. The sender should
take the recipients state into account and avoid sending messages to
peers that are using a different voter sets or are in a different round.
Messages received from a future voter set or round can be dropped and
ignored.</p>
</div>
<div id="defn-grandpa-neighbor-msg" class="exampleblock">
<div class="title">Definition 47. <a href="#defn-grandpa-neighbor-msg">GRANDPA Neighbor Message</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA Neighbor Message</strong> is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$M^("neigh") := "Enc"_("SC")(v,r,"id"_(bbb V),H_i(B_("last")))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$v\$ is an unsigned 8-bit integer indicating the version of the neighbor message, currently <em>1</em>.</p>
</li>
<li>
<p>\$r\$ is an unsigned 64-bit integer indicating the round number (<a href="#defn-voting-rounds">Definition 76</a>).</p>
</li>
<li>
<p>\$"id"_(bbb V)\$ is an unsigned 64-bit integer indicating the authority
Id (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$H_i(B_("last"))\$ is an unsigned 32-bit integer indicating the block number of the last finalized block \$B_("last")\$.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This message is the sub-component of the GRANDPA gossip message
(<a href="#defn-gossip-message">Definition 43</a>) of type Id <em>2</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-grandpa-catchup-messages"><a class="anchor" href="#sect-grandpa-catchup-messages"></a><a class="link" href="#sect-grandpa-catchup-messages">4.8.6.2. GRANDPA Catch-up Messages</a></h5>
<div class="paragraph">
<p>Whenever a Polkadot node detects that it is lagging behind the finality
procedure, it needs to initiate a <em>catch-up</em> procedure. GRANDPA Neighbor
messages (<a href="#defn-grandpa-neighbor-msg">Definition 47</a>) reveal the round number for the last
finalized GRANDPA round which the node’s peers have observed. This provides the
means to identify a discrepancy in the latest finalized round number observed
among the peers. If such a discrepancy is observed, the node needs to initiate
the catch-up procedure explained in <a href="#sect-grandpa-catchup">Section 6.6.1</a>).</p>
</div>
<div class="paragraph">
<p>In particular, this procedure involves sending a <em>catch-up request</em> and
processing <em>catch-up response</em> messages.</p>
</div>
<div id="defn-grandpa-catchup-request-msg" class="exampleblock">
<div class="title">Definition 48. <a href="#defn-grandpa-catchup-request-msg">Catch-Up Request Message</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA catch-up request message</strong> for round \$r\$,
\$M_(i,v)^("Cat"-q)("id"_(bbb V),r)\$, is a message sent from node \$i\$
to its voting peer node \$v\$ requesting the latest status of a GRANDPA round
\$r' &gt;r\$ of the authority set \$bbb V_("id")\$ along with the
justification of the status and has the following structure:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_(i,v)^(r,"Cat"-q) := "Enc"_("SC")(r,"id"_(bbb V))\$
</div>
</div>
<div class="paragraph">
<p>This message is the sub-component of the GRANDPA Gossip message
(<a href="#defn-gossip-message">Definition 43</a>) of type Id <em>3</em>.</p>
</div>
</div>
</div>
<div id="defn-grandpa-catchup-response-msg" class="exampleblock">
<div class="title">Definition 49. <a href="#defn-grandpa-catchup-response-msg">Catch-Up Response Message</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA catch-up response message</strong> for round \$r\$,
\$M_(v,i)^("Cat"-s)("id"_(bbb V),r)\$, is a message sent by a node \$v\$
to node \$i\$ in response of a catch-up request
\$M_(v,i)^("Cat"-q)("id"_(bbb V),r')\$ in which \$r &gt;= r'\$ is the
latest GRANDPA round which v has prove of its finalization and has the following
structure:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_(v,i)^("Cat"-s) := "Enc"_("SC")("id"_(bbb V), r, J_(0,...n)^(r,"pv")(B), J_(0,...m)^(r,"pc")(B),H_h(B'),H_i(B'))\$
</div>
</div>
<div class="paragraph">
<p>Where \$B\$ is the highest block which \$v\$ believes to be finalized in
round \$r\$ (<a href="#defn-voting-rounds">Definition 76</a>). \$B'\$ is the highest ancestor of
all blocks voted on in the arrays of justifications \$J_(0,...n)^(r,"pv")(B)\$
and \$J_(0,...m)^(r,"pc")(B)\$ (<a href="#defn-grandpa-justification">Definition 78</a>) with the
exception of the equivocatory votes.</p>
</div>
<div class="paragraph">
<p>This message is the sub-component of the GRANDPA Gossip message
(<a href="#defn-gossip-message">Definition 43</a>) of type Id <em>4</em>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-msg-grandpa-beefy"><a class="anchor" href="#sect-msg-grandpa-beefy"></a><a class="link" href="#sect-msg-grandpa-beefy">4.8.7. GRANDPA BEEFY</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The BEEFY protocol is currently in early development and subject to
change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This section defines the messages required for the GRANDPA BEEFY protocol
(<a href="#sect-grandpa-beefy">Section 6.7</a>). Those messages are sent over the <code>/paritytech/beefy/1</code>
substream.</p>
</div>
<div id="defn-grandpa-beefy-commitment" class="exampleblock">
<div class="title">Definition 50. <a href="#defn-grandpa-beefy-commitment">Commitment</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>commitment</strong>, \$C\$, contains the information extracted from the finalized
block at height \$H_i(B_("last"))\$ as specified in the message body and a
datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$C = (R_h,H_i(B_("last")),"id"_(bbb V))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$R_h\$ is the MMR root of all the block header hashes leading up to the
latest, finalized block.</p>
</li>
<li>
<p>\$H_i(B_("last"))\$ is the block number this commitment is for. Namely the
latest, finalized block.</p>
</li>
<li>
<p>\$"id"_(bbb V)\$ is the current authority set Id (<a href="#defn-authority-set-id">Definition 73</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-msg-beefy-gossip" class="exampleblock">
<div class="title">Definition 51. <a href="#defn-msg-beefy-gossip">Vote Message</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>vote message</strong>, \$M_v\$, is direct vote created by the Polkadot Host on every
BEEFY round and is gossiped to its peers. The message is a datastructure of the
following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_v = "Enc"_("SC")(C,A_("id")^("bfy"),A_("sig"))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$C\$ is the BEEFY commitment (<a href="#defn-grandpa-beefy-commitment">Definition 50</a>).</p>
</li>
<li>
<p>\$A_("id")^("bfy")\$ is the ECDSA public key of the Polkadot Host.</p>
</li>
<li>
<p>\$A_("sig")\$ is the signature created with \$A_("id")^("bfy")\$ by
signing the statement \$R_h\$ in \$C\$.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-grandpa-beefy-signed-commitment" class="exampleblock">
<div class="title">Definition 52. <a href="#defn-grandpa-beefy-signed-commitment">Signed Commitment</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>signed commitment</strong>, \$M_("sc")\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_("SC") = "Enc"_("SC")(C,S_n)\$
\$S_n = (A_0^("sig"),... A_n^("sig"))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$C\$ is the BEEFY commitment (<a href="#defn-grandpa-beefy-commitment">Definition 50</a>).</p>
</li>
<li>
<p>\$S_n\$ is an array where its exact size matches the number of validators
in the current authority set as specified by \$"id"_(bbb V)\$
(<a href="#defn-authority-set-id">Definition 73</a>) in \$C\$. Individual items are of the type
<em>Option</em> (<a href="#defn-option-type">Definition 190</a>) which can contain a signature of a validator
which signed the same statement (\$R_h\$ in \$C\$) and is active in the
current authority set. It’s critical that the signatures are sorted based on
their corresponding public key entry in the authority set.</p>
<div class="paragraph">
<p>For example, the signature of the validator at index 3 in the authority set must
be placed at index <em>3</em> in \$S_n\$. If not signature is available for that
validator, then the <em>Option</em> variant is <em>None</em> inserted (<a href="#defn-option-type">Definition 190</a>).
This sorting allows clients to map public keys to their corresponding
signatures.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-grandpa-beefy-signed-commitment-witness" class="exampleblock">
<div class="title">Definition 53. <a href="#defn-grandpa-beefy-signed-commitment-witness">Signed Commitment Witness</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>signed commitment witness</strong>, \$M_("SC")^w\$, is a light version of the signed
BEEFY commitment (<a href="#defn-grandpa-beefy-signed-commitment">Definition 52</a>). Instead of
containing the entire list of signatures, it only claims which validator signed
the statement.</p>
</div>
<div class="paragraph">
<p>The message is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M_("SC")^w = "Enc"_("SC")(C,V_(0,... n), R_("sig"))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$C\$ is the BEEFY commitment (<a href="#defn-grandpa-beefy-commitment">Definition 50</a>).</p>
</li>
<li>
<p>\$V_(0,... n)\$ is an array where its exact size matches the number of
validators in the current authority set as specified by \$"id"_(bbb V)\$ in
\$C\$. Individual items are booleans which indicate whether the validator has
signed the statement (<em>true</em>) or not (<em>false</em>). It’s critical that the boolean
indicators are sorted based on their corresponding public key entry in the
authority set.</p>
<div class="paragraph">
<p>For example, the boolean indicator of the validator at index 3 in the authority
set must be placed at index <em>3</em> in \$V_n\$. This sorting allows clients to
map public keys to their corresponding boolean indicators.</p>
</div>
</li>
<li>
<p>\$R_("sig")\$ is the MMR root of the signatures in the original signed
BEEFY commitment (<a href="#defn-grandpa-beefy-signed-commitment">Definition 52</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-block-production"><a class="anchor" href="#sect-block-production"></a><a class="link" href="#sect-block-production">5. Block Production</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="id-introduction-3"><a class="anchor" href="#id-introduction-3"></a><a class="link" href="#id-introduction-3">5.1. Introduction</a></h3>
<div class="paragraph">
<p>The Polkadot Host uses BABE protocol for block production. It is designed based
on Ouroboros praos . BABE execution happens in sequential non-overlapping phases
known as an <strong><em>epoch</em></strong>. Each epoch on its turn is divided into a predefined
number of slots. All slots in each epoch are sequentially indexed starting from
0. At the beginning of each epoch, the BABE node needs to run
<a href="#algo-block-production-lottery">Algorithm 6</a> to find out in which slots it
should produce a block and gossip to the other block producers. In turn, the
block producer node should keep a copy of the block tree and grow it as it
receives valid blocks from other block producers. A block producer prunes the
tree in parallel by eliminating branches that do not include the most recent
finalized blocks (<a href="#defn-pruned-tree">Definition 5</a>).</p>
</div>
<div class="sect3">
<h4 id="id-block-producer"><a class="anchor" href="#id-block-producer"></a><a class="link" href="#id-block-producer">5.1.1. Block Producer</a></h4>
<div class="paragraph">
<p>A <strong>block producer</strong>, noted by \$cc P_j\$, is a node running the Polkadot
Host which is authorized to keep a transaction queue and which it gets a turn in
producing blocks.</p>
</div>
</div>
<div class="sect3">
<h4 id="id-block-authoring-session-key-pair"><a class="anchor" href="#id-block-authoring-session-key-pair"></a><a class="link" href="#id-block-authoring-session-key-pair">5.1.2. Block Authoring Session Key Pair</a></h4>
<div class="paragraph">
<p><strong>Block authoring session key pair</strong> \$(sk_j^s,pk_j^s)\$ is an SR25519 key pair
which the block producer \$cc P_j\$ signs by their account key
(<a href="#defn-account-key">Definition 177</a>) and is used to sign the produced block as well as to
compute its lottery values in <a href="#algo-block-production-lottery">Algorithm 6</a>.</p>
</div>
<div id="defn-epoch-slot" class="exampleblock">
<div class="title">Definition 54. <a href="#defn-epoch-slot">Epoch and Slot</a></div>
<div class="content">
<div class="paragraph">
<p>A block production <strong>epoch</strong>, formally referred to as \$cc E\$, is a
period with a pre-known starting time and fixed-length during which the set of
block producers stays constant. Epochs are indexed sequentially, and we refer to
the \$n^(th)\$ epoch since genesis by \$cc E_n\$. Each epoch is divided
into equal-length periods known as block production <strong>slots</strong>, sequentially
indexed in each epoch. The index of each slot is called a <strong>slot number</strong>. The
equal length duration of each slot is called the <strong>slot duration</strong> and indicated
by \$cc T\$. Each slot is awarded to a subset of block producers during
which they are allowed to generate a block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Substrate refers to an epoch as "session" in some places, however,
epoch should be the preferred and official name for these periods.
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="defn-epoch-duration" class="exampleblock">
<div class="title">Definition 55. <a href="#defn-epoch-duration">Epoch and Slot Duration</a></div>
<div class="content">
<div class="paragraph">
<p>We refer to the number of slots in epoch \$cc E_n\$ by \$sc_n\$.
\$sc_n\$ is set to the <code>duration</code> field in the returned data from the call of
the Runtime entry <code>BabeApi_configuration</code> (<a href="#sect-rte-babeapi-epoch">Section C.11.1</a>) at
genesis. For a given block \$B\$, we use the notation <strong>\(s_B\)</strong> to
refer to the slot during which \$B\$ has been produced. Conversely, for slot
\$s\$, \$cc B_c\$ is the set of Blocks generated at slot \$s\$.</p>
</div>
<div class="paragraph">
<p><a href="#defn-epoch-subchain">Definition 56</a> provides an iterator over the blocks produced during a
specific epoch.</p>
</div>
</div>
</div>
<div id="defn-epoch-subchain" class="exampleblock">
<div class="title">Definition 56. <a href="#defn-epoch-subchain">Epoch Subchain</a></div>
<div class="content">
<div class="paragraph">
<p>By \$"SubChain"(cc E_n\$) for epoch \$cc E_n\$, we refer to the path
graph of \$BT\$ containing all the blocks generated during the slots of epoch
\$cc E_n\$. When there is more than one block generated at a slot, we
choose the one which is also on \$"Longest-Chain"(BT)\$.</p>
</div>
</div>
</div>
<div id="defn-equivovation" class="exampleblock">
<div class="title">Definition 57. <a href="#defn-equivocation">Equivocation</a></div>
<div class="content">
<div class="paragraph">
<p>A block producer <strong>equivocates</strong> if they produce more than one block at the same
slot. The proof of equivocation are the given distinct headers that were signed
by the validator and which include the slot number.</p>
</div>
<div class="paragraph">
<p>The Polkadot Host must detect equivocations committed by other validators and
submit those to the Runtime as described in
<a href="#sect-babeapi_submit_report_equivocation_unsigned_extrinsic">Section C.11.6</a>.</p>
</div>
</div>
</div>
<div id="defn-consensus-message-babe" class="exampleblock">
<div class="title">Definition 58. <a href="#defn-consensus-message-babe">BABE Consensus Message</a></div>
<div class="content">
<div class="paragraph">
<p>\$"CM"_b\$, the consensus message for BABE, is of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$"CM"_b = {(1,("Auth"_C, r)),(2,A_i),(3,D):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
</dl>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
1
</td>
<td class="hdlist2">
<p>implies <strong>next epoch data</strong>: The Runtime issues this message on every first
block of an epoch. The supplied authority set (<a href="#defn-authority-list">Definition 33</a>),
\$"Auth"_C\$, and randomness (<a href="#defn-epoch-randomness">Definition 71</a>), \$r\$, are used
in the next epoch \$cc E_n + 1\$.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
2
</td>
<td class="hdlist2">
<p>implies <strong>on disabled</strong>: A 32-bit integer, \$A_i\$, indicating the
individual authority in the current authority list that should be immediately
disabled until the next authority set changes. This message initial intension
was to cause an immediate suspension of all authority functionality with the
specified authority.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
3
</td>
<td class="hdlist2">
<p>implies <strong>next epoch descriptor</strong>: These messages are only issued on
configuration change and in the first block of an epoch. The supplied
configuration data are intended to be used from the next epoch onwards.</p>
<div class="ulist">
<ul>
<li>
<p>\$D\$ is a varying datatype of the following format:</p>
<div class="stemblock">
<div class="content">
\$D = {(1, (c,2_("nd"))):}\$
</div>
</div>
<div class="paragraph">
<p>where \$c\$ is the probability that a slot will not be empty
(<a href="#defn-babe-constant">Definition 59</a>). It is encoded as a tuple of two unsigned 64-bit
integers \$(c_("nominator"),c_("denominator"))\$ which are used to compute
the rational \$c = c_("nominator")/c_("denominator")\$.</p>
</div>
</li>
<li>
<p>\$2_("nd")\$ describes what secondary slot (<a href="#defn-babe-secondary-slots">Definition 61</a>),
if any, is to be used. It is encoded as one-byte varying datatype:</p>
<div class="stemblock">
<div class="content">
\$s_"2nd" = {
	(0,-&gt;,"no secondary slot"),
	(1,-&gt;,"plain secondary slot"),
	(2,-&gt;,"secondary slot with VRF output")
:}\$
</div>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-block-production-lottery"><a class="anchor" href="#sect-block-production-lottery"></a><a class="link" href="#sect-block-production-lottery">5.2. Block Production Lottery</a></h3>
<div class="paragraph">
<p>The babe constant (<a href="#defn-babe-constant">Definition 59</a>) is initialized at genesis to the
value returned by calling <code>BabeApi_configuration</code> (<a href="#sect-rte-babeapi-epoch">Section C.11.1</a>).
For efficiency reasons, it is generally updated by the Runtime through the <em>next
config data</em> consensus message in the digest (<a href="#defn-digest">Definition 11</a>)
of the first block of an epoch for the next epoch.</p>
</div>
<div class="paragraph">
<p>A block producer aiming to produce a block during \$cc E_n\$ should run
&lt;algo-block-production-lottery&gt;&gt; to identify the slots it is awarded. These
are the slots during which the block producer is allowed to build a block. The
\$sk\$ is the block producer lottery secret key and \$n\$ is the index of
the epoch for whose slots the block producer is running the lottery.</p>
</div>
<div class="paragraph">
<p>In order to ensure consistent block production, BABE uses secondary slots in
case no authority won the (primary) block production lottery. Unlike the
lottery, secondary slot assignees are know upfront publically
(<a href="#defn-babe-secondary-slots">Definition 61</a>). The Runtime provides information on how
or if secondary slots are executed (<a href="#sect-rte-babeapi-epoch">Section C.11.1</a>), explained
further in <a href="#defn-babe-secondary-slots">Definition 61</a>.</p>
</div>
<div id="defn-babe-constant" class="exampleblock">
<div class="title">Definition 59. <a href="#defn-babe-constant">BABE Constant</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>BABE constant</strong> is the probability that a slot will not be empty and used in
the winning threshold calculation (<a href="#defn-winning-threshold">Definition 60</a>). It&#8217;s expressed
as a rational, \$(x, y)\$, where \$x\$ is the numerator and \$y\$ is
the denominator.</p>
</div>
</div>
</div>
<div id="defn-winning-threshold" class="exampleblock">
<div class="title">Definition 60. <a href="#defn-winning-threshold">Winning Threshold</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Winning threshold</strong> denoted by \$T_(cc E_n)\$ is the threshold that is
used alongside the result of <a href="#algo-block-production-lottery">Algorithm 6</a> to decide if a
block producer is the winner of a specific slot. \$T_(cc E_n)\$ is calculated
as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$A_w =sum_(n=1)^(|"Auth"_C(B)|)(w_A in "Auth"_C(B)_n)\$
\$T_(cc E_n) := 1 - (1 - c)^(w_a/A_w)\$
</div>
</div>
<div class="paragraph">
<p>where \$A_w\$ is the total sum of all authority weights in the authority set
(<a href="#defn-authority-list">Definition 33</a>) for epoch \$cc E_n\$, \$w_a\$ is the weight of
the block author and \$c in (0, 1)\$ is the BABE constant
(<a href="#defn-babe-constant">Definition 59</a>).</p>
</div>
<div class="paragraph">
<p>The numbers should be treated as 64-bit rational numbers.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-primary-block-production-lottery"><a class="anchor" href="#id-primary-block-production-lottery"></a><a class="link" href="#id-primary-block-production-lottery">5.2.1. Primary Block Production Lottery</a></h4>
<div class="paragraph">
<p>A block producer aiming to produce a block during \$cc E_n\$ should run the
\$"Block-Production-Lottery"\$ algorithm to identify the slots it is awarded.
These are the slots during which the block producer is allowed to build a block.
The session secret key, \$sk\$, is the block producer lottery secret key and
\$n\$ is the index of the epoch for whose slots the block producer is running
the lottery.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-block-production-lottery" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 6 </span><span style="font-style:normal;font-variant:small-caps;">Block-Production-Lottery</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span>sk</p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">r \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Epoch-Randomness</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>:</mo><mo>=</mo><mn>1</mn><mtext> </mtext><mtext mathvariant="bold">to</mtext><mtext> </mtext><mi>s</mi><msub><mi>c</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">i := 1 ~\textbf{to}~ sc_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">1</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">to</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>π</mi><mo separator="true">,</mo><mi>d</mi><mo stretchy="false">)</mo><mo>←</mo></mrow><annotation encoding="application/x-tex">(\pi, d) \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">VRF</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mi>s</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">r, i, sk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>←</mo><mo stretchy="false">(</mo><mi>d</mi><mo separator="true">,</mo><mi>π</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A[i] \leftarrow (d, \pi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mclose">)</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">return </span>A</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 6. <a href="#algo-block-production-lottery">Block-Production-Lottery</a></div>
          </div>
<div class="paragraph">
<p>where \$"Epoch-Randomness"\$ is defined in (<a href="#defn-epoch-randomness">Definition 71</a>),
\$sc_n\$ is defined in <a href="#defn-epoch-duration">Definition 55</a> , \$"VRF"\$ creates the
BABE VRF transcript (<a href="#defn-babe-vrf-transcript">Definition 62</a>) and \$e_i\$ is the epoch
index, retrieved from the Runtime (<a href="#sect-rte-babeapi-epoch">Section C.11.1</a>). \$s_k\$ and
\$p_k\$ is the secret key respectively the public key of the authority. For
any slot \$s\$ in epoch \$n\$ where \$o &lt; T_(cc E_n)\$
(<a href="#defn-winning-threshold">Definition 60</a>), the block producer is required to produce a block.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the secondary slots (<a href="#defn-babe-secondary-slots">Definition 61</a>) are running
along side the primary block production lottery and mainly serve as a fallback
to in case no authority was selected in the primary lottery.
</td>
</tr>
</table>
</div>
<div id="defn-babe-secondary-slots" class="exampleblock">
<div class="title">Definition 61. <a href="#defn-babe-secondary-slots">Secondary Slots</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Secondary slots</strong> work along side primary slot to ensure consistent block
production, as described in <a href="#sect-block-production-lottery">Section 5.2</a>. The secondary
assignee of a block is determined by calculating a specific value, \$i_d\$,
which indicates the index in the authority set (<a href="#defn-authority-list">Definition 33</a>). The
corresponding authority in that set has the right to author a secondary block.
This calculation is done for every slot in the epoch, \$s in sc_n\$
(<a href="#defn-epoch-duration">Definition 55</a>).</p>
</div>
<div class="stemblock">
<div class="content">
\$p larr h("Enc"_"SC"(r,s))\$
\$i_d larr p mod A_l\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$r\$ is the Epoch randomness (<a href="#defn-epoch-randomness">Definition 71</a>).</p>
</li>
<li>
<p>\$s\$ is the slot number (<a href="#defn-epoch-slot">Definition 54</a>).</p>
</li>
<li>
<p>\$"Enc"_"SC"(...)\$ encodes its inner value to the corresponding SCALE value.</p>
</li>
<li>
<p>\$h(...)\$ creates a 256-bit Blake2 hash from its inner value.</p>
</li>
<li>
<p>\$A_l\$ is the lengths of the authority list (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If \$i_d\$ points to the authority, that authority must claim the secondary
slot by creating a BABE VRF transcript (<a href="#defn-babe-vrf-transcript">Definition 62</a>). The
resulting values \$o\$ and \$p\$ are then used in the Pre-Digest item
(<a href="#defn-babe-header">Definition 69</a>). In case of secondary slots with plain outputs,
respectively the Pre-Digest being of value <em>2</em>, the transcript respectively the
VRF is skipped.</p>
</div>
</div>
</div>
<div id="defn-babe-vrf-transcript" class="exampleblock">
<div class="title">Definition 62. <a href="#defn-babe-vrf-transcript">BABE Slot VRF transcript</a></div>
<div class="content">
<div class="paragraph">
<p>The BABE block production lottery requires a specific transcript structure
(<a href="#defn-vrf-transcript">Definition 175</a>). That structure is used by both primary slots
(<a href="#algo-block-production-lottery">Algorithm 6</a>) and secondary slots
(<a href="#defn-babe-secondary-slots">Definition 61</a>).</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 larr "Transcript"("'BABE'")\$
\$t_2 larr "append"(t_1, "'slot number'", s)\$
\$t_3 larr "append"(t_2, "'current epoch'", e_i)\$
\$t_4 larr "append"(t_3, "'chain randomness'", r)\$
\$t_5 larr "append"(t_4, "'vrf-nm-pk'", p_k)\$
\$t_6 larr "meta-ad"(t_5, "'VRFHash'", "False")\$
\$t_7 larr "meta-ad"(t_6, 64_"le", "True")\$
\$h larr "prf"(t_7, "False")\$
\$o = s_k * h\$
\$p larr "dleq_prove"(t_7, h)\$
</div>
</div>
<div class="paragraph">
<p>The operators are defined in <a href="#defn-strobe-operations">Definition 176</a>, \$"dleq_prove"\$ in
<a href="#defn-vrf-dleq-prove">Definition 172</a>. The computed outputs, \$o\$ and \$p\$, are
included in the block Pre-Digest (<a href="#defn-babe-header">Definition 69</a>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-slot-number-calculation"><a class="anchor" href="#sect-slot-number-calculation"></a><a class="link" href="#sect-slot-number-calculation">5.3. Slot Number Calculation</a></h3>
<div class="paragraph">
<p>It is imperative for the security of the network that each block producer
correctly determines the current slot numbers at a given time by regularly
estimating the local clock offset in relation to the network
(<a href="#defn-relative-synchronization">Definition 64</a>).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>The calculation described in this section is still to be implemented and
deployed</strong>: For now, each block producer is required to synchronize its local
clock using NTP instead. The current slot \$s\$ is then calculated by \$s
= t_"unix"/cc T\$ where \$cc T\$ is defined in <a href="#defn-epoch-slot">Definition 54</a> and
\$t_"unix"\$ is defined in <a href="#defn-unix-time">Definition 181</a>. That also entails that slot
numbers are currently not reset at the beginning of each epoch.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Polkadot does this synchronization without relying on any external clock source
(e.g. through the or the ). To stay in synchronization, each producer is
therefore required to periodically estimate its local clock offset in relation
to the rest of the network.</p>
</div>
<div class="paragraph">
<p>This estimation depends on the two fixed parameters \$k\$
(<a href="#defn-prunned-best">Definition 65</a>) and \$s_(cq)\$ (<a href="#defn-chain-quality">Definition 66</a>). These are
chosen based on the results of a
<a href="https://research.web3.foundation/en/latest/polkadot/block-production/Babe.html#-5.-security-analysis">formal
security analysis</a>, currently assuming a \$1 s\$ clock drift per day and
targeting a probability lower than \$0.5%\$ for an adversary to break BABE in
3 years with resistance against a network delay up to \$1 / 3\$ of the slot
time and a Babe constant (<a href="#defn-babe-constant">Definition 59</a>) of \$c = 0.38\$.</p>
</div>
<div class="paragraph">
<p>All validators are then required to run <a href="#algo-slot-time">Algorithm 8</a> at the beginning of
each sync period (<a href="#defn-sync-period">Definition 68</a>) to update their synchronization using
all block arrival times of the previous period. The algorithm should only be
run once all the blocks in this period have been finalized, even if only
probabilistically (<a href="#defn-prunned-best">Definition 65</a>). The target slot to which to
synchronize should be the first slot in the new sync period.</p>
</div>
<div id="defn-slot-offset" class="exampleblock">
<div class="title">Definition 63. <a href="#defn-slot-offset">Slot Offset</a></div>
<div class="content">
<div class="paragraph">
<p>Let \$s_i\$ and \$s_j\$ be two slots belonging to epochs \$cc E_k\$
and \$cc E_l\$. By <strong>Slot-Offset</strong>\$(s_i,s_j)\$ we refer to the function
whose value is equal to the number of slots between \$s_i\$ and \$s_j\$
(counting \$s_j\$) on the time continuum. As such, we have
<strong>Slot-Offset</strong>\$(s_i, s_i) = 0\$.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>It is imperative for the security of the network that each block producer
correctly determines the current slot numbers at a given time by regularly
estimating the local clock offset in relation to the network
(<a href="#defn-relative-synchronization">Definition 64</a>).</p>
</div>
<div id="defn-relative-synchronization" class="exampleblock">
<div class="title">Definition 64. <a href="#defn-relative-synchronization">Relative Time Synchronization</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>relative time synchronization</strong> is a tuple of a slot number and a local
clock timestamp \$(s_"sync",t_"sync")\$ describing the last point at
which the slot numbers have been synchronized with the local clock.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-slot-offset" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 7 </span><span style="font-style:normal;font-variant:small-caps;">Slot-Time</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mtext>sync</mtext></msub><mo>+</mo></mrow><annotation encoding="application/x-tex">t_\text{sync} + </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">sync</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">+</span></span></span></span><span class="ps-funcname">Slot-Offset</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>s</mi><mi>y</mi><mi>n</mi><mi>c</mi></mrow></msub><mo separator="true">,</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">s_{sync}, s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">s</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo><mi mathvariant="script">T</mi></mrow><annotation encoding="application/x-tex"> \times \mathcal{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">×</span><span class="mord mathcal" style="margin-right:0.25417em;">T</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 7. <a href="#algo-slot-offset">Slot-Time</a></div>
          </div>
<div class="paragraph">
<p>where \$s\$ is the slot number.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-slot-time" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 8 </span><span style="font-style:normal;font-variant:small-caps;">Median-Algorithm</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="fraktur">E</mi><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>s</mi><mi>y</mi><mi>n</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathfrak{E}, s_{sync}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9775em;vertical-align:-0.2861em;"></span><span class="mord mathfrak">E</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>s</mi></msub><mo>←</mo><mo stretchy="false">{</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">T_s \leftarrow \{ \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mtext> </mtext><mtext mathvariant="bold">in</mtext><mtext> </mtext><msub><mi mathvariant="fraktur">E</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">B ~\textbf{in}~ \mathfrak{E}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">in</span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathfrak">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow><mi>B</mi></msubsup><mo>←</mo><msub><mi>T</mi><mi>B</mi></msub><mo>+</mo></mrow><annotation encoding="application/x-tex">t_{est}^{B} \leftarrow T_B + </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0883em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">es</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">+</span></span></span></span><span class="ps-funcname">Slot-Offset</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>B</mi></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>s</mi><mi>y</mi><mi>n</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">s_B, s_{sync}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo><mi mathvariant="script">T</mi></mrow><annotation encoding="application/x-tex"> \times \mathcal{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">×</span><span class="mord mathcal" style="margin-right:0.25417em;">T</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>s</mi></msub><mo>←</mo><msub><mi>T</mi><mi>s</mi></msub><mo>∪</mo><msubsup><mi>t</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow><mi>B</mi></msubsup></mrow><annotation encoding="application/x-tex">T_s \leftarrow T_s \cup t_{est}^{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0883em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">es</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">return </span><span class="ps-funcname">Median</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">T_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 8. <a href="#algo-slot-time">Median-Algorithm</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(\mathfrak{E}\) is the sync period used for the estimate.</p>
</li>
<li>
<p>\$s_"sync"\$ is the slot time to estimate.</p>
</li>
<li>
<p>\$"Slot-Offset"\$ is defined in <a href="#algo-slot-offset">Algorithm 7</a>.</p>
</li>
<li>
<p>\(\mathcal{T}\) is the slot duration defined in <a href="#defn-epoch-slot">Definition 54</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-prunned-best" class="exampleblock">
<div class="title">Definition 65. <a href="#defn-prunned-best">Pruned Best Chain</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>pruned best chain</strong> \$C^(r^k)\$ is the longest selected chain
(<a href="#defn-longest-chain">Definition 7</a>) with the last \$k\$ Blocks pruned. We chose
\$k= 140\$. The <strong>last (probabilistic) finalized block</strong> describes the last block in
this pruned best chain.</p>
</div>
</div>
</div>
<div id="defn-chain-quality" class="exampleblock">
<div class="title">Definition 66. <a href="#defn-chain-quality">Chain Quality</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>chain quality</strong> \$s_(cq)\$ represents the number of slots that are used
to estimate the local clock offset. Currently, it is set to \$s_(cq) =
3000\$.</p>
</div>
<div class="paragraph">
<p>The prerequisite for such a calculation is that each producer stores the arrival
time of each block (<a href="#defn-block-time">Definition 67</a>) measured by a clock that is otherwise
not adjusted by any external protocol.</p>
</div>
</div>
</div>
<div id="defn-block-time" class="exampleblock">
<div class="title">Definition 67. <a href="#defn-block-time">Block Arrival Time</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>block arrival time</strong> of block \$B\$ for node \$j\$ formally
represented by \$T_B^j\$ is the local time of node \$j\$ when node
\$j\$ has received block \$B\$ for the first time. If the node \$j\$
itself is the producer of \$B\$, \$T_B^j\$ is set equal to the time that
the block is produced. The index \$j\$ in \$T_B^j\$ notation may be
dropped and B’s arrival time is referred to by \$T_B\$ when there is no
ambiguity about the underlying node.</p>
</div>
</div>
</div>
<div id="defn-sync-period" class="exampleblock">
<div class="title">Definition 68. <a href="#defn-sync-period">Sync Period</a></div>
<div class="content">
<div class="paragraph">
<p>A is an interval at which each validator (re-)evaluates its local clock offsets.
The first sync period \$fr E_1\$ starts just after the genesis block is
released. Consequently, each sync period \$fr E_i\$ starts after \$fr
E_(i - 1)\$. The length of the sync period (<a href="#defn-chain-quality">Definition 66</a>) is equal to
\$s_(qc)\$and expressed in the number of slots.</p>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<svg
   version="1.1"
   id="svg2"
   xml:space="preserve"
   width="1097.3333"
   height="636.89331"
   viewBox="0 0 1097.3333 636.89331"
   sodipodi:docname="c01-s05_babe-time-sync.eps"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><defs
     id="defs6" /><sodipodi:namedview
     id="namedview4"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0" /><g
     id="g8"
     inkscape:groupmode="layer"
     inkscape:label="ink_ext_XXXXXX"
     transform="matrix(1.3333333,0,0,-1.3333333,0,636.89333)"><g
       id="g10"
       transform="scale(0.1)"><path
         d="M 1971.02,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path12" /><path
         d="M 2505,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path14" /><path
         d="M 3150.17,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path16" /><path
         d="M 3581.78,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path18" /><path
         d="M 4137.45,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path20" /><path
         d="M 4495.6,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path22" /><path
         d="M 5190.65,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path24" /><path
         d="M 5936.74,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path26" /><path
         d="M 6324.3,3668.12 V 2232.25"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path28" /><path
         d="m 7231.42,188.691 h -314.55 v 422.457 h 314.55 V 188.691"
         style="fill:#facd08;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path30" /><path
         d="m 1970.89,3612.3 688.42,489.79 H 6486.2"
         style="fill:none;stroke:#facd08;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path32" /><path
         d="m 2659.31,4102.09 146.45,496.96 h 2610.47"
         style="fill:none;stroke:#facd08;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path34" /><path
         d="M 1970.89,3612.3 H 6960.12"
         style="fill:none;stroke:#facd08;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path36" /><path
         d="m 3150.05,3612.3 142.44,-489.79 h 2452.46"
         style="fill:none;stroke:#facd08;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path38" /><path
         d="M 6324.19,3612.3 7492.23,2632.72"
         style="fill:none;stroke:#facd08;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path40" /><path
         d="M 6140.54,4102.09 6911.1,4613.4"
         style="fill:none;stroke:#facd08;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path42" /><path
         d="m 1915.07,3454.04 c -56.48,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.96,102.44 102.44,102.44 h 111.65 c 56.48,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path44" /><path
         d="m 2026.72,3775.56 c -20.47,0 -91.18,0 -111.65,0 -59.34,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.44,-107.43 20.47,0 91.18,0 111.65,0 59.34,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.1,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.73,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.71,97.44 97.44,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path46" /><path
         d="m 2449.05,3454.04 c -56.49,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.95,102.44 102.44,102.44 h 111.65 c 56.48,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path48" /><path
         d="m 2560.7,3775.56 c -20.47,0 -91.18,0 -111.65,0 -59.34,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.44,-107.43 20.47,0 91.18,0 111.65,0 59.34,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.1,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.73,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.71,97.44 97.44,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path50" /><path
         d="m 2504.87,4157.92 c 0,59.33 48.1,107.43 107.45,107.43 20.47,0 91.17,0 111.64,0 59.34,0 107.44,-48.1 107.44,-107.43 0,-20.48 0,-91.19 0,-111.65 0,-59.34 -48.1,-107.45 -107.44,-107.45 -20.47,0 -91.17,0 -111.64,0 -59.35,0 -107.45,48.11 -107.45,107.45 0,20.46 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path52" /><path
         d="m 2642.5,4654.88 c 0,59.34 48.1,107.43 107.43,107.43 20.48,0 91.18,0 111.65,0 59.34,0 107.44,-48.09 107.44,-107.43 0,-20.48 0,-91.18 0,-111.65 0,-59.34 -48.1,-107.44 -107.44,-107.44 -20.47,0 -91.17,0 -111.65,0 -59.33,0 -107.43,48.1 -107.43,107.44 0,20.47 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path54" /><path
         d="m 4876.32,4654.88 c 0,59.34 48.11,107.43 107.45,107.43 20.47,0 91.17,0 111.65,0 59.33,0 107.44,-48.09 107.44,-107.43 0,-20.48 0,-91.18 0,-111.65 0,-59.34 -48.11,-107.44 -107.44,-107.44 -20.48,0 -91.18,0 -111.65,0 -59.34,0 -107.45,48.1 -107.45,107.44 0,20.47 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path56" /><path
         d="m 5252.97,4654.88 c 0,59.34 48.1,107.43 107.44,107.43 20.47,0 91.17,0 111.65,0 59.33,0 107.43,-48.09 107.43,-107.43 0,-20.48 0,-91.18 0,-111.65 0,-59.34 -48.1,-107.44 -107.43,-107.44 -20.48,0 -91.18,0 -111.65,0 -59.34,0 -107.44,48.1 -107.44,107.44 0,20.47 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path58" /><path
         d="m 2888.93,4157.92 c 0,59.33 48.1,107.43 107.44,107.43 20.47,0 91.18,0 111.65,0 59.33,0 107.44,-48.1 107.44,-107.43 0,-20.48 0,-91.19 0,-111.65 0,-59.34 -48.11,-107.45 -107.44,-107.45 -20.47,0 -91.18,0 -111.65,0 -59.34,0 -107.44,48.11 -107.44,107.45 0,20.46 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path60" /><path
         d="m 4495.47,4157.92 c 0,59.33 48.11,107.43 107.45,107.43 20.47,0 91.17,0 111.65,0 59.33,0 107.43,-48.1 107.43,-107.43 0,-20.48 0,-91.19 0,-111.65 0,-59.34 -48.1,-107.45 -107.43,-107.45 -20.48,0 -91.18,0 -111.65,0 -59.34,0 -107.45,48.11 -107.45,107.45 0,20.46 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path62" /><path
         d="m 5977.28,4157.92 c 0,59.33 48.11,107.43 107.44,107.43 20.47,0 91.17,0 111.65,0 59.34,0 107.44,-48.1 107.44,-107.43 0,-20.48 0,-91.19 0,-111.65 0,-59.34 -48.1,-107.45 -107.44,-107.45 -20.48,0 -91.18,0 -111.65,0 -59.33,0 -107.44,48.11 -107.44,107.45 0,20.46 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path64" /><path
         d="m 6322.94,4157.92 c 0,59.33 48.09,107.43 107.43,107.43 20.48,0 91.18,0 111.65,0 59.33,0 107.44,-48.1 107.44,-107.43 0,-20.48 0,-91.19 0,-111.65 0,-59.34 -48.11,-107.45 -107.44,-107.45 -20.47,0 -91.17,0 -111.65,0 -59.34,0 -107.43,48.11 -107.43,107.45 0,20.46 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path66" /><path
         d="m 3094.22,3454.04 c -56.48,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.96,102.44 102.44,102.44 h 111.65 c 56.48,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path68" /><path
         d="m 3205.87,3775.56 c -20.47,0 -91.18,0 -111.65,0 -59.34,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.44,-107.43 20.47,0 91.18,0 111.65,0 59.34,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.1,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.73,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.71,97.44 97.44,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path70" /><path
         d="m 3525.83,3454.04 c -56.48,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.96,102.44 102.44,102.44 h 111.65 c 56.49,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.95,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path72" /><path
         d="m 3637.48,3775.56 c -20.47,0 -91.18,0 -111.65,0 -59.33,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.11,-107.43 107.44,-107.43 20.47,0 91.18,0 111.65,0 59.34,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.1,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.73,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.71,97.44 97.44,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path74" /><path
         d="m 3129.23,3178.34 c 0,59.33 48.1,107.44 107.44,107.44 20.47,0 91.17,0 111.65,0 59.33,0 107.43,-48.11 107.43,-107.44 0,-20.48 0,-91.17 0,-111.65 0,-59.34 -48.1,-107.44 -107.43,-107.44 -20.48,0 -91.18,0 -111.65,0 -59.34,0 -107.44,48.1 -107.44,107.44 0,20.48 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path76" /><path
         d="m 3529.28,3178.34 c 0,59.33 48.11,107.44 107.44,107.44 20.48,0 91.18,0 111.66,0 59.33,0 107.43,-48.11 107.43,-107.44 0,-20.48 0,-91.17 0,-111.65 0,-59.34 -48.1,-107.44 -107.43,-107.44 -20.48,0 -91.18,0 -111.66,0 -59.33,0 -107.44,48.1 -107.44,107.44 0,20.48 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path78" /><path
         d="m 4764.58,3178.34 c 0,59.33 48.1,107.44 107.44,107.44 20.47,0 91.17,0 111.65,0 59.33,0 107.44,-48.11 107.44,-107.44 0,-20.48 0,-91.17 0,-111.65 0,-59.34 -48.11,-107.44 -107.44,-107.44 -20.48,0 -91.18,0 -111.65,0 -59.34,0 -107.44,48.1 -107.44,107.44 0,20.48 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path80" /><path
         d="m 5575.91,3178.34 c 0,59.33 48.11,107.44 107.45,107.44 20.46,0 91.17,0 111.65,0 59.33,0 107.43,-48.11 107.43,-107.44 0,-20.48 0,-91.17 0,-111.65 0,-59.34 -48.1,-107.44 -107.43,-107.44 -20.48,0 -91.19,0 -111.65,0 -59.34,0 -107.45,48.1 -107.45,107.44 0,20.48 0,91.17 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path82" /><path
         d="m 4081.51,3454.04 c -56.49,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.95,102.44 102.44,102.44 h 111.64 c 56.49,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.95,-102.43 -102.44,-102.43 h -111.64"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path84" /><path
         d="m 4193.15,3775.56 c -20.47,0 -91.17,0 -111.64,0 -59.34,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.44,-107.43 20.47,0 91.17,0 111.64,0 59.35,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.09,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.64 c -53.73,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.71,97.44 97.44,97.44 h 111.64"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path86" /><path
         d="m 4439.65,3454.04 c -56.48,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.96,102.44 102.44,102.44 h 111.65 c 56.48,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path88" /><path
         d="m 4551.3,3775.56 c -20.47,0 -91.18,0 -111.66,0 -59.33,0 -107.43,-48.1 -107.43,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.43,-107.43 20.48,0 91.19,0 111.66,0 59.34,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.1,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.66 c -53.72,0 -97.43,43.71 -97.43,97.43 v 111.65 c 0,53.73 43.71,97.44 97.43,97.44 h 111.66"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path90" /><path
         d="m 5134.7,3454.04 c -56.48,0 -102.43,45.95 -102.43,102.43 v 111.65 c 0,56.49 45.95,102.44 102.43,102.44 h 111.65 c 56.49,0 102.45,-45.95 102.45,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.45,-102.43 H 5134.7"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path92" /><path
         d="m 5246.35,3775.56 c -20.46,0 -91.17,0 -111.65,0 -59.33,0 -107.43,-48.1 -107.43,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.43,-107.43 20.48,0 91.19,0 111.65,0 59.34,0 107.45,48.1 107.45,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.11,107.44 -107.45,107.44 z m 0,-10 c 53.73,0 97.45,-43.71 97.45,-97.44 v -111.65 c 0,-53.72 -43.72,-97.43 -97.45,-97.43 H 5134.7 c -53.72,0 -97.43,43.71 -97.43,97.43 v 111.65 c 0,53.73 43.71,97.44 97.43,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path94" /><path
         d="M 1971.02,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path96" /><path
         d="M 2505,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path98" /><path
         d="M 3150.17,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path100" /><path
         d="M 3581.78,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path102" /><path
         d="M 4137.46,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path104" /><path
         d="M 4495.6,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path106" /><path
         d="M 5190.66,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path108" /><path
         d="M 258.152,2232.25 H 8230.01"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path110" /><path
         d="M 7231.42,611.148 V 1569.52"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path112" /><path
         d="m 1935.85,2232.25 c 0,18.19 14.73,32.92 32.92,32.92 18.17,0 32.91,-14.73 32.91,-32.92 0,-18.17 -14.74,-32.91 -32.91,-32.91 -18.19,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path114" /><path
         d="m 2474.33,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.19,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.73,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path116" /><path
         d="m 2635.34,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path118" /><path
         d="m 2775.22,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.17,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.75,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path120" /><path
         d="m 3021.65,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path122" /><path
         d="m 3119.5,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path124" /><path
         d="m 3261.95,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path126" /><path
         d="m 3551.11,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path128" /><path
         d="m 3662.01,2232.25 c 0,18.19 14.73,32.92 32.92,32.92 18.18,0 32.91,-14.73 32.91,-32.92 0,-18.17 -14.73,-32.91 -32.91,-32.91 -18.19,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path130" /><path
         d="m 4106.79,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.91,-14.73 32.91,-32.92 0,-18.17 -14.73,-32.91 -32.91,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path132" /><path
         d="m 4464.94,2232.25 c 0,18.19 14.73,32.92 32.91,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.91,14.74 -32.91,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path134" /><path
         d="m 4625.82,2232.25 c 0,18.19 14.73,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.19,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path136" /><path
         d="m 4894.92,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path138" /><path
         d="m 5006.68,2232.25 c 0,18.19 14.73,32.92 32.92,32.92 18.17,0 32.91,-14.73 32.91,-32.92 0,-18.17 -14.74,-32.91 -32.91,-32.91 -18.19,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path140" /><path
         d="m 5159.99,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path142" /><path
         d="m 7198.5,1569.52 c 0,18.18 14.74,32.92 32.92,32.92 18.18,0 32.91,-14.74 32.91,-32.92 0,-18.17 -14.73,-32.92 -32.91,-32.92 -18.18,0 -32.92,14.75 -32.92,32.92"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path144" /><path
         d="m 5383.31,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path146" /><path
         d="m 5706.26,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path148" /><path
         d="m 5906.08,2232.25 c 0,18.19 14.74,32.92 32.91,32.92 18.18,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.74,-32.91 -32.92,-32.91 -18.17,0 -32.91,14.74 -32.91,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path150" /><path
         d="m 6107.62,2232.25 c 0,18.19 14.75,32.92 32.92,32.92 18.19,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.73,-32.91 -32.92,-32.91 -18.17,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path152" /><path
         d="m 7459.31,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.19,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.73,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path154" /><path
         d="m 6292,2232.25 c 0,18.19 14.73,32.92 32.92,32.92 18.17,0 32.91,-14.73 32.91,-32.92 0,-18.17 -14.74,-32.91 -32.91,-32.91 -18.19,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path156" /><path
         d="m 6453.28,2232.25 c 0,18.19 14.73,32.92 32.92,32.92 18.17,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.75,-32.91 -32.92,-32.91 -18.19,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path158" /><path
         d="m 6763.4,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.19,0 32.92,-14.73 32.92,-32.92 0,-18.17 -14.73,-32.91 -32.92,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path160" /><path
         d="M 1970.62,507.699 V 441.281"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path162" /><path
         d="M 2382.8,507.699 V 441.281"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path164" /><path
         d="M 1970.62,474.488 H 2382.8"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path166" /><path
         d="m 2150.65,371.801 v 9.558 h 52.57 v -9.558 h -20.56 v -55.832 h -11.45 v 55.832 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path168" /><path
         d="m 1969.98,2135.37 c -9.38,0 -14.79,-9.11 -14.79,-25.62 0,-16.5 5.41,-25.6 14.79,-25.6 9.47,0 14.88,9.1 14.88,25.6 0,16.51 -5.41,25.62 -14.88,25.62 z m 0,8.2 c 17.5,0 26.06,-13.8 26.06,-33.82 0,-20.1 -8.56,-33.9 -26.06,-33.9 -17.41,0 -25.97,13.8 -25.97,33.9 0,20.02 8.56,33.82 25.97,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path170" /><path
         d="m 2498.01,2126.8 h -14.61 v 7.4 c 9.47,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.73 v 49.78"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path172" /><path
         d="m 2662.08,2086.39 h 34.27 v -9.37 h -47.61 v 8.84 c 21.82,17.04 34.89,28.58 34.89,39.5 0,6.31 -4.14,10.01 -10.55,10.01 -6.22,0 -12.17,-3.7 -12.17,-13.89 h -10.73 c -0.18,13.17 9.02,22.09 23.36,22.09 12.08,0 21.28,-6.22 21.28,-17.31 0,-13.53 -12.99,-26.15 -32.74,-39.87"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path174" /><path
         d="m 3145.02,2086.39 h 34.27 v -9.37 h -47.61 v 8.84 c 21.82,17.04 34.89,28.58 34.89,39.5 0,6.31 -4.14,10.01 -10.55,10.01 -6.22,0 -12.17,-3.7 -12.17,-13.89 h -10.73 c -0.18,13.17 9.02,22.09 23.36,22.09 12.08,0 21.28,-6.22 21.28,-17.31 0,-13.53 -12.99,-26.15 -32.74,-39.87"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path176" /><path
         d="m 2809.81,2106.69 h -3.15 v 8.92 h 2.7 c 10.19,0 15.15,3.34 15.15,10.11 0,6.58 -5.32,9.65 -11.36,9.65 -7.94,0 -12.36,-4.79 -13.35,-12.45 h -10.46 c 0.99,12.45 9.92,20.65 24.44,20.65 10.91,0 21.73,-4.96 21.73,-17.22 0,-6.5 -3.79,-11.91 -9.56,-14.7 7.85,-2.88 11.27,-9.29 11.27,-15.96 0,-13.35 -11.45,-19.84 -24.52,-19.84 -15.15,0 -23.36,9.92 -24.17,21.46 h 10.46 c 1.08,-7.21 5.32,-13.16 13.89,-13.16 7.57,0 13.25,4.14 13.25,11.27 0,8.39 -6.67,11.27 -16.32,11.27"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path178" /><path
         d="m 3056.25,2106.69 h -3.16 v 8.92 h 2.71 c 10.19,0 15.14,3.34 15.14,10.11 0,6.58 -5.31,9.65 -11.36,9.65 -7.93,0 -12.35,-4.79 -13.34,-12.45 h -10.46 c 0.99,12.45 9.91,20.65 24.44,20.65 10.9,0 21.73,-4.96 21.73,-17.22 0,-6.5 -3.79,-11.91 -9.56,-14.7 7.85,-2.88 11.27,-9.29 11.27,-15.96 0,-13.35 -11.45,-19.84 -24.53,-19.84 -15.15,0 -23.35,9.92 -24.17,21.46 h 10.47 c 1.08,-7.21 5.31,-13.16 13.88,-13.16 7.58,0 13.26,4.14 13.26,11.27 0,8.39 -6.68,11.27 -16.32,11.27"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path180" /><path
         d="m 3298.8,2106.69 h -3.16 v 8.92 h 2.71 c 10.19,0 15.14,3.34 15.14,10.11 0,6.58 -5.31,9.65 -11.36,9.65 -7.93,0 -12.35,-4.79 -13.34,-12.45 h -10.46 c 0.99,12.45 9.91,20.65 24.43,20.65 10.91,0 21.74,-4.96 21.74,-17.22 0,-6.5 -3.79,-11.91 -9.56,-14.7 7.84,-2.88 11.27,-9.29 11.27,-15.96 0,-13.35 -11.45,-19.84 -24.53,-19.84 -15.15,0 -23.35,9.92 -24.17,21.46 h 10.46 c 1.08,-7.21 5.32,-13.16 13.89,-13.16 7.57,0 13.26,4.14 13.26,11.27 0,8.39 -6.68,11.27 -16.32,11.27"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path182" /><path
         d="m 3595.45,2101.64 v 26.79 l -20.56,-26.79 z m 10.73,-9.29 v -15.33 h -10.73 v 15.33 h -32.28 v 8.93 l 32.37,41.12 h 10.64 v -40.76 h 11.54 v -9.29 h -11.54"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path184" /><path
         d="m 5044.96,2101.64 v 26.79 l -20.57,-26.79 z m 10.73,-9.29 v -15.33 h -10.73 v 15.33 h -32.29 v 8.93 l 32.38,41.12 h 10.64 v -40.76 h 11.54 v -9.29 h -11.54"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path186" /><path
         d="m 4146.96,2112.37 c -6.04,0 -10.45,-3.07 -11.81,-6.85 l -10.1,0.53 4.33,36.35 h 39.13 v -9.47 h -30.29 l -2.08,-16.41 c 3.16,2.52 7.67,4.05 13.53,4.05 11.18,0 21.55,-7.66 21.55,-22.36 0,-14.61 -11.18,-22.36 -24.16,-22.36 -15.24,0 -23,9.92 -23.81,21.19 h 10.37 c 0.9,-7.58 5.05,-12.89 13.62,-12.89 7.21,0 12.89,5.14 12.89,13.89 0,9.73 -6.67,14.33 -13.17,14.33"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path188" /><path
         d="m 3722.3,2142.4 v -9.47 c -16.68,-15.78 -25.61,-31.93 -27.05,-55.91 h -12.18 c 1.17,23 12.63,42.02 27.87,55.91 h -35.62 v 9.47 h 46.98"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path190" /><path
         d="m 4916.82,2125.45 c 0,-6.22 4.79,-10.37 11.82,-10.37 7.13,0 11.73,4.15 11.73,10.37 0,6.22 -4.6,9.92 -11.73,9.92 -7.03,0 -11.82,-3.7 -11.82,-9.92 z m 11.82,-41.3 c 8.03,0 13.16,4.41 13.16,11.81 0,7.3 -5.13,11.81 -13.16,11.81 -8.03,0 -13.17,-4.51 -13.17,-11.81 0,-7.4 5.14,-11.81 13.17,-11.81 z m 13.97,27.77 c 7.77,-3.97 10.37,-10.19 10.37,-16.33 0,-12.89 -10.63,-19.74 -24.34,-19.74 -13.71,0 -24.35,6.85 -24.35,19.74 0,6.14 2.62,12.46 10.37,16.33 -5.77,3.24 -8.38,9.29 -8.38,14.88 0,9.74 8.65,16.77 22.36,16.77 13.61,0 22.36,-7.03 22.36,-16.77 0,-5.59 -2.43,-11.36 -8.39,-14.88"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path192" /><path
         d="m 4514.84,2098.04 c 0,8.56 -5.32,13.97 -12.71,13.97 -7.4,0 -12.81,-5.41 -12.81,-13.97 0,-8.67 5.32,-13.89 12.72,-13.89 7.48,0 12.8,5.22 12.8,13.89 z m -10.63,22.45 c 12.08,0 21.72,-8.67 21.72,-22.28 0,-13.07 -9.73,-22.36 -23.8,-22.36 -16.96,0 -24.54,12.8 -24.54,31.92 0,18.85 6.86,35.8 25.98,35.8 13.7,0 20.2,-8.84 21.1,-17.59 h -10.91 c -0.73,6.32 -5.14,9.39 -11,9.39 -8.84,0 -14.07,-8.94 -14.25,-22.36 2.88,4.14 8.21,7.48 15.7,7.48"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path194" /><path
         d="m 4646.23,2121.39 c 0,-8.57 5.31,-13.98 12.71,-13.98 7.31,0 12.8,5.41 12.8,13.98 0,8.75 -5.41,13.98 -12.71,13.98 -7.49,0 -12.8,-5.23 -12.8,-13.98 z m 10.63,-22.46 c -12.08,0 -21.73,8.66 -21.73,22.37 0,12.99 9.74,22.27 23.81,22.27 16.95,0 24.52,-12.8 24.52,-31.92 0,-18.85 -6.94,-35.8 -26.05,-35.8 -13.62,0 -20.12,8.84 -21.02,17.59 h 10.91 c 0.72,-6.32 5.15,-9.29 11.01,-9.29 8.83,0 14.07,8.92 14.24,22.26 -2.88,-4.14 -8.2,-7.48 -15.69,-7.48"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path196" /><path
         d="m 5220.27,2142.4 v -9.47 c -16.68,-15.78 -25.61,-31.93 -27.05,-55.91 h -12.18 c 1.17,23 12.63,42.02 27.87,55.91 h -35.62 v 9.47 h 46.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path198" /><path
         d="m 1976.09,1743.89 c -9.37,0 -14.79,-9.12 -14.79,-25.62 0,-16.5 5.42,-25.61 14.79,-25.61 9.47,0 14.88,9.11 14.88,25.61 0,16.5 -5.41,25.62 -14.88,25.62 z m 0,8.2 c 17.5,0 26.06,-13.8 26.06,-33.82 0,-20.11 -8.56,-33.91 -26.06,-33.91 -17.4,0 -25.97,13.8 -25.97,33.91 0,20.02 8.57,33.82 25.97,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path200" /><path
         d="m 2029.58,1704.83 h -19.94 v 9.65 h 19.94 v 19.4 h 9.91 v -19.4 h 19.84 v -9.65 h -19.84 v -19.29 h -9.91 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path202" /><path
         d="m 2077.82,1735.31 h -14.61 v 7.4 c 9.47,0.27 14.07,1.08 17.4,8.21 h 7.94 v -65.38 h -10.73 v 49.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path204" /><path
         d="m 2108.93,1694.91 h 34.27 v -9.37 h -47.61 v 8.83 c 21.82,17.04 34.89,28.59 34.89,39.51 0,6.3 -4.14,10.01 -10.55,10.01 -6.22,0 -12.17,-3.71 -12.17,-13.89 h -10.73 c -0.18,13.16 9.02,22.09 23.36,22.09 12.08,0 21.28,-6.22 21.28,-17.32 0,-13.52 -12.99,-26.15 -32.74,-39.86"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path206" /><path
         d="m 2144.01,1741.36 v 9.56 h 52.58 v -9.56 h -20.56 v -55.82 h -11.46 v 55.82 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path208" /><path
         d="m 2503.29,1735.31 h -14.61 v 7.4 c 9.47,0.27 14.07,1.08 17.41,8.21 h 7.93 v -65.38 h -10.73 v 49.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path210" /><path
         d="m 2544.69,1704.83 h -19.93 v 9.65 h 19.93 v 19.4 h 9.92 v -19.4 h 19.83 v -9.65 h -19.83 v -19.29 h -9.92 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path212" /><path
         d="m 2592.93,1735.31 h -14.61 v 7.4 c 9.47,0.27 14.07,1.08 17.4,8.21 h 7.94 v -65.38 h -10.73 v 49.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path214" /><path
         d="m 2625.4,1735.31 h -14.61 v 7.4 c 9.47,0.27 14.06,1.08 17.4,8.21 h 7.94 v -65.38 h -10.73 v 49.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path216" /><path
         d="m 2641.53,1741.36 v 9.56 h 52.58 v -9.56 h -20.56 v -55.82 h -11.45 v 55.82 h -20.57"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path218" /><path
         d="m 3148.13,1694.91 h 34.26 v -9.37 h -47.61 v 8.83 c 21.82,17.04 34.9,28.59 34.9,39.51 0,6.3 -4.15,10.01 -10.55,10.01 -6.22,0 -12.18,-3.71 -12.18,-13.89 h -10.73 c -0.18,13.16 9.02,22.09 23.36,22.09 12.09,0 21.28,-6.22 21.28,-17.32 0,-13.52 -12.98,-26.15 -32.73,-39.86"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path220" /><path
         d="m 3208.46,1704.83 h -19.93 v 9.65 h 19.93 v 19.4 h 9.92 v -19.4 h 19.84 v -9.65 h -19.84 v -19.29 h -9.92 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path222" /><path
         d="m 3256.71,1735.31 h -14.61 v 7.4 c 9.46,0.27 14.06,1.08 17.4,8.21 h 7.94 v -65.38 h -10.73 v 49.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path224" /><path
         d="m 3301.98,1743.89 c -9.38,0 -14.79,-9.12 -14.79,-25.62 0,-16.5 5.41,-25.61 14.79,-25.61 9.47,0 14.88,9.11 14.88,25.61 0,16.5 -5.41,25.62 -14.88,25.62 z m 0,8.2 c 17.49,0 26.06,-13.8 26.06,-33.82 0,-20.11 -8.57,-33.91 -26.06,-33.91 -17.41,0 -25.97,13.8 -25.97,33.91 0,20.02 8.56,33.82 25.97,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path226" /><path
         d="m 3330.2,1741.36 v 9.56 h 52.58 v -9.56 h -20.56 v -55.82 h -11.46 v 55.82 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path228" /><path
         d="m 3594.02,1709.03 v 26.79 l -20.56,-26.79 z m 10.73,-9.29 v -15.33 h -10.73 v 15.33 h -32.28 v 8.93 l 32.37,41.12 h 10.64 v -40.76 h 11.55 v -9.29 h -11.55"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path230" /><path
         d="m 3640.83,1703.71 h -19.93 v 9.65 h 19.93 v 19.39 h 9.92 v -19.39 h 19.84 v -9.65 h -19.84 v -19.3 h -9.92 v 19.3"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path232" /><path
         d="m 3691.15,1732.84 c 0,-6.22 4.78,-10.37 11.81,-10.37 7.12,0 11.72,4.15 11.72,10.37 0,6.22 -4.6,9.92 -11.72,9.92 -7.03,0 -11.81,-3.7 -11.81,-9.92 z m 11.81,-41.3 c 8.03,0 13.17,4.42 13.17,11.81 0,7.3 -5.14,11.81 -13.17,11.81 -8.03,0 -13.16,-4.51 -13.16,-11.81 0,-7.39 5.13,-11.81 13.16,-11.81 z m 13.98,27.77 c 7.75,-3.97 10.37,-10.19 10.37,-16.32 0,-12.89 -10.64,-19.75 -24.35,-19.75 -13.71,0 -24.35,6.86 -24.35,19.75 0,6.13 2.62,12.45 10.37,16.32 -5.77,3.25 -8.38,9.29 -8.38,14.88 0,9.74 8.65,16.78 22.36,16.78 13.62,0 22.36,-7.04 22.36,-16.78 0,-5.59 -2.43,-11.36 -8.38,-14.88"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path234" /><path
         d="m 3730.29,1740.23 v 9.56 h 52.58 v -9.56 h -20.56 v -55.82 h -11.46 v 55.82 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path236" /><path
         d="m 4142.99,1719.78 c -6.04,0 -10.46,-3.06 -11.81,-6.85 l -10.1,0.54 4.33,36.34 h 39.13 v -9.47 h -30.3 l -2.07,-16.41 c 3.15,2.52 7.67,4.06 13.52,4.06 11.18,0 21.55,-7.67 21.55,-22.37 0,-14.61 -11.18,-22.36 -24.16,-22.36 -15.24,0 -23,9.92 -23.81,21.19 h 10.37 c 0.91,-7.58 5.05,-12.89 13.62,-12.89 7.21,0 12.9,5.14 12.9,13.89 0,9.73 -6.68,14.33 -13.17,14.33"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path238" /><path
         d="m 4194.76,1703.73 h -19.93 v 9.65 h 19.93 v 19.39 h 9.91 v -19.39 h 19.85 v -9.65 h -19.85 v -19.3 h -9.91 v 19.3"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path240" /><path
         d="m 4275.1,1749.81 v -9.47 c -16.68,-15.78 -25.6,-31.92 -27.05,-55.91 h -12.17 c 1.17,23 12.62,42.02 27.87,55.91 h -35.63 v 9.47 h 46.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path242" /><path
         d="m 4271.95,1740.25 v 9.56 h 52.58 v -9.56 h -20.57 v -55.82 h -11.44 v 55.82 h -20.57"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path244" /><path
         d="m 4514.85,1706.55 c 0,8.57 -5.32,13.98 -12.71,13.98 -7.4,0 -12.81,-5.41 -12.81,-13.98 0,-8.66 5.32,-13.89 12.72,-13.89 7.48,0 12.8,5.23 12.8,13.89 z m -10.63,22.45 c 12.08,0 21.72,-8.66 21.72,-22.27 0,-13.08 -9.73,-22.37 -23.8,-22.37 -16.96,0 -24.54,12.81 -24.54,31.93 0,18.85 6.86,35.8 25.98,35.8 13.71,0 20.2,-8.84 21.1,-17.59 h -10.91 c -0.73,6.32 -5.14,9.39 -11,9.39 -8.84,0 -14.07,-8.94 -14.25,-22.37 2.88,4.14 8.2,7.48 15.7,7.48"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path246" /><path
         d="m 4553.54,1704.83 h -19.93 v 9.65 h 19.93 v 19.4 h 9.92 v -19.4 h 19.84 v -9.65 h -19.84 v -19.29 h -9.92 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path248" /><path
         d="m 4628.03,1706.55 c 0,8.57 -5.32,13.98 -12.71,13.98 -7.39,0 -12.8,-5.41 -12.8,-13.98 0,-8.66 5.32,-13.89 12.71,-13.89 7.48,0 12.8,5.23 12.8,13.89 z M 4617.4,1729 c 12.08,0 21.73,-8.66 21.73,-22.27 0,-13.08 -9.74,-22.37 -23.81,-22.37 -16.95,0 -24.53,12.81 -24.53,31.93 0,18.85 6.85,35.8 25.97,35.8 13.71,0 20.2,-8.84 21.11,-17.59 h -10.92 c -0.72,6.32 -5.14,9.39 -11,9.39 -8.83,0 -14.07,-8.94 -14.24,-22.37 2.88,4.14 8.2,7.48 15.69,7.48"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path250" /><path
         d="m 4641.47,1741.36 v 9.56 h 52.58 v -9.56 h -20.57 v -55.82 h -11.44 v 55.82 h -20.57"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path252" /><path
         d="m 5220.27,1750.92 v -9.48 c -16.68,-15.78 -25.61,-31.92 -27.05,-55.9 h -12.18 c 1.17,22.99 12.63,42.02 27.87,55.9 h -35.62 v 9.48 h 46.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path254" /><path
         d="m 5242.37,1704.83 h -19.93 v 9.65 h 19.93 v 19.4 h 9.92 v -19.4 h 19.84 v -9.65 h -19.84 v -19.29 h -9.92 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path256" /><path
         d="m 5302.61,1720.89 c -6.04,0 -10.46,-3.07 -11.81,-6.86 l -10.1,0.54 4.33,36.35 h 39.14 v -9.48 h -30.31 l -2.07,-16.4 c 3.16,2.52 7.67,4.05 13.53,4.05 11.18,0 21.55,-7.67 21.55,-22.36 0,-14.61 -11.18,-22.37 -24.17,-22.37 -15.23,0 -22.99,9.93 -23.81,21.19 h 10.37 c 0.91,-7.57 5.06,-12.89 13.63,-12.89 7.21,0 12.89,5.14 12.89,13.89 0,9.74 -6.67,14.34 -13.17,14.34"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path258" /><path
         d="m 5329.13,1741.36 v 9.56 h 52.58 v -9.56 h -20.57 v -55.82 h -11.45 v 55.82 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path260" /><path
         d="M 5937.28,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path262" /><path
         d="m 5922.74,1733.96 c 0,-6.22 4.79,-10.37 11.82,-10.37 7.13,0 11.73,4.15 11.73,10.37 0,6.22 -4.6,9.93 -11.73,9.93 -7.03,0 -11.82,-3.71 -11.82,-9.93 z m 11.82,-41.3 c 8.02,0 13.16,4.42 13.16,11.81 0,7.31 -5.14,11.82 -13.16,11.82 -8.03,0 -13.17,-4.51 -13.17,-11.82 0,-7.39 5.14,-11.81 13.17,-11.81 z m 13.97,27.78 c 7.77,-3.98 10.37,-10.2 10.37,-16.33 0,-12.89 -10.63,-19.75 -24.34,-19.75 -13.71,0 -24.35,6.86 -24.35,19.75 0,6.13 2.62,12.45 10.37,16.33 -5.77,3.24 -8.39,9.28 -8.39,14.87 0,9.75 8.66,16.78 22.37,16.78 13.61,0 22.36,-7.03 22.36,-16.78 0,-5.59 -2.43,-11.36 -8.39,-14.87"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path264" /><path
         d="m 5987.14,1704.83 h -19.94 v 9.65 h 19.94 v 19.4 h 9.92 v -19.4 h 19.83 v -9.65 h -19.83 v -19.29 h -9.92 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path266" /><path
         d="m 6053.79,1710.15 v 26.79 l -20.57,-26.79 z m 10.73,-9.28 v -15.33 h -10.73 v 15.33 h -32.29 v 8.92 l 32.37,41.13 h 10.65 v -40.77 h 11.54 v -9.28 h -11.54"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path268" /><path
         d="m 6075.34,1741.36 v 9.56 h 52.58 v -9.56 h -20.57 v -55.82 h -11.45 v 55.82 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path270" /><path
         d="M 6323.2,2011.42 V 1813.98"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path272" /><path
         d="m 6305.37,1735.31 h -14.61 v 7.4 c 9.47,0.27 14.07,1.08 17.4,8.21 h 7.94 v -65.38 h -10.73 v 49.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path274" /><path
         d="m 6350.63,1743.89 c -9.37,0 -14.79,-9.12 -14.79,-25.62 0,-16.5 5.42,-25.61 14.79,-25.61 9.46,0 14.88,9.11 14.88,25.61 0,16.5 -5.42,25.62 -14.88,25.62 z m 0,8.2 c 17.49,0 26.07,-13.8 26.07,-33.82 0,-20.11 -8.58,-33.91 -26.07,-33.91 -17.4,0 -25.98,13.8 -25.98,33.91 0,20.02 8.58,33.82 25.98,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path276" /><path
         d="m 6404.12,1704.83 h -19.93 v 9.65 h 19.93 v 19.4 h 9.92 v -19.4 h 19.83 v -9.65 h -19.83 v -19.29 h -9.92 v 19.29"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path278" /><path
         d="m 6453.17,1694.91 h 34.27 v -9.37 h -47.62 v 8.83 c 21.83,17.04 34.9,28.59 34.9,39.51 0,6.3 -4.15,10.01 -10.54,10.01 -6.22,0 -12.18,-3.71 -12.18,-13.89 h -10.73 c -0.18,13.16 9.02,22.09 23.36,22.09 12.08,0 21.27,-6.22 21.27,-17.32 0,-13.52 -12.98,-26.15 -32.73,-39.86"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path280" /><path
         d="m 6488.25,1741.36 v 9.56 h 52.58 v -9.56 h -20.57 v -55.82 h -11.45 v 55.82 h -20.56"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path282" /><path
         d="m 7096.67,1734.7 v -52.94 h -11.19 v 65.38 h 17.77 l 15.88,-52.13 15.78,52.13 h 17.76 v -65.38 h -11.18 v 52.94 l -16.59,-52.94 h -11.64 l -16.59,52.94"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path284" /><path
         d="m 7196.4,1710.79 c -0.26,7.58 -6.03,12.18 -12.35,12.18 -5.05,0 -11.99,-2.98 -12.89,-12.18 z m -12.08,-21.28 c 5.59,0 10.01,2.26 11.91,6.77 h 10.54 c -2.25,-7.76 -9.46,-15.7 -22,-15.7 -15.6,0 -24.53,11.91 -24.53,25.8 0,14.6 10.01,24.98 23.81,24.98 14.88,0 24.17,-12.08 23.27,-28.41 h -36.16 c 0.72,-9.02 7.03,-13.44 13.16,-13.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path286" /><path
         d="m 7222.74,1706.01 c 0,-10.28 5.14,-16.68 12.27,-16.68 7.03,0 12.54,5.5 12.54,16.68 0,11.19 -5.51,16.6 -12.54,16.6 -7.13,0 -12.27,-6.4 -12.27,-16.6 z m 35.08,41.13 v -65.38 h -10.73 v 6.4 c -2.88,-4.78 -7.93,-7.58 -14.43,-7.58 -11.45,0 -21.1,9.83 -21.1,25.43 0,15.51 9.65,25.35 21.1,25.35 6.5,0 11.55,-2.8 14.43,-7.58 v 23.36 h 10.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path288" /><path
         d="m 7278.83,1681.76 h -10.73 v 48.51 h 10.73 z m 0,54.56 h -10.73 v 10.82 h 10.73 v -10.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path290" /><path
         d="m 7297.58,1695.37 c 0,-4.24 3.52,-6.76 8.93,-6.76 7.94,0 12.63,4.05 12.63,12.27 v 3.69 c -15.34,-1.44 -21.56,-3.6 -21.56,-9.2 z m 21.28,16.69 v 0.9 c 0,8.3 -4.77,10.82 -10.09,10.82 -5.41,0 -9.48,-2.88 -9.75,-8.75 h -10.55 c 0.73,9.92 8.93,16.69 20.66,16.69 11.63,0 20.74,-5.33 20.47,-20.83 0,-2.44 -0.19,-8.12 -0.19,-12.54 0,-6.13 0.55,-12.53 1.45,-16.59 h -9.83 c -0.36,2.07 -0.72,3.24 -0.91,6.58 -3.06,-5.23 -8.83,-7.76 -15.95,-7.76 -10.56,0 -17.95,5.69 -17.95,14.53 0,12.08 14.88,15.14 32.64,16.95"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path292" /><path
         d="m 7364.06,1731.36 c 11.72,0 16.5,-7.58 16.5,-19.13 v -30.47 h -10.73 v 27.86 c 0,6.59 -1,12.99 -9.2,12.99 -8.2,0 -11.27,-6.31 -11.27,-15.06 v -25.79 h -10.73 v 48.51 h 10.73 v -6.76 c 2.79,5.05 7.93,7.85 14.7,7.85"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path294" /><path
         d="m 7007.77,368.512 c -19.12,0 -30.22,13.617 -30.22,34.097 0,20.551 11.82,33.629 30.76,33.629 14.52,0 24.89,-8.297 27.51,-22.91 h -11.01 c -1.98,8.84 -8.39,13.531 -16.86,13.531 -10.38,0 -18.58,-8.468 -18.58,-24.25 0,-15.879 8.03,-24.718 18.49,-24.718 8.84,0 15.14,4.597 17.14,13.519 h 10.99 c -2.7,-14.601 -13.16,-22.898 -28.22,-22.898"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path296" /><path
         d="m 7043.31,369.691 v 65.379 h 10.73 v -65.379 h -10.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path298" /><path
         d="m 7097.78,393.859 c 0,11.18 -6.05,16.68 -12.81,16.68 -6.76,0 -12.81,-5.5 -12.81,-16.68 0,-11.187 6.05,-16.597 12.81,-16.597 6.76,0 12.81,5.41 12.81,16.597 z m -12.81,-25.347 c -11.81,0 -23.9,7.847 -23.9,25.347 0,17.493 12.09,25.43 23.9,25.43 11.81,0 23.89,-7.937 23.89,-25.43 0,-17.5 -12.08,-25.347 -23.89,-25.347"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path300" /><path
         d="m 7148.18,401.609 c -0.9,5.141 -5.41,8.75 -11.27,8.75 -6.67,0 -12.71,-4.961 -12.71,-16.418 0,-11.543 6.13,-16.5 12.44,-16.5 5.23,0 10.55,2.34 11.9,8.84 H 7159 c -2.16,-11.363 -12.17,-17.769 -22.54,-17.769 -14.07,0 -23.36,10.906 -23.36,25.347 0,14.422 9.38,25.43 23.81,25.43 10.55,0 19.93,-6.859 21.73,-17.68 h -10.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path302" /><path
         d="m 7176.23,398.719 17.94,19.48 h 12.9 l -18.59,-19.929 20.66,-28.579 h -12.53 l -15.25,21.008 -5.13,-5.508 v -15.5 h -10.74 v 65.379 h 10.74 v -36.351"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path304" /><path
         d="m 7283.64,393.77 -9.92,28.031 -9.84,-28.031 z m -3.43,41.3 24.52,-65.379 h -12.53 l -5.14,14.52 h -26.51 l -5.06,-14.52 h -11.71 l 24.34,65.379 h 12.09"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path306" /><path
         d="m 7316.37,393.941 c 0,-10.281 5.14,-16.679 12.27,-16.679 7.03,0 12.54,5.496 12.54,16.679 0,11.188 -5.51,16.598 -12.54,16.598 -7.13,0 -12.27,-6.398 -12.27,-16.598 z m 35.08,41.129 v -65.379 h -10.73 v 6.399 c -2.88,-4.781 -7.93,-7.578 -14.42,-7.578 -11.46,0 -21.11,9.828 -21.11,25.429 0,15.508 9.65,25.348 21.11,25.348 6.49,0 11.54,-2.801 14.42,-7.578 v 23.359 h 10.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path308" /><path
         d="m 7372.48,424.25 h -10.74 v 10.82 h 10.74 z m 0,-6.051 v -49.238 c 0,-12.172 -3.07,-15.063 -14.08,-15.063 h -3.6 v 8.313 h 1.98 c 4.42,0 4.96,1.168 4.96,6.301 v 49.687 h 10.74"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path310" /><path
         d="m 7398.35,368.512 c -11.55,0 -16.23,7.578 -16.23,19.129 v 30.558 h 10.73 v -27.961 c 0,-6.578 0.9,-12.976 8.92,-12.976 8.03,0 10.92,6.308 10.92,15.058 v 25.879 h 10.72 v -48.508 h -10.72 v 6.668 c -2.8,-5.05 -7.76,-7.847 -14.34,-7.847"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path312" /><path
         d="m 7450.74,411.078 c -4.69,0 -9.02,-2.078 -9.02,-5.316 0,-3.25 2.35,-4.961 6.49,-5.774 l 6.85,-1.359 c 9.84,-1.891 17.32,-4.961 17.32,-14.418 0,-10.109 -9.56,-15.699 -20.56,-15.699 -11.9,0 -19.84,6.769 -21.01,15.957 h 10.46 c 0.99,-4.949 4.6,-7.84 10.91,-7.84 5.59,0 9.74,2.34 9.74,6.312 0,3.969 -3.6,5.77 -8.39,6.68 l -7.3,1.438 c -8.21,1.621 -14.61,5.32 -14.61,14.152 0,8.578 9.2,14.078 19.75,14.078 9.47,0 18.13,-4.598 20.11,-14.34 h -10.1 c -1.17,4.41 -5.23,6.129 -10.64,6.129"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path314" /><path
         d="m 7492.23,431 v -12.801 h 9.74 v -7.75 h -9.74 V 384.02 c 0,-4.961 1.17,-6.129 5.77,-6.129 h 3.88 v -8.2 h -7.94 c -10.37,0 -12.44,2.789 -12.44,12.707 v 28.051 h -7.22 v 7.75 h 7.22 V 431 h 10.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path316" /><path
         d="m 7508.82,369.691 v 48.508 h 10.74 v -6.758 c 2.79,5.047 7.57,7.848 14.06,7.848 7.49,0 11.9,-3.16 14.16,-8.57 4.15,6.133 9.82,8.57 15.78,8.57 11.46,0 15.87,-7.578 15.87,-19.129 v -30.469 h -10.73 v 27.86 c 0,6.59 -0.63,12.988 -8.57,12.988 -7.94,0 -10.64,-6.309 -10.64,-15.059 v -25.789 h -10.72 v 27.86 c 0,6.59 -0.64,12.988 -8.58,12.988 -7.93,0 -10.63,-6.309 -10.63,-15.059 v -25.789 h -10.74"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path318" /><path
         d="m 7621.72,398.719 c -0.26,7.582 -6.03,12.179 -12.35,12.179 -5.05,0 -11.99,-2.976 -12.89,-12.179 z m -12.08,-21.278 c 5.59,0 10.01,2.258 11.91,6.77 h 10.55 c -2.26,-7.762 -9.47,-15.699 -22.01,-15.699 -15.6,0 -24.53,11.91 -24.53,25.789 0,14.609 10.01,24.988 23.81,24.988 14.88,0 24.17,-12.078 23.27,-28.41 h -36.16 c 0.71,-9.02 7.03,-13.438 13.16,-13.438"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path320" /><path
         d="m 7665.11,419.289 c 11.72,0 16.51,-7.578 16.51,-19.129 v -30.469 h -10.73 v 27.86 c 0,6.59 -1,12.988 -9.2,12.988 -8.21,0 -11.27,-6.309 -11.27,-15.059 v -25.789 h -10.74 v 48.508 h 10.74 v -6.758 c 2.79,5.047 7.93,7.848 14.69,7.848"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path322" /><path
         d="m 7703.26,431 v -12.801 h 9.73 v -7.75 h -9.73 V 384.02 c 0,-4.961 1.17,-6.129 5.77,-6.129 h 3.88 v -8.2 h -7.94 c -10.37,0 -12.44,2.789 -12.44,12.707 v 28.051 h -7.22 v 7.75 h 7.22 V 431 h 10.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path324" /><path
         d="m 5430.15,2098.04 c 0,8.56 -5.32,13.97 -12.71,13.97 -7.39,0 -12.8,-5.41 -12.8,-13.97 0,-8.67 5.32,-13.89 12.71,-13.89 7.48,0 12.8,5.22 12.8,13.89 z m -10.63,22.45 c 12.08,0 21.73,-8.67 21.73,-22.28 0,-13.07 -9.74,-22.36 -23.81,-22.36 -16.96,0 -24.53,12.8 -24.53,31.92 0,18.85 6.85,35.8 25.97,35.8 13.7,0 20.2,-8.84 21.11,-17.59 h -10.92 c -0.72,6.32 -5.14,9.39 -11,9.39 -8.84,0 -14.07,-8.94 -14.25,-22.36 2.89,4.14 8.21,7.48 15.7,7.48"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path326" /><path
         d="m 5709.95,2126.8 h -14.61 v 7.4 c 9.47,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.73 v 49.78"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path328" /><path
         d="m 5755.22,2135.37 c -9.37,0 -14.79,-9.11 -14.79,-25.62 0,-16.5 5.42,-25.6 14.79,-25.6 9.46,0 14.88,9.1 14.88,25.6 0,16.51 -5.42,25.62 -14.88,25.62 z m 0,8.2 c 17.49,0 26.07,-13.8 26.07,-33.82 0,-20.1 -8.58,-33.9 -26.07,-33.9 -17.4,0 -25.98,13.8 -25.98,33.9 0,20.02 8.58,33.82 25.98,33.82"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path330" /><path
         d="m 6111.3,2126.8 h -14.6 v 7.4 c 9.47,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.74 v 49.78"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path332" /><path
         d="m 6156.57,2135.37 c -9.38,0 -14.8,-9.11 -14.8,-25.62 0,-16.5 5.42,-25.6 14.8,-25.6 9.46,0 14.88,9.1 14.88,25.6 0,16.51 -5.42,25.62 -14.88,25.62 z m 0,8.2 c 17.49,0 26.06,-13.8 26.06,-33.82 0,-20.1 -8.57,-33.9 -26.06,-33.9 -17.4,0 -25.98,13.8 -25.98,33.9 0,20.02 8.58,33.82 25.98,33.82"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path334" /><path
         d="m 5923.8,2125.45 c 0,-6.22 4.78,-10.37 11.81,-10.37 7.13,0 11.73,4.15 11.73,10.37 0,6.22 -4.6,9.92 -11.73,9.92 -7.03,0 -11.81,-3.7 -11.81,-9.92 z m 11.81,-41.3 c 8.03,0 13.17,4.41 13.17,11.81 0,7.3 -5.14,11.81 -13.17,11.81 -8.03,0 -13.16,-4.51 -13.16,-11.81 0,-7.4 5.13,-11.81 13.16,-11.81 z m 13.98,27.77 c 7.76,-3.97 10.37,-10.19 10.37,-16.33 0,-12.89 -10.64,-19.74 -24.35,-19.74 -13.71,0 -24.34,6.85 -24.34,19.74 0,6.14 2.61,12.46 10.37,16.33 -5.77,3.24 -8.39,9.29 -8.39,14.88 0,9.74 8.65,16.77 22.36,16.77 13.61,0 22.36,-7.03 22.36,-16.77 0,-5.59 -2.43,-11.36 -8.38,-14.88"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path336" /><path
         d="m 6459.44,2126.8 h -14.61 v 7.4 c 9.47,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.73 v 49.78"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path338" /><path
         d="m 6498.39,2106.69 h -3.15 v 8.92 h 2.71 c 10.19,0 15.15,3.34 15.15,10.11 0,6.58 -5.32,9.65 -11.37,9.65 -7.93,0 -12.35,-4.79 -13.34,-12.45 h -10.46 c 0.99,12.45 9.92,20.65 24.44,20.65 10.91,0 21.73,-4.96 21.73,-17.22 0,-6.5 -3.79,-11.91 -9.56,-14.7 7.85,-2.88 11.28,-9.29 11.28,-15.96 0,-13.35 -11.46,-19.84 -24.53,-19.84 -15.15,0 -23.36,9.92 -24.17,21.46 h 10.45 c 1.09,-7.21 5.33,-13.16 13.89,-13.16 7.58,0 13.26,4.14 13.26,11.27 0,8.39 -6.67,11.27 -16.33,11.27"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path340" /><path
         d="m 6305.37,2126.8 h -14.61 v 7.4 c 9.47,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.73 v 49.78"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path342" /><path
         d="m 6350.63,2135.37 c -9.37,0 -14.79,-9.11 -14.79,-25.62 0,-16.5 5.42,-25.6 14.79,-25.6 9.46,0 14.88,9.1 14.88,25.6 0,16.51 -5.42,25.62 -14.88,25.62 z m 0,8.2 c 17.49,0 26.07,-13.8 26.07,-33.82 0,-20.1 -8.58,-33.9 -26.07,-33.9 -17.4,0 -25.98,13.8 -25.98,33.9 0,20.02 8.58,33.82 25.98,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path344" /><path
         d="m 6778,2126.8 h -14.61 v 7.4 c 9.48,0.26 14.08,1.07 17.41,8.2 h 7.94 v -65.38 H 6778 v 49.78"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path346" /><path
         d="m 6810.47,2126.8 h -14.61 v 7.4 c 9.47,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.73 v 49.78"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path348" /><path
         d="m 7464.76,2126.8 h -14.61 v 7.4 c 9.48,0.26 14.07,1.07 17.4,8.2 h 7.94 v -65.38 h -10.73 v 49.78"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path350" /><path
         d="m 7521.3,2098.04 c 0,8.56 -5.33,13.97 -12.72,13.97 -7.39,0 -12.8,-5.41 -12.8,-13.97 0,-8.67 5.32,-13.89 12.71,-13.89 7.48,0 12.81,5.22 12.81,13.89 z m -10.64,22.45 c 12.08,0 21.73,-8.67 21.73,-22.28 0,-13.07 -9.74,-22.36 -23.81,-22.36 -16.95,0 -24.53,12.8 -24.53,31.92 0,18.85 6.85,35.8 25.98,35.8 13.71,0 20.19,-8.84 21.1,-17.59 h -10.92 c -0.72,6.32 -5.14,9.39 -10.99,9.39 -8.84,0 -14.08,-8.94 -14.25,-22.36 2.88,4.14 8.2,7.48 15.69,7.48"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path352" /><path
         d="m 6883.6,2232.25 c 0,18.19 14.74,32.92 32.92,32.92 18.17,0 32.91,-14.73 32.91,-32.92 0,-18.17 -14.74,-32.91 -32.91,-32.91 -18.18,0 -32.92,14.74 -32.92,32.91"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path354" /><path
         d="m 6889.25,2126.8 h -14.61 v 7.4 c 9.48,0.26 14.08,1.07 17.41,8.2 h 7.94 v -65.38 h -10.74 v 49.78"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path356" /><path
         d="m 6920.36,2086.39 h 34.27 v -9.37 h -47.62 v 8.84 c 21.82,17.04 34.9,28.58 34.9,39.5 0,6.31 -4.15,10.01 -10.55,10.01 -6.22,0 -12.17,-3.7 -12.17,-13.89 h -10.74 c -0.17,13.17 9.03,22.09 23.36,22.09 12.08,0 21.28,-6.22 21.28,-17.31 0,-13.53 -12.99,-26.15 -32.73,-39.87"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path358" /><path
         d="m 2502.57,3639.99 h -23.38 v 11.83 c 15.16,0.44 22.52,1.74 27.86,13.14 h 12.7 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path360" /><path
         d="m 3133.25,3575.32 h 54.85 v -15.01 h -76.21 v 14.15 c 34.93,27.28 55.86,45.75 55.86,63.22 0,10.1 -6.64,16.02 -16.89,16.02 -9.96,0 -19.49,-5.92 -19.49,-22.23 h -17.17 c -0.29,21.08 14.43,35.37 37.38,35.37 19.34,0 34.07,-9.96 34.07,-27.71 0,-21.66 -20.79,-41.87 -52.4,-63.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path362" /><path
         d="m 3280.6,3113.47 h -5.05 v 14.29 h 4.33 c 16.31,0 24.25,5.34 24.25,16.17 0,10.54 -8.51,15.44 -18.19,15.44 -12.7,0 -19.77,-7.64 -21.36,-19.91 h -16.75 c 1.6,19.91 15.88,33.06 39.12,33.06 17.47,0 34.79,-7.94 34.79,-27.58 0,-10.39 -6.06,-19.05 -15.3,-23.53 12.56,-4.61 18.04,-14.86 18.04,-25.54 0,-21.37 -18.33,-31.76 -39.26,-31.76 -24.25,0 -37.39,15.88 -38.69,34.35 h 16.75 c 1.73,-11.55 8.52,-21.07 22.23,-21.07 12.12,0 21.22,6.64 21.22,18.04 0,13.43 -10.68,18.04 -26.13,18.04"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path364" /><path
         d="m 3735.01,3170.63 v -15.15 c -26.71,-25.26 -41,-51.1 -43.3,-89.5 h -19.49 c 1.87,36.81 20.2,67.27 44.6,89.5 h -57.02 v 15.15 h 75.21"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path366" /><path
         d="m 4908.79,3143.5 c 0,-9.96 7.64,-16.6 18.9,-16.6 11.41,0 18.76,6.64 18.76,16.6 0,9.96 -7.35,15.87 -18.76,15.87 -11.26,0 -18.9,-5.91 -18.9,-15.87 z m 18.9,-66.11 c 12.84,0 21.08,7.07 21.08,18.91 0,11.69 -8.24,18.9 -21.08,18.9 -12.85,0 -21.07,-7.21 -21.07,-18.9 0,-11.84 8.22,-18.91 21.07,-18.91 z m 22.37,44.45 c 12.42,-6.34 16.61,-16.3 16.61,-26.12 0,-20.64 -17.03,-31.61 -38.98,-31.61 -21.94,0 -38.97,10.97 -38.97,31.61 0,9.82 4.19,19.92 16.6,26.12 -9.24,5.2 -13.43,14.88 -13.43,23.82 0,15.6 13.86,26.86 35.8,26.86 21.8,0 35.8,-11.26 35.8,-26.86 0,-8.94 -3.89,-18.18 -13.43,-23.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path368" /><path
         d="m 5692.43,3145.66 h -23.39 v 11.84 c 15.16,0.44 22.52,1.74 27.86,13.13 h 12.71 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path370" /><path
         d="m 5764.86,3159.37 c -15.01,0 -23.67,-14.57 -23.67,-40.98 0,-26.42 8.66,-41 23.67,-41 15.16,0 23.82,14.58 23.82,41 0,26.41 -8.66,40.98 -23.82,40.98 z m 0,13.15 c 28.01,0 41.72,-22.09 41.72,-54.13 0,-32.2 -13.71,-54.28 -41.72,-54.28 -27.86,0 -41.57,22.08 -41.57,54.28 0,32.04 13.71,54.13 41.57,54.13"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path372" /><path
         d="m 2642.51,4064.94 h 54.85 v -15.01 h -76.22 v 14.15 c 34.94,27.28 55.87,45.75 55.87,63.22 0,10.1 -6.64,16.02 -16.89,16.02 -9.96,0 -19.49,-5.92 -19.49,-22.23 h -17.18 c -0.28,21.07 14.44,35.37 37.39,35.37 19.34,0 34.06,-9.96 34.06,-27.71 0,-21.66 -20.78,-41.87 -52.39,-63.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path374" /><path
         d="m 3046.06,4097.42 h -5.05 v 14.29 h 4.33 c 16.31,0 24.25,5.34 24.25,16.17 0,10.53 -8.51,15.44 -18.19,15.44 -12.7,0 -19.77,-7.65 -21.36,-19.91 h -16.75 c 1.59,19.91 15.88,33.05 39.12,33.05 17.47,0 34.79,-7.94 34.79,-27.57 0,-10.4 -6.06,-19.06 -15.3,-23.53 12.56,-4.62 18.04,-14.86 18.04,-25.55 0,-21.36 -18.33,-31.76 -39.26,-31.76 -24.25,0 -37.39,15.88 -38.69,34.36 h 16.75 c 1.73,-11.55 8.52,-21.07 22.23,-21.07 12.12,0 21.22,6.64 21.22,18.03 0,13.43 -10.68,18.05 -26.13,18.05"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path376" /><path
         d="m 4637.31,4120.95 c 0,-13.72 8.52,-22.38 20.35,-22.38 11.69,0 20.5,8.66 20.5,22.38 0,14 -8.66,22.37 -20.35,22.37 -11.98,0 -20.5,-8.37 -20.5,-22.37 z m 17.03,-35.94 c -19.34,0 -34.78,13.85 -34.78,35.8 0,20.78 15.58,35.65 38.1,35.65 27.14,0 39.27,-20.5 39.27,-51.1 0,-30.17 -11.12,-57.31 -41.72,-57.31 -21.8,0 -32.19,14.15 -33.63,28.15 h 17.46 c 1.16,-10.1 8.23,-14.86 17.62,-14.86 14.14,0 22.51,14.28 22.8,35.65 -4.62,-6.64 -13.14,-11.98 -25.12,-11.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path378" /><path
         d="m 6092.36,4129.61 h -23.39 v 11.84 c 15.16,0.43 22.52,1.73 27.86,13.13 h 12.71 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path380" /><path
         d="m 6164.79,4143.32 c -15.01,0 -23.67,-14.57 -23.67,-40.99 0,-26.42 8.66,-40.99 23.67,-40.99 15.16,0 23.82,14.57 23.82,40.99 0,26.42 -8.66,40.99 -23.82,40.99 z m 0,13.14 c 28.01,0 41.72,-22.09 41.72,-54.13 0,-32.19 -13.71,-54.28 -41.72,-54.28 -27.86,0 -41.57,22.09 -41.57,54.28 0,32.04 13.71,54.13 41.57,54.13"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path382" /><path
         d="m 6441.98,4129.61 h -23.39 v 11.84 c 15.16,0.43 22.52,1.73 27.86,13.13 h 12.71 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path384" /><path
         d="m 6504.31,4097.42 h -5.06 v 14.29 h 4.34 c 16.31,0 24.25,5.34 24.25,16.17 0,10.53 -8.52,15.44 -18.2,15.44 -12.69,0 -19.77,-7.65 -21.35,-19.91 h -16.75 c 1.59,19.91 15.88,33.05 39.12,33.05 17.46,0 34.79,-7.94 34.79,-27.57 0,-10.4 -6.07,-19.06 -15.31,-23.53 12.56,-4.62 18.05,-14.86 18.05,-25.55 0,-21.36 -18.33,-31.76 -39.26,-31.76 -24.26,0 -37.39,15.88 -38.69,34.36 h 16.75 c 1.73,-11.55 8.51,-21.07 22.23,-21.07 12.12,0 21.22,6.64 21.22,18.03 0,13.43 -10.69,18.05 -26.13,18.05"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path386" /><path
         d="m 2799.64,4594.23 h -5.06 v 14.29 h 4.33 c 16.32,0 24.26,5.34 24.26,16.17 0,10.53 -8.52,15.44 -18.19,15.44 -12.71,0 -19.78,-7.65 -21.37,-19.92 h -16.74 c 1.59,19.92 15.88,33.06 39.12,33.06 17.46,0 34.78,-7.94 34.78,-27.58 0,-10.39 -6.06,-19.05 -15.3,-23.53 12.56,-4.61 18.05,-14.86 18.05,-25.54 0,-21.37 -18.33,-31.76 -39.27,-31.76 -24.24,0 -37.38,15.88 -38.68,34.36 h 16.75 c 1.72,-11.56 8.51,-21.08 22.22,-21.08 12.13,0 21.22,6.64 21.22,18.04 0,13.43 -10.68,18.05 -26.12,18.05"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path388" /><path
         d="m 5048.19,4586.14 v 42.87 l -32.91,-42.87 z m 17.18,-14.86 v -24.55 h -17.18 v 24.55 h -51.68 v 14.29 l 51.83,65.82 h 17.03 v -65.25 h 18.47 v -14.86 h -18.47"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path390" /><path
         d="m 5429.54,4580.37 c 0,13.71 -8.52,22.37 -20.35,22.37 -11.84,0 -20.5,-8.66 -20.5,-22.37 0,-13.86 8.51,-22.23 20.35,-22.23 11.98,0 20.5,8.37 20.5,22.23 z m -17.03,35.95 c 19.33,0 34.78,-13.86 34.78,-35.66 0,-20.93 -15.58,-35.8 -38.1,-35.8 -27.14,0 -39.27,20.5 -39.27,51.09 0,30.18 10.97,57.32 41.57,57.32 21.94,0 32.33,-14.15 33.78,-28.16 h -17.46 c -1.16,10.11 -8.23,15.02 -17.62,15.02 -14.14,0 -22.52,-14.29 -22.8,-35.8 4.62,6.65 13.13,11.99 25.12,11.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path392" /><path
         d="m 3584.18,3599.71 v 42.88 l -32.91,-42.88 z m 17.17,-14.86 v -24.54 h -17.17 v 24.54 h -51.68 v 14.29 l 51.82,65.82 h 17.03 v -65.25 h 18.48 v -14.86 h -18.48"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path394" /><path
         d="m 4133.94,3616.89 c -9.67,0 -16.74,-4.9 -18.91,-10.96 l -16.17,0.87 6.93,58.16 h 62.64 v -15.16 h -48.49 l -3.32,-26.27 c 5.05,4.05 12.27,6.5 21.65,6.5 17.9,0 34.5,-12.27 34.5,-35.79 0,-23.39 -17.9,-35.8 -38.68,-35.8 -24.4,0 -36.81,15.87 -38.11,33.91 h 16.6 c 1.44,-12.12 8.08,-20.63 21.8,-20.63 11.54,0 20.64,8.22 20.64,22.22 0,15.59 -10.69,22.95 -21.08,22.95"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path396" /><path
         d="m 4509.67,3593.94 c 0,13.71 -8.51,22.38 -20.35,22.38 -11.83,0 -20.5,-8.67 -20.5,-22.38 0,-13.85 8.52,-22.22 20.36,-22.22 11.98,0 20.49,8.37 20.49,22.22 z m -17.03,35.95 c 19.34,0 34.79,-13.86 34.79,-35.65 0,-20.94 -15.59,-35.8 -38.11,-35.8 -27.14,0 -39.27,20.49 -39.27,51.09 0,30.18 10.98,57.31 41.58,57.31 21.94,0 32.33,-14.15 33.78,-28.15 h -17.46 c -1.17,10.11 -8.24,15.01 -17.62,15.01 -14.14,0 -22.52,-14.29 -22.8,-35.79 4.61,6.64 13.13,11.98 25.11,11.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path398" /><path
         d="m 5229.36,3664.96 v -15.16 c -26.71,-25.25 -40.99,-51.09 -43.31,-89.49 h -19.48 c 1.87,36.81 20.2,67.27 44.6,89.49 h -57.01 v 15.16 h 75.2"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path400" /><path
         d="m 7328.97,2688.54 c 0,59.34 48.11,107.44 107.44,107.44 20.47,0 91.17,0 111.65,0 59.34,0 107.43,-48.1 107.43,-107.44 0,-20.47 0,-91.17 0,-111.64 0,-59.34 -48.09,-107.44 -107.43,-107.44 -20.48,0 -91.18,0 -111.65,0 -59.33,0 -107.44,48.1 -107.44,107.44 0,20.47 0,91.17 0,111.64"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path402" /><path
         d="m 6753.25,4669.22 c 0,59.34 48.1,107.44 107.44,107.44 20.48,0 91.17,0 111.65,0 59.34,0 107.44,-48.1 107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 -48.1,-107.43 -107.44,-107.43 -20.48,0 -91.17,0 -111.65,0 -59.34,0 -107.44,48.1 -107.44,107.43 0,20.48 0,91.18 0,111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path404" /><path
         d="m 6268.36,3454.04 c -56.49,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.95,102.44 102.44,102.44 h 111.65 c 56.48,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path406" /><path
         d="m 6380.01,3775.56 c -20.47,0 -91.18,0 -111.65,0 -59.34,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.1,-107.43 107.44,-107.43 20.47,0 91.18,0 111.65,0 59.33,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.11,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.72,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.72,97.44 97.44,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path408" /><path
         d="m 6275.99,3639.99 h -23.39 v 11.83 c 15.16,0.44 22.52,1.74 27.87,13.14 h 12.7 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path410" /><path
         d="m 6348.42,3653.7 c -15.01,0 -23.67,-14.57 -23.67,-40.99 0,-26.41 8.66,-40.99 23.67,-40.99 15.16,0 23.82,14.58 23.82,40.99 0,26.42 -8.66,40.99 -23.82,40.99 z m 0,13.14 c 28.01,0 41.72,-22.09 41.72,-54.13 0,-32.19 -13.71,-54.27 -41.72,-54.27 -27.86,0 -41.57,22.08 -41.57,54.27 0,32.04 13.71,54.13 41.57,54.13"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path412" /><path
         d="m 7448.3,2658.6 h -23.39 v 11.84 c 15.15,0.44 22.52,1.74 27.86,13.13 h 12.7 v -104.65 h -17.17 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path414" /><path
         d="m 7538.78,2612.56 c 0,13.71 -8.52,22.37 -20.36,22.37 -11.83,0 -20.49,-8.66 -20.49,-22.37 0,-13.86 8.51,-22.23 20.35,-22.23 11.98,0 20.5,8.37 20.5,22.23 z m -17.04,35.94 c 19.34,0 34.79,-13.85 34.79,-35.65 0,-20.94 -15.59,-35.8 -38.11,-35.8 -27.13,0 -39.26,20.5 -39.26,51.09 0,30.18 10.97,57.32 41.57,57.32 21.94,0 32.33,-14.15 33.78,-28.16 h -17.46 c -1.16,10.11 -8.24,15.01 -17.62,15.01 -14.14,0 -22.52,-14.28 -22.8,-35.79 4.62,6.64 13.13,11.98 25.11,11.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path416" /><path
         d="m 6869.6,4639.28 h -23.39 v 11.83 c 15.15,0.44 22.52,1.74 27.86,13.14 h 12.7 V 4559.6 h -17.17 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path418" /><path
         d="m 6919.37,4574.61 h 54.85 V 4559.6 H 6898 v 14.15 c 34.94,27.27 55.86,45.75 55.86,63.22 0,10.1 -6.64,16.01 -16.88,16.01 -9.96,0 -19.49,-5.91 -19.49,-22.22 h -17.18 c -0.28,21.07 14.44,35.37 37.39,35.37 19.34,0 34.06,-9.96 34.06,-27.72 0,-21.65 -20.78,-41.86 -52.39,-63.8"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path420" /><path
         d="m 6738.12,3454.04 c -56.48,0 -102.44,45.95 -102.44,102.43 v 111.65 c 0,56.49 45.96,102.44 102.44,102.44 h 111.65 c 56.49,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.95,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path422" /><path
         d="m 6849.77,3775.56 c -20.48,0 -91.17,0 -111.65,0 -59.33,0 -107.44,-48.1 -107.44,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.11,-107.43 107.44,-107.43 20.48,0 91.17,0 111.65,0 59.34,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.1,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.73,0 -97.44,43.71 -97.44,97.43 v 111.65 c 0,53.73 43.71,97.44 97.44,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path424" /><path
         d="m 6765.67,3639.99 h -23.39 v 11.83 c 15.16,0.44 22.52,1.74 27.86,13.14 h 12.71 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path426" /><path
         d="m 6817.6,3639.99 h -23.38 v 11.83 c 15.15,0.44 22.51,1.74 27.86,13.14 h 12.7 v -104.65 h -17.18 v 79.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path428" /><path
         d="m 5880.79,3454.04 c -56.49,0 -102.43,45.95 -102.43,102.43 v 111.65 c 0,56.49 45.94,102.44 102.43,102.44 h 111.65 c 56.48,0 102.44,-45.95 102.44,-102.44 v -111.65 c 0,-56.48 -45.96,-102.43 -102.44,-102.43 h -111.65"
         style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path430" /><path
         d="m 5992.44,3775.56 c -20.47,0 -91.17,0 -111.65,0 -59.34,0 -107.43,-48.1 -107.43,-107.44 0,-20.47 0,-91.17 0,-111.65 0,-59.33 48.09,-107.43 107.43,-107.43 20.48,0 91.18,0 111.65,0 59.33,0 107.44,48.1 107.44,107.43 0,20.48 0,91.18 0,111.65 0,59.34 -48.11,107.44 -107.44,107.44 z m 0,-10 c 53.73,0 97.44,-43.71 97.44,-97.44 v -111.65 c 0,-53.72 -43.71,-97.43 -97.44,-97.43 h -111.65 c -53.72,0 -97.43,43.71 -97.43,97.43 v 111.65 c 0,53.73 43.71,97.44 97.43,97.44 h 111.65"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path432" /><path
         d="m 5911.25,3637.83 c 0,-9.96 7.64,-16.6 18.9,-16.6 11.41,0 18.76,6.64 18.76,16.6 0,9.95 -7.35,15.87 -18.76,15.87 -11.26,0 -18.9,-5.92 -18.9,-15.87 z m 18.9,-66.11 c 12.84,0 21.08,7.07 21.08,18.9 0,11.69 -8.24,18.91 -21.08,18.91 -12.85,0 -21.07,-7.22 -21.07,-18.91 0,-11.83 8.22,-18.9 21.07,-18.9 z m 22.38,44.45 c 12.41,-6.35 16.6,-16.31 16.6,-26.12 0,-20.65 -17.03,-31.61 -38.98,-31.61 -21.94,0 -38.97,10.96 -38.97,31.61 0,9.81 4.19,19.92 16.6,26.12 -9.24,5.2 -13.43,14.87 -13.43,23.82 0,15.59 13.86,26.85 35.8,26.85 21.8,0 35.8,-11.26 35.8,-26.85 0,-8.95 -3.89,-18.19 -13.42,-23.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path434" /><path
         d="M 1970.62,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path436" /><path
         d="M 2382.8,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path438" /><path
         d="M 2794.99,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path440" /><path
         d="M 3207.18,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path442" /><path
         d="M 3619.37,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path444" /><path
         d="M 4031.56,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path446" /><path
         d="M 4443.75,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path448" /><path
         d="M 4855.93,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path450" /><path
         d="M 5268.12,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path452" /><path
         d="M 5680.31,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path454" /><path
         d="M 6092.5,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path456" /><path
         d="M 6504.68,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path458" /><path
         d="M 6916.87,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path460" /><path
         d="M 7329.06,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path462" /><path
         d="M 7741.25,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path464" /><path
         d="M 8153.43,644.359 V 577.93"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path466" /><path
         d="M 258.156,611.148 H 8230.01"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path468" /><path
         d="m 1979.12,783.34 c -9.38,0 -14.79,-9.11 -14.79,-25.621 0,-16.5 5.41,-25.598 14.79,-25.598 9.47,0 14.88,9.098 14.88,25.598 0,16.511 -5.41,25.621 -14.88,25.621 z m 0,8.199 c 17.5,0 26.06,-13.801 26.06,-33.82 0,-20.098 -8.56,-33.899 -26.06,-33.899 -17.4,0 -25.97,13.801 -25.97,33.899 0,20.019 8.57,33.82 25.97,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path470" /><path
         d="m 2375.69,774.762 h -14.6 v 7.406 c 9.46,0.262 14.06,1.07 17.4,8.203 h 7.94 v -65.383 h -10.74 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path472" /><path
         d="m 2784.84,734.359 h 34.26 v -9.371 h -47.61 v 8.84 c 21.82,17.043 34.9,28.582 34.9,39.5 0,6.313 -4.15,10.012 -10.55,10.012 -6.22,0 -12.18,-3.699 -12.18,-13.891 h -10.73 c -0.18,13.172 9.02,22.09 23.36,22.09 12.09,0 21.28,-6.219 21.28,-17.309 0,-13.531 -12.98,-26.16 -32.73,-39.871"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path474" /><path
         d="m 3204.87,754.66 h -3.15 v 8.918 h 2.7 c 10.19,0 15.15,3.34 15.15,10.113 0,6.579 -5.32,9.649 -11.37,9.649 -7.93,0 -12.35,-4.789 -13.34,-12.449 h -10.46 c 0.99,12.449 9.92,20.648 24.44,20.648 10.91,0 21.73,-4.961 21.73,-17.23 0,-6.489 -3.79,-11.899 -9.56,-14.688 7.85,-2.883 11.27,-9.293 11.27,-15.961 0,-13.351 -11.45,-19.84 -24.52,-19.84 -15.16,0 -23.36,9.918 -24.17,21.461 h 10.46 c 1.08,-7.222 5.32,-13.16 13.89,-13.16 7.57,0 13.25,4.137 13.25,11.27 0,8.39 -6.67,11.269 -16.32,11.269"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path476" /><path
         d="m 3626.8,749.609 v 26.782 l -20.56,-26.782 z m 10.73,-9.289 v -15.332 h -10.73 v 15.332 h -32.29 v 8.93 l 32.38,41.121 h 10.64 v -40.762 h 11.54 v -9.289 h -11.54"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path478" /><path
         d="m 4032.58,760.34 c -6.04,0 -10.46,-3.07 -11.81,-6.86 l -10.1,0.54 4.33,36.351 h 39.13 v -9.473 h -30.3 l -2.07,-16.41 c 3.15,2.524 7.67,4.051 13.52,4.051 11.19,0 21.56,-7.66 21.56,-22.359 0,-14.61 -11.18,-22.36 -24.17,-22.36 -15.24,0 -23,9.918 -23.81,21.188 h 10.37 c 0.91,-7.578 5.05,-12.887 13.62,-12.887 7.21,0 12.9,5.129 12.9,13.879 0,9.738 -6.68,14.34 -13.17,14.34"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path480" /><path
         d="m 4459,746 c 0,8.57 -5.32,13.98 -12.71,13.98 -7.4,0 -12.81,-5.41 -12.81,-13.98 0,-8.66 5.32,-13.879 12.72,-13.879 7.48,0 12.8,5.219 12.8,13.879 z m -10.63,22.461 c 12.08,0 21.72,-8.672 21.72,-22.281 0,-13.078 -9.73,-22.36 -23.8,-22.36 -16.96,0 -24.54,12.801 -24.54,31.918 0,18.852 6.86,35.801 25.98,35.801 13.7,0 20.2,-8.84 21.1,-17.59 h -10.91 c -0.73,6.321 -5.14,9.391 -11,9.391 -8.84,0 -14.07,-8.942 -14.25,-22.371 2.88,4.152 8.21,7.492 15.7,7.492"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path482" /><path
         d="m 4872.54,790.371 v -9.473 c -16.68,-15.777 -25.61,-31.929 -27.06,-55.91 h -12.17 c 1.17,23 12.62,42.024 27.87,55.91 h -35.63 v 9.473 h 46.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path484" /><path
         d="m 5254.69,773.418 c 0,-6.219 4.79,-10.367 11.82,-10.367 7.13,0 11.73,4.148 11.73,10.367 0,6.223 -4.6,9.922 -11.73,9.922 -7.03,0 -11.82,-3.699 -11.82,-9.922 z m 11.82,-41.297 c 8.03,0 13.16,4.41 13.16,11.801 0,7.308 -5.13,11.816 -13.16,11.816 -8.03,0 -13.16,-4.508 -13.16,-11.816 0,-7.391 5.13,-11.801 13.16,-11.801 z m 13.97,27.77 c 7.77,-3.973 10.38,-10.192 10.38,-16.332 0,-12.891 -10.64,-19.739 -24.35,-19.739 -13.71,0 -24.35,6.848 -24.35,19.739 0,6.14 2.62,12.453 10.38,16.332 -5.78,3.238 -8.39,9.289 -8.39,14.871 0,9.75 8.65,16.777 22.36,16.777 13.61,0 22.36,-7.027 22.36,-16.777 0,-5.582 -2.43,-11.352 -8.39,-14.871"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path486" /><path
         d="m 5664.27,769.352 c 0,-8.563 5.32,-13.973 12.72,-13.973 7.3,0 12.8,5.41 12.8,13.973 0,8.75 -5.41,13.988 -12.71,13.988 -7.49,0 -12.81,-5.238 -12.81,-13.988 z m 10.64,-22.454 c -12.08,0 -21.73,8.653 -21.73,22.372 0,12.98 9.74,22.269 23.81,22.269 16.95,0 24.52,-12.801 24.52,-31.918 0,-18.851 -6.94,-35.801 -26.05,-35.801 -13.63,0 -20.12,8.828 -21.02,17.578 h 10.91 c 0.72,-6.308 5.14,-9.277 11,-9.277 8.84,0 14.08,8.918 14.25,22.258 -2.88,-4.141 -8.2,-7.481 -15.69,-7.481"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path488" /><path
         d="m 6077.01,774.762 h -14.61 v 7.406 c 9.47,0.262 14.07,1.07 17.4,8.203 h 7.94 v -65.383 h -10.73 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path490" /><path
         d="m 6122.27,783.34 c -9.37,0 -14.79,-9.11 -14.79,-25.621 0,-16.5 5.42,-25.598 14.79,-25.598 9.46,0 14.88,9.098 14.88,25.598 0,16.511 -5.42,25.621 -14.88,25.621 z m 0,8.199 c 17.49,0 26.07,-13.801 26.07,-33.82 0,-20.098 -8.58,-33.899 -26.07,-33.899 -17.4,0 -25.97,13.801 -25.97,33.899 0,20.019 8.57,33.82 25.97,33.82"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path492" /><path
         d="m 6489.2,774.762 h -14.61 v 7.406 c 9.47,0.262 14.07,1.07 17.4,8.203 h 7.94 v -65.383 h -10.73 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path494" /><path
         d="m 6521.66,774.762 h -14.61 v 7.406 c 9.47,0.262 14.07,1.07 17.4,8.203 h 7.94 v -65.383 h -10.73 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path496" /><path
         d="m 6899.4,774.762 h -14.61 v 7.406 c 9.47,0.262 14.07,1.07 17.4,8.203 h 7.94 v -65.383 h -10.73 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path498" /><path
         d="m 6930.51,734.359 h 34.27 v -9.371 h -47.62 v 8.84 c 21.83,17.043 34.91,28.582 34.91,39.5 0,6.313 -4.15,10.012 -10.55,10.012 -6.22,0 -12.18,-3.699 -12.18,-13.891 h -10.73 c -0.18,13.172 9.02,22.09 23.36,22.09 12.08,0 21.28,-6.219 21.28,-17.309 0,-13.531 -12.99,-26.16 -32.74,-39.871"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path500" /><path
         d="m 7310.07,774.762 h -14.6 v 7.406 c 9.47,0.262 14.07,1.07 17.4,8.203 h 7.94 v -65.383 h -10.74 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path502" /><path
         d="m 7349.02,754.66 h -3.15 v 8.918 h 2.7 c 10.2,0 15.16,3.34 15.16,10.113 0,6.579 -5.33,9.649 -11.37,9.649 -7.93,0 -12.35,-4.789 -13.35,-12.449 h -10.46 c 1,12.449 9.92,20.648 24.44,20.648 10.91,0 21.73,-4.961 21.73,-17.23 0,-6.489 -3.79,-11.899 -9.56,-14.688 7.85,-2.883 11.28,-9.293 11.28,-15.961 0,-13.351 -11.45,-19.84 -24.53,-19.84 -15.15,0 -23.36,9.918 -24.17,21.461 h 10.46 c 1.08,-7.222 5.32,-13.16 13.89,-13.16 7.57,0 13.26,4.137 13.26,11.27 0,8.39 -6.67,11.269 -16.33,11.269"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path504" /><path
         d="m 7709.81,774.762 h -14.61 v 7.406 c 9.47,0.262 14.07,1.07 17.4,8.203 h 7.94 v -65.383 h -10.73 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path506" /><path
         d="m 7758.51,749.609 v 26.782 l -20.56,-26.782 z m 10.73,-9.289 v -15.332 h -10.73 v 15.332 h -32.28 v 8.93 l 32.37,41.121 h 10.64 v -40.762 h 11.55 v -9.289 h -11.55"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path508" /><path
         d="m 8132.19,774.762 h -14.61 v 7.406 c 9.48,0.262 14.08,1.07 17.41,8.203 h 7.94 v -65.383 h -10.74 v 49.774"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path510" /><path
         d="m 8174.49,760.34 c -6.05,0 -10.46,-3.07 -11.82,-6.86 l -10.1,0.54 4.33,36.351 h 39.14 v -9.473 h -30.3 l -2.07,-16.41 c 3.15,2.524 7.66,4.051 13.52,4.051 11.19,0 21.56,-7.66 21.56,-22.359 0,-14.61 -11.19,-22.36 -24.17,-22.36 -15.24,0 -22.99,9.918 -23.81,21.188 h 10.37 c 0.91,-7.578 5.06,-12.887 13.62,-12.887 7.22,0 12.89,5.129 12.89,13.879 0,9.738 -6.67,14.34 -13.16,14.34"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path512" /><path
         d="m 305.969,655.898 c -26.754,0 -42.278,19.051 -42.278,47.692 0,28.781 16.536,47.07 43.036,47.07 20.316,0 34.828,-11.601 38.484,-32.051 h -15.395 c -2.773,12.371 -11.734,18.93 -23.597,18.93 -14.516,0 -25.992,-11.859 -25.992,-33.949 0,-22.199 11.23,-34.57 25.867,-34.57 12.363,0 21.195,6.441 23.976,18.929 h 15.395 c -3.785,-20.437 -18.422,-32.051 -39.496,-32.051"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path514" /><path
         d="m 378.723,655.898 c -16.153,0 -22.715,10.59 -22.715,26.743 v 42.789 h 15.015 v -39.121 c 0,-9.207 1.258,-18.18 12.493,-18.18 11.23,0 15.269,8.84 15.269,21.082 v 36.219 h 15.016 v -67.891 h -15.016 v 9.332 c -3.91,-7.062 -10.855,-10.973 -20.062,-10.973"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path516" /><path
         d="m 458.059,710.539 c -9.469,0 -14.895,-3.777 -14.895,-17.418 v -35.582 h -15.012 v 67.891 h 14.758 v -12.121 c 3.664,7.582 10.227,12.121 18.426,12.242 1.137,0 2.777,-0.121 3.914,-0.25 v -15.153 c -2.523,0.262 -4.922,0.391 -7.191,0.391"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path518" /><path
         d="m 502.063,710.539 c -9.465,0 -14.887,-3.777 -14.887,-17.418 V 657.539 H 472.16 v 67.891 h 14.762 v -12.121 c 3.66,7.582 10.223,12.121 18.422,12.242 1.136,0 2.777,-0.121 3.914,-0.25 v -15.153 c -2.524,0.262 -4.922,0.391 -7.195,0.391"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path520" /><path
         d="m 560.715,698.168 c -0.375,10.602 -8.453,17.031 -17.285,17.031 -7.067,0 -16.782,-4.16 -18.047,-17.031 z m -16.91,-29.777 c 7.828,0 14.008,3.148 16.66,9.461 H 575.23 C 572.07,667 561.98,655.898 544.441,655.898 c -21.832,0 -34.328,16.661 -34.328,36.09 0,20.442 14.008,34.953 33.317,34.953 20.82,0 33.816,-16.902 32.558,-39.742 h -50.605 c 1.012,-12.629 9.844,-18.808 18.422,-18.808"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path522" /><path
         d="m 621.367,726.941 c 16.406,0 23.098,-10.589 23.098,-26.75 v -42.652 h -15.02 v 38.992 c 0,9.207 -1.386,18.18 -12.871,18.18 -11.48,0 -15.773,-8.84 -15.773,-21.082 v -36.09 h -15.016 v 67.891 h 15.016 v -9.461 c 3.914,7.062 11.105,10.972 20.566,10.972"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path524" /><path
         d="M 674.707,743.352 V 725.43 h 13.629 v -10.852 h -13.629 v -36.969 c 0,-6.949 1.641,-8.589 8.078,-8.589 h 5.43 v -11.481 h -11.11 c -14.511,0 -17.41,3.91 -17.41,17.789 v 39.25 h -10.097 v 10.852 h 10.097 v 17.922 h 15.012"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path526" /><path
         d="m 763.758,655.898 c -26.754,0 -42.278,19.051 -42.278,47.692 0,28.781 16.536,47.07 43.032,47.07 20.316,0 34.832,-11.601 38.488,-32.051 h -15.395 c -2.777,12.371 -11.734,18.93 -23.601,18.93 -14.512,0 -25.988,-11.859 -25.988,-33.949 0,-22.199 11.226,-34.57 25.867,-34.57 12.363,0 21.195,6.441 23.976,18.929 h 15.395 c -3.785,-20.437 -18.426,-32.051 -39.496,-32.051"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path528" /><path
         d="m 813.426,657.539 v 91.481 h 15.012 v -91.481 h -15.012"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path530" /><path
         d="m 889.621,691.359 c 0,15.641 -8.457,23.352 -17.922,23.352 -9.465,0 -17.918,-7.711 -17.918,-23.352 0,-15.648 8.453,-23.23 17.918,-23.23 9.465,0 17.922,7.582 17.922,23.23 z m -17.922,-35.461 c -16.531,0 -33.441,10.973 -33.441,35.461 0,24.481 16.91,35.582 33.441,35.582 16.531,0 33.438,-11.101 33.438,-35.582 0,-24.488 -16.907,-35.461 -33.438,-35.461"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path532" /><path
         d="m 960.117,702.211 c -1.262,7.187 -7.57,12.238 -15.773,12.238 -9.336,0 -17.793,-6.941 -17.793,-22.969 0,-16.152 8.578,-23.089 17.414,-23.089 7.316,0 14.762,3.281 16.656,12.371 h 14.641 c -3.028,-15.91 -17.039,-24.864 -31.551,-24.864 -19.688,0 -32.684,15.27 -32.684,35.461 0,20.192 13.125,35.582 33.317,35.582 14.765,0 27.89,-9.589 30.41,-24.73 h -14.637"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path534" /><path
         d="m 999.316,698.168 25.114,27.262 h 18.04 l -25.99,-27.891 28.9,-40 h -17.54 l -21.33,29.402 -7.194,-7.691 v -21.711 h -15.011 v 91.481 h 15.011 v -50.852"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path536" /><path
         d="M 7643.61,221.898 V 155.48"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path538" /><path
         d="M 7231.42,221.898 V 155.48"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path540" /><path
         d="M 8055.8,221.898 V 155.48"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path542" /><path
         d="M 258.156,188.691 H 8230.01"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path544" /><path
         d="m 7206.65,50.9492 h -14.61 v 7.4024 c 9.47,0.2578 14.07,1.0664 17.4,8.1992 h 7.94 V 1.16797 h -10.73 V 50.9492"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path546" /><path
         d="m 7237.76,10.5508 h 34.27 V 1.16797 h -47.62 v 8.84373 c 21.83,17.0391 34.9,28.5781 34.9,39.5 0,6.3086 -4.15,10.0078 -10.54,10.0078 -6.22,0 -12.18,-3.6992 -12.18,-13.8906 h -10.73 c -0.18,13.1719 9.02,22.0899 23.36,22.0899 12.08,0 21.27,-6.2188 21.27,-17.3086 0,-13.5313 -12.98,-26.1485 -32.73,-39.8594"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path548" /><path
         d="m 7613.74,50.9492 h -14.61 v 7.4024 c 9.47,0.2578 14.07,1.0664 17.4,8.1992 h 7.94 V 1.16797 h -10.73 V 50.9492"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path550" /><path
         d="m 7652.69,30.8398 h -3.15 v 8.9219 h 2.7 c 10.2,0 15.16,3.3399 15.16,10.1094 0,6.5781 -5.32,9.6484 -11.37,9.6484 -7.93,0 -12.35,-4.789 -13.35,-12.4492 h -10.46 c 1,12.4492 9.92,20.6485 24.45,20.6485 10.9,0 21.72,-4.961 21.72,-17.2188 0,-6.5 -3.78,-11.9102 -9.56,-14.6992 7.86,-2.8906 11.28,-9.293 11.28,-15.961 C 7680.11,6.48828 7668.66,0 7655.58,0 c -15.14,0 -23.36,9.91797 -24.17,21.4609 h 10.46 c 1.09,-7.2109 5.32,-13.16012 13.89,-13.16012 7.58,0 13.26,4.14062 13.26,11.26952 0,8.3906 -6.67,11.2695 -16.33,11.2695"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path552" /><path
         d="m 8027.02,50.9492 h -14.61 v 7.4024 c 9.47,0.2578 14.07,1.0664 17.4,8.1992 h 7.94 V 1.16797 h -10.73 V 50.9492"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path554" /><path
         d="m 8075.72,25.7891 v 26.789 l -20.57,-26.789 z M 8086.45,16.5 V 1.16797 h -10.73 V 16.5 h -32.29 v 8.9297 l 32.38,41.1211 h 10.64 V 25.7891 h 11.54 V 16.5 h -11.54"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path556" /><path
         d="M 282.871,308.148 V 235.09 h -15.516 v 91.48 h 21.45 l 38.742,-73.058 v 73.058 h 15.519 v -91.48 h -21.453 l -38.742,73.058"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path558" /><path
         d="m 404.211,275.719 c -0.375,10.601 -8.453,17.031 -17.285,17.031 -7.067,0 -16.781,-4.16 -18.047,-17.031 z m -16.91,-29.778 c 7.828,0 14.008,3.149 16.66,9.457 h 14.766 c -3.161,-10.847 -13.25,-21.949 -30.789,-21.949 -21.833,0 -34.329,16.66 -34.329,36.09 0,20.441 14.008,34.949 33.317,34.949 20.82,0 33.816,-16.91 32.558,-39.75 h -50.605 c 1.012,-12.617 9.844,-18.797 18.422,-18.797"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path560" /><path
         d="m 474.336,302.98 11.738,-48.21 9.965,48.21 h 16.281 l -18.047,-67.89 h -14.257 l -13.375,50.219 -13.379,-50.219 h -14.258 l -18.047,67.89 h 16.281 l 9.969,-48.21 11.609,48.21 h 15.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path562" /><path
         d="m 584.684,233.449 c -26.754,0 -42.274,19.051 -42.274,47.692 0,28.777 16.531,47.07 43.031,47.07 20.317,0 34.829,-11.602 38.485,-32.051 h -15.395 c -2.773,12.371 -11.734,18.93 -23.597,18.93 -14.512,0 -25.993,-11.86 -25.993,-33.949 0,-22.211 11.231,-34.571 25.872,-34.571 12.363,0 21.195,6.442 23.972,18.93 h 15.395 c -3.782,-20.441 -18.422,-32.051 -39.496,-32.051"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path564" /><path
         d="m 634.348,235.09 v 91.48 h 15.015 v -91.48 h -15.015"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path566" /><path
         d="m 710.547,268.898 c 0,15.653 -8.457,23.352 -17.918,23.352 -9.469,0 -17.922,-7.699 -17.922,-23.352 0,-15.636 8.453,-23.218 17.922,-23.218 9.461,0 17.918,7.582 17.918,23.218 z m -17.918,-35.449 c -16.535,0 -33.441,10.969 -33.441,35.449 0,24.493 16.906,35.59 33.441,35.59 16.527,0 33.437,-11.097 33.437,-35.59 0,-24.48 -16.91,-35.449 -33.437,-35.449"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path568" /><path
         d="m 781.043,279.75 c -1.266,7.199 -7.574,12.25 -15.777,12.25 -9.336,0 -17.793,-6.941 -17.793,-22.969 0,-16.152 8.578,-23.09 17.418,-23.09 7.312,0 14.757,3.278 16.652,12.368 h 14.641 c -3.028,-15.911 -17.036,-24.86 -31.547,-24.86 -19.688,0 -32.688,15.27 -32.688,35.449 0,20.204 13.125,35.59 33.317,35.59 14.765,0 27.89,-9.59 30.41,-24.738 h -14.633"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path570" /><path
         d="m 820.242,275.719 25.11,27.261 h 18.046 l -25.996,-27.89 28.899,-40 h -17.539 l -21.328,29.398 -7.192,-7.687 V 235.09 h -15.015 v 91.48 h 15.015 v -50.851"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path572" /><path
         d="m 263.945,2346.03 c 0,17.17 17.793,25.75 34.578,25.75 18.047,0 32.176,-8.21 35.84,-27.26 H 318.84 c -2.652,10.98 -12.242,14.13 -21.203,14.13 -7.063,0 -17.539,-3.15 -17.539,-12.11 0,-7.07 5.808,-10.59 13.629,-12.12 l 11.23,-2.14 c 16.027,-3.15 31.293,-8.96 31.293,-27.38 0,-18.43 -18.297,-27.89 -36.34,-27.89 -21.707,0 -36.594,11.87 -38.488,31.92 h 15.773 c 2.778,-12.49 10.852,-18.8 23.469,-18.8 10.856,0 19.563,4.93 19.563,13.75 0,9.35 -10.094,12.5 -18.805,14.15 l -11.102,2.13 c -14.386,2.9 -26.375,10.36 -26.375,25.87"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path574" /><path
         d="m 362.953,2364.46 v -17.92 h 13.629 v -10.85 h -13.629 v -36.97 c 0,-6.94 1.645,-8.59 8.078,-8.59 h 5.43 v -11.48 h -11.109 c -14.512,0 -17.411,3.92 -17.411,17.79 v 39.25 h -10.097 v 10.85 h 10.097 v 17.92 h 15.012"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path576" /><path
         d="m 432.977,2312.47 c 0,15.64 -8.457,23.35 -17.922,23.35 -9.469,0 -17.918,-7.71 -17.918,-23.35 0,-15.65 8.449,-23.22 17.918,-23.22 9.465,0 17.922,7.57 17.922,23.22 z m -17.922,-35.46 c -16.532,0 -33.442,10.98 -33.442,35.46 0,24.48 16.91,35.58 33.442,35.58 16.527,0 33.437,-11.1 33.437,-35.58 0,-24.48 -16.91,-35.46 -33.437,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path578" /><path
         d="m 488.195,2331.65 c -9.465,0 -14.886,-3.78 -14.886,-17.41 v -35.59 h -15.016 v 67.89 h 14.762 v -12.12 c 3.66,7.58 10.222,12.12 18.422,12.25 1.136,0 2.777,-0.13 3.914,-0.26 v -15.14 c -2.524,0.25 -4.922,0.38 -7.196,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path580" /><path
         d="m 546.848,2319.29 c -0.375,10.59 -8.453,17.03 -17.285,17.03 -7.067,0 -16.782,-4.16 -18.047,-17.03 z m -16.91,-29.79 c 7.828,0 14.007,3.15 16.66,9.46 h 14.765 c -3.16,-10.85 -13.25,-21.95 -30.789,-21.95 -21.832,0 -34.328,16.66 -34.328,36.09 0,20.44 14.008,34.95 33.317,34.95 20.82,0 33.816,-16.9 32.558,-39.74 h -50.605 c 1.011,-12.63 9.843,-18.81 18.422,-18.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path582" /><path
         d="m 583.652,2312.6 c 0,-14.39 7.196,-23.35 17.164,-23.35 9.84,0 17.539,7.7 17.539,23.35 0,15.64 -7.699,23.22 -17.539,23.22 -9.968,0 -17.164,-8.97 -17.164,-23.22 z m 49.09,57.53 v -91.48 h -15.015 v 8.96 c -4.039,-6.68 -11.106,-10.6 -20.192,-10.6 -16.023,0 -29.531,13.75 -29.531,35.59 0,21.7 13.508,35.45 29.531,35.45 9.086,0 16.153,-3.91 20.192,-10.59 v 32.67 h 15.015"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path584" /><path
         d="m 720.887,2312.34 -13.883,39.25 -13.758,-39.25 z m -4.797,57.79 34.32,-91.48 h -17.539 l -7.191,20.31 h -37.102 l -7.062,-20.31 h -16.407 l 34.071,91.48 h 16.91"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path586" /><path
         d="m 786.203,2331.65 c -9.469,0 -14.894,-3.78 -14.894,-17.41 v -35.59 h -15.012 v 67.89 h 14.758 v -12.12 c 3.664,7.58 10.226,12.12 18.425,12.25 1.137,0 2.778,-0.13 3.915,-0.26 v -15.14 c -2.524,0.25 -4.922,0.38 -7.192,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path588" /><path
         d="m 830.215,2331.65 c -9.469,0 -14.891,-3.78 -14.891,-17.41 v -35.59 h -15.015 v 67.89 h 14.761 v -12.12 c 3.66,7.58 10.223,12.12 18.422,12.25 1.137,0 2.778,-0.13 3.918,-0.26 v -15.14 c -2.527,0.25 -4.922,0.38 -7.195,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path590" /><path
         d="m 859.332,2278.65 h -15.016 v 67.89 h 15.016 z m 0,76.35 h -15.016 v 15.13 h 15.016 V 2355"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path592" /><path
         d="m 912.945,2346.54 h 15.649 l -24.481,-67.89 h -14.136 l -24.731,67.89 h 16.531 l 15.645,-48.46 15.523,48.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path594" /><path
         d="m 943.199,2297.7 c 0,-5.92 4.922,-9.46 12.492,-9.46 11.106,0 17.668,5.68 17.668,17.16 v 5.17 c -21.453,-2.02 -30.16,-5.04 -30.16,-12.87 z m 29.781,23.35 v 1.26 c 0,11.61 -6.691,15.15 -14.136,15.15 -7.567,0 -13.246,-4.04 -13.629,-12.25 h -14.762 c 1.008,13.89 12.492,23.35 28.899,23.35 16.281,0 29.023,-7.45 28.64,-29.15 0,-3.41 -0.246,-11.36 -0.246,-17.54 0,-8.58 0.758,-17.55 2.016,-23.22 h -13.754 c -0.504,2.9 -1.012,4.54 -1.262,9.21 -4.293,-7.31 -12.367,-10.85 -22.336,-10.85 -14.762,0 -25.109,7.95 -25.109,20.31 0,16.92 20.82,21.2 45.679,23.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path596" /><path
         d="m 1000.58,2278.65 v 91.48 h 15.01 v -91.48 h -15.01"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path598" /><path
         d="m 1048.61,2356.77 v 13.36 h 73.57 v -13.36 h -28.77 v -78.12 h -16.03 v 78.12 h -28.77"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path600" /><path
         d="m 1143.72,2278.65 h -15.02 v 67.89 h 15.02 z m 0,76.35 h -15.02 v 15.13 h 15.02 V 2355"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path602" /><path
         d="m 1158.08,2278.65 v 67.89 h 15.02 v -9.46 c 3.91,7.06 10.6,10.97 19.68,10.97 10.48,0 16.66,-4.41 19.81,-11.99 5.81,8.59 13.76,11.99 22.09,11.99 16.02,0 22.21,-10.59 22.21,-26.74 v -42.66 h -15.02 v 38.99 c 0,9.21 -0.88,18.18 -11.99,18.18 -11.1,0 -14.89,-8.84 -14.89,-21.08 v -36.09 h -15.01 v 38.99 c 0,9.21 -0.89,18.18 -11.99,18.18 -11.11,0 -14.89,-8.84 -14.89,-21.08 v -36.09 h -15.02"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path604" /><path
         d="m 1316.01,2319.29 c -0.38,10.59 -8.46,17.03 -17.29,17.03 -7.06,0 -16.78,-4.16 -18.04,-17.03 z m -16.91,-29.79 c 7.83,0 14.01,3.15 16.66,9.46 h 14.76 c -3.16,-10.85 -13.25,-21.95 -30.79,-21.95 -21.83,0 -34.32,16.66 -34.32,36.09 0,20.44 14.01,34.95 33.31,34.95 20.82,0 33.82,-16.9 32.56,-39.74 h -50.6 c 1.01,-12.63 9.84,-18.81 18.42,-18.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path606" /><path
         d="m 1365.18,2336.57 c -6.57,0 -12.62,-2.9 -12.62,-7.44 0,-4.54 3.28,-6.94 9.08,-8.08 l 9.59,-1.89 c 13.76,-2.65 24.23,-6.95 24.23,-20.2 0,-14.13 -13.37,-21.95 -28.77,-21.95 -16.65,0 -27.76,9.46 -29.4,22.33 h 14.64 c 1.39,-6.94 6.43,-10.97 15.27,-10.97 7.82,0 13.63,3.28 13.63,8.84 0,5.54 -5.05,8.07 -11.74,9.33 l -10.22,2.01 c -11.49,2.28 -20.45,7.45 -20.45,19.82 0,11.99 12.88,19.68 27.64,19.68 13.25,0 25.37,-6.43 28.14,-20.06 h -14.13 c -1.64,6.19 -7.32,8.58 -14.89,8.58"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path608" /><path
         d="m 1967.45,3653.7 c -15.01,0 -23.67,-14.57 -23.67,-40.99 0,-26.41 8.66,-40.99 23.67,-40.99 15.16,0 23.82,14.58 23.82,40.99 0,26.42 -8.66,40.99 -23.82,40.99 z m 0,13.14 c 28.01,0 41.72,-22.09 41.72,-54.13 0,-32.19 -13.71,-54.27 -41.72,-54.27 -27.86,0 -41.57,22.08 -41.57,54.27 0,32.04 13.71,54.13 41.57,54.13"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path610" /><path
         d="m 263.945,4199.49 c 0,17.17 17.793,25.74 34.578,25.74 18.047,0 32.176,-8.2 35.84,-27.25 H 318.84 c -2.652,10.97 -12.242,14.13 -21.203,14.13 -7.063,0 -17.539,-3.16 -17.539,-12.11 0,-7.07 5.808,-10.6 13.629,-12.12 l 11.23,-2.14 c 16.027,-3.15 31.293,-8.96 31.293,-27.38 0,-18.43 -18.297,-27.89 -36.34,-27.89 -21.707,0 -36.594,11.86 -38.488,31.92 h 15.773 c 2.778,-12.49 10.852,-18.8 23.469,-18.8 10.856,0 19.563,4.93 19.563,13.75 0,9.35 -10.094,12.5 -18.805,14.14 l -11.102,2.14 c -14.386,2.9 -26.375,10.35 -26.375,25.87"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path612" /><path
         d="m 345.797,4132.11 v 91.48 h 15.016 v -91.48 h -15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path614" /><path
         d="m 421.996,4165.93 c 0,15.64 -8.457,23.35 -17.918,23.35 -9.469,0 -17.918,-7.71 -17.918,-23.35 0,-15.65 8.449,-23.23 17.918,-23.23 9.461,0 17.918,7.58 17.918,23.23 z m -17.918,-35.46 c -16.531,0 -33.441,10.98 -33.441,35.46 0,24.48 16.91,35.58 33.441,35.58 16.527,0 33.438,-11.1 33.438,-35.58 0,-24.48 -16.911,-35.46 -33.438,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path616" /><path
         d="M 464.473,4217.92 V 4200 h 13.629 v -10.85 h -13.629 v -36.97 c 0,-6.95 1.64,-8.59 8.078,-8.59 h 5.429 v -11.48 h -11.109 c -14.512,0 -17.41,3.91 -17.41,17.79 v 39.25 H 439.363 V 4200 h 10.098 v 17.92 h 15.012"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path618" /><path
         d="m 549.738,4201.51 c 16.407,0 23.094,-10.6 23.094,-26.74 v -42.66 h -15.019 v 38.99 c 0,9.21 -1.387,18.18 -12.872,18.18 -11.476,0 -15.769,-8.84 -15.769,-21.08 v -36.09 H 514.156 V 4200 h 15.016 v -9.46 c 3.91,7.06 11.101,10.97 20.566,10.97"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path620" /><path
         d="m 607.746,4130.47 c -16.152,0 -22.711,10.59 -22.711,26.74 V 4200 h 15.016 v -39.12 c 0,-9.21 1.258,-18.18 12.496,-18.18 11.23,0 15.266,8.84 15.266,21.08 V 4200 h 15.015 v -67.89 h -15.015 v 9.34 c -3.915,-7.07 -10.852,-10.98 -20.067,-10.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path622" /><path
         d="M 657.168,4132.11 V 4200 h 15.016 v -9.46 c 3.91,7.06 10.601,10.97 19.687,10.97 10.473,0 16.656,-4.41 19.809,-11.99 5.808,8.59 13.758,11.99 22.086,11.99 16.027,0 22.207,-10.6 22.207,-26.74 v -42.66 h -15.016 v 38.99 c 0,9.21 -0.883,18.18 -11.984,18.18 -11.11,0 -14.895,-8.84 -14.895,-21.08 v -36.09 h -15.015 v 38.99 c 0,9.21 -0.883,18.18 -11.993,18.18 -11.101,0 -14.886,-8.84 -14.886,-21.08 v -36.09 h -15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path624" /><path
         d="m 818.117,4166.05 c 0,14.26 -7.191,23.23 -17.164,23.23 -9.844,0 -17.539,-7.58 -17.539,-23.23 0,-15.64 7.695,-23.35 17.539,-23.35 9.973,0 17.164,8.97 17.164,23.35 z m -34.074,24.86 c 4.039,6.69 11.105,10.6 20.191,10.6 16.028,0 29.528,-13.75 29.528,-35.46 0,-21.83 -13.5,-35.58 -29.528,-35.58 -9.086,0 -16.152,3.91 -20.191,10.59 v -8.95 h -15.012 v 91.48 h 15.012 v -32.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path626" /><path
         d="m 890.254,4172.74 c -0.379,10.6 -8.457,17.03 -17.289,17.03 -7.067,0 -16.781,-4.16 -18.047,-17.03 z m -16.914,-29.78 c 7.828,0 14.012,3.15 16.66,9.46 h 14.766 c -3.157,-10.85 -13.25,-21.95 -30.789,-21.95 -21.832,0 -34.329,16.66 -34.329,36.09 0,20.44 14.012,34.95 33.317,34.95 20.82,0 33.82,-16.9 32.558,-39.74 h -50.605 c 1.012,-12.63 9.844,-18.81 18.422,-18.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path628" /><path
         d="m 945.227,4185.11 c -9.465,0 -14.887,-3.79 -14.887,-17.41 v -35.59 H 915.324 V 4200 h 14.762 v -12.12 c 3.66,7.58 10.223,12.12 18.422,12.25 1.137,0 2.777,-0.13 3.914,-0.26 v -15.14 c -2.524,0.25 -4.922,0.38 -7.195,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path630" /><path
         d="m 997.676,4151.16 c 0,-5.93 4.924,-9.46 12.494,-9.46 11.11,0 17.66,5.68 17.66,17.16 v 5.17 c -21.45,-2.02 -30.154,-5.05 -30.154,-12.87 z m 29.784,23.35 v 1.26 c 0,11.61 -6.69,15.14 -14.14,15.14 -7.57,0 -13.25,-4.04 -13.625,-12.24 h -14.761 c 1.004,13.89 12.488,23.35 28.896,23.35 16.28,0 29.02,-7.45 28.64,-29.15 0,-3.41 -0.25,-11.36 -0.25,-17.54 0,-8.58 0.76,-17.55 2.02,-23.22 h -13.76 c -0.5,2.9 -1.01,4.54 -1.26,9.21 -4.29,-7.32 -12.36,-10.85 -22.33,-10.85 -14.765,0 -25.113,7.94 -25.113,20.31 0,16.92 20.823,21.2 45.683,23.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path632" /><path
         d="m 1099.47,4176.78 c -1.26,7.19 -7.57,12.24 -15.77,12.24 -9.34,0 -17.8,-6.94 -17.8,-22.97 0,-16.15 8.58,-23.09 17.42,-23.09 7.32,0 14.76,3.28 16.66,12.37 h 14.64 c -3.03,-15.91 -17.04,-24.86 -31.55,-24.86 -19.69,0 -32.69,15.27 -32.69,35.46 0,20.19 13.13,35.58 33.32,35.58 14.76,0 27.89,-9.59 30.41,-24.73 h -14.64"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path634" /><path
         d="m 1170.72,4165.93 c 0,15.64 -8.45,23.35 -17.92,23.35 -9.46,0 -17.92,-7.71 -17.92,-23.35 0,-15.65 8.46,-23.23 17.92,-23.23 9.47,0 17.92,7.58 17.92,23.23 z m -17.92,-35.46 c -16.53,0 -33.44,10.98 -33.44,35.46 0,24.48 16.91,35.58 33.44,35.58 16.53,0 33.44,-11.1 33.44,-35.58 0,-24.48 -16.91,-35.46 -33.44,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path636" /><path
         d="m 1225.95,4185.11 c -9.47,0 -14.89,-3.79 -14.89,-17.41 v -35.59 h -15.02 V 4200 h 14.76 v -12.12 c 3.66,7.58 10.23,12.12 18.42,12.25 1.14,0 2.78,-0.13 3.92,-0.26 v -15.14 c -2.52,0.25 -4.92,0.38 -7.19,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path638" /><path
         d="m 1249.52,4166.05 c 0,-14.38 7.2,-23.35 17.17,-23.35 9.83,0 17.53,7.71 17.53,23.35 0,15.65 -7.7,23.23 -17.53,23.23 -9.97,0 -17.17,-8.97 -17.17,-23.23 z m 49.09,57.54 v -91.48 h -15.02 v 8.95 c -4.03,-6.68 -11.1,-10.59 -20.19,-10.59 -16.02,0 -29.53,13.75 -29.53,35.58 0,21.71 13.51,35.46 29.53,35.46 9.09,0 16.16,-3.91 20.19,-10.6 v 32.68 h 15.02"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path640" /><path
         d="m 1327.97,4132.11 h -15.02 V 4200 h 15.02 z m 0,76.34 h -15.02 v 15.14 h 15.02 v -15.14"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path642" /><path
         d="m 1377.92,4201.51 c 16.4,0 23.09,-10.6 23.09,-26.74 v -42.66 h -15.02 v 38.99 c 0,9.21 -1.38,18.18 -12.87,18.18 -11.48,0 -15.77,-8.84 -15.77,-21.08 v -36.09 h -15.01 V 4200 h 15.01 v -9.46 c 3.91,7.06 11.1,10.97 20.57,10.97"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path644" /><path
         d="m 1425.07,4167.44 c 0,-13.88 7.19,-22.33 17.16,-22.33 9.84,0 17.54,7.07 17.54,22.33 0,15.15 -7.7,22.08 -17.54,22.08 -9.97,0 -17.16,-8.45 -17.16,-22.08 z m 49.09,32.56 v -61.07 c 0,-11.11 -2.78,-18.93 -8.21,-23.98 -5.42,-5.05 -13.5,-7.32 -24.1,-7.32 -14.89,0 -26.75,5.92 -29.02,20.82 h 14.89 c 1.39,-6.31 5.55,-8.96 14.51,-8.96 6.69,0 10.98,1.9 13.5,4.92 2.53,2.9 3.41,7.06 3.41,11.49 v 7.95 c -4.04,-6.69 -11.1,-10.61 -20.19,-10.61 -16.02,0 -29.53,13 -29.53,34.2 0,21.2 13.51,34.07 29.53,34.07 9.09,0 16.15,-3.91 20.19,-10.6 v 9.09 h 15.02"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path646" /><path
         d="m 283.758,4060.27 v -17.92 h 13.625 v -10.85 h -13.625 v -36.97 c 0,-6.94 1.64,-8.58 8.074,-8.58 h 5.43 v -11.49 h -11.11 c -14.511,0 -17.41,3.92 -17.41,17.79 v 39.25 h -10.097 v 10.85 h 10.097 v 17.92 h 15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path648" /><path
         d="m 353.77,4008.28 c 0,15.65 -8.457,23.35 -17.918,23.35 -9.469,0 -17.922,-7.7 -17.922,-23.35 0,-15.64 8.453,-23.22 17.922,-23.22 9.461,0 17.918,7.58 17.918,23.22 z m -17.918,-35.46 c -16.536,0 -33.442,10.98 -33.442,35.46 0,24.48 16.906,35.58 33.442,35.58 16.527,0 33.437,-11.1 33.437,-35.58 0,-24.48 -16.91,-35.46 -33.437,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path650" /><path
         d="m 422.73,4060.27 v -17.92 h 13.629 V 4031.5 H 422.73 v -36.97 c 0,-6.94 1.641,-8.58 8.079,-8.58 h 5.429 v -11.49 h -11.109 c -14.512,0 -17.414,3.92 -17.414,17.79 v 39.25 h -10.098 v 10.85 h 10.098 v 17.92 h 15.015"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path652" /><path
         d="m 481.516,4043.86 c 16.406,0 23.093,-10.59 23.093,-26.74 v -42.66 H 489.59 v 38.99 c 0,9.21 -1.387,18.18 -12.871,18.18 -11.477,0 -15.77,-8.84 -15.77,-21.08 v -36.09 h -15.015 v 91.49 h 15.015 v -33.06 c 3.91,7.06 11.102,10.97 20.567,10.97"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path654" /><path
         d="m 563.75,4015.1 c -0.379,10.59 -8.457,17.03 -17.289,17.03 -7.066,0 -16.781,-4.16 -18.047,-17.03 z m -16.914,-29.79 c 7.828,0 14.012,3.15 16.66,9.46 h 14.766 c -3.157,-10.84 -13.25,-21.95 -30.789,-21.95 -21.832,0 -34.328,16.66 -34.328,36.09 0,20.45 14.011,34.95 33.316,34.95 20.82,0 33.82,-16.91 32.559,-39.74 h -50.606 c 1.012,-12.63 9.844,-18.81 18.422,-18.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path656" /><path
         d="m 664.391,4008.41 c 0,14.25 -7.192,23.22 -17.164,23.22 -9.844,0 -17.539,-7.58 -17.539,-23.22 0,-15.65 7.695,-23.35 17.539,-23.35 9.972,0 17.164,8.96 17.164,23.35 z m -34.071,24.86 c 4.035,6.68 11.102,10.59 20.188,10.59 16.027,0 29.527,-13.75 29.527,-35.45 0,-21.83 -13.5,-35.59 -29.527,-35.59 -9.086,0 -16.153,3.91 -20.188,10.59 v -8.95 h -15.015 v 91.49 h 15.015 v -32.68"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path658" /><path
         d="m 689.707,3974.46 v 91.49 h 15.016 v -91.49 h -15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path660" /><path
         d="m 765.91,4008.28 c 0,15.65 -8.457,23.35 -17.922,23.35 -9.465,0 -17.918,-7.7 -17.918,-23.35 0,-15.64 8.453,-23.22 17.918,-23.22 9.465,0 17.922,7.58 17.922,23.22 z m -17.922,-35.46 c -16.531,0 -33.441,10.98 -33.441,35.46 0,24.48 16.91,35.58 33.441,35.58 16.532,0 33.438,-11.1 33.438,-35.58 0,-24.48 -16.906,-35.46 -33.438,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path662" /><path
         d="m 836.402,4019.13 c -1.265,7.19 -7.574,12.25 -15.777,12.25 -9.336,0 -17.793,-6.95 -17.793,-22.97 0,-16.16 8.578,-23.1 17.418,-23.1 7.316,0 14.762,3.28 16.656,12.37 h 14.637 c -3.027,-15.9 -17.035,-24.86 -31.547,-24.86 -19.687,0 -32.683,15.27 -32.683,35.46 0,20.2 13.125,35.58 33.312,35.58 14.766,0 27.891,-9.58 30.41,-24.73 h -14.633"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path664" /><path
         d="m 875.605,4015.1 25.114,27.25 h 18.043 l -25.992,-27.89 28.898,-40 h -17.539 l -21.328,29.4 -7.196,-7.69 v -21.71 h -15.011 v 91.49 h 15.011 v -50.85"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path666" /><path
         d="m 1000.73,4008.41 c 0,14.25 -6.308,23.22 -16.785,23.22 -9.843,0 -17.539,-7.58 -17.539,-23.22 0,-15.65 7.696,-23.35 17.539,-23.35 10.477,0 16.785,8.96 16.785,23.35 z m -33.695,24.86 c 4.039,6.68 11.106,10.59 20.192,10.59 16.533,0 29.153,-13.75 29.153,-35.45 0,-21.83 -12.62,-35.59 -29.153,-35.59 -9.086,0 -16.153,3.91 -20.192,10.59 v -31.03 h -15.012 v 89.97 h 15.012 v -9.08"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path668" /><path
         d="m 1055.96,4027.46 c -9.47,0 -14.89,-3.78 -14.89,-17.41 v -35.59 h -15.02 v 67.89 h 14.76 v -12.12 c 3.66,7.58 10.23,12.12 18.42,12.25 1.14,0 2.78,-0.13 3.92,-0.25 v -15.15 c -2.52,0.25 -4.92,0.38 -7.19,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path670" /><path
         d="m 1115.36,4008.28 c 0,15.65 -8.45,23.35 -17.92,23.35 -9.47,0 -17.92,-7.7 -17.92,-23.35 0,-15.64 8.45,-23.22 17.92,-23.22 9.47,0 17.92,7.58 17.92,23.22 z m -17.92,-35.46 c -16.53,0 -33.44,10.98 -33.44,35.46 0,24.48 16.91,35.58 33.44,35.58 16.53,0 33.44,-11.1 33.44,-35.58 0,-24.48 -16.91,-35.46 -33.44,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path672" /><path
         d="m 1152.42,4008.41 c 0,-14.39 7.19,-23.35 17.16,-23.35 9.85,0 17.54,7.7 17.54,23.35 0,15.64 -7.69,23.22 -17.54,23.22 -9.97,0 -17.16,-8.97 -17.16,-23.22 z m 49.09,57.54 v -91.49 h -15.02 v 8.95 c -4.04,-6.68 -11.11,-10.59 -20.19,-10.59 -16.03,0 -29.53,13.76 -29.53,35.59 0,21.7 13.5,35.45 29.53,35.45 9.08,0 16.15,-3.91 20.19,-10.59 v 32.68 h 15.02"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path674" /><path
         d="m 1237.68,3972.82 c -16.16,0 -22.72,10.59 -22.72,26.75 v 42.78 h 15.02 v -39.12 c 0,-9.21 1.26,-18.17 12.49,-18.17 11.23,0 15.27,8.83 15.27,21.07 v 36.22 h 15.02 v -67.89 h -15.02 v 9.34 c -3.91,-7.07 -10.85,-10.98 -20.06,-10.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path676" /><path
         d="m 1331.52,4019.13 c -1.26,7.19 -7.57,12.25 -15.78,12.25 -9.33,0 -17.79,-6.95 -17.79,-22.97 0,-16.16 8.58,-23.1 17.42,-23.1 7.31,0 14.76,3.28 16.65,12.37 h 14.64 c -3.03,-15.9 -17.03,-24.86 -31.55,-24.86 -19.68,0 -32.68,15.27 -32.68,35.46 0,20.2 13.12,35.58 33.31,35.58 14.77,0 27.89,-9.58 30.41,-24.73 h -14.63"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path678" /><path
         d="m 1402.01,4015.1 c -0.37,10.59 -8.45,17.03 -17.28,17.03 -7.07,0 -16.78,-4.16 -18.05,-17.03 z m -16.91,-29.79 c 7.83,0 14.01,3.15 16.66,9.46 h 14.77 c -3.16,-10.84 -13.25,-21.95 -30.79,-21.95 -21.83,0 -34.33,16.66 -34.33,36.09 0,20.45 14.01,34.95 33.32,34.95 20.82,0 33.82,-16.91 32.56,-39.74 h -50.61 c 1.01,-12.63 9.84,-18.81 18.42,-18.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path680" /><path
         d="m 1456.99,4027.46 c -9.46,0 -14.88,-3.78 -14.88,-17.41 v -35.59 h -15.02 v 67.89 h 14.76 v -12.12 c 3.66,7.58 10.23,12.12 18.42,12.25 1.14,0 2.78,-0.13 3.92,-0.25 v -15.15 c -2.52,0.25 -4.92,0.38 -7.2,0.38"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path682" /><path
         d="m 0,4211.64 c 0,29.67 24.0508,53.71 53.7188,53.71 10.2382,0 45.5898,0 55.8242,0 29.668,0 53.719,-24.04 53.719,-53.71 0,-10.25 0,-45.6 0,-55.83 0,-29.67 -24.051,-53.72 -53.719,-53.72 -10.2344,0 -45.586,0 -55.8242,0 -29.668,0 -53.7188,24.05 -53.7188,53.72 0,10.23 0,45.58 0,55.83"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path684" /><path
         d="m 56.4648,4210.06 h 10.9727 l 12.5586,-17.83 12.8477,17.83 h 10.3942 l -18.0466,-25.12 19.2736,-27.21 H 93.4922 l -13.8555,19.56 -14.0742,-19.56 H 55.2422 l 19.2695,26.78 -18.0469,25.55"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path686" /><path
         d="m 304.703,3655.19 c 11.36,0 17.035,5.18 17.035,14.26 0,9.34 -5.675,13.89 -17.918,13.89 h -20.441 v -28.15 z m -1.387,40.38 c 9.34,0 15.141,4.16 15.141,13.13 0,8.08 -6.055,12.24 -15.141,12.24 h -19.937 v -25.37 z m -1.511,38.24 c 16.652,0 32.933,-4.54 32.933,-23.34 0,-8.59 -4.797,-16.28 -10.218,-19.56 7.566,-3.41 13.753,-9.34 13.753,-21.46 0,-19.69 -15.523,-27.13 -34.199,-27.13 h -36.719 v 91.49 h 34.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path688" /><path
         d="m 348.191,3642.32 v 91.49 h 15.012 v -91.49 h -15.012"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path690" /><path
         d="m 424.391,3676.14 c 0,15.65 -8.457,23.35 -17.918,23.35 -9.469,0 -17.922,-7.7 -17.922,-23.35 0,-15.64 8.453,-23.22 17.922,-23.22 9.461,0 17.918,7.58 17.918,23.22 z m -17.918,-35.46 c -16.535,0 -33.446,10.98 -33.446,35.46 0,24.48 16.911,35.59 33.446,35.59 16.527,0 33.437,-11.11 33.437,-35.59 0,-24.48 -16.91,-35.46 -33.437,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path692" /><path
         d="m 494.883,3686.99 c -1.266,7.2 -7.57,12.25 -15.774,12.25 -9.336,0 -17.793,-6.95 -17.793,-22.97 0,-16.15 8.579,-23.1 17.414,-23.1 7.317,0 14.762,3.28 16.657,12.38 h 14.64 c -3.031,-15.91 -17.039,-24.87 -31.55,-24.87 -19.688,0 -32.684,15.28 -32.684,35.46 0,20.2 13.125,35.59 33.316,35.59 14.762,0 27.887,-9.59 30.411,-24.74 h -14.637"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path694" /><path
         d="m 534.09,3682.96 25.109,27.25 h 18.047 l -25.996,-27.89 28.898,-40 h -17.539 l -21.328,29.41 -7.191,-7.7 v -21.71 h -15.016 v 91.49 h 15.016 v -50.85"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path696" /><path
         d="m 606.609,3700.24 c -6.562,0 -12.617,-2.9 -12.617,-7.44 0,-4.54 3.281,-6.94 9.082,-8.08 l 9.594,-1.89 c 13.75,-2.65 24.227,-6.94 24.227,-20.2 0,-14.13 -13.379,-21.95 -28.774,-21.95 -16.656,0 -27.758,9.46 -29.398,22.34 h 14.632 c 1.391,-6.95 6.438,-10.98 15.27,-10.98 7.824,0 13.633,3.28 13.633,8.84 0,5.54 -5.051,8.07 -11.738,9.33 l -10.219,2.01 c -11.485,2.28 -20.446,7.46 -20.446,19.82 0,11.99 12.872,19.69 27.637,19.69 13.25,0 25.36,-6.44 28.141,-20.07 H 621.5 c -1.641,6.19 -7.32,8.58 -14.891,8.58"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path698" /><path
         d="m 719.867,3676.14 c 0,15.65 -8.457,23.35 -17.918,23.35 -9.469,0 -17.918,-7.7 -17.918,-23.35 0,-15.64 8.449,-23.22 17.918,-23.22 9.461,0 17.918,7.58 17.918,23.22 z m -17.918,-35.46 c -16.531,0 -33.441,10.98 -33.441,35.46 0,24.48 16.91,35.59 33.441,35.59 16.528,0 33.438,-11.11 33.438,-35.59 0,-24.48 -16.91,-35.46 -33.438,-35.46"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path700" /><path
         d="m 770.293,3733.81 h 5.934 v -11.49 h -4.293 c -7.446,0 -9.086,-1.38 -9.086,-8.44 v -3.67 h 13.379 v -10.85 h -13.379 v -57.04 h -15.016 v 57.04 h -9.461 v 10.85 h 9.461 v 4.16 c 0,15.91 6.063,19.44 22.461,19.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path702" /><path
         d="m 827.672,3728.13 v -17.92 h 13.629 v -10.85 h -13.629 v -36.97 c 0,-6.94 1.641,-8.58 8.074,-8.58 h 5.434 v -11.49 h -11.11 c -14.511,0 -17.414,3.92 -17.414,17.8 v 39.24 h -10.097 v 10.85 h 10.097 v 17.92 h 15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path704" /><path
         d="m 886.457,3711.73 c 16.406,0 23.094,-10.6 23.094,-26.75 v -42.66 h -15.02 v 39 c 0,9.21 -1.386,18.17 -12.871,18.17 -11.476,0 -15.769,-8.84 -15.769,-21.07 v -36.1 h -15.016 v 91.49 h 15.016 v -33.06 c 3.91,7.06 11.101,10.98 20.566,10.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path706" /><path
         d="m 968.691,3682.96 c -0.378,10.59 -8.457,17.03 -17.289,17.03 -7.066,0 -16.781,-4.16 -18.047,-17.03 z m -16.914,-29.79 c 7.828,0 14.008,3.16 16.661,9.46 h 14.765 c -3.156,-10.84 -13.25,-21.95 -30.789,-21.95 -21.832,0 -34.328,16.66 -34.328,36.1 0,20.43 14.012,34.95 33.316,34.95 20.821,0 33.821,-16.91 32.559,-39.75 h -50.606 c 1.012,-12.63 9.844,-18.81 18.422,-18.81"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path708" /><path
         d="m 266.598,3484.68 v 91.48 h 15.015 v -91.48 h -15.015"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path710" /><path
         d="m 342.793,3518.49 c 0,15.65 -8.457,23.35 -17.918,23.35 -9.469,0 -17.922,-7.7 -17.922,-23.35 0,-15.64 8.453,-23.22 17.922,-23.22 9.461,0 17.918,7.58 17.918,23.22 z m -17.918,-35.45 c -16.535,0 -33.441,10.97 -33.441,35.45 0,24.49 16.906,35.59 33.441,35.59 16.527,0 33.438,-11.1 33.438,-35.59 0,-24.48 -16.911,-35.45 -33.438,-35.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path712" /><path
         d="m 403.699,3554.08 c 16.406,0 23.094,-10.6 23.094,-26.75 v -42.65 h -15.02 v 38.99 c 0,9.21 -1.386,18.17 -12.871,18.17 -11.48,0 -15.769,-8.83 -15.769,-21.07 v -36.09 h -15.016 v 67.89 h 15.016 v -9.47 c 3.91,7.06 11.101,10.98 20.566,10.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path714" /><path
         d="m 450.852,3520.01 c 0,-13.88 7.191,-22.34 17.164,-22.34 9.836,0 17.539,7.07 17.539,22.34 0,15.14 -7.703,22.08 -17.539,22.08 -9.973,0 -17.164,-8.45 -17.164,-22.08 z m 49.086,32.56 v -61.08 c 0,-11.1 -2.774,-18.93 -8.204,-23.97 -5.425,-5.05 -13.5,-7.33 -24.101,-7.33 -14.887,0 -26.754,5.93 -29.024,20.82 h 14.895 c 1.387,-6.3 5.551,-8.95 14.512,-8.95 6.683,0 10.976,1.89 13.5,4.92 2.523,2.9 3.406,7.06 3.406,11.48 v 7.95 c -4.035,-6.69 -11.102,-10.6 -20.188,-10.6 -16.027,0 -29.535,13 -29.535,34.2 0,21.2 13.508,34.07 29.535,34.07 9.086,0 16.153,-3.92 20.188,-10.6 v 9.09 h 15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path716" /><path
         d="m 560.215,3525.31 c -0.379,10.6 -8.457,17.03 -17.289,17.03 -7.067,0 -16.781,-4.16 -18.047,-17.03 z m -16.914,-29.78 c 7.828,0 14.012,3.15 16.66,9.46 h 14.766 c -3.157,-10.85 -13.25,-21.95 -30.789,-21.95 -21.833,0 -34.329,16.66 -34.329,36.09 0,20.44 14.008,34.95 33.317,34.95 20.82,0 33.816,-16.91 32.558,-39.75 h -50.605 c 1.012,-12.62 9.844,-18.8 18.422,-18.8"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path718" /><path
         d="m 609.387,3542.6 c -6.563,0 -12.617,-2.9 -12.617,-7.45 0,-4.54 3.281,-6.94 9.082,-8.07 l 9.589,-1.9 c 13.754,-2.64 24.227,-6.94 24.227,-20.19 0,-14.13 -13.371,-21.95 -28.77,-21.95 -16.656,0 -27.761,9.46 -29.398,22.33 h 14.633 c 1.394,-6.94 6.437,-10.98 15.273,-10.98 7.824,0 13.629,3.28 13.629,8.84 0,5.55 -5.047,8.08 -11.738,9.34 l -10.219,2.01 c -11.484,2.27 -20.445,7.45 -20.445,19.81 0,11.99 12.871,19.69 27.637,19.69 13.246,0 25.367,-6.44 28.14,-20.07 h -14.133 c -1.64,6.19 -7.316,8.59 -14.89,8.59"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path720" /><path
         d="m 667.391,3570.49 v -17.92 h 13.625 v -10.85 h -13.625 v -36.98 c 0,-6.94 1.64,-8.58 8.074,-8.58 h 5.43 v -11.48 h -11.11 c -14.512,0 -17.41,3.91 -17.41,17.79 v 39.25 h -10.098 v 10.85 h 10.098 v 17.92 h 15.016"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path722" /><path
         d="m 761.484,3529.34 c -1.261,7.2 -7.574,12.25 -15.773,12.25 -9.34,0 -17.793,-6.94 -17.793,-22.97 0,-16.15 8.578,-23.09 17.414,-23.09 7.316,0 14.762,3.28 16.656,12.37 h 14.641 c -3.027,-15.91 -17.039,-24.86 -31.551,-24.86 -19.687,0 -32.683,15.27 -32.683,35.45 0,20.2 13.125,35.59 33.316,35.59 14.766,0 27.891,-9.59 30.406,-24.74 h -14.633"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path724" /><path
         d="m 821.258,3554.08 c 16.402,0 23.094,-10.6 23.094,-26.75 v -42.65 h -15.02 v 38.99 c 0,9.21 -1.387,18.17 -12.871,18.17 -11.481,0 -15.77,-8.83 -15.77,-21.07 v -36.09 h -15.015 v 91.48 h 15.015 v -33.06 c 3.911,7.06 11.102,10.98 20.567,10.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path726" /><path
         d="m 869.293,3503.73 c 0,-5.93 4.922,-9.46 12.492,-9.46 11.106,0 17.668,5.68 17.668,17.15 v 5.18 c -21.453,-2.02 -30.16,-5.05 -30.16,-12.87 z m 29.781,23.35 v 1.26 c 0,11.61 -6.691,15.14 -14.136,15.14 -7.571,0 -13.247,-4.04 -13.629,-12.24 h -14.758 c 1.004,13.89 12.488,23.35 28.894,23.35 16.282,0 29.024,-7.45 28.645,-29.15 0,-3.41 -0.25,-11.36 -0.25,-17.54 0,-8.59 0.758,-17.55 2.015,-23.22 h -13.753 c -0.504,2.9 -1.012,4.54 -1.262,9.2 -4.289,-7.31 -12.367,-10.84 -22.336,-10.84 -14.762,0 -25.109,7.94 -25.109,20.31 0,16.91 20.82,21.2 45.679,23.73"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path728" /><path
         d="m 941.688,3484.68 h -15.016 v 67.89 h 15.016 z m 0,76.34 h -15.016 v 15.14 h 15.016 v -15.14"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path730" /><path
         d="m 991.633,3554.08 c 16.407,0 23.097,-10.6 23.097,-26.75 v -42.65 h -15.023 v 38.99 c 0,9.21 -1.387,18.17 -12.871,18.17 -11.477,0 -15.77,-8.83 -15.77,-21.07 v -36.09 h -15.015 v 67.89 h 15.015 v -9.47 c 3.911,7.06 11.102,10.98 20.567,10.98"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path732" /><path
         d="M 317.859,3273.04 H 310.5 c -2.633,8.83 -10.199,13.67 -21.762,13.67 -7.675,0 -18.508,-3.05 -18.508,-13.04 0,-7.68 6.204,-11.56 14.719,-13.46 l 9.043,-1.99 c 11.039,-2.53 25.653,-6.94 25.653,-21.45 0,-14.61 -13.356,-22.29 -28.18,-22.29 -19.027,0 -29.539,10.62 -31.219,24.29 h 7.359 c 2.625,-12.09 11.141,-17.56 23.547,-17.56 8.309,0 21.133,3.05 21.133,14.4 0,9.36 -9.043,13.67 -19.765,15.98 l -9.571,2.11 c -9.984,2.3 -19.972,7.15 -19.972,19.66 0,14.08 14.191,20.08 26.492,20.08 14.933,0 25.652,-7.47 28.39,-20.4"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path734" /><path
         d="m 374.285,3248.23 c 0,9.56 -6.836,19.24 -18.191,19.24 -10.512,0 -18.086,-6.73 -19.446,-19.24 z m -18.086,25.13 c 15.981,0 26.074,-13.46 25.235,-31.13 h -44.996 c 0.21,-13.66 8.828,-21.75 20.394,-21.75 8.828,0 15.035,4.52 17.242,12.29 h 6.832 c -2.734,-11.67 -12.09,-18.29 -24.5,-18.29 -16.605,0 -26.699,11.89 -26.699,29.43 0,18.3 11.356,29.45 26.492,29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path736" /><path
         d="m 394.867,3215.85 v 76.22 h 6.52 v -76.22 h -6.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path738" /><path
         d="m 459.41,3248.23 c 0,9.56 -6.836,19.24 -18.187,19.24 -10.512,0 -18.086,-6.73 -19.45,-19.24 z m -18.086,25.13 c 15.981,0 26.074,-13.46 25.235,-31.13 h -44.996 c 0.21,-13.66 8.828,-21.75 20.398,-21.75 8.824,0 15.031,4.52 17.238,12.29 h 6.832 c -2.734,-11.67 -12.09,-18.29 -24.496,-18.29 -16.605,0 -26.699,11.89 -26.699,29.43 0,18.3 11.352,29.45 26.488,29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path740" /><path
         d="m 518.477,3254.22 c -2.106,8.51 -8.832,13.14 -17.032,13.14 -9.781,0 -18.398,-7.78 -18.398,-23.34 0,-16.08 8.617,-23.54 18.504,-23.54 9.672,0 15.769,6.2 17.347,13.24 h 6.938 c -2.313,-11.67 -11.777,-19.24 -24.285,-19.24 -16.086,0 -25.442,11.98 -25.442,29.43 0,17.56 9.457,29.45 25.965,29.45 12.828,0 21.555,-8.94 23.235,-19.14 h -6.832"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path742" /><path
         d="m 547.684,3285.13 v -12.72 h 11.14 v -5.67 h -11.14 v -36.18 c 0,-7.35 0.207,-8.82 7.777,-8.82 h 3.363 v -5.89 h -5.359 c -10.094,0 -12.41,2.31 -12.41,13.45 v 37.44 h -9.356 v 5.67 h 9.356 v 12.72 h 6.629"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path744" /><path
         d="m 608.43,3285.13 v -12.72 h 11.14 v -5.67 h -11.14 v -36.18 c 0,-7.35 0.211,-8.82 7.777,-8.82 h 3.363 v -5.89 h -5.359 c -10.094,0 -12.406,2.31 -12.406,13.45 v 37.44 h -9.356 v 5.67 h 9.356 v 12.72 h 6.625"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path746" /><path
         d="m 658.254,3273.36 c 13.348,0 19.027,-7.99 19.027,-21.87 v -35.64 h -6.519 v 33.86 c 0,10.61 -2.735,17.76 -14.192,17.76 -9.777,0 -17.136,-8.2 -17.136,-20.19 v -31.43 h -6.516 v 76.22 h 6.516 v -29.23 c 2.734,5.36 8.308,10.52 18.82,10.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path748" /><path
         d="m 733.609,3248.23 c 0,9.56 -6.836,19.24 -18.187,19.24 -10.512,0 -18.086,-6.73 -19.449,-19.24 z m -18.086,25.13 c 15.981,0 26.075,-13.46 25.235,-31.13 h -44.996 c 0.211,-13.66 8.828,-21.75 20.398,-21.75 8.828,0 15.031,4.52 17.238,12.29 h 6.832 c -2.734,-11.67 -12.089,-18.29 -24.496,-18.29 -16.605,0 -26.699,11.89 -26.699,29.43 0,18.3 11.352,29.45 26.488,29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path750" /><path
         d="m 821.363,3248.23 c 0,9.56 -6.836,19.24 -18.187,19.24 -10.516,0 -18.086,-6.73 -19.449,-19.24 z m -18.086,25.13 c 15.981,0 26.075,-13.46 25.235,-31.13 h -44.996 c 0.211,-13.66 8.828,-21.75 20.394,-21.75 8.832,0 15.035,4.52 17.242,12.29 h 6.832 c -2.734,-11.67 -12.089,-18.29 -24.496,-18.29 -16.605,0 -26.699,11.89 -26.699,29.43 0,18.3 11.352,29.45 26.488,29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path752" /><path
         d="m 877.691,3241.71 v 2.73 c -23.023,-2.52 -32.906,-5.56 -32.906,-14.4 0,-5.99 5.469,-9.78 12.938,-9.78 10.511,0 19.968,5.36 19.968,21.45 z m -21.445,-27.23 c -10.512,0 -18.711,6.09 -18.711,15.46 0,12.82 12.613,17.55 39.844,20.28 v 2 c 0,12.83 -7.566,15.67 -15.77,15.67 -9.566,0 -15.347,-5.36 -15.875,-12.73 h -6.836 c 1.473,11.16 10.516,18.51 23.129,18.51 13.145,0 21.871,-5.47 21.871,-22.29 0,-7.78 -0.109,-12.92 -0.109,-17.45 0,-6.41 0.32,-11.99 0.633,-18.08 h -6.621 l -0.321,8.62 c -3.675,-6 -10.722,-9.99 -21.234,-9.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path754" /><path
         d="m 921.512,3265.89 c -11.672,0 -15.457,-8.41 -15.457,-20.39 v -29.65 h -6.41 v 56.56 h 6.203 v -10.3 c 2.523,6.62 9.882,10.72 16.718,10.72 0.52,0 1.258,0 1.887,-0.11 v -6.93 c -1.047,0.1 -1.996,0.1 -2.941,0.1"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path756" /><path
         d="m 934.535,3215.85 v 76.22 h 6.52 v -76.22 h -6.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path758" /><path
         d="m 965.438,3215.85 h -6.52 v 56.56 h 6.52 z m 0,65.81 h -6.52 v 10.41 h 6.52 v -10.41"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path760" /><path
         d="m 1023.46,3248.23 c 0,9.56 -6.83,19.24 -18.19,19.24 -10.508,0 -18.082,-6.73 -19.446,-19.24 z m -18.08,25.13 c 15.98,0 26.07,-13.46 25.23,-31.13 h -44.993 c 0.207,-13.66 8.828,-21.75 20.393,-21.75 8.83,0 15.04,4.52 17.24,12.29 h 6.83 c -2.73,-11.67 -12.09,-18.29 -24.49,-18.29 -16.61,0 -26.703,11.89 -26.703,29.43 0,18.3 11.355,29.45 26.493,29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path762" /><path
         d="m 1062.55,3267.67 c -6.21,0 -14.4,-2.41 -14.4,-9.24 0,-5.57 4.41,-8.52 10.61,-9.67 l 7.99,-1.48 c 9.25,-1.68 19.56,-4.83 19.56,-15.55 0,-11.25 -10.2,-17.25 -22.5,-17.25 -11.67,0 -21.76,5.78 -23.45,18.71 h 6.84 c 1.26,-8.93 8.41,-12.93 17.13,-12.93 6.84,0 15.35,2.84 15.35,10.41 0,6.62 -6.3,8.94 -13.98,10.41 l -8.83,1.68 c -8.2,1.57 -15.35,6.31 -15.35,15.14 0,8.93 8.94,15.56 21.66,15.56 12.09,0 20.4,-7.47 21.76,-16.51 h -6.83 c -1.37,6.73 -7.57,10.72 -15.56,10.72"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path764" /><path
         d="m 1110.36,3285.13 v -12.72 h 11.15 v -5.67 h -11.15 v -36.18 c 0,-7.35 0.21,-8.82 7.78,-8.82 h 3.37 v -5.89 h -5.37 c -10.09,0 -12.4,2.31 -12.4,13.45 v 37.44 h -9.36 v 5.67 h 9.36 v 12.72 h 6.62"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path766" /><path
         d="m 280.742,3168.38 h 4.629 v -6 h -3.262 c -7.148,0 -7.988,-0.62 -7.988,-7.57 v -6.09 h 11.25 v -5.67 h -11.25 v -50.89 h -6.516 v 50.89 h -7.781 v 5.67 h 7.781 v 7.04 c 0,9.26 2.415,12.62 13.137,12.62"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path768" /><path
         d="m 303.547,3092.16 h -6.52 v 56.56 h 6.52 z m 0,65.81 h -6.52 v 10.41 h 6.52 v -10.41"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path770" /><path
         d="m 346.75,3149.67 c 13.348,0 19.027,-7.99 19.027,-21.87 v -35.64 h -6.519 v 33.85 c 0,10.62 -2.735,17.77 -14.192,17.77 -9.777,0 -17.136,-8.21 -17.136,-20.19 v -31.43 h -6.52 v 56.56 h 6.52 v -9.57 c 2.734,5.36 8.308,10.52 18.82,10.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path772" /><path
         d="m 417.688,3118.02 v 2.73 c -23.024,-2.52 -32.907,-5.57 -32.907,-14.4 0,-5.99 5.469,-9.78 12.934,-9.78 10.515,0 19.973,5.36 19.973,21.45 z m -21.446,-27.23 c -10.512,0 -18.711,6.09 -18.711,15.46 0,12.82 12.614,17.55 39.844,20.28 v 2 c 0,12.83 -7.57,15.67 -15.773,15.67 -9.567,0 -15.344,-5.36 -15.872,-12.73 h -6.835 c 1.472,11.16 10.515,18.51 23.128,18.51 13.145,0 21.872,-5.47 21.872,-22.29 0,-7.78 -0.11,-12.93 -0.11,-17.45 0,-6.41 0.317,-11.99 0.629,-18.08 h -6.621 l -0.316,8.62 c -3.676,-6 -10.723,-9.99 -21.235,-9.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path774" /><path
         d="m 439.645,3092.16 v 76.22 h 6.519 v -76.22 h -6.519"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path776" /><path
         d="m 533.297,3120.22 c 0,15.04 -7.461,23.56 -17.973,23.56 -8.515,0 -18.187,-6.84 -18.187,-23.56 0,-16.71 9.672,-23.54 18.187,-23.54 10.512,0 17.973,8.51 17.973,23.54 z m -35.742,-18.82 v -9.24 h -6.52 v 76.22 h 6.52 v -29.44 c 3.996,6.83 10.824,10.73 19.133,10.73 13.035,0 23.656,-10.73 23.656,-29.45 0,-18.82 -10.621,-29.43 -23.656,-29.43 -8.309,0 -15.137,3.89 -19.133,10.61"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path778" /><path
         d="m 553.672,3092.16 v 76.22 h 6.519 v -76.22 h -6.519"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path780" /><path
         d="m 617.902,3120.22 c 0,16.19 -7.886,23.45 -18.711,23.45 -10.832,0 -18.609,-7.26 -18.609,-23.45 0,-16.18 7.777,-23.43 18.609,-23.43 10.825,0 18.711,7.25 18.711,23.43 z m 6.938,0 c 0,-20.6 -12.09,-29.43 -25.649,-29.43 -13.566,0 -25.546,8.83 -25.546,29.43 0,20.61 11.98,29.45 25.546,29.45 13.559,0 25.649,-8.84 25.649,-29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path782" /><path
         d="m 677.07,3130.53 c -2.101,8.51 -8.832,13.14 -17.031,13.14 -9.777,0 -18.398,-7.78 -18.398,-23.34 0,-16.08 8.621,-23.54 18.504,-23.54 9.671,0 15.769,6.2 17.347,13.24 h 6.938 c -2.313,-11.67 -11.778,-19.24 -24.285,-19.24 -16.086,0 -25.442,11.98 -25.442,29.43 0,17.56 9.457,29.45 25.969,29.45 12.824,0 21.551,-8.94 23.23,-19.14 h -6.832"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path784" /><path
         d="m 703.547,3120.44 25.859,28.28 h 7.992 l -20.921,-22.71 22.812,-33.85 h -7.57 l -19.446,29.22 -8.726,-9.46 v -19.76 h -6.52 v 76.22 h 6.52 v -47.94"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path786" /><path
         d="m 782.891,3092.16 h -6.52 v 56.56 h 6.52 z m 0,65.81 h -6.52 v 10.41 h 6.52 v -10.41"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path788" /><path
         d="m 826.09,3149.67 c 13.351,0 19.027,-7.99 19.027,-21.87 v -35.64 h -6.515 v 33.85 c 0,10.62 -2.735,17.77 -14.196,17.77 -9.777,0 -17.133,-8.21 -17.133,-20.19 v -31.43 h -6.519 v 56.56 h 6.519 v -9.57 c 2.735,5.36 8.305,10.52 18.817,10.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path790" /><path
         d="m 897.551,3161.44 v -12.72 h 11.14 v -5.67 h -11.14 v -36.18 c 0,-7.35 0.211,-8.82 7.777,-8.82 h 3.363 v -5.89 h -5.359 c -10.094,0 -12.406,2.31 -12.406,13.45 v 37.44 h -9.356 v 5.67 h 9.356 v 12.72 h 6.625"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path792" /><path
         d="m 947.375,3149.67 c 13.348,0 19.027,-7.99 19.027,-21.87 v -35.64 h -6.519 v 33.85 c 0,10.62 -2.735,17.77 -14.192,17.77 -9.777,0 -17.136,-8.21 -17.136,-20.19 v -31.43 h -6.52 v 76.22 h 6.52 v -29.23 c 2.734,5.36 8.308,10.52 18.82,10.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path794" /><path
         d="m 1022.73,3124.54 c 0,9.56 -6.84,19.24 -18.19,19.24 -10.509,0 -18.083,-6.73 -19.446,-19.24 z m -18.09,25.13 c 15.99,0 26.08,-13.46 25.24,-31.13 h -44.997 c 0.211,-13.66 8.828,-21.75 20.397,-21.75 8.83,0 15.03,4.52 17.24,12.29 h 6.83 c -2.73,-11.67 -12.09,-18.29 -24.5,-18.29 -16.604,0 -26.694,11.88 -26.694,29.43 0,18.3 11.352,29.45 26.484,29.45"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path796" /><path
         d="m 266.027,2968.47 v 76.23 h 6.52 v -76.23 h -6.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path798" /><path
         d="m 330.25,2996.54 c 0,16.19 -7.887,23.45 -18.711,23.45 -10.828,0 -18.609,-7.26 -18.609,-23.45 0,-16.18 7.781,-23.44 18.609,-23.44 10.824,0 18.711,7.26 18.711,23.44 z m 6.938,0 c 0,-20.6 -12.09,-29.43 -25.649,-29.43 -13.562,0 -25.547,8.83 -25.547,29.43 0,20.61 11.985,29.44 25.547,29.44 13.559,0 25.649,-8.83 25.649,-29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path800" /><path
         d="m 375.969,3025.98 c 13.347,0 19.027,-7.98 19.027,-21.86 v -35.65 h -6.519 v 33.86 c 0,10.62 -2.735,17.77 -14.192,17.77 -9.777,0 -17.137,-8.21 -17.137,-20.19 v -31.44 h -6.515 v 56.57 h 6.515 v -9.57 c 2.735,5.36 8.305,10.51 18.821,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path802" /><path
         d="m 413.371,2997.7 c 0,-13.98 7.359,-22.5 17.871,-22.5 8.621,0 18.293,6.84 18.293,22.5 0,15.56 -9.672,22.4 -18.293,22.4 -10.512,0 -17.871,-8.52 -17.871,-22.4 z m 16.504,-28.28 c -12.93,0 -23.551,10.62 -23.551,28.28 0,17.56 10.621,28.28 23.551,28.28 8.41,0 15.242,-3.89 19.137,-10.72 v 9.78 h 6.625 v -54.56 c 0,-15.15 -10.52,-21.77 -23.977,-21.77 -11.668,0 -20.812,6.42 -21.863,16.61 h 6.832 c 0.734,-6 5.676,-10.94 15.246,-10.94 10.617,0 17.137,4.85 17.137,15.35 v 10.31 c -3.895,-6.84 -10.727,-10.62 -19.137,-10.62"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path804" /><path
         d="m 513.648,3000.86 c 0,9.56 -6.835,19.24 -18.187,19.24 -10.512,0 -18.086,-6.73 -19.449,-19.24 z m -18.085,25.12 c 15.98,0 26.074,-13.45 25.234,-31.12 h -44.996 c 0.211,-13.66 8.828,-21.76 20.398,-21.76 8.828,0 15.031,4.53 17.239,12.3 h 6.832 c -2.735,-11.67 -12.09,-18.29 -24.497,-18.29 -16.609,0 -26.699,11.88 -26.699,29.43 0,18.3 11.352,29.44 26.489,29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path806" /><path
         d="m 552.73,3020.3 c -6.199,0 -14.398,-2.41 -14.398,-9.25 0,-5.57 4.414,-8.51 10.613,-9.67 l 7.996,-1.47 c 9.247,-1.68 19.551,-4.83 19.551,-15.56 0,-11.25 -10.195,-17.24 -22.496,-17.24 -11.672,0 -21.762,5.78 -23.449,18.71 h 6.836 c 1.262,-8.94 8.41,-12.93 17.137,-12.93 6.835,0 15.347,2.84 15.347,10.41 0,6.62 -6.304,8.93 -13.98,10.41 l -8.828,1.68 c -8.204,1.57 -15.356,6.31 -15.356,15.14 0,8.93 8.938,15.56 21.656,15.56 12.094,0 20.403,-7.47 21.762,-16.51 h -6.828 c -1.367,6.73 -7.57,10.72 -15.563,10.72"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path808" /><path
         d="m 600.555,3037.76 v -12.72 h 11.14 v -5.68 h -11.14 v -36.17 c 0,-7.35 0.207,-8.83 7.777,-8.83 h 3.363 v -5.89 h -5.359 c -10.094,0 -12.41,2.32 -12.41,13.46 v 37.43 h -9.356 v 5.68 h 9.356 v 12.72 h 6.629"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path810" /><path
         d="m 690,3006.84 c -2.102,8.52 -8.832,13.15 -17.031,13.15 -9.778,0 -18.399,-7.78 -18.399,-23.34 0,-16.09 8.621,-23.55 18.504,-23.55 9.672,0 15.77,6.2 17.348,13.25 h 6.937 c -2.312,-11.67 -11.777,-19.24 -24.285,-19.24 -16.086,0 -25.441,11.98 -25.441,29.43 0,17.56 9.457,29.44 25.969,29.44 12.824,0 21.55,-8.93 23.23,-19.14 H 690"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path812" /><path
         d="m 735.289,3025.98 c 13.352,0 19.027,-7.98 19.027,-21.86 v -35.65 h -6.515 v 33.86 c 0,10.62 -2.735,17.77 -14.196,17.77 -9.777,0 -17.132,-8.21 -17.132,-20.19 v -31.44 h -6.52 v 76.23 h 6.52 v -29.23 c 2.73,5.36 8.304,10.51 18.816,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path814" /><path
         d="m 806.23,2994.33 v 2.74 c -23.019,-2.52 -32.906,-5.57 -32.906,-14.41 0,-5.98 5.473,-9.77 12.938,-9.77 10.511,0 19.968,5.36 19.968,21.44 z m -21.445,-27.22 c -10.512,0 -18.711,6.09 -18.711,15.46 0,12.82 12.614,17.55 39.844,20.28 v 2 c 0,12.82 -7.566,15.67 -15.77,15.67 -9.566,0 -15.347,-5.37 -15.875,-12.73 h -6.835 c 1.472,11.14 10.515,18.51 23.128,18.51 13.145,0 21.872,-5.47 21.872,-22.29 0,-7.78 -0.11,-12.93 -0.11,-17.45 0,-6.42 0.32,-11.99 0.633,-18.09 h -6.621 l -0.317,8.63 c -3.679,-6 -10.722,-9.99 -21.238,-9.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path816" /><path
         d="m 834.703,2968.47 h -6.519 v 56.57 h 6.519 z m 0,65.82 h -6.519 v 10.41 h 6.519 v -10.41"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path818" /><path
         d="m 877.906,3025.98 c 13.352,0 19.028,-7.98 19.028,-21.86 v -35.65 h -6.516 v 33.86 c 0,10.62 -2.734,17.77 -14.195,17.77 -9.778,0 -17.133,-8.21 -17.133,-20.19 v -31.44 h -6.52 v 56.57 h 6.52 v -9.57 c 2.734,5.36 8.305,10.51 18.816,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path820" /><path
         d="m 973.02,3025.04 14.507,-46.37 12.094,46.37 h 7.249 l -16.401,-56.57 h -6.094 l -14.824,47.52 -14.403,-47.52 h -5.992 l -16.402,56.57 h 7.254 l 12.512,-46.26 13.98,46.26 h 6.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path822" /><path
         d="m 1042.69,3025.98 c 13.35,0 19.03,-7.98 19.03,-21.86 v -35.65 h -6.52 v 33.86 c 0,10.62 -2.73,17.77 -14.19,17.77 -9.78,0 -17.14,-8.21 -17.14,-20.19 v -31.44 h -6.52 v 76.23 h 6.52 v -29.23 c 2.74,5.36 8.31,10.51 18.82,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path824" /><path
         d="m 1084.41,2968.47 h -6.52 v 56.57 h 6.52 z m 0,65.82 h -6.52 v 10.41 h 6.52 v -10.41"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path826" /><path
         d="m 1140.23,3006.84 c -2.11,8.52 -8.84,13.15 -17.04,13.15 -9.78,0 -18.39,-7.78 -18.39,-23.34 0,-16.09 8.61,-23.55 18.5,-23.55 9.67,0 15.77,6.2 17.35,13.25 h 6.93 c -2.31,-11.67 -11.77,-19.24 -24.28,-19.24 -16.09,0 -25.44,11.98 -25.44,29.43 0,17.56 9.46,29.44 25.96,29.44 12.83,0 21.56,-8.93 23.24,-19.14 h -6.83"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path828" /><path
         d="m 1185.51,3025.98 c 13.35,0 19.03,-7.98 19.03,-21.86 v -35.65 h -6.52 v 33.86 c 0,10.62 -2.73,17.77 -14.19,17.77 -9.78,0 -17.13,-8.21 -17.13,-20.19 v -31.44 h -6.52 v 76.23 h 6.52 v -29.23 c 2.73,5.36 8.3,10.51 18.81,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path830" /><path
         d="m 1273.06,3025.98 c 13.35,0 19.03,-7.98 19.03,-21.86 v -35.65 h -6.52 v 33.86 c 0,10.62 -2.74,17.77 -14.2,17.77 -9.77,0 -17.13,-8.21 -17.13,-20.19 v -31.44 h -6.52 v 76.23 h 6.52 v -29.23 c 2.73,5.36 8.31,10.51 18.82,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path832" /><path
         d="m 1344,2994.33 v 2.74 c -23.02,-2.52 -32.91,-5.57 -32.91,-14.41 0,-5.98 5.47,-9.77 12.94,-9.77 10.51,0 19.97,5.36 19.97,21.44 z m -21.45,-27.22 c -10.51,0 -18.71,6.09 -18.71,15.46 0,12.82 12.62,17.55 39.85,20.28 v 2 c 0,12.82 -7.57,15.67 -15.77,15.67 -9.57,0 -15.35,-5.37 -15.88,-12.73 h -6.83 c 1.47,11.14 10.51,18.51 23.13,18.51 13.14,0 21.87,-5.47 21.87,-22.29 0,-7.78 -0.11,-12.93 -0.11,-17.45 0,-6.42 0.32,-11.99 0.63,-18.09 h -6.62 l -0.32,8.63 c -3.68,-6 -10.72,-9.99 -21.24,-9.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path834" /><path
         d="m 1384.24,3020.3 c -6.2,0 -14.4,-2.41 -14.4,-9.25 0,-5.57 4.42,-8.51 10.62,-9.67 l 7.99,-1.47 c 9.25,-1.68 19.55,-4.83 19.55,-15.56 0,-11.25 -10.19,-17.24 -22.49,-17.24 -11.67,0 -21.76,5.78 -23.45,18.71 h 6.84 c 1.26,-8.94 8.41,-12.93 17.13,-12.93 6.84,0 15.35,2.84 15.35,10.41 0,6.62 -6.31,8.93 -13.98,10.41 l -8.83,1.68 c -8.2,1.57 -15.35,6.31 -15.35,15.14 0,8.93 8.93,15.56 21.65,15.56 12.1,0 20.4,-7.47 21.77,-16.51 h -6.83 c -1.37,6.73 -7.57,10.72 -15.57,10.72"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path836" /><path
         d="m 275.281,2914.07 v -12.72 h 11.141 v -5.68 h -11.141 v -36.17 c 0,-7.35 0.207,-8.83 7.778,-8.83 h 3.363 v -5.89 h -5.359 c -10.094,0 -12.411,2.32 -12.411,13.46 v 37.43 h -9.355 v 5.68 h 9.355 v 12.72 h 6.629"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path838" /><path
         d="m 325.098,2902.29 c 13.351,0 19.031,-7.99 19.031,-21.86 v -35.65 h -6.52 v 33.86 c 0,10.62 -2.734,17.76 -14.195,17.76 -9.773,0 -17.133,-8.2 -17.133,-20.18 v -31.44 h -6.519 V 2921 h 6.519 v -29.22 c 2.735,5.36 8.305,10.51 18.817,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path840" /><path
         d="m 400.461,2877.17 c 0,9.56 -6.836,19.23 -18.188,19.23 -10.515,0 -18.082,-6.72 -19.449,-19.23 z m -18.086,25.12 c 15.98,0 26.074,-13.45 25.234,-31.12 h -44.996 c 0.211,-13.66 8.828,-21.76 20.395,-21.76 8.828,0 15.035,4.52 17.242,12.3 h 6.832 c -2.734,-11.67 -12.09,-18.29 -24.496,-18.29 -16.609,0 -26.699,11.88 -26.699,29.43 0,18.3 11.351,29.44 26.488,29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path842" /><path
         d="m 466.344,2896.61 c -6.199,0 -14.399,-2.41 -14.399,-9.25 0,-5.57 4.414,-8.51 10.614,-9.67 l 7.996,-1.47 c 9.246,-1.68 19.55,-4.84 19.55,-15.56 0,-11.25 -10.195,-17.24 -22.496,-17.24 -11.671,0 -21.761,5.78 -23.449,18.71 h 6.836 c 1.262,-8.94 8.41,-12.93 17.137,-12.93 6.836,0 15.351,2.84 15.351,10.41 0,6.62 -6.308,8.93 -13.988,10.41 l -8.824,1.68 c -8.203,1.57 -15.352,6.31 -15.352,15.13 0,8.94 8.934,15.57 21.653,15.57 12.097,0 20.402,-7.47 21.765,-16.51 h -6.832 c -1.367,6.73 -7.57,10.72 -15.562,10.72"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path844" /><path
         d="M 504.91,2844.78 V 2921 h 6.516 v -76.22 h -6.516"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path846" /><path
         d="m 569.137,2872.85 c 0,16.19 -7.887,23.45 -18.711,23.45 -10.828,0 -18.61,-7.26 -18.61,-23.45 0,-16.18 7.782,-23.44 18.61,-23.44 10.824,0 18.711,7.26 18.711,23.44 z m 6.937,0 c 0,-20.61 -12.09,-29.43 -25.648,-29.43 -13.563,0 -25.547,8.82 -25.547,29.43 0,20.61 11.984,29.44 25.547,29.44 13.558,0 25.648,-8.83 25.648,-29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path848" /><path
         d="m 598.766,2914.07 v -12.72 h 11.144 v -5.68 h -11.144 v -36.17 c 0,-7.35 0.211,-8.83 7.777,-8.83 h 3.367 v -5.89 h -5.363 c -10.094,0 -12.406,2.32 -12.406,13.46 v 37.43 h -9.356 v 5.68 h 9.356 v 12.72 h 6.625"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path850" /><path
         d="m 675.598,2902.29 c 13.347,0 19.027,-7.99 19.027,-21.86 v -35.65 h -6.52 v 33.86 c 0,10.62 -2.734,17.76 -14.195,17.76 -9.773,0 -17.133,-8.2 -17.133,-20.18 v -31.44 h -6.515 v 56.57 h 6.515 v -9.57 c 2.735,5.36 8.309,10.51 18.821,10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path852" /><path
         d="m 727.512,2843.42 c -12.93,0 -18.399,7.98 -18.399,21.86 v 36.07 h 6.52 v -34.28 c 0,-10.62 2.523,-17.77 13.562,-17.77 9.039,0 16.504,8.21 16.504,20.19 v 31.86 h 6.52 v -56.57 h -6.52 v 9.15 c -2.734,-5.36 -8.406,-10.51 -18.187,-10.51"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path854" /><path
         d="m 770.07,2844.78 v 56.57 h 6.52 v -9.57 c 2.734,5.36 7.777,10.51 17.765,10.51 9.04,0 14.297,-3.99 16.614,-11.25 4.304,7.15 9.984,11.25 19.129,11.25 12.828,0 17.98,-7.99 17.98,-21.86 v -35.65 h -6.519 v 33.86 c 0,10.62 -2.207,17.76 -13.141,17.76 -9.25,0 -16.09,-8.2 -16.09,-20.18 v -31.44 h -6.515 v 33.86 c 0,10.62 -2.208,17.76 -13.141,17.76 -9.254,0 -16.082,-8.2 -16.082,-20.18 v -31.44 h -6.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path856" /><path
         d="m 906.5,2872.85 c 0,15.04 -7.461,23.55 -17.973,23.55 -8.515,0 -18.187,-6.83 -18.187,-23.55 0,-16.71 9.672,-23.55 18.187,-23.55 10.512,0 17.973,8.52 17.973,23.55 z m -35.742,-18.82 v -9.25 h -6.52 V 2921 h 6.52 v -29.43 c 3.996,6.83 10.824,10.72 19.133,10.72 13.035,0 23.656,-10.72 23.656,-29.44 0,-18.82 -10.621,-29.43 -23.656,-29.43 -8.309,0 -15.137,3.88 -19.133,10.61"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path858" /><path
         d="m 967.871,2877.17 c 0,9.56 -6.836,19.23 -18.187,19.23 -10.512,0 -18.082,-6.72 -19.45,-19.23 z m -18.086,25.12 c 15.985,0 26.074,-13.45 25.235,-31.12 h -44.993 c 0.207,-13.66 8.828,-21.76 20.395,-21.76 8.828,0 15.031,4.52 17.238,12.3 h 6.832 c -2.734,-11.67 -12.09,-18.29 -24.496,-18.29 -16.605,0 -26.699,11.88 -26.699,29.43 0,18.3 11.351,29.44 26.488,29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path860" /><path
         d="m 1010.32,2894.82 c -11.668,0 -15.453,-8.41 -15.453,-20.39 v -29.65 h -6.41 v 56.57 h 6.203 v -10.31 c 2.524,6.62 9.88,10.73 16.72,10.73 0.52,0 1.26,0 1.89,-0.11 v -6.94 c -1.05,0.1 -2,0.1 -2.95,0.1"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path862" /><path
         d="m 1052.56,2874.01 c 0,-13.98 7.36,-22.5 17.88,-22.5 8.62,0 18.29,6.84 18.29,22.5 0,15.56 -9.67,22.39 -18.29,22.39 -10.52,0 -17.88,-8.51 -17.88,-22.39 z m 16.51,-28.28 c -12.93,0 -23.55,10.62 -23.55,28.28 0,17.56 10.62,28.28 23.55,28.28 8.41,0 15.24,-3.89 19.13,-10.72 v 9.78 h 6.63 v -54.56 c 0,-15.15 -10.52,-21.77 -23.97,-21.77 -11.67,0 -20.82,6.41 -21.87,16.61 h 6.83 c 0.74,-6 5.68,-10.94 15.25,-10.94 10.62,0 17.13,4.85 17.13,15.35 v 10.31 c -3.89,-6.84 -10.72,-10.62 -19.13,-10.62"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path864" /><path
         d="m 1134.54,2894.82 c -11.67,0 -15.45,-8.41 -15.45,-20.39 v -29.65 h -6.41 v 56.57 h 6.2 v -10.31 c 2.52,6.62 9.88,10.73 16.72,10.73 0.52,0 1.26,0 1.89,-0.11 v -6.94 c -1.05,0.1 -2,0.1 -2.95,0.1"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path866" /><path
         d="m 1187.73,2877.17 c 0,9.56 -6.84,19.23 -18.19,19.23 -10.52,0 -18.08,-6.72 -19.45,-19.23 z m -18.09,25.12 c 15.98,0 26.07,-13.45 25.23,-31.12 h -44.99 c 0.21,-13.66 8.83,-21.76 20.39,-21.76 8.83,0 15.04,4.52 17.25,12.3 h 6.83 c -2.74,-11.67 -12.09,-18.29 -24.5,-18.29 -16.61,0 -26.7,11.88 -26.7,29.43 0,18.3 11.35,29.44 26.49,29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path868" /><path
         d="m 1244.05,2870.64 v 2.74 c -23.02,-2.52 -32.9,-5.57 -32.9,-14.41 0,-5.98 5.47,-9.77 12.93,-9.77 10.52,0 19.97,5.36 19.97,21.44 z m -21.44,-27.22 c -10.51,0 -18.71,6.09 -18.71,15.46 0,12.82 12.61,17.54 39.84,20.28 v 2 c 0,12.82 -7.57,15.66 -15.77,15.66 -9.57,0 -15.35,-5.36 -15.87,-12.72 h -6.84 c 1.47,11.14 10.52,18.51 23.13,18.51 13.14,0 21.87,-5.47 21.87,-22.29 0,-7.78 -0.11,-12.93 -0.11,-17.45 0,-6.42 0.32,-11.99 0.63,-18.09 h -6.62 l -0.32,8.63 c -3.67,-6 -10.72,-9.99 -21.23,-9.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path870" /><path
         d="m 1275.26,2914.07 v -12.72 h 11.14 v -5.68 h -11.14 v -36.17 c 0,-7.35 0.21,-8.83 7.78,-8.83 h 3.36 v -5.89 h -5.36 c -10.09,0 -12.41,2.32 -12.41,13.46 v 37.43 h -9.35 v 5.68 h 9.35 v 12.72 h 6.63"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path872" /><path
         d="m 1339.91,2877.17 c 0,9.56 -6.84,19.23 -18.19,19.23 -10.51,0 -18.09,-6.72 -19.45,-19.23 z m -18.09,25.12 c 15.98,0 26.08,-13.45 25.24,-31.12 h -45 c 0.21,-13.66 8.83,-21.76 20.4,-21.76 8.83,0 15.03,4.52 17.24,12.3 h 6.83 c -2.73,-11.67 -12.09,-18.29 -24.5,-18.29 -16.6,0 -26.7,11.88 -26.7,29.43 0,18.3 11.36,29.44 26.49,29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path874" /><path
         d="m 1382.35,2894.82 c -11.67,0 -15.45,-8.41 -15.45,-20.39 v -29.65 h -6.41 v 56.57 h 6.2 v -10.31 c 2.53,6.62 9.88,10.73 16.72,10.73 0.52,0 1.26,0 1.89,-0.11 v -6.94 c -1.05,0.1 -2,0.1 -2.95,0.1"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path876" /><path
         d="m 305.871,2749.16 c 0,16.19 -7.887,23.45 -18.711,23.45 -10.832,0 -18.609,-7.26 -18.609,-23.45 0,-16.18 7.777,-23.44 18.609,-23.44 10.824,0 18.711,7.26 18.711,23.44 z m 6.938,0 c 0,-20.61 -12.09,-29.44 -25.649,-29.44 -13.566,0 -25.547,8.83 -25.547,29.44 0,20.6 11.981,29.44 25.547,29.44 13.559,0 25.649,-8.84 25.649,-29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path878" /><path
         d="m 348.113,2771.13 c -11.672,0 -15.457,-8.41 -15.457,-20.39 v -29.65 h -6.41 v 56.56 h 6.203 v -10.3 c 2.524,6.62 9.879,10.72 16.715,10.72 0.524,0 1.262,0 1.891,-0.1 v -6.94 c -1.047,0.1 -1.996,0.1 -2.942,0.1"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path880" /><path
         d="m 428.309,2753.47 c 0,9.57 -6.836,19.24 -18.192,19.24 -10.512,0 -18.086,-6.73 -19.445,-19.24 z m -18.086,25.13 c 15.98,0 26.074,-13.46 25.23,-31.12 h -44.992 c 0.211,-13.66 8.828,-21.76 20.394,-21.76 8.829,0 15.036,4.52 17.243,12.3 h 6.832 c -2.735,-11.67 -12.09,-18.3 -24.5,-18.3 -16.606,0 -26.7,11.89 -26.7,29.44 0,18.3 11.356,29.44 26.493,29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path882" /><path
         d="m 451.941,2749.16 c 0,-15.03 7.461,-23.55 17.973,-23.55 8.516,0 18.188,6.84 18.188,23.55 0,16.72 -9.672,23.55 -18.188,23.55 -10.512,0 -17.973,-8.51 -17.973,-23.55 z m 35.743,18.82 v 9.67 h 6.515 v -74.96 h -6.515 v 27.76 c -3.996,-6.84 -10.829,-10.73 -19.133,-10.73 -13.035,0 -23.656,10.73 -23.656,29.44 0,18.82 10.621,29.44 23.656,29.44 8.304,0 15.137,-3.89 19.133,-10.62"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path884" /><path
         d="m 528.766,2719.72 c -12.93,0 -18.399,7.99 -18.399,21.87 v 36.06 h 6.52 v -34.27 c 0,-10.62 2.523,-17.77 13.562,-17.77 9.043,0 16.504,8.21 16.504,20.19 v 31.85 h 6.52 v -56.56 h -6.52 v 9.15 c -2.734,-5.36 -8.406,-10.52 -18.187,-10.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path886" /><path
         d="m 607.07,2746.95 v 2.74 c -23.019,-2.52 -32.902,-5.57 -32.902,-14.41 0,-5.98 5.469,-9.77 12.934,-9.77 10.511,0 19.968,5.36 19.968,21.44 z m -21.445,-27.23 c -10.512,0 -18.711,6.1 -18.711,15.46 0,12.83 12.613,17.55 39.844,20.29 v 2 c 0,12.82 -7.567,15.66 -15.77,15.66 -9.566,0 -15.347,-5.36 -15.875,-12.72 h -6.836 c 1.477,11.14 10.52,18.5 23.129,18.5 13.145,0 21.871,-5.46 21.871,-22.28 0,-7.78 -0.105,-12.93 -0.105,-17.45 0,-6.42 0.316,-11.99 0.629,-18.09 h -6.621 l -0.317,8.62 c -3.679,-5.99 -10.722,-9.99 -21.238,-9.99"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path888" /><path
         d="m 629.023,2721.09 v 76.22 h 6.52 v -76.22 h -6.52"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path890" /><path
         d="m 689.668,2790.38 v -12.73 h 11.145 v -5.67 h -11.145 v -36.17 c 0,-7.35 0.211,-8.83 7.781,-8.83 h 3.364 v -5.89 h -5.364 c -10.09,0 -12.406,2.32 -12.406,13.46 v 37.43 h -9.355 v 5.67 h 9.355 v 12.73 h 6.625"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path892" /><path
         d="m 754,2749.16 c 0,16.19 -7.887,23.45 -18.711,23.45 -10.828,0 -18.609,-7.26 -18.609,-23.45 0,-16.18 7.781,-23.44 18.609,-23.44 10.824,0 18.711,7.26 18.711,23.44 z m 6.938,0 c 0,-20.61 -12.09,-29.44 -25.649,-29.44 -13.562,0 -25.547,8.83 -25.547,29.44 0,20.6 11.985,29.44 25.547,29.44 13.559,0 25.649,-8.84 25.649,-29.44"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path894" /><path
         d="m 803.594,2773.13 c 0,-12.4 7.676,-20.6 19.449,-20.6 11.777,0 19.453,8.2 19.453,20.6 0,11.67 -8.094,19.77 -19.453,19.77 -11.461,0 -19.449,-8.1 -19.449,-19.77 z m 18.719,-26.38 c -15.145,0 -25.657,10.92 -25.657,26.07 0,14.3 10.305,25.86 26.387,25.86 18.82,0 27.336,-13.46 27.336,-36.38 0,-23.86 -7.672,-42.58 -29.645,-42.58 -13.668,0 -21.343,8.21 -22.816,18.93 h 7.043 c 1.262,-8.94 7.887,-13.14 16.824,-13.14 13.348,0 21.973,11.56 21.973,33.43 -3.473,-7.05 -11.356,-12.19 -21.445,-12.19"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path896" /><path
         d="m 109.543,3775.56 c -10.2344,0 -45.586,0 -55.8242,0 C 24.0508,3775.56 0,3751.51 0,3721.84 c 0,-10.23 0,-45.58 0,-55.82 0,-29.66 24.0508,-53.72 53.7188,-53.72 10.2382,0 45.5898,0 55.8242,0 29.668,0 53.719,24.06 53.719,53.72 0,10.24 0,45.59 0,55.82 0,29.67 -24.051,53.72 -53.719,53.72 z m 0,-10 c 24.105,0 43.719,-19.6 43.719,-43.72 v -55.82 c 0,-24.11 -19.614,-43.72 -43.719,-43.72 H 53.7188 C 29.6094,3622.3 10,3641.91 10,3666.02 v 55.82 c 0,24.12 19.6094,43.72 43.7188,43.72 h 55.8242"
         style="fill:#b6b6b8;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path898" /><path
         d="m 56.4648,3720.27 h 10.9727 l 12.5586,-17.82 12.8477,17.82 h 10.3942 l -18.0466,-25.12 19.2736,-27.2 H 93.4922 l -13.8555,19.56 -14.0742,-19.56 H 55.2422 l 19.2695,26.77 -18.0469,25.55"
         style="fill:#100f0d;fill-opacity:1;fill-rule:nonzero;stroke:none"
         id="path900" /><path
         d="m 6916.52,1569.52 v -447.45 h -4945.5 v 469.48"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path902" /><path
         d="M 7038.23,1569.52 V 1170.67 H 2505 v 431.81"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path904" /><path
         d="M 7269.87,1569.52 V 1219.74 H 3149.49 v 391.82"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path906" /><path
         d="M 6878.21,1565 V 1268.5 H 3581.78 v 314"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path908" /><path
         d="M 7021.62,1569.52 V 1317.21 H 4137.46 v 274.72"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path910" /><path
         d="M 6966.14,1569.52 V 1365.91 H 4499.03 v 234.77"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path912" /><path
         d="M 7249.38,1569.52 V 1414.61 H 5190.87 v 195.53"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path914" /><path
         d="M 7584.62,1569.52 V 1464.05 H 5936.61 v 156.37"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path916" /><path
         d="m 7145.11,1569.52 v -56 H 6323.5 v 77.79"
         style="fill:none;stroke:#100f0d;stroke-width:2.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path918" /><path
         d="m 6878.21,1569.52 h 706.43"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path920" /><path
         d="m 6878.21,1589.29 v -39.53"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path922" /><path
         d="m 7584.64,1589.29 v -39.53"
         style="fill:none;stroke:#100f0d;stroke-width:10;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
         id="path924" /></g></g></svg>
</div>
<div class="title">Figure 1. An exemplary result of Median Algorithm in first sync epoch with \$s_"cq" = 9\$ and \$k = 1\$.</div>
</div>
</div>
<div class="sect2">
<h3 id="block-production"><a class="anchor" href="#block-production"></a><a class="link" href="#block-production">5.4. Production Algorithm</a></h3>
<div class="paragraph">
<p>Throughout each epoch, each block producer should run <a href="#algo-block-production">Algorithm 9</a>
to produce blocks during the slots it has been awarded during that epoch. The
produced block needs to carry the <em>Pre-Digest</em> (<a href="#defn-babe-header">Definition 69</a>) as well
as the <em>block signature</em> (<a href="#defn-block-signature">Definition 70</a>) as Pre-Runtime and Seal
digest items.</p>
</div>
<div id="defn-babe-header" class="exampleblock">
<div class="title">Definition 69. <a href="#defn-babe-header">Pre-Digest</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Pre-Digest</strong>, or BABE header, \$P\$, is a varying datatype of the
following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$P = {(1,-&gt;,(a_"id",s,o,p)),(2,-&gt;,(a_"id",s)),(3,-&gt;,(a_"id",s,o,p)):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>1</em> indicates a primary slot with VRF outputs, <em>2</em> a secondary slot with plain
outputs and <em>3</em> a secondary slot with VRF outputs
(<a href="#sect-block-production-lottery">Section 5.2</a>). Plain outputs are no longer actively used
and only exist for backwards compatibility reasons, respectively to sync old
blocks.</p>
</li>
<li>
<p>\$a_"id"\$ is the unsigned 32-bit integer indicating the index of the
authority in the authority set (<a href="#sect-authority-set">Section 3.3.1</a>) who authored the
block.</p>
</li>
<li>
<p>\$s\$ is the slot number (<a href="#defn-epoch-slot">Definition 54</a>).</p>
</li>
<li>
<p>\$o\$ is VRF output (<a href="#algo-block-production-lottery">Algorithm 6</a> respectively
<a href="#defn-babe-secondary-slots">Definition 61</a>).</p>
</li>
<li>
<p>\$p\$ is VRF proof (<a href="#algo-block-production-lottery">Algorithm 6</a> respectively
<a href="#defn-babe-secondary-slots">Definition 61</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Pre-Digest must be included as a digest item of Pre-Runtime type in the
header digest (<a href="#defn-digest">Definition 11</a>) \$H_d(B)\$.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-block-production" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 9 </span><span style="font-style:normal;font-variant:small-caps;">Invoke-Block-Authoring</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>k</mi><mo separator="true">,</mo><mi>p</mi><mi>k</mi><mo separator="true">,</mo><mi>n</mi><mo separator="true">,</mo><mi>B</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">sk, pk, n, BT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">BT</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">A \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Block-production-lottery</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>k</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">sk, n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>←</mo><mn>1</mn><mtext> </mtext><mtext mathvariant="bold">to</mtext><mtext> </mtext><mi>s</mi><msub><mi>c</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">s \leftarrow 1 ~\textbf{to}~ sc_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">1</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">to</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="ps-funcname">Wait-Until</span>(<span class="ps-funcname">Slot-Time</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>))</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>d</mi><mo separator="true">,</mo><mi>π</mi><mo stretchy="false">)</mo><mo>←</mo><mi>A</mi><mo stretchy="false">[</mo><mi>s</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">(d, \pi) \leftarrow A[s]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mopen">[</span><span class="mord mathnormal">s</span><span class="mclose">]</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>&lt;</mo><mi>τ</mi></mrow><annotation encoding="application/x-tex">d &lt; \tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">6:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>B</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">C_{Best} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">es</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Longest-Chain</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">BT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">BT</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>s</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">B_s \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Build-Block</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>B</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{Best}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">es</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">8:</span><span class="ps-funcname">Add-Digest-Item</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>s</mi></msub><mo separator="true">,</mo><mtext>Pre-Runtime</mtext><mo separator="true">,</mo><msub><mi>E</mi><mrow><mi>i</mi><mi>d</mi></mrow></msub><mo stretchy="false">(</mo><mtext>BABE</mtext><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>H</mi><mtext>BABE</mtext></msub><mo stretchy="false">(</mo><msub><mi>B</mi><mi>s</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B_s,\text{Pre-Runtime}, E_{id}(\text{BABE}), H_\text{BABE}(B_s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Pre-Runtime</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">BABE</span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">BABE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">9:</span><span class="ps-funcname">Add-Digest-Item</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>s</mi></msub><mo separator="true">,</mo><mtext>Seal</mtext><mo separator="true">,</mo><msub><mi>S</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">B_s, \text{Seal}, S_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Seal</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">10:</span><span class="ps-funcname">Broadcast-Block</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">B_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">11:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">12:</span><span class="ps-keyword">end for</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 9. <a href="#algo-block-production">Invoke-Block-Authoring</a></div>
          </div>
<div class="paragraph">
<p>where \$"BT"\$ is the current block tree, \$"Block-Production-Lottery"\$
is defined in <a href="#algo-block-production-lottery">Algorithm 6</a> and \$"Add-Digest-Item"\$
appends a digest item to the end of the header digest \$H_d(B)\$
(<a href="#defn-digest">Definition 11</a>).</p>
</div>
</div>
</div>
<div id="defn-block-signature" class="exampleblock">
<div class="title">Definition 70. <a href="#defn-block-signature">Block Signature</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Block Signature</strong> \$S_B\$ is a signature of the block header hash
(<a href="#defn-block-header-hash">Definition 12</a>) and defined as</p>
</div>
<div class="stemblock">
<div class="content">
\$"Sig"_("SR25519","sk"_j^s)(H_h(B))\$
</div>
</div>
<div class="paragraph">
<p>\$m\$ should be included in \$H_d(B)\$ as the Seal digest item
(<a href="#defn-digest">Definition 11</a>) of value:</p>
</div>
<div class="stemblock">
<div class="content">
\$(t, "id"("BABE"), m)\$
</div>
</div>
<div class="paragraph">
<p>in which, \$t = 5\$ is the seal digest identifier and \$"id"("BABE")\$ is the BABE consensus engine unique identifier
(<a href="#defn-digest">Definition 11</a>). The Seal digest item is referred to as the
<strong>BABE Seal</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-epoch-randomness"><a class="anchor" href="#sect-epoch-randomness"></a><a class="link" href="#sect-epoch-randomness">5.5. Epoch Randomness</a></h3>
<div class="paragraph">
<p>At the beginning of each epoch, \$cc E_n\$ the host will receive the
randomness seed \$cc R_(cc E_(n+1))\$ (<a href="#defn-epoch-randomness">Definition 71</a>)
necessary to participate in the block production lottery in the next epoch
\$cc E_(n+1)\$ from the Runtime, through the consensus message
(<a href="#defn-consensus-message-babe">Definition 58</a>) in the digest of the first block.</p>
</div>
<div id="defn-epoch-randomness" class="exampleblock">
<div class="title">Definition 71. <a href="#defn-epoch-randomness">Randomness Seed</a></div>
<div class="content">
<div class="paragraph">
<p>For epoch \$cc E\$, there is a 32-byte \$cc R_(cc E)\$ computed based on
the previous epochs VRF outputs. For \$cc E_0\$ and \$cc E_1\$, the
randomness seed is provided in the genesis state (<a href="#sect-rte-babeapi-epoch">Section C.11.1</a>).
For any further epochs, the randomness is retrieved from the consensus message
(<a href="#defn-consensus-message-babe">Definition 58</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-verifying-authorship"><a class="anchor" href="#sect-verifying-authorship"></a><a class="link" href="#sect-verifying-authorship">5.6. Verifying Authorship Right</a></h3>
<div class="paragraph">
<p>When a Polkadot node receives a produced block, it needs to verify if the block
producer was entitled to produce the block in the given slot by running
<a href="#algo-verify-authorship-right">Algorithm 10</a>. <a href="#algo-verify-slot-winner">Algorithm 11</a> runs as part of the verification process,
when a node is importing a block.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-verify-authorship-right" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 10 </span><span style="font-style:normal;font-variant:small-caps;">Verify-Authorship-Right</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>Head</mtext><mrow><mi>s</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">\text{Head}_{s(B)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0496em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord text"><span class="mord">Head</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">s \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Slot-Number-At-Given-Time</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">T_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">E</mi><mi>c</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{E}_c \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08944em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0894em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Current-Epoch</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>D</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>D</mi><mrow><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi></mrow></msub><mo stretchy="false">)</mo><mo>←</mo><msub><mi>H</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(D_1, \ldots, D_{|H_d(B)|}) \leftarrow H_d(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0813em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mclose mtight">)</span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>s</mi></msub><mo>←</mo><msub><mi>D</mi><mrow><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi></mrow></msub></mrow><annotation encoding="application/x-tex">D_s \leftarrow D_{|H_d(B)|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0813em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mclose mtight">)</span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo>←</mo><mrow><mo fence="true">(</mo><msub><mi>D</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>D</mi><mrow><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">H_d(B) \leftarrow \left(D_1, \ldots, D_{|H_d(B)| - 1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2052em;vertical-align:-0.3552em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0813em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mclose mtight">)</span><span class="mord mtight">∣</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><span class="ps-comment"> &#x2F;&#x2F; remove the seal from the digest</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mi>d</mi><mo separator="true">,</mo><msub><mtext>Sig</mtext><mi>B</mi></msub><mo stretchy="false">)</mo><mo>←</mo><msub><mtext>Dec</mtext><mrow><mi>S</mi><mi>C</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>D</mi><mi>s</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(id, \text{Sig}_B)\leftarrow \text{Dec}_{SC}(D_s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord text"><span class="mord">Sig</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2342em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">Dec</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">SC</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>d</mi><mo mathvariant="normal">≠</mo></mrow><annotation encoding="application/x-tex">id \neq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">Seal-Id</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">8:</span><span style="font-weight:bold;">error</span> ‘‘Seal missing&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">9:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">10:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AuthorID</mtext><mo>←</mo><msup><mtext>AuthorityDirectory</mtext><msub><mi mathvariant="script">E</mi><mi>c</mi></msub></msup><mo stretchy="false">[</mo><msub><mi>H</mi><mrow><mi>B</mi><mi>A</mi><mi>B</mi><mi>E</mi></mrow></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mtext>SingerIndex</mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{AuthorID} \leftarrow \text{AuthorityDirectory}^{\mathcal{E}_c}[H_{BABE}(B).\text{SingerIndex}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">AuthorID</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1757em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">AuthorityDirectory</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9257em;"><span style="top:-3.1473em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.08944em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0894em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">BE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mord">.</span><span class="mord text"><span class="mord">SingerIndex</span></span><span class="mclose">]</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="ps-funcname">Verify-Signature</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AuthorID</mtext><mo separator="true">,</mo><msub><mi>H</mi><mi>h</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mtext>Sig</mtext><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">\text{AuthorID}, H_h(B),\text{Sig}_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">AuthorID</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord text"><span class="mord">Sig</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2342em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">12:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∃</mi><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>∈</mo><mi>B</mi><mi>T</mi><mo>:</mo><msub><mi>H</mi><mi>h</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo mathvariant="normal">≠</mo><msub><mi>H</mi><mi>h</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\exists B&#x27; \in BT : H_h(B) \neq H_h (B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.791em;vertical-align:-0.0391em;"></span><span class="mord">∃</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">BT</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> <span class="ps-keyword">and</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>B</mi></msub><mo>=</mo><msubsup><mi>s</mi><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">s_B = s_B&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span></span></span></span> <span class="ps-keyword">and</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>SignerIndex</mtext><mi>B</mi></msub><mo>=</mo><msub><mtext>SignerIndex</mtext><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub></mrow><annotation encoding="application/x-tex">\text{SignerIndex}_B = \text{SignerIndex}_{B&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord text"><span class="mord">SignerIndex</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2342em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord text"><span class="mord">SignerIndex</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2342em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">13:</span><span style="font-weight:bold;">error</span> ‘‘Block producer is equivocating&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">14:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">15:</span><span class="ps-funcname">Verify-Slot-Winner</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>d</mi><mi>B</mi></msub><mo separator="true">,</mo><msub><mi>π</mi><mi>B</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>s</mi><mi>B</mi></msub><mo separator="true">,</mo><mtext>AuthorID</mtext></mrow><annotation encoding="application/x-tex">(d_B, \pi_B), s_B, \text{AuthorID}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">AuthorID</span></span></span></span></span>)</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 10. <a href="#algo-verify-authorship-right">Verify-Authorship-Right</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"Head"_s(B)\$ is the header of the block that&#8217;s being verified.</p>
</li>
<li>
<p>\$T_B\$ is \$B\$’s arrival time (<a href="#defn-block-time">Definition 67</a>).</p>
</li>
<li>
<p>\$H_d(B)\$ is the digest sub-component (<a href="#defn-digest">Definition 11</a>) of
\$"Head"(B)\$ (<a href="#defn-block-header">Definition 10</a>).</p>
</li>
<li>
<p>The Seal \$D_s\$ is the last element in the digest array \$H_d(B)\$ as
described in <a href="#defn-digest">Definition 11</a>.</p>
</li>
<li>
<p>\$"Seal-Id"\$ is the type index showing that a digest item (<a href="#defn-digest">Definition 11</a>)
of varying type (<a href="#defn-scale-variable-type">Definition 189</a>) is of type <em>Seal</em>.</p>
</li>
<li>
<p>\$"AuthorityDirectory"^(cc E_c)\$ is the set of Authority ID for block
producers of epoch \$cc E_c\$.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>\$"AuthorId"\$ is the public session key of the block producer.</p>
</li>
</ol>
</div>
</li>
<li>
<p>\$"BT"\$ is the pruned block tree (<a href="#defn-pruned-tree">Definition 5</a>).</p>
</li>
<li>
<p>\$"Verify-Slot-Winner"\$ is defined in <a href="#algo-verify-slot-winner">Algorithm 11</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-verify-slot-winner" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 11 </span><span style="font-style:normal;font-variant:small-caps;">Verify-Slot-Winner</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">E</mi><mi>c</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{E}_c \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08944em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0894em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">Current-Epoch</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">\rho \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ρ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Epoch-Randomness</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-funcname">Verify-VRF</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>B</mi><mi>A</mi><mi>B</mi><mi>E</mi></mrow></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><msub><mi>d</mi><mi>B</mi></msub><mo separator="true">,</mo><msub><mi>π</mi><mi>B</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>B</mi><mi>A</mi><mi>B</mi><mi>E</mi></mrow></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>s</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">\rho, H_{BABE}(B).(d_B, \pi_B), H_{BABE}(B).s, c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ρ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">BE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mord">.</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">BE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>B</mi></msub><mo>⩾</mo><mi>τ</mi></mrow><annotation encoding="application/x-tex">d_B \geqslant \tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span style="font-weight:bold;">error</span> ‘‘Block producer is not a winner of the slot&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 11. <a href="#algo-verify-slot-winner">Verify-Slot-Winner</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>\$"Epoch-Randomness"\$ is defined in <a href="#defn-epoch-randomness">Definition 71</a>.</p>
</li>
<li>
<p>\$H_"BABE"(B)\$ is the BABE header defined in <a href="#defn-babe-header">Definition 69</a>.</p>
</li>
<li>
<p>\$(o,p)\$ is the block lottery result for block \$B\$
(<a href="#algo-block-production-lottery">Algorithm 6</a>), respectively the VRF output
(<a href="#defn-babe-vrf-transcript">Definition 62</a>).</p>
</li>
<li>
<p>\$"Verify-VRF"\$ is described in <a href="#sect-vrf">Section A.1.3</a>.</p>
</li>
<li>
<p>\$T_(cc E_n)\$ is the winning threshold as defined in <a href="#defn-winning-threshold">Definition 60</a>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-block-building"><a class="anchor" href="#sect-block-building"></a><a class="link" href="#sect-block-building">5.7. Block Building Process</a></h3>
<div class="paragraph">
<p>The block building process is triggered by <a href="#algo-block-production">Algorithm 9</a> of the
consensus engine which in turn runs <a href="#algo-build-block">Algorithm 12</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-build-block" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 12 </span><span style="font-style:normal;font-variant:small-caps;">Build-Block</span></p>
<div class="ps-algorithmic with-linenum">
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>B</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">P_B \leftarrow </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span><span class="ps-funcname">Head</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>B</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{Best}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">es</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Head</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo>←</mo><mrow><mo fence="true">(</mo><msub><mi>H</mi><mi>p</mi></msub><mo>←</mo><msub><mi>H</mi><mi>h</mi></msub><mo stretchy="false">(</mo><msub><mi>P</mi><mi>B</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>H</mi><mi>i</mi></msub><mo>←</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>P</mi><mi>B</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>H</mi><mi>r</mi></msub><mo>←</mo><mi>ϕ</mi><mo separator="true">,</mo><msub><mi>H</mi><mi>e</mi></msub><mo>←</mo><mi>ϕ</mi><mo separator="true">,</mo><msub><mi>H</mi><mi>d</mi></msub><mo>←</mo><mi>ϕ</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Head}(B) \leftarrow \left(H_p \leftarrow H_h(P_B), H_i \leftarrow H_i(P_B) + 1, H_r \leftarrow \phi, H_e \leftarrow \phi, H_d \leftarrow \phi \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Head</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">ϕ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">ϕ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">ϕ</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">Core_initialize_block</mtext><mo separator="true">,</mo><mtext>Head</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\texttt{Core\_initialize\_block}, \text{Head}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord texttt">Core_initialize_block</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Head</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span style="font-style:normal;font-variant:small-caps;">I-D</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo></mrow><annotation encoding="application/x-tex"> \leftarrow </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span></span></span></span><span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">BlockBuilder_inherent_extrinsics</mtext><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">\texttt{BlockBuilder\_inherent\_extrinsics}, </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8055em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord texttt">BlockBuilder_inherent_extrinsics</span></span><span class="mpunct">,</span></span></span></span><span style="font-style:normal;font-variant:small-caps;">Inherent-Data</span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mtext> </mtext><mtext mathvariant="bold">in</mtext></mrow><annotation encoding="application/x-tex">E~\textbf{in} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord textbf">in</span></span></span></span></span><span style="font-style:normal;font-variant:small-caps;">I-D</span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">BlockBuilder_apply_extrinsics</mtext><mo separator="true">,</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">\texttt{BlockBuilder\_apply\_extrinsics}, E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9055em;vertical-align:-0.2222em;"></span><span class="mord text"><span class="mord texttt">BlockBuilder_apply_extrinsics</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">8:</span><span class="ps-keyword">while </span><span class="ps-keyword">not</span> <span class="ps-funcname">End-Of-Slot</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>)<span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">9:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">E \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Next-Ready-Extrinsic</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">10:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">R \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">BlockBuilder_apply_extrinsics</mtext><mo separator="true">,</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">\texttt{BlockBuilder\_apply\_extrinsics}, E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9055em;vertical-align:-0.2222em;"></span><span class="mord text"><span class="mord texttt">BlockBuilder_apply_extrinsics</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">11:</span><span class="ps-keyword">if </span><span class="ps-funcname">Block-Is-Full</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>)<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">12:</span><span class="ps-keyword">break</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">13:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">14:</span><span class="ps-keyword">if </span><span class="ps-funcname">Should-Drop</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>)<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">15:</span><span class="ps-funcname">Drop</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">16:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">17:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Head</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo>←</mo></mrow><annotation encoding="application/x-tex">\text{Head}(B) \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Head</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Call-Runtime-Entry</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">BlockBuilder_finalize_block</mtext><mo separator="true">,</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">\texttt{BlockBuilder\_finalize\_block}, B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord texttt">BlockBuilder_finalize_block</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">18:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">B \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Add-Seal</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">19:</span><span class="ps-keyword">end while</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 12. <a href="#algo-build-block">Build-Block</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$C_"Best"\$ is the chain head at which the block should be constructed
("parent").</p>
</li>
<li>
<p>\$s\$ is the slot number.</p>
</li>
<li>
<p>\$"Head"(B)\$ is defined in <a href="#defn-block-header">Definition 10</a>.</p>
</li>
<li>
<p>\$"Call-Runtime-Entry"\$ is defined in <a href="#defn-call-into-runtime">Definition 32</a>.</p>
</li>
<li>
<p>\$"Inherent-Data"\$ is defined in <a href="#defn-inherent-data">Definition 15</a>.</p>
</li>
<li>
<p>\$"End-Of-Slot"\$ indicates the end of the BABE slot as defined
<a href="#algo-slot-time">Algorithm 8</a> respectively <a href="#defn-epoch-slot">Definition 54</a>.</p>
</li>
<li>
<p>\$"Next-Ready-Extrinsic"\$ indicates picking an extrinsic from the
extrinsics queue (<a href="#defn-transaction-queue">Definition 14</a>).</p>
</li>
<li>
<p>\$"Block-Is-Full"\$ indicates that the maximum block size is being used.</p>
</li>
<li>
<p>\$"Should-Drop"\$ determines based on the result \$R\$ whether the
extrinsic should be dropped or remain in the extrinsics queue and scheduled for
the next block. The <em>ApplyExtrinsicResult</em> (<a href="#defn-rte-apply-extrinsic-result">Definition 217</a>)
describes this behavior in more detail.</p>
</li>
<li>
<p>\$"Drop"\$ indicates removing the extrinsic from the extrinsic queue
(<a href="#defn-transaction-queue">Definition 14</a>).</p>
</li>
<li>
<p>\$"Add-Seal"\$ adds the seal to the block (&lt;&lt;&gt;&gt;) before sending it to
peers. The seal is removed again before submitting it to the Runtime.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-finality"><a class="anchor" href="#sect-finality"></a><a class="link" href="#sect-finality">6. Finality</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="id-introduction-4"><a class="anchor" href="#id-introduction-4"></a><a class="link" href="#id-introduction-4">6.1. Introduction</a></h3>
<div class="paragraph">
<p>The Polkadot Host uses GRANDPA Finality protocol to finalize blocks.
Finality is obtained by consecutive rounds of voting by the validator
nodes. Validators execute GRANDPA finality process in parallel to Block
Production as an independent service. In this section, we describe the
different functions that GRANDPA service performs to successfully
participate in the block-finalization process.</p>
</div>
<div id="defn-grandpa-voter" class="exampleblock">
<div class="title">Definition 72. <a href="#defn-grandpa-voter">GRANDPA Voter</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA Voter</strong>,
\$v\$, represented by a key pair
\$(K_v^("pr"),v_("id"))\$
where \$k_v^("pr")\$ represents an
<em>ed25519</em> private key, is a
node running a GRANDPA protocol and broadcasting votes to finalize
blocks in a Polkadot Host-based chain. The <strong>set of all GRANDPA voters</strong>
for a given block B is indicated by \$bbb V_B\$. In that
regard, we have [To do: change function name, only call at genesis,
adjust V_B over the sections]</p>
</div>
<div class="stemblock">
<div class="content">
\$bbb V = tt "grandpa_authorities"(B)\$
</div>
</div>
<div class="paragraph">
<p>where \$tt "grandpa_authorities"\$ is a function entrypoint of the Runtime
described in <a href="#sect-rte-grandpa-auth">Section C.10.1</a>. We refer to \$bbb V_B\$ as
\$bbb V\$ when there is no chance of ambiguity.</p>
</div>
<div class="paragraph">
<p>Analogously we say that a Polkadot node is a <strong>non-voter node</strong> for block
\$B\$, if it does not own any of the key pairs in
\$bbb V_B\$.</p>
</div>
</div>
</div>
<div id="defn-authority-set-id" class="exampleblock">
<div class="title">Definition 73. <a href="#defn-authority-set-id">Authority Set Id</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>authority set Id</strong> (\$"id"_(bbb V)\$) is an incremental counter which
tracks the amount of authority list changes that occurred
(<a href="#defn-consensus-message-grandpa">Definition 86</a>). Starting with the value of zero at genesis,
the Polkadot Host increments this value by one every time a <strong>Scheduled Change</strong>
or a <strong>Forced Change</strong> occurs. The authority set Id is an unsigned 64-bit integer.</p>
</div>
</div>
</div>
<div id="defn-grandpa-state" class="exampleblock">
<div class="title">Definition 74. <a href="#defn-grandpa-state">GRANDPA State</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>GRANDPA state</strong>, \$"GS"\$, is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"GS" := {bbb V, "id"_(bbb V),r}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$bbb V\$: is the set of voters.</p>
</li>
<li>
<p>\$"id"_(bbb V)\$: is the authority set ID (<a href="#defn-authority-set-id">Definition 73</a>).</p>
</li>
<li>
<p>\$r\$: is the voting round number.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-vote" class="exampleblock">
<div class="title">Definition 75. <a href="#defn-vote">GRANDPA Vote</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>GRANDPA vote</strong> or simply a vote for block \$B\$ is an ordered pair defined
as</p>
</div>
<div class="stemblock">
<div class="content">
\$V(B) := (H_h(B),H_i(B))\$
</div>
</div>
<div class="paragraph">
<p>where \$H_h(B)\$ and \$H_i (B)\$ are the block hash
(<a href="#defn-block-header-hash">Definition 12</a>) and the block number (<a href="#defn-block-header">Definition 10</a>).</p>
</div>
</div>
</div>
<div id="defn-voting-rounds" class="exampleblock">
<div class="title">Definition 76. <a href="#defn-voting-rounds">Voting Rounds</a></div>
<div class="content">
<div class="paragraph">
<p>Voters engage in a maximum of two sub-rounds of voting for each round \$r\$.
The first sub-round is called <strong>pre-vote</strong> and the second sub-round is called
<strong>pre-commit</strong>.</p>
</div>
<div class="paragraph">
<p>By \$V_v^(r,"pv")\$ and \$V_v^(r,"pc")\$ we refer to the vote cast by
voter \$v\$ in round \$r\$ (for block \$B\$) during the pre-vote and
the pre-commit sub-round respectively.</p>
</div>
<div class="paragraph">
<p>Voting is done by means of broadcasting voting messages (<a href="#sect-msg-grandpa">Section 4.8.6</a>)
to the network. Validators inform their peers about the block finalized in round
\$r\$ by broadcasting a commit message (<a href="#algo-grandpa-round">Algorithm 14</a>).</p>
</div>
</div>
</div>
<div id="defn-sign-round-vote" class="exampleblock">
<div class="title">Definition 77. <a href="#defn-sign-round-vote">Vote Signature</a></div>
<div class="content">
<div class="paragraph">
<p>\$"Sign"_(v_i)^(r,"stage")\$ refers to the signature of a voter for a specific
message in a round and is formally defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Sign"_(v_i)^(r,"stage") := "Sig"_("ed25519")("msg",r,"id"_(bbb V))\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"msg"\$: is an byte array containing the message to be signed
(<a href="#defn-vote">Definition 75</a>).</p>
</li>
<li>
<p>\$r\$: is an unsigned 64-bit integer is the round number.</p>
</li>
<li>
<p>\$"id"_(bbb V)\$: is an unsigned 64-bit integer indicating the authority
set Id (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-grandpa-justification" class="exampleblock">
<div class="title">Definition 78. <a href="#defn-grandpa-justification">Justification</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>justification</strong> for block \$B\$ in round \$r\$,
\$J^(r,"stage")(B)\$, is a vector of pairs of the type:</p>
</div>
<div class="stemblock">
<div class="content">
\$(V(B'),"Sign"_(v_i)^(r,"stage")(B'),v_("id"))\$
</div>
</div>
<div class="paragraph">
<p>in which either</p>
</div>
<div class="stemblock">
<div class="content">
\$B' &gt;= B\$
</div>
</div>
<div class="paragraph">
<p>or \$V_(v_i)^(r,"pc")(B')\$ is an equivocatory vote.</p>
</div>
<div class="paragraph">
<p>In all cases, \$"Sign"_(v_i)^(r,"stage")(B')\$ is the signature
(<a href="#defn-sign-round-vote">Definition 77</a>) of voter \$v_("id") in bbb V_B\$ broadcasted during
either the pre-vote (stage = pv) or the pre-commit (stage = pc) sub-round of
round r. A <strong>valid justification</strong> must only contain up-to-one valid vote from
each voter and must not contain more than two equivocatory votes from each
voter.</p>
</div>
</div>
</div>
<div id="defn-finalizing-justification" class="exampleblock">
<div class="title">Definition 79. <a href="#defn-finalizing-justification">Finalizing Justification</a></div>
<div class="content">
<div class="paragraph">
<p>We say \$J^(r,"pc")(B)\$ <strong>justifies the finalization</strong> of \$B' &gt;= B\$ <strong>for
a non-voter node</strong> \$n\$ if the number of valid signatures in
\$J^(r,"pc")(B)\$ for \$B'\$ is greater than \$2/3|bbb V_B|\$.</p>
</div>
<div class="paragraph">
<p>Note that \$J^(r,"pc")(B)\$ can only be used by a non-voter node to finalize
a block. In contrast, a voter node can only be assured of the finality
(<a href="#defn-finalized-block">Definition 90</a>) of block \$B\$ by actively participating in the
voting process. That is by invoking <a href="#algo-grandpa-round">Algorithm 14</a>.</p>
</div>
<div class="paragraph">
<p>The GRANDPA protocol dictates how an honest voter should vote in each sub-round,
which is described by <a href="#algo-grandpa-round">Algorithm 14</a>. After
defining what constitutes a vote in GRANDPA, we define how GRANDPA counts votes.</p>
</div>
</div>
</div>
<div id="defn-equivocation" class="exampleblock">
<div class="title">Definition 80. <a href="#defn-equivocation">Equivocation</a></div>
<div class="content">
<div class="paragraph">
<p>Voter \$v\$ <strong>equivocates</strong> if they broadcast two or more valid votes to blocks
during one voting sub-round. In such a situation, we say that \$v\$ is an
<strong>equivocator</strong> and any vote \$V_v^(r,"stage")(B)\$ cast by \$v\$ in that
sub-round is an <strong>equivocatory vote</strong>, and</p>
</div>
<div class="stemblock">
<div class="content">
\$cc E^(r,"stage")\$
</div>
</div>
<div class="paragraph">
<p>represents the set of all equivocators voters in sub-round <em>stage</em> of
round \$r\$. When we want to refer to the number of equivocators whose
equivocation has been observed by voter \$v\$ we refer to it by:</p>
</div>
<div class="stemblock">
<div class="content">
\$cc E_("obs"(v))^(r,"stage")\$
</div>
</div>
<div class="paragraph">
<p>The Polkadot Host must detect equivocations committed by other validators and
submit those to the Runtime as described in
<a href="#sect-grandpaapi_submit_report_equivocation_unsigned_extrinsic">Section C.10.2</a>.</p>
</div>
<div class="paragraph">
<p>A vote \$V_v^(r,"stage") = V(B)\$ is <strong>invalid</strong> if</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$H (B)\$ does not correspond to a valid block.</p>
</li>
<li>
<p>\$B\$ is not an (eventual) descendant of a previously finalized block.</p>
</li>
<li>
<p>\$M_v^(r,"stage")\$ does not bear a valid signature.</p>
</li>
<li>
<p>\$"id"_(bbb V)\$ does no match the current \$bbb V\$.</p>
</li>
<li>
<p>\$V_v^(r,"stage")\$ is an equivocatory vote.</p>
</li>
</ul>
</div>
</div>
</div>
<div id="defn-observed-direct-votes" class="exampleblock">
<div class="title">Definition 81. <a href="#defn-observed-direct-votes">Set of Observed Direct Votes</a></div>
<div class="content">
<div class="paragraph">
<p>For validator \$v\$, <strong>the set of observed direct votes for Block \$B\$ in
round \$r\$</strong>, formally denoted by \$"VD"_("obs"(v))^(r,"stage")(B)\$ is
equal to the union of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set of <em>valid</em> votes \$V_(v_i)^(r,"stage")\$ cast in round \$r\$ and
received by \$v\$ such that \$V_(v_i)^(r,"stage") = V(B)\$.</p>
</li>
</ul>
</div>
</div>
</div>
<div id="defn-observed-votes" class="exampleblock">
<div class="title">Definition 82. <a href="#defn-observed-votes">Set of Total Observed Votes</a></div>
<div class="content">
<div class="paragraph">
<p>We refer to <strong>the set of total votes observed by voter \$v\$ in sub-round
<em>stage</em> of round \$r\$</strong> by \$V_("obs"(v))^(r,"stage")\$.</p>
</div>
<div class="paragraph">
<p>The <strong>set of all observed votes by \$v\$ in the sub-round stage of round
\$r\$ for block \$B\$</strong>, <strong>\$V_("obs"(v))^(r,"stage")\$</strong> is equal to all
of the observed direct votes cast for block \$B\$ and all of the \$B\$’s
descendants defined formally as:</p>
</div>
<div class="stemblock">
<div class="content">
\$V_("obs"(v))^(r,"stage")(B) := uuu_(v_i in bbb V, B &lt; B') "VD"_("obs"(v))^(r,"stage")(B')\$
</div>
</div>
<div class="paragraph">
<p>The <strong>total number of observed votes for Block \$B\$ in round \$r\$</strong> is
defined to be the size of that set plus the total number of equivocator voters:</p>
</div>
<div class="stemblock">
<div class="content">
\$#V_("obs"(v))^(r,"stage")(B) := |V_("obs"(v))^(r,"stage")(B)|+|cc E_("obs"(v))^(r,"stage")|\$
</div>
</div>
<div class="paragraph">
<p>Note that for genesis state we always have
\$#V_("obs"(v))^(r,"pv")(B) = |bbb V|\$.</p>
</div>
</div>
</div>
<div id="defn-total-potential-votes" class="exampleblock">
<div class="title">Definition 83. <a href="#defn-total-potential-votes">Set of Total Potential Votes</a></div>
<div class="content">
<div class="paragraph">
<p>Let \$V_("unobs"(v))^(r,"stage")\$ be the set of voters whose vote in the
given stage has not been received. We define the <strong>total number of potential
votes for Block \$B\$ in round \$r\$</strong> to be:</p>
</div>
<div class="stemblock">
<div class="content">
\$#V_("obs"(v),"pot")^(r,"stage")(B) := |V_("obs"(v))^(r,"stage")(B)|+|V_("unobs"(v))^(r,"stage")|+"Min"(1/3|bbb V|,|bbb V|-|V_("obs"(v))^(r,"stage")(B)|-|V_("unobs"(v))^(r,"stage")|)\$
</div>
</div>
</div>
</div>
<div id="defn-grandpa-ghost" class="exampleblock">
<div class="title">Definition 84. <a href="#defn-grandpa-ghost">Current Pre-Voted Block</a></div>
<div class="content">
<div class="paragraph">
<p>The current <strong>pre-voted</strong> block \$B_v^(r,"pv")\$ also know as GRANDPA GHOST is
the block chosen by <a href="#algo-grandpa-ghost">Algorithm 17</a>:</p>
</div>
<div class="stemblock">
<div class="content">
\$B_v^(r,"pv") := "GRANDPA-GHOST"(r)\$
</div>
</div>
<div class="paragraph">
<p>Finally, we define when a voter \$v\$ sees a round as completable, that is
when they are confident that \$B_v^(r,"pv")\$ is an upper bound for what is
going to be finalized in this round.</p>
</div>
</div>
</div>
<div id="defn-grandpa-completable" class="exampleblock">
<div class="title">Definition 85. <a href="#defn-grandpa-completable">Completable Round</a></div>
<div class="content">
<div class="paragraph">
<p>We say that
round \$r\$ is <strong>completable</strong> if
\$|V_("obs"(v))^(r,"pc")|+ cc E_("obs"(v))^(r,"pc") &gt; 2/3 bbb V\$
and for all \$B' &gt; B_v^(r,"pv")\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$|V_("obs"(v))^(r,"pc")|- cc E_("obs"(v))^(r,"pc") - |V_("obs"(v))^(r,"pc")(B')|&gt; 2/3|bbb V|\$
</div>
</div>
<div class="paragraph">
<p>Note that in practice we only need to check the inequality for those \$B' &gt;
B_v^(r,"pv")\$ where \$|V_("obs"(v))^(r,"pc")(B')| &gt; 0\$.</p>
</div>
</div>
</div>
<div id="defn-consensus-message-grandpa" class="exampleblock">
<div class="title">Definition 86. <a href="#defn-consensus-message-babe">GRANDPA Consensus Message</a></div>
<div class="content">
<div class="paragraph">
<p>\$"CM"_g\$, the consensus message for GRANDPA, is of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$"CM"_g = {(1,("Auth"_C,N_("delay"))),(2,(m,"Auth"_C,N_("delay"))),(3,"A"_i),(4,N_("delay")),(5,N_("delay")):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
</dl>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
\$N_"delay"\$
</td>
<td class="hdlist2">
<p>is an unsigned 32-bit integer indicating how deep in the
chain the announcing block must be before the change is applied.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
1
</td>
<td class="hdlist2">
<p>implies <strong>scheduled change</strong>: Schedule an authority set change after the
given delay of \$N_("delay") := |"SubChain"(B,B')|\$ where \$B'\$ is the
block where the change is applied. The earliest digest of this type in a
single block will be respected, unless a force change is present, in which case
the force change takes precedence.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
2
</td>
<td class="hdlist2">
<p>implies <strong>forced change</strong>: Schedule a forced authority set change after the
given delay of \$N_("delay") := |"SubChain"(B,m + B')|\$ where \$B'\$ is
the block where the change is applied. The earliest digest
of this type in a block will be respected.</p>
<div class="paragraph">
<p>Forced changes are explained further in <a href="#sect-finality-forced-changes">Section 6.5</a>.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
3
</td>
<td class="hdlist2">
<p>implies <strong>on disabled</strong>: An index to the individual authority in the current
authority list (<a href="#defn-authority-list">Definition 33</a>) that should be immediately disabled
until the next authority set changes. When an authority gets disabled, the node
should stop performing any authority functionality from that authority,
including authoring blocks and casting GRANDPA votes for finalization.
Similarly, other nodes should ignore all messages from the indicated authority
which pertain to their authority role.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
4
</td>
<td class="hdlist2">
<p>implies <strong>pause</strong>: A signal to pause the current authority set after the
given delay of \$N_("delay") := |"SubChain"(B,B')|\$ where \$B'\$ is a
block where the change is applied. Once applied, the authorities should stop
voting.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
5
</td>
<td class="hdlist2">
<p>implies <strong>resume</strong>: A signal to resume the current authority set after the
given delay of \$N_("delay") := |"SubChain"(B,B')|\$ where \$B'\$ is the
block where the change is applied. Once applied, the authorities should resume
voting.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="defn-consensus-message-beefy" class="exampleblock">
<div class="title">Definition 87. <a href="#defn-consensus-message-beefy">BEEFY Consensus Message</a></div>
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The BEEFY protocol is still under construction. The following part will be
updated in the future and certain information will be clarified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>\$"CM"_y\$, the consensus message for BEEFY (<a href="#sect-grandpa-beefy">Section 6.7</a>), is of
the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$"CM"_y = {(1,(V_B,V_i)),(2,A_i),(3,R):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
</dl>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
1
</td>
<td class="hdlist2">
<p>implies that the remote <strong>authorities have changed</strong>. \$V_B\$ is the
array of the new BEEFY authorities&#8217;s public keys and \$V_i\$ is the
identifier of the remote validator set.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
2
</td>
<td class="hdlist2">
<p>implies <strong>on disabled</strong>: an index to the individual authorty in \$V_B\$
that should be immediately disabled until the next authority change.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
3
</td>
<td class="hdlist2">
<p>implies <strong>MMR root</strong>: a 32-byte array containing the MMR root.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-initiating-the-grandpa-state"><a class="anchor" href="#id-initiating-the-grandpa-state"></a><a class="link" href="#id-initiating-the-grandpa-state">6.2. Initiating the GRANDPA State</a></h3>
<div class="paragraph">
<p>In order to participate coherently in the voting process, a validator must
initiate its state and sync it with other active validators. In particular,
considering that voting is happening in different distinct rounds where each
round of voting is assigned a unique sequential round number \$r_v\$, it
needs to determine and set its round counter \$r\$ equal to the voting round
\$r_n\$ currently undergoing in the network. The mandated initialization
procedure for the GRANDPA protocol for a joining validator is described in
detail in <a href="#algo-initiate-grandpa">Algorithm 13</a>.</p>
</div>
<div class="paragraph">
<p>The process of joining a new voter set is different from the one of rejoining
the current voter set after a network disconnect. The details of this
distinction are described further in this section.</p>
</div>
<div class="sect3">
<h4 id="id-voter-set-changes"><a class="anchor" href="#id-voter-set-changes"></a><a class="link" href="#id-voter-set-changes">6.2.1. Voter Set Changes</a></h4>
<div class="paragraph">
<p>A GRANDPA voter node which is initiating GRANDPA protocol as part of joining a
new authority set is required to execute <a href="#algo-initiate-grandpa">Algorithm 13</a>. The
algorithm mandates the initialization procedure for GRANDPA protocol.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The GRANDPA round number reset to 0 for every authority set change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Voter set changes are signaled by Runtime via a consensus engine message
(<a href="#sect-consensus-message-digest">Section 3.3.2</a>). When Authorities process such messages they
must not vote on any block with a higher number than the block at which the
change is supposed to happen. The new authority set should reinitiate GRANDPA
protocol by executing <a href="#algo-initiate-grandpa">Algorithm 13</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-initiate-grandpa" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 13 </span><span style="font-style:normal;font-variant:small-caps;">Initiate-Grandpa</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>B</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">r_{last}, B_{last}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span style="font-style:normal;font-variant:small-caps;">Last-Finalized-Block</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo><msub><mi>B</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\leftarrow B_{last}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span style="font-style:normal;font-variant:small-caps;">Best-Final-Candidate</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>←</mo><msub><mi>B</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">(0) \leftarrow B_{last}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span style="font-style:normal;font-variant:small-caps;">GRANDPA-GHOST</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>←</mo><msub><mi>B</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">(0) \leftarrow B_{last}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span style="font-style:normal;font-variant:small-caps;">Last-Completed-Round</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo><mn>0</mn></mrow><annotation encoding="application/x-tex"> \leftarrow 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>n</mi></msub><mo>←</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r_n \leftarrow 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-funcname">Play-Grandpa-round</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">r_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 13. <a href="#algo-initiate-grandpa">Initiate-Grandpa</a></div>
          </div>
<div class="paragraph">
<p>where \$B_("last")\$ is the last block which has been finalized on the chain
(<a href="#defn-finalized-block">Definition 90</a>). \$r_("last")\$ is equal to the latest round the
voter has observed that other voters are voting on. The voter obtains this
information through various gossiped messages including those mentioned in
<a href="#defn-finalized-block">Definition 90</a>. \$r_("last")\$ is set to <em>0</em> if the GRANDPA node is
initiating the GRANDPA voting process as a part of a new authority set. This is
because the GRANDPA round number resets to <em>0</em> for every authority set change.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-rejoining-the-same-voter-set"><a class="anchor" href="#id-rejoining-the-same-voter-set"></a><a class="link" href="#id-rejoining-the-same-voter-set">6.3. Rejoining the Same Voter Set</a></h3>
<div class="paragraph">
<p>When a voter node rejoins the network after a disconnect from the voter set and
with the condition that there has been no change to the voter set at the time of
the disconnect, the node must continue performing the GRANDPA protocol at the
same state as before getting disconnected from the network, ignoring any
possible progress in GRANDPA finalization. Following reconnection, the node
eventually gets updated to the current GRANDPA round and synchronizes its state
with the rest of the voting set through the process called Catchup
(<a href="#sect-grandpa-catchup">Section 6.6.1</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="id-voting-process-in-round-r"><a class="anchor" href="#id-voting-process-in-round-r"></a><a class="link" href="#id-voting-process-in-round-r">6.4. Voting Process in Round \$r\$</a></h3>
<div class="paragraph">
<p>For each round \$r\$, an honest voter \$v\$ must participate in the voting
process by following <a href="#algo-grandpa-round">Algorithm 14</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-grandpa-round" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 14 </span><span style="font-style:normal;font-variant:small-caps;">Play-Grandpa-Round</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>v</mi></mrow></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">t_{r, v} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> Current local time</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>primary</mtext><mo>←</mo></mrow><annotation encoding="application/x-tex">\textrm{primary} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textrm">primary</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Derive-Primary</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><mtext>primary</mtext></mrow><annotation encoding="application/x-tex">v = \textrm{primary}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8623em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textrm">primary</span></span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="ps-funcname">Broadcast</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mi>v</mi><mrow><mi>r</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mtext>Fin</mtext></mrow></msubsup><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">M_{v}^{r - 1, \textrm{Fin}}(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">Fin</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span></span></span></span><span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="ps-keyword">if </span><span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⩾</mo></mrow><annotation encoding="application/x-tex">\geqslant</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mrel amsrm">⩾</span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">Last-Finalized-Block</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">6:</span><span class="ps-funcname">Broadcast</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mi>v</mi><mrow><mi>r</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mtext>Prim</mtext></mrow></msubsup><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">M_{v}^{r - 1, \textrm{Prim}}(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">Prim</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span></span></span></span><span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">7:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">8:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">9:</span><span class="ps-funcname">Receive-Messages</span>(<span style="font-weight:bold;">until</span> Time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⩾</mo><msub><mi>t</mi><mrow><msub><mi>r</mi><mo separator="true">,</mo></msub><mi>v</mi></mrow></msub><mo>+</mo><mn>2</mn><mo>×</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">\geqslant t_{r_,v} + 2 \times T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9624em;vertical-align:-0.3473em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.0676em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mpunct mtight">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3473em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> <span class="ps-keyword">or</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> <span style="font-weight:bold;">is</span> completable)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">10:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">L \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">N \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Best-PreVote-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">12:</span><span class="ps-funcname">Broadcast</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mtext>pv</mtext></mrow></msubsup><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_v^{r, \textrm{pv}} (N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">pv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">13:</span><span class="ps-funcname">Receive-Messages</span>(<span style="font-weight:bold;">until</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mtext>pv</mtext></mrow></msubsup><mo>⩾</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">B^{r,\textrm{pv}}_v \geqslant L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">pv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> <span class="ps-keyword">and</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span></span></span></span> Time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⩾</mo><msub><mi>t</mi><mrow><msub><mi>r</mi><mo separator="true">,</mo></msub><mi>v</mi></mrow></msub><mo>+</mo><mn>4</mn><mo>×</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">\geqslant t_{r_,v} + 4 \times T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9624em;vertical-align:-0.3473em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.0676em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mpunct mtight">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3473em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> <span class="ps-keyword">or</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> <span style="font-weight:bold;">is</span> completable <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">14:</span><span class="ps-funcname">Broadcast</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mtext>pc</mtext></mrow></msubsup><mo stretchy="false">(</mo><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mtext>pv</mtext></mrow></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_v^{r, \textrm{pc}}(B_v^{r, \textrm{pv}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">pc</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">pv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">15:</span><span class="ps-keyword">repeat</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">16:</span><span class="ps-funcname">Receive-Messages</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">17:</span><span class="ps-funcname">Attempt-To-Finalize-At-Round</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">18:</span><span class="ps-keyword">until </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> <span style="font-weight:bold;">is</span> completable <span class="ps-keyword">and</span> <span class="ps-funcname">Finalizable</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>) <span class="ps-keyword">and</span> <span style="font-style:normal;font-variant:small-caps;">Last-Finalized-Block</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⩾</mo></mrow><annotation encoding="application/x-tex">\geqslant</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mrel amsrm">⩾</span></span></span></span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">19:</span><span class="ps-funcname">Play-Grandpa-round</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">20:</span><span class="ps-keyword">repeat</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">21:</span><span class="ps-funcname">Receive-Messages</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">22:</span><span class="ps-funcname">Attempt-To-Finalize-At-Round</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">23:</span><span class="ps-keyword">until </span><span style="font-style:normal;font-variant:small-caps;">Last-Finalized-Block</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⩾</mo></mrow><annotation encoding="application/x-tex">\geqslant</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mrel amsrm">⩾</span></span></span></span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">24:</span><span class="ps-keyword">if </span><span style="font-style:normal;font-variant:small-caps;">Last-Completed-Round</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>r</mi></mrow><annotation encoding="application/x-tex"> &lt; r </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">25:</span><span style="font-style:normal;font-variant:small-caps;">Last-Completed-Round</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">\leftarrow r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">26:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 14. <a href="#algo-grandpa-round">Play-Grandpa-Round</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$T\$ is sampled from a log-normal distribution whose mean and standard
deviation are equal to the average network delay for a message to be sent and
received from one validator to another.</p>
</li>
<li>
<p>\$"Derive-Primary"\$ is described in <a href="#algo-derive-primary">Algorithm 15</a>.</p>
</li>
<li>
<p>The condition of <em>completablitiy</em> is defined in <a href="#defn-grandpa-completable">Definition 85</a>.</p>
</li>
<li>
<p>\$"Best-Final-Candidate"\$ function is explained in <a href="#algo-grandpa-best-candidate">Algorithm 16</a>.</p>
</li>
<li>
<p>\$"Attempt-To-Finalize-At-Round"(r)\$ is described in <a href="#algo-attempt-to–finalize">Algorithm 19</a>.</p>
</li>
<li>
<p>\$"Finalizable"\$ is defined in <a href="#algo-finalizable">Algorithm 20</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-derive-primary" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 15 </span><span style="font-style:normal;font-variant:small-caps;">Derive-Primary</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi mathvariant="normal">∣</mi><mi mathvariant="double-struck">V</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">r \bmod |\mathbb{V}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathbb">V</span><span class="mord">∣</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 15. <a href="#algo-derive-primary">Derive-Primary</a></div>
          </div>
<div class="paragraph">
<p>where \$r\$ is the GRANDPA round whose primary is to be determined.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-grandpa-best-candidate" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 16 </span><span style="font-style:normal;font-variant:small-caps;">Best-Final-Candidate</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup><mo>←</mo></mrow><annotation encoding="application/x-tex">B_v^{r, pv} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">GRANDPA-GHOST</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">r = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">B_v^{r, pv}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">C</mi><mo>←</mo><mo stretchy="false">{</mo><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>⩽</mo><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup><mi mathvariant="normal">∣</mi><mi mathvariant="normal">#</mi><msubsup><mi>V</mi><mrow><mi mathvariant="normal">obv</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>p</mi><mi>o</mi><mi>t</mi></mrow><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>c</mi></mrow></msubsup><mo stretchy="false">(</mo><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo>&gt;</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mi mathvariant="normal">∣</mi><mi mathvariant="double-struck">V</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{C} \leftarrow \{ B&#x27; | B&#x27; \leqslant B_v^{r,pv} | \#V^{r, pc}_{\operatorname{obv}(v), pot}(B&#x27;) &gt; \frac{2}{3} |\mathbb{V}| \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.05834em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2975em;vertical-align:-0.5152em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">∣#</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3598em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">obv</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5152em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">∣</span><span class="mord mathbb">V</span><span class="mord">∣</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">C</mi><mo>=</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\mathcal{C} = \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.05834em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">B_v^{r, pv}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">8:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">9:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>∈</mo><mi mathvariant="script">C</mi><mo>:</mo><msub><mi>H</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">max</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>H</mi><mi>n</mi></msub><mo stretchy="false">(</mo><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>∈</mo><mi mathvariant="script">C</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">E \in \mathcal{C} : H_n (E) = \operatorname{max}\left(H_n (B&#x27;) | B&#x27; \in \mathcal{C}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.05834em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">max</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathcal" style="margin-right:0.05834em;">C</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">10:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 16. <a href="#algo-grandpa-best-candidate">Best-Final-Candidate</a></div>
          </div>
<div class="paragraph">
<p>where \$#V_("obv"(v),pot)^(r,pc)\$ is defined in <a href="#defn-total-potential-votes">Definition 83</a>.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-grandpa-ghost" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 17 </span><span style="font-style:normal;font-variant:small-caps;">GRANDPA-GHOST</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">r = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>←</mo><msub><mi>B</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">G \leftarrow B_{last}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">L \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">G</mi><mo>=</mo><mo stretchy="false">{</mo><mi mathvariant="normal">∀</mi><mi>B</mi><mo>&gt;</mo><mi>L</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">#</mi><msubsup><mi>V</mi><mrow><mi mathvariant="normal">obs</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo>⩾</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mi mathvariant="normal">∣</mi><mi mathvariant="double-struck">V</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{G} = \{ \forall B &gt; L | \#V_{\operatorname{obs}(v)}^{r, pv}(B) \geqslant \frac{2}{3} |\mathbb{V}| \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7805em;vertical-align:-0.0972em;"></span><span class="mord mathcal" style="margin-right:0.0593em;">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">∀</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2975em;vertical-align:-0.5152em;"></span><span class="mord mathnormal">L</span><span class="mord">∣#</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3598em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">obs</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5152em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">∣</span><span class="mord mathbb">V</span><span class="mord">∣</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">G</mi><mo>=</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\mathcal{G} = \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7805em;vertical-align:-0.0972em;"></span><span class="mord mathcal" style="margin-right:0.0593em;">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>←</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">G \leftarrow L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">8:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">9:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>∈</mo><mi mathvariant="script">G</mi><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">max</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>H</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∀</mi><mi>B</mi><mo>∈</mo><mi mathvariant="script">G</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">G \in \mathcal{G} | H_n(G) = \operatorname{max}\left( H_n (B) | \forall B \in \mathcal{G} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.0593em;">G</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">G</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">max</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mord">∣∀</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathcal" style="margin-right:0.0593em;">G</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">10:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">12:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 17. <a href="#algo-grandpa-ghost">GRANDPA-GHOST</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$B_("last")\$ is the last block which has been finalized on the chain
(<a href="#defn-finalized-block">Definition 90</a>).</p>
</li>
<li>
<p>\$#V_("obs"(v))^(r,pv)(B)\$ is defined in <a href="#defn-observed-votes">Definition 82</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-best-prevote-candidate" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 18 </span><span style="font-style:normal;font-variant:small-caps;">Best-PreVote-Candidate</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup><mo>←</mo></mrow><annotation encoding="application/x-tex">B^{r, pv}_v \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">GRANDPA-GHOST</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">if </span><span class="ps-funcname">Received</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><msub><mi>v</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>r</mi><mi>y</mi></mrow></msub><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>m</mi></mrow></msubsup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_{v_{primary}}^{r, prim}(B))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.269em;vertical-align:-0.4443em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">ima</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ry</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">im</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4443em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">))</span></span></span></span> <span class="ps-keyword">and</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup><mo>⩾</mo><mi>B</mi><mo>&gt;</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">B^{r, pv}_v \geqslant B &gt; L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>)<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>←</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">N \leftarrow B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>←</mo><msubsup><mi>B</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">N \leftarrow B^{r, pv}_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 18. <a href="#algo-best-prevote-candidate">Best-PreVote-Candidate</a></div>
          </div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-attempt-to–finalize" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 19 </span><span style="font-style:normal;font-variant:small-caps;">Attempt-To-Finalize-At-Round</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">L \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">Last-Finalized-Block</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">E \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>⩾</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">E \geqslant L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.82em;vertical-align:-0.1367em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> <span class="ps-keyword">and</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>V</mi><mrow><mtext>obs</mtext><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><mrow><mi>r</mi><mo separator="true">,</mo><mtext>pc</mtext></mrow></msubsup><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mn>2</mn><mi mathvariant="normal">/</mi><mn>3</mn><mi mathvariant="normal">∣</mi><mi mathvariant="double-struck">V</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">{V^{r, \textrm{pc}}_{\textrm{obs}(v)}}(E) &gt; 2 / 3 |\mathbb{V}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2975em;vertical-align:-0.5152em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3598em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textrm mtight">obs</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">pc</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5152em;"><span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2/3∣</span><span class="mord mathbb">V</span><span class="mord">∣</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span style="font-style:normal;font-variant:small-caps;">Last-Finalized-Block</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">\leftarrow E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mtext>Fin</mtext></mrow></msubsup><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo><mo mathvariant="normal">∉</mo></mrow><annotation encoding="application/x-tex">M_v^{r, \textrm{Fin}} (E) \notin </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">Fin</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span></span></span></span><span style="font-style:normal;font-variant:small-caps;">Received-Messages</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">6:</span><span class="ps-funcname">Broadcast</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mtext>Fin</mtext></mrow></msubsup><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_v^{r, \textrm{Fin}}(E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textrm mtight">Fin</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="ps-keyword">return </span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">8:</span><span class="ps-keyword">end if</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">9:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 19. <a href="#algo-attempt-to–finalize">Attempt-To-Finalize-At-Round</a></div>
          </div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-finalizable" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 20 </span><span style="font-style:normal;font-variant:small-caps;">Finalizable</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> <span style="font-weight:bold;">is not</span>   Completable<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">2:</span><span class="ps-keyword">return </span><span style="font-weight:bold;">False</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">G \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">GRANDPA-GHOST</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J^{r, pv}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>=</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">G = \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="ps-keyword">return </span><span style="font-weight:bold;">False</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">8:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>r</mi></msub><mo>←</mo></mrow><annotation encoding="application/x-tex">E_r \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">9:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>r</mi></msub><mo mathvariant="normal">≠</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">E_r \neq \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> <span class="ps-keyword">and</span> <span class="ps-funcname">Best-Final-Candidate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⩽</mo><msub><mi>E</mi><mi>r</mi></msub><mo>⩽</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">\leqslant E_r \leqslant G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">10:</span><span class="ps-keyword">return </span><span style="font-weight:bold;">True</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="ps-keyword">else</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">12:</span><span class="ps-keyword">return </span><span style="font-weight:bold;">False</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">13:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 20. <a href="#algo-finalizable">Finalizable</a></div>
          </div>
<div class="paragraph">
<p>where the condition for <em>completability</em> is defined in <a href="#defn-grandpa-completable">Definition 85</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that we might not always succeed in finalizing our best final candidate due to the possibility of equivocation. We might even not finalize anything in a round (although <a href="#algo-grandpa-round">Algorithm 14</a> prevents us from moving to the round \$r+1\$ before finalizing the best final candidate of round \$r-1\$) The example in <a href="#exmp-candid-unfinalized">Definition 88</a> serves to demonstrate a situation where the best final candidate of a round cannot be finalized during its own round:</p>
</div>
<div id="exmp-candid-unfinalized" class="exampleblock">
<div class="title">Definition 88. Unfinalized Candidate</div>
<div class="content">
<div class="paragraph">
<p>Let us assume
that we have 100 voters and there are two blocks in the chain
(\$B_1 &lt; B_2\$). At round 1, we get 67 pre-votes for
\$B_2\$ and at least one pre-vote for \$B_1\$ which
means that \$"GRANDPA-GHOST"(1) = B_2\$.</p>
</div>
<div class="paragraph">
<p>Subsequently, potentially honest voters who could claim not seeing all the
pre-votes for \$B_2\$ but receiving the pre-votes for \$B_1\$ would
pre-commit to \$B_1\$. In this way, we receive 66 pre-commits for \$B_1\$
and 1 pre-commit for \$B_2\$. Henceforth, we finalize \$B_1\$ since we
have a threshold commit (67 votes) for \$B_1\$.</p>
</div>
<div class="paragraph">
<p>At this point, though, we have
\$tt "Best-Final-Candidate"(r) = B_2\$ as
\$#V_("obs"(v),"pot")^(r,"stage")(B_2) = 67\$
and \$2 &gt; 1\$.</p>
</div>
<div class="paragraph">
<p>However, at this point, the round is already completable as we know that we have
\$tt "GRANDPA-GHOST"(1) = B_2\$ as an upper limit on what we can finalize and
nothing greater than \$B_2\$ can be finalized at \$r = 1\$. Therefore, the
condition of <a href="#algo-grandpa-round">Algorithm 14</a> is satisfied and we must proceed to round 2.</p>
</div>
<div class="paragraph">
<p>Nonetheless, we must continue to attempt to finalize round <em>1</em> in the background
as the condition of <a href="#algo-attempt-to–finalize">Algorithm 19</a> has not been fulfilled.</p>
</div>
<div class="paragraph">
<p>This prevents us from proceeding to round 3 until either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We finalize \$B_2\$ in round 2, or</p>
</li>
<li>
<p>We receive an extra pre-commit vote for \$B_1\$ in round 1. This will make
it impossible to finalize \$B_2\$ in round 1, no matter to whom the remaining
pre-commits are going to be cast for (even with considering the possibility of
1/3 of voter equivocating) and therefore we have \$tt
"Best-Final-Candidate"(r) = B_1\$.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both scenarios unblock <a href="#algo-grandpa-round">Algorithm 14</a>,
\$tt "Last-Finalized-Block" &gt;= tt "Best-Final-Candidate"(r - 1)\$ albeit in
different ways: the former with increasing the \$tt "Last-Finalized-Block"\$
and the latter with decreasing \$tt "Best-Final-Candidate"(r - 1)\$.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-finality-forced-changes"><a class="anchor" href="#sect-finality-forced-changes"></a><a class="link" href="#sect-finality-forced-changes">6.5. Forced Authority Set Changes</a></h3>
<div class="paragraph">
<p>In a case of emergency where the Polkadot network is unable to finalize blocks,
such as in an event of mass validator outage, the Polkadot governance mechanism
must enact a forced change, which the Host must handle in a specific manner.
Given that in such a case finality cannot be relied on, the Host must detect the
forced change (<a href="#defn-consensus-message-grandpa">Definition 86</a>) in a (valid) block and apply
it to all forks.</p>
</div>
<div class="paragraph">
<p>The \$m in CM_g\$, which is specified by the governance mechanism, defines
the starting block at which \$N_("delay")\$ is applied. This provides some
degree of probabilistic consensus to the network with the assumption that the
forced change was received by most participants and that finality can be
continued.</p>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" style="background-color: rgb(255, 255, 255);" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="871px" height="422px" viewBox="-0.5 -0.5 871 422" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-06-07T10:56:02.198Z&quot; agent=&quot;5.0 (X11)&quot; version=&quot;19.0.2&quot; etag=&quot;MZnKmeYrkyP88Fwe8Ahs&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;liZ5AVIy7FNIeXNKdl8L&quot;&gt;7VxLk6M2EP41riSHcSHEwz76sZMcNqmtTKp294hBY7ODLQfjHTu/PhJIgEDYmPduMQcPaoSQ1P1JX7ckJnC1v/zuW8fdn9hB3kRVnMsErieqOp9D8ksFVyZQzUiw9V0nEoFE8OL+h5hQYdKz66CTkDHA2Avcoyi08eGA7ECQWb6P38Vsr9gT33q0tigneLEtLy/97DrBjkmBoiQ3/kDudsdePdPZjY1lv219fD6w9x3wAUV39hYvhmU97SwHv6dE8MMErnyMg+hqf1khj/Yq77HoueeCu3GVfXQIyjygsmoEV95q5JBOYEnsBzu8xQfL+5BIl2HLEC1AIakkz0eMj0QIiPAbCoIr06h1DjAR7YK9x+6SuvnXLzQxVWYaF3ylBU61eZxjfWGviFLXdOoT8t09CpDPhK/4EDxbe9ejuf4ht06kVX+hd/L7N95bB5aFVQkYJB21nDZX6LsTPvs2EzEDDix/i1h3qkq+i0GsOAIFhEm9/CvJ4iPPCtzvYvEWM8ptnC/RDrlgCpIri1Xnu+WdWaFLD9tvE1onGJtlSpeipt53boBejlbYuncCWVErr67nrbCH/fBZCExVUWk/nQIfvyF+J7RluLQ8d0s6de2hV9IJy+/ID1yCnAUTB9QSwh5Plfgc/tESSR3cw/Zj+Owa1lEffTG6FBp/gWbYAyrQo0fYAAVmrAvfU3DnCt+lkG4o9ZWp9Ys8EXX6Hcy1Ay89Dy/YH7r02+gCvyxGfD2GL2hm8KV2iC9jxJc5KHyZ9/C1HPFVD1+q1iG+Zjl1Lo5HzyXa6hN3Kah9FZAmx51jnXbhe0FrIATcdUmj0HhU1aRd5mwuaBsyJZYGKiv8E3bJO+OS9XnBIM2LiCrOnkq7ErwgnhG/vp6QkGfh+9Y1leNInzgV18UwFaEupuC8kIuowMQ+444qZbLz2qb57bw/8vyWb1czVsHoaOKTFRBP5hBKVCWyZ2dBPdhkwCKSZ5e2LLLiixtE5q7qLPmVQ4FcJ9ZOE4LjFD0FTChOUIpiDsftkkFGb37iktugpimV8PCorcMC3DVl7CDvDtax9m043dYcmqGasToNVrG6FDpszzqdXFsASA5jHQ7ss/74Fa9PakaeqIZH6Y0r2IHx75mGl8I2P53CRi/ouGMcL2HL+X1ytWX/PZ6/VkG/vthEKWePcgRltbMOW/QbL3zjN1JH0klRNXNil8sWZ2LDvhtQJbzQ+YryT1L4KrxqssM2tUpxiIHQOuqpRmxuNawefb7DiPeu44RDRIZmr1er5dosotkZBp1w8qEwaF0chHUJgeYkO02gtQYINOgl9trFwGhIBkatq/nbUAgpmmWYsjqda0ryp5ea0atMuvkQ7S2v6KO1QZ4chjbpJjrhFQPRR2QQsTZhedQYGOEghevLib5uGFNskYW9byKPg6t3fBhtroh4ewKN+DCq6Bk9zcQC8o5JFdXWD9g24j0ILD5Np8BUielVGXe3ouchJWRydyT2QKTuSHeDj9kjKdOHx8J1PWM2PzQLl+hb63GNjtencRbeDXm+zZKXI0suy5ILiO9D7HmoLBnCLmlyft3gGftvsduW0SZpZdAeo6ID64l1bqHPk1Jxyg3qQW0ZsgUkajMlqwPZgFclreWXBxKt5TE4aq1Qa7GKutBasxHyymwl260lqEYJZZVgE7wTBTZRXoWNswlenxSMptPpCJ9i+AAtAx8lDx/YEnxii+ovopN4YpXWhXRdWBd6UqaKcc+p7HBhiMd12t6QV2lBB4DMwpGR2XqZzW+ot/LXXgBSe4kvNrISz60YpGw4seguwwkyi+txDw1/d48jTH6C77Dne3TsG9iw2XgkR8us4s9nRpXB+tFITpVJpkMjUQc6IcDsXvzsThwd3Mpff0IYYCzykSliGAFHmcm1sDml9LBUf59rq0q9f5rjZxp7Wlhp6GTo0aB+K3/9occcnpXCuTh5KkalLXC5IacgcHFnHx+I3s7teaqot+kuTciqkl/RaygyIrH2XiMj+QDjz7PO8iWHli628ji2vXHMyY1dO7LIz5Eb4Uu0WsGqOJi1C3EglJ3wMiThoCZWLoay37jqoZRmoq5Vjl1KorA9Uiw4BmEfBJ2eoRNAcjClrSAsrB+EbQh1faFH7YSXltaHOqKnHnri41pdoKd+gLHhOWuq6MI2NzJvqTFzbzjK1RIgtTwg2whSldaxlkOkcBLTGE9iPgpZI+Nvd3oSEzYb12sCswBoImY1s9JnPfrDrGwPe5+f/shvK8xgdvw6QU3Mdvp1Aji0gNgP4xvKVnzKH6duHpj5ONRIb2/izswc8u7UORzIBrcfDnaaJCTTxpmu0l9PGmMyNWHXpVfJFwpGbZXVVuYjBC3uYiTJ5HOD0dJe8jVH+OF/&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 235 210 L 215 210 L 203.89 209.89" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 198.64 209.83 L 205.67 206.4 L 203.89 209.89 L 205.6 213.4 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="235" y="180" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 187px; margin-left: 240px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #100</div></div></div></foreignObject><text x="240" y="203" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #100</text></switch></g><path d="M 395 150 L 375 150 L 375 210 L 361.37 210" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 356.12 210 L 363.12 206.5 L 361.37 210 L 363.12 213.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="395" y="120" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 127px; margin-left: 400px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #101'A</div></div></div></foreignObject><text x="400" y="143" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #101'A</text></switch></g><path d="M 395 270 L 375 270 L 375 210 L 361.37 210" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 356.12 210 L 363.12 206.5 L 361.37 210 L 363.12 213.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="395" y="240" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 247px; margin-left: 400px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #101'B</div></div></div></foreignObject><text x="400" y="263" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #101'B</text></switch></g><path d="M 550 70 L 690 70 L 690 113.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 690 118.88 L 686.5 111.88 L 690 113.63 L 693.5 111.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 80px; margin-left: 720px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">Applied</div></div></div></foreignObject><text x="720" y="85" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Applied</text></switch></g><path d="M 418.75 90 L 418.83 120.42 L 415.83 120.42" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="1 1" pointer-events="stroke"/><path d="M 550 70 L 806 70 L 805.96 134.49" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 805.96 139.74 L 802.46 132.74 L 805.96 134.49 L 809.46 132.74 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="375" y="50" width="175" height="40" fill="#dccbd7" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 170px; height: 1px; padding-top: 70px; margin-left: 380px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #172026; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(23, 32, 38); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style="font-size: 16px;"><font style="font-size: 16px;">(Scheduled Change)<br style="font-size: 16px;" /></font></i>Authority Set #A, <i style="font-size: 16px;"><b style="font-size: 16px;">delay 5</b></i></div></div></div></foreignObject><text x="380" y="75" fill="#172026" font-family="Times New Roman" font-size="16px">(Scheduled Change)...</text></switch></g><path d="M 550 350 L 690 350 L 690 306.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 690 301.12 L 693.5 308.12 L 690 306.37 L 686.5 308.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 341px; margin-left: 720px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">Applied</div></div></div></foreignObject><text x="720" y="346" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Applied</text></switch></g><path d="M 418.75 330 L 415.42 330 L 415.4 301.2" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="1 1" pointer-events="stroke"/><path d="M 550 350 L 806.67 350 L 806.65 287.23" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 806.65 281.98 L 810.15 288.98 L 806.65 287.23 L 803.15 288.98 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="375" y="330" width="175" height="40" fill="#dccbd7" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 170px; height: 1px; padding-top: 350px; margin-left: 380px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #172026; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(23, 32, 38); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style="font-size: 16px;">(Scheduled Change)<br style="font-size: 16px;" /></i>Authority Set #B, <i style="font-size: 16px;"><b style="font-size: 16px;">delay 5</b></i></div></div></div></foreignObject><text x="380" y="355" fill="#172026" font-family="Times New Roman" font-size="16px">(Scheduled Change)...</text></switch></g><rect x="325" y="130" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 140px; margin-left: 360px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Fork #A</div></div></div></foreignObject><text x="360" y="145" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Fork #A</text></switch></g><rect x="325" y="270" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 280px; margin-left: 360px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Fork #B</div></div></div></foreignObject><text x="360" y="285" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Fork #B</text></switch></g><path d="M 165 210 L 96.37 210" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 91.12 210 L 98.12 206.5 L 96.37 210 L 98.12 213.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="165" y="200" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 210px; margin-left: 180px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="180" y="215" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 130 120 L 130 160 L 181.58 160 L 181.59 192.39" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 181.59 197.64 L 178.09 190.64 L 181.59 192.39 L 185.09 190.64 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 100 L 295 100 L 295 173.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 295 178.88 L 291.5 171.88 L 295 173.63 L 298.5 171.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 100 L 415.78 100 M 421.78 100 M 421.78 100 L 570 100 L 570 133.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 570 138.88 L 566.5 131.88 L 570 133.63 L 573.5 131.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 120 L 130 207 M 130 213 M 130 213 L 130 320 L 412.41 320 M 418.41 320 M 418.41 320 L 571.33 320 L 571.3 286.09" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 571.29 280.84 L 574.8 287.83 L 571.3 286.09 L 567.8 287.84 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 100 L 415.78 100 M 421.78 100 M 421.78 100 L 455 100 L 455 113.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 455 118.88 L 451.5 111.88 L 455 113.63 L 458.5 111.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 120 L 130 207 M 130 213 M 130 213 L 130 320 L 412.41 320 M 418.41 320 M 418.41 320 L 455 320 L 455 306.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 455 301.12 L 458.5 308.12 L 455 306.37 L 451.5 308.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 76.72 121 L 76.17 201.34" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="1 1" pointer-events="stroke"/><rect x="50" y="80" width="160" height="40" fill="#dccbd7" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 155px; height: 1px; padding-top: 100px; margin-left: 55px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #172026; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(23, 32, 38); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style="font-size: 16px;">(Scheduled Change)<br style="font-size: 16px;" /></i>Authority Set #X</div></div></div></foreignObject><text x="55" y="105" fill="#172026" font-family="Times New Roman" font-size="16px">(Scheduled Change)...</text></switch></g><path d="M 555 150 L 521.37 150" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 516.12 150 L 523.12 146.5 L 521.37 150 L 523.12 153.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="555" y="140" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 150px; margin-left: 570px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="570" y="155" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 555 270 L 521.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 516.12 270 L 523.12 266.5 L 521.37 270 L 523.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="555" y="260" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 270px; margin-left: 570px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="570" y="275" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 630 270 L 593.08 270.4" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 587.83 270.55 L 594.73 266.85 L 593.08 270.4 L 594.92 273.85 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="630" y="240" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 247px; margin-left: 635px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #106'B</div></div></div></foreignObject><text x="635" y="263" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #106'B</text></switch></g><path d="M 630 150 L 594.79 149.61" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 589.54 149.45 L 596.64 146.17 L 594.79 149.61 L 596.43 153.17 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="630" y="120" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 127px; margin-left: 635px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #106'A</div></div></div></foreignObject><text x="635" y="143" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #106'A</text></switch></g><path d="M 790 150 L 756.37 150" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 751.12 150 L 758.12 146.5 L 756.37 150 L 758.12 153.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="790" y="140" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 150px; margin-left: 805px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="805" y="155" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 790 270 L 756.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 751.12 270 L 758.12 266.5 L 756.37 270 L 758.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="790" y="260" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 270px; margin-left: 805px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="805" y="275" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><rect x="60" y="200" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 210px; margin-left: 75px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="75" y="215" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</div>
<div class="title">Figure 2. Applying a scheduled change</div>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" style="background-color: rgb(255, 255, 255);" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="871px" height="442px" viewBox="-0.5 -0.5 871 442" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-06-07T10:56:19.495Z&quot; agent=&quot;5.0 (X11)&quot; version=&quot;19.0.2&quot; etag=&quot;1w9YJhjo6zulCMZPoTNo&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;sbszC-jo-hkVt9zIXCEv&quot;&gt;7Vxbc6M2FP41nu4+2MNNYB5tJ2k7s+3sNDvT3UdiK5gNRi7gjdNfXwkkQCB8AXHJ1n5I4CCE0Dnfuemgib7aHX8Nnf32D7SB/kRTNseJfjfRNNvW8V9CeKMEzUoJbuhtUpKaEx69fyElKpR68DYw4hrGCPmxt+eJaxQEcB1zNCcM0Svf7Bn5/FP3jgsrhMe141epf3ubeEupqqLkF36Dnrulj54DeuHJWb+4IToE9HkBCmB6ZeewbmjTaOts0GuBpN9P9FWIUJwe7Y4r6JNZZTOW3vdQczUbcgiD+JIbNDqM+I29NdzgSaCnKIy3yEWB49/n1GXyZpB0oOCzvM0nhPaYqGLidxjHb5SjziFGmLSNdz69iscWvn0lJzNlbjDCN9LhzLCzFndH+oj07K149hmG3g7GMKTEZxTED87O80mrL/hShN/qT/iK//6Fdk5Am9AhqSY+T9+cvC43dxE6hGtKogIcO6EL6XQyWnGK1YxxGAoQ4XGFb7hJCH0n9n7w3TtUKN2sXc4dfEAZJGYWffQPxz/QTpc+Wr9MCI/1TCwLvOQ59br1Yvi4d5K3e8WQ5bny7Pn+CvkoTO7VVUtTNDJPURyiF8iuJLKsLx3fc/Gk3vnwGU/C8gcMYw8jZ0HJMZGEZMYLPT4kP9IjHoMXuJ+Se+/0NuwjD4bHWuGv4Qy9QVNBegtVUGBOp/C1AHeG1G0B6abSnpnGsMjjUQfOYK4beIEqvAZEFziNLvWXxQ1f1+FLt0r40nrEl3nDlzUqfFnn8LW84asdvkyjR3zNW+Pr+2G3Z+2dcN0McRsn2iY9spPPTozdwiChaEqKw82ChAM59zHlwSNvlkLx6MVfE5hqgJ5+YxDGxzlkyQnnhaZ3qZbOo11RrPH4sCoLnQpaAMjXAvTWz8jDPWYSajCJLFsA1kU6KnpXLnyYX85bodmeNIjqn6PbYkuTy3LaYy7Z2TteJOy2VGF3E9XVVtjLsnBOzHk9iPXZ3Wq1vLOyKyzG1S4TxYaip9t9yR4A9kw37PzHSYhhKTPTVLKfepFcNhAdls0o2L2JZvrE6jxxImX+cyBRfzL30yhh7IJoMHN/TKabXcdHLvn/uxugEEsD7QyP44ldGoe0FlQkUOyiipxipalllGt05E+AAONqO48tCtANTnynTKyagoQ1Qc/PEWwt42qtjHutZJz1Qtq36ujD4xrLzcEneFFWWydw4ccMhqGUMeJJSodZIXuMtjhgEIVeTHj7SGaduL6481VyJHPC2qmWDRYqMkYgVi7VF2vnuZ9xxnfeZpPoqJKHn6G35KfXeP4c3lnalYzO9Z0oYiriBcbrLR3XaPx8wHs3BhD4+SwWKPr5hgQ/Xx0kRVzR8x04xrbAO7H68k6w6zFjMRRlq6VoM9vozA+pZo8X+73vEY0o4O8n5wn6Ypiu8dQQg1wP1BBiJeM8Jf0RAaDuO+4cLCfgTjKQ6PoPfd4kW1vhmKidsbCGrfAgm6rtDCzLMdvCXuWa3/a5ZCmxOBcTF/09daZoZ7w9GXG8yGGsCe6zeF4Y3PencDrQNxcrdjC+MAGAktgY+hm5ETM9l5Q1Me7emhOWAQ2MMWACVm2fEpfOcI7d16iIE7FfHcurQV7FQbzHZtlayAv/RC5GVwmQa3NmwOZzc5ZZKhU4095UT7c3rZPtW+fkVGt84lzRX9a8if4amaQzG8oy4oU1rVoT2lQ/Xh4cvW90WHOrW3TM6919ZR2iKJo+o/BlKN+/KNAX69qmvr91xvdXDU3jvXRdiu8/BaVuWQwm1/u3K5yWk0v6ICeZ9IAw4mvS1N2l4k7n3JaSH9huhiKsAWMvcIlkxDUTNab04O7ytCCWXtPZEcsaPEX7QrMxvMf7SHNCYqmdig2nIfDoaxRKuUtLvzB3KaNGQauuvT0kRo/m3UvcxG8Zd2f2iOcY0cmt5WaB9QUGD8C2UjYMCNhmCSpLyuv7jbhWXU3KuVbF4I1rtVzLQrA+uNZ+nUBKONYgXJIT7IuqxQ1DfjhzMUOqCf/ZbHaDTz18VKMEH6UKH70r+AxSD84lGvJUeaMyOAC4MripMlPMc1n/Pr/lEJRidFEO2yjboKp89gCcyTaopnaqfevsgdZ+bUBiYlg5I0VCKb4mWdWfxA2Y/h+mIp7jTdXA9zjzQ079CFPVBqetlZk9N5so62uX2poYmR6FpKvK6LYGwSp/x1kpdlVPtW9vEOSW+0tfOzxnIsaxIiwSuQ4k7mK1NJKy9qYLwj+X7umq9Kxr1WPo4FT71qqHRVxjklKdK2cnkU6jL35aVbPn0qymT2fyPFO00+4uORENpVpyJSczIpL2ITMjbDzyV8x6qTI/vbT1tYKWbhYpamqu62q0hZmf0SxS8BrPEO0DYAoSPzLqq3W5edP2xZtXfrosJ7/axIYK8q0DOlP6Ld16JepAyXEAgs+Xu0q36qMpmR4KPYLNNwYsRtaru2/c0HMVekyzR/SMrZIY+7yA++IA261mH5gOB0jRbh1D2rOT+3V82E20Jfh427PjWtiapei61z079JFs2lHAraoaPG4Nq9EGcMPhVlTjP+QmcdVyUAFuR7eXlU9qjpfZxonvrMqtjOped7oyxpYgey8RpCHIS3Xxec7FjKzmpW5O8EncWaVvjPoMIQ25iZv/EewEiZsuPry/mJG3zE1L2PUZe7KFgxu3LuVWaQ+2Dqsa8Wm+dXW61JfvDK7f/wc=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 235 210 L 215 210 L 203.89 209.89" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 198.64 209.83 L 205.67 206.4 L 203.89 209.89 L 205.6 213.4 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="235" y="180" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 187px; margin-left: 240px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #100</div></div></div></foreignObject><text x="240" y="203" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #100</text></switch></g><path d="M 395 150 L 375 150 L 375 210 L 361.37 210" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 356.12 210 L 363.12 206.5 L 361.37 210 L 363.12 213.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="395" y="120" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 127px; margin-left: 400px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #101'A</div></div></div></foreignObject><text x="400" y="143" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #101'A</text></switch></g><path d="M 395 270 L 375 270 L 375 210 L 361.37 210" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 356.12 210 L 363.12 206.5 L 361.37 210 L 363.12 213.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="395" y="240" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 247px; margin-left: 400px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #101'B</div></div></div></foreignObject><text x="400" y="263" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #101'B</text></switch></g><path d="M 418.75 90 L 418.83 120.42 L 415.83 120.42" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="1 1" pointer-events="stroke"/><path d="M 550 70 L 690 70 L 690 120" fill="none" stroke="#dccbd7" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 550 70 L 805.33 70 L 805.27 137.42" fill="none" stroke="#dccbd7" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 80px; margin-left: 720px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;"><b style="font-size: 16px;">Ignored</b></div></div></div></foreignObject><text x="720" y="85" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Ignored</text></switch></g><rect x="375" y="50" width="175" height="40" fill="none" stroke="none" pointer-events="all"/><path d="M 374.91 50.1 C 374.91 50.1 374.91 50.1 374.91 50.1 M 374.91 50.1 C 374.91 50.1 374.91 50.1 374.91 50.1 M 375.31 55.74 C 376.34 53.97 377.92 53.44 380.56 49.71 M 375.31 55.74 C 376.71 54.54 377.16 53.17 380.56 49.71 M 375.05 62.14 C 378.66 59.03 382.91 53.93 385.54 50.07 M 375.05 62.14 C 378.9 57.83 381.23 54.89 385.54 50.07 M 374.78 68.54 C 378.76 61.87 383.88 56.28 391.19 49.67 M 374.78 68.54 C 379.15 62.11 385.32 57.14 391.19 49.67 M 375.18 74.18 C 382.05 67.97 384.89 62.97 396.17 50.03 M 375.18 74.18 C 380.62 67.56 384.57 63.31 396.17 50.03 M 374.92 80.58 C 381.49 73.07 392.69 61.98 401.82 49.64 M 374.92 80.58 C 381.4 74.14 386.74 66.48 401.82 49.64 M 375.31 86.22 C 389.15 70.2 398.72 58.78 406.8 50 M 375.31 86.22 C 383.48 76.37 392.4 65.49 406.8 50 M 376.36 91.11 C 390.07 77.94 402.55 63.01 411.79 50.36 M 376.36 91.11 C 387.4 79.13 399.49 66.6 411.79 50.36 M 381.35 91.47 C 397.4 74.31 410.35 60.41 417.43 49.96 M 381.35 91.47 C 394.44 75.75 407.42 62.91 417.43 49.96 M 386.99 91.08 C 400.81 75.4 415.6 58.48 422.42 50.32 M 386.99 91.08 C 397.49 79.03 406.34 67.98 422.42 50.32 M 391.98 91.44 C 401.12 84.53 409.24 74.58 428.06 49.93 M 391.98 91.44 C 398.64 82.69 407.1 74.95 428.06 49.93 M 397.62 91.04 C 412.26 73.02 424.56 58.72 433.05 50.29 M 397.62 91.04 C 404.61 81.9 411.52 74.01 433.05 50.29 M 402.61 91.4 C 416.94 73.43 431.09 56.9 438.69 49.89 M 402.61 91.4 C 413.49 77.67 425.1 64.36 438.69 49.89 M 408.25 91.01 C 418.68 77.36 431.75 63.59 443.68 50.25 M 408.25 91.01 C 418.38 81.11 426.82 70.32 443.68 50.25 M 413.24 91.37 C 422.93 81.19 434.09 68.21 449.32 49.86 M 413.24 91.37 C 423.17 81.75 431.48 72.25 449.32 49.86 M 418.88 90.97 C 427.77 80.27 436.84 69.93 454.31 50.22 M 418.88 90.97 C 427.53 80.7 436.18 70.37 454.31 50.22 M 423.87 91.33 C 435.73 77.73 448.89 63.05 459.95 49.82 M 423.87 91.33 C 432.56 81.51 441.26 70.88 459.95 49.82 M 429.51 90.94 C 440.31 79.79 445.02 72.43 464.94 50.18 M 429.51 90.94 C 442.87 74.2 456.56 59.52 464.94 50.18 M 434.5 91.3 C 444.43 77.7 455.89 67.5 470.58 49.79 M 434.5 91.3 C 444.15 79.61 453.69 69.98 470.58 49.79 M 440.14 90.9 C 454.46 75.96 466.72 59.41 475.57 50.15 M 440.14 90.9 C 452.88 75.98 464.53 63.25 475.57 50.15 M 445.13 91.26 C 451.69 82.29 462.07 71.4 481.21 49.76 M 445.13 91.26 C 457.84 77.81 470.05 62.99 481.21 49.76 M 450.77 90.87 C 464.91 75.73 479.18 62.11 486.2 50.12 M 450.77 90.87 C 461.21 79.76 470.8 68.82 486.2 50.12 M 455.76 91.23 C 464.78 82.03 469.21 75.59 491.84 49.72 M 455.76 91.23 C 469.87 74.26 483.76 58.75 491.84 49.72 M 461.4 90.83 C 471.59 82.07 475.89 71.26 496.83 50.08 M 461.4 90.83 C 471.68 79.07 483.49 66.15 496.83 50.08 M 466.39 91.2 C 476.45 81.9 483.15 73.09 502.47 49.69 M 466.39 91.2 C 474.83 80.65 484.01 70.58 502.47 49.69 M 472.03 90.8 C 480.92 77.65 495.36 64.7 507.46 50.05 M 472.03 90.8 C 481.81 79.4 492.94 66.13 507.46 50.05 M 477.02 91.16 C 491.25 77.67 503.7 61.39 513.1 49.65 M 477.02 91.16 C 484.44 81.98 492.57 75.22 513.1 49.65 M 482.01 91.52 C 491.9 79.64 500.47 70.77 518.09 50.01 M 482.01 91.52 C 489.39 81.88 498.29 73.82 518.09 50.01 M 487.65 91.13 C 495.93 83.57 500.91 74.98 523.08 50.37 M 487.65 91.13 C 497.23 78.79 508.03 66.41 523.08 50.37 M 492.64 91.49 C 503.28 76.44 515.03 64.88 528.72 49.98 M 492.64 91.49 C 500.39 82.71 509.17 72.56 528.72 49.98 M 498.28 91.09 C 510.15 75.48 524.25 61.76 533.71 50.34 M 498.28 91.09 C 504.46 83.36 512.94 74.21 533.71 50.34 M 503.27 91.45 C 511.64 80.88 523.67 70.52 539.35 49.94 M 503.27 91.45 C 517.93 74.37 532.1 58.19 539.35 49.94 M 508.91 91.06 C 522.95 75.92 535.03 59.72 544.34 50.3 M 508.91 91.06 C 521.11 77.34 530.99 64.74 544.34 50.3 M 513.9 91.42 C 526.17 80.37 537.44 64.85 549.98 49.91 M 513.9 91.42 C 526.66 77.17 540.15 62.15 549.98 49.91 M 519.54 91.02 C 526.63 82.87 533.9 75.88 553 52.53 M 519.54 91.02 C 530.12 77.66 541.99 65.36 553 52.53 M 524.53 91.38 C 532.9 83.74 540.39 73.45 552.74 58.93 M 524.53 91.38 C 531.58 81.53 539.47 74.4 552.74 58.93 M 530.17 90.99 C 535.62 84.92 539.42 78.49 553.13 64.57 M 530.17 90.99 C 534.06 85.08 538.99 79.85 553.13 64.57 M 535.16 91.35 C 543.11 85.73 546.99 76.15 552.87 70.97 M 535.16 91.35 C 538.37 85.58 544.59 80.81 552.87 70.97 M 540.8 90.95 C 544.89 84.47 547.69 82.36 553.27 76.61 M 540.8 90.95 C 543.28 88.19 546.57 84.45 553.27 76.61 M 545.79 91.31 C 549.55 88.81 550.3 86.12 553.01 83.01 M 545.79 91.31 C 548.1 87.96 550.19 85.68 553.01 83.01" fill="none" stroke="#dccbd7" stroke-width="0.5" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><path d="M 375 50 C 426.04 52.42 476.52 50.91 550 50 M 375 50 C 424.68 52.32 475.95 51.59 550 50 M 550 50 C 550.81 65.64 548.73 76.79 550 90 M 550 50 C 549.95 58.51 551.03 66.16 550 90 M 550 90 C 510.15 88.82 475.07 90.11 375 90 M 550 90 C 481.87 90.36 414.19 90.26 375 90 M 375 90 C 373.88 79.22 373.9 68.8 375 50 M 375 90 C 375.25 78.51 375.14 67.07 375 50" fill="none" stroke="#dccbd7" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 170px; height: 1px; padding-top: 70px; margin-left: 380px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #172026; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(23, 32, 38); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style="font-size: 16px;"><font style="font-size: 16px;">(Scheduled Change)<br style="font-size: 16px;" /></font></i>Authority Set #A, <i style="font-size: 16px;"><b style="font-size: 16px;">delay 5</b></i></div></div></div></foreignObject><text x="380" y="75" fill="#172026" font-family="Times New Roman" font-size="16px">(Scheduled Change)...</text></switch></g><path d="M 550 360 L 690 360 L 690 306.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 690 301.12 L 693.5 308.12 L 690 306.37 L 686.5 308.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 350px; margin-left: 720px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">Applied</div></div></div></foreignObject><text x="720" y="355" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Applied</text></switch></g><path d="M 418.75 330 L 415.42 330 L 415.4 301.2" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="1 1" pointer-events="stroke"/><path d="M 550 360 L 806.67 360 L 806.65 287.23" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 806.65 281.98 L 810.15 288.98 L 806.65 287.23 L 803.15 288.98 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 550 360 L 610 360 L 610 210 L 690 210 L 690 188.24" fill="none" stroke="#e6007a" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 690 182.24 L 694 190.24 L 690 188.24 L 686 190.24 Z" fill="#e6007a" stroke="#e6007a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 550 360 L 610 360 L 610 210 L 806.67 210 L 806.65 169.8" fill="none" stroke="#e6007a" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 806.65 163.8 L 810.65 171.79 L 806.65 169.8 L 802.65 171.8 Z" fill="#e6007a" stroke="#e6007a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 200px; margin-left: 608px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">Applied cross-fork</div></div></div></foreignObject><text x="608" y="205" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Applied cross-fork</text></switch></g><rect x="375" y="330" width="175" height="60" fill="#e6007a" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 170px; height: 1px; padding-top: 360px; margin-left: 380px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style="font-size: 16px;">(<b style="font-size: 16px;">Forced</b> Change)<br style="font-size: 16px;" /></i>Authority Set #B<br style="font-size: 16px;" /><b style="font-size: 16px;">starting at</b> <i style="font-size: 16px;"><b style="font-size: 16px;">m</b></i>, <i style="font-size: 16px;"><b style="font-size: 16px;">delay 5</b></i></div></div></div></foreignObject><text x="380" y="365" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">(Forced Change)...</text></switch></g><rect x="325" y="130" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 140px; margin-left: 360px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Fork #A</div></div></div></foreignObject><text x="360" y="145" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Fork #A</text></switch></g><rect x="325" y="270" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 280px; margin-left: 360px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Fork #B</div></div></div></foreignObject><text x="360" y="285" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">Fork #B</text></switch></g><path d="M 165 210 L 96.37 210" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 91.12 210 L 98.12 206.5 L 96.37 210 L 98.12 213.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="165" y="200" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 210px; margin-left: 180px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="180" y="215" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 130 120 L 130 160 L 181.58 160 L 181.59 192.39" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 181.59 197.64 L 178.09 190.64 L 181.59 192.39 L 185.09 190.64 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 100 L 295 100 L 295 173.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 295 178.88 L 291.5 171.88 L 295 173.63 L 298.5 171.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 100 L 415.78 100 M 421.78 100 M 421.78 100 L 570 100 L 570 133.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 570 138.88 L 566.5 131.88 L 570 133.63 L 573.5 131.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 120 L 130 207 M 130 213 M 130 213 L 130 320 L 412.41 320 M 418.41 320 M 418.41 320 L 571.33 320 L 571.3 286.09" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 571.29 280.84 L 574.8 287.83 L 571.3 286.09 L 567.8 287.84 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 100 L 415.78 100 M 421.78 100 M 421.78 100 L 455 100 L 455 113.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 455 118.88 L 451.5 111.88 L 455 113.63 L 458.5 111.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 120 L 130 207 M 130 213 M 130 213 L 130 320 L 412.41 320 M 418.41 320 M 418.41 320 L 455 320 L 455 306.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 455 301.12 L 458.5 308.12 L 455 306.37 L 451.5 308.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 76.72 121 L 76.17 201.34" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="1 1" pointer-events="stroke"/><rect x="50" y="80" width="160" height="40" fill="#dccbd7" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 155px; height: 1px; padding-top: 100px; margin-left: 55px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #172026; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(23, 32, 38); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style="font-size: 16px;">(Scheduled Change)<br style="font-size: 16px;" /></i>Authority Set #X</div></div></div></foreignObject><text x="55" y="105" fill="#172026" font-family="Times New Roman" font-size="16px">(Scheduled Change)...</text></switch></g><path d="M 555 150 L 521.37 150" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 516.12 150 L 523.12 146.5 L 521.37 150 L 523.12 153.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="555" y="140" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 150px; margin-left: 570px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="570" y="155" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 555 270 L 521.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 516.12 270 L 523.12 266.5 L 521.37 270 L 523.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="555" y="260" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 270px; margin-left: 570px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="570" y="275" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 630 270 L 613 270.23 M 607 270.31 M 607 270.31 L 593.08 270.4" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 587.83 270.55 L 594.73 266.85 L 593.08 270.4 L 594.92 273.85 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="630" y="240" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 247px; margin-left: 635px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #(m+5)'B</div></div></div></foreignObject><text x="635" y="263" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #(m+5)'B</text></switch></g><path d="M 630 150 L 594.79 149.61" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 589.54 149.45 L 596.64 146.17 L 594.79 149.61 L 596.43 153.17 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="630" y="120" width="120" height="60" fill="#172026" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 115px; height: 1px; padding-top: 127px; margin-left: 635px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: #FFFFFF; "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Block #(m+5)'A</div></div></div></foreignObject><text x="635" y="143" fill="#FFFFFF" font-family="Times New Roman" font-size="16px">Block #(m+5)'A</text></switch></g><path d="M 790 150 L 756.37 150" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 751.12 150 L 758.12 146.5 L 756.37 150 L 758.12 153.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="790" y="140" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 150px; margin-left: 805px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="805" y="155" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><path d="M 790 270 L 756.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 751.12 270 L 758.12 266.5 L 756.37 270 L 758.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="790" y="260" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 270px; margin-left: 805px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="805" y="275" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g><rect x="60" y="200" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 210px; margin-left: 75px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: Times New Roman; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">...</div></div></div></foreignObject><text x="75" y="215" fill="rgb(0, 0, 0)" font-family="Times New Roman" font-size="16px" text-anchor="middle">...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</div>
<div class="title">Figure 3. Applying a forced change</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-block-finalization"><a class="anchor" href="#sect-block-finalization"></a><a class="link" href="#sect-block-finalization">6.6. Block Finalization</a></h3>
<div id="defn-justified-block-header" class="exampleblock">
<div class="title">Definition 89. <a href="#defn-justified-block-header">Justified Block Header</a></div>
<div class="content">
<div class="paragraph">
<p>The Justified Block Header is provided by the consensus engine and
presented to the Polkadot Host, for the block to be appended to the
blockchain. It contains the following parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>block_header</strong> the complete block header (<a href="#defn-block-header">Definition 10</a>) and denoted
by \$"Head"(B)\$.</p>
</li>
<li>
<p><strong>justification</strong>: as defined by the consensus specification indicated by
\$"Just"(B)\$ as defined in <a href="#defn-grandpa-justification">Definition 78</a>.</p>
</li>
<li>
<p><strong>authority Ids</strong>: This is the list of the Ids of authorities, which have voted
for the block to be stored and is formally referred to as \$A(B)\$. An
authority Id is 256-bit.</p>
</li>
</ul>
</div>
</div>
</div>
<div id="defn-finalized-block" class="exampleblock">
<div class="title">Definition 90. <a href="#defn-finalized-block">Finalized</a></div>
<div class="content">
<div class="paragraph">
<p>A Polkadot relay chain node \$n\$ should consider block \$B\$ as
<strong>finalized</strong> if any of the following criteria hold for \$B' &gt;= B\$:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$V_("obs"(n))^(r,"pc")(B') &gt; 2/3|bbb V_(B')|\$.</p>
</li>
<li>
<p>It receives a \$M_v^(r,"Fin")(B')\$ message in which \$J^r(B)\$
justifies the finalization (<a href="#defn-grandpa-justification">Definition 78</a>).</p>
</li>
<li>
<p>It receives a block data message for \$B'\$ with \$"Just"(B')\$
(<a href="#defn-justified-block-header">Definition 89</a>) which justifies the finalization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any round \$r\$ if the node \$n\$ is <em>not</em> a GRANDPA voter.</p>
</li>
<li>
<p>Only for round \$r\$ for which the node \$n\$ has invoked <a href="#algo-grandpa-round">Algorithm 14</a> and round \$r+1\$ if \$n\$ is a GRANDPA voter and has already caught up to its peers according to the process described in Section <a href="#sect-grandpa-catchup">Section 6.6.1</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that all Polkadot relay chain nodes are supposed to process GRANDPA commit
messages regardless of their GRANDPA voter status.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-grandpa-catchup"><a class="anchor" href="#sect-grandpa-catchup"></a><a class="link" href="#sect-grandpa-catchup">6.6.1. Catching up</a></h4>
<div class="paragraph">
<p>When a Polkadot node (re)joins the network, it requests the history of state transitions in the form of blocks, which it is missing.</p>
</div>
<div class="paragraph">
<p>Nonetheless, the process is different for a GRANDPA voter node. When a voter node joins the network, it needs to gather the justification (<a href="#defn-grandpa-justification">Definition 78</a>) of the rounds it has missed. Through this process, they can safely join the voting process of the current round, on which the voting is taking place.</p>
</div>
<div class="sect4">
<h5 id="sect-sending-catchup-request"><a class="anchor" href="#sect-sending-catchup-request"></a><a class="link" href="#sect-sending-catchup-request">6.6.1.1. Sending the catch-up requests</a></h5>
<div class="paragraph">
<p>When a Polkadot voter node has the same authority list as a peer voter node who is reporting
a higher number for the <em>finalized round</em> field, it should send a catch-up
request message (<a href="#defn-grandpa-catchup-request-msg">Definition 48</a>) to the reporting peer. This will allow the node to
to catch up to the more advanced finalized round, provided that the
following criteria hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The peer node is a GRANDPA voter, and:</p>
</li>
<li>
<p>The last known finalized round for the Polkadot node is at least 2 rounds
behind the finalized round for the peer.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="id-processing-the-catch-up-requests"><a class="anchor" href="#id-processing-the-catch-up-requests"></a><a class="link" href="#id-processing-the-catch-up-requests">6.6.1.2. Processing the catch-up requests</a></h5>
<div class="paragraph">
<p>Only GRANDPA voter nodes are required to respond to the catch-up requests. Additionally, it is only GRANDPA voters who are supposed to send catch-up requests. As such GRANDPA voters could safely ignore the catch-up requests from non-voter nodes. When a GRANDPA voter node receives a catch-up request message, it needs to execute <a href="#algo-process-catchup-request">Algorithm 21</a>. Note: a voter node should not respond to catch-up requests for rounds that are actively being voted on, those are the rounds for which <a href="#algo-grandpa-round">Algorithm 14</a> is not concluded.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-process-catchup-request" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 21 </span><span style="font-style:normal;font-variant:small-caps;">Process-Catchup-Request</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>v</mi></mrow><mtext>Cat-q</mtext></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_{i, v}^\text{Cat-q}(\text{id}_\mathbb{V}, r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3722em;vertical-align:-0.413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4231em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">Cat-q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>v</mi></mrow><mtext>Cat-q</mtext></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo mathvariant="normal">≠</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub></mrow><annotation encoding="application/x-tex">M_{i, v}^\text{Cat-q}(\text{id}_\mathbb{V}, r).\text{id}_\mathbb{V} \neq \text{id}_\mathbb{V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3722em;vertical-align:-0.413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4231em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">Cat-q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mord">.</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">2:</span><span style="font-weight:bold;">error</span> ‘‘Catching up on different set&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo mathvariant="normal">∉</mo><mi mathvariant="double-struck">P</mi></mrow><annotation encoding="application/x-tex">i \notin \mathbb{P}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">P</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span style="font-weight:bold;">error</span> ‘‘Requesting catching up from a non-peer&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">r &gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">Last-Completed-Round</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">8:</span><span style="font-weight:bold;">error</span> ‘‘Catching up on a round in the future&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">9:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">10:</span><span class="ps-funcname">Send</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><msubsup><mi>M</mi><mrow><mi>v</mi><mo separator="true">,</mo><mi>i</mi></mrow><mtext>Cat-s</mtext></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">i, M_{v, i}^\text{Cat-s}(\text{id}_\mathbb{V}, r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2361em;vertical-align:-0.3948em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4413em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">Cat-s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>)</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 21. <a href="#algo-process-catchup-request">Process-Catchup-Request</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M_(i,v)^("Cat"-q)("id"_(bbb V),r)\$ is the catch-up message received
from peer \$i\$ (<a href="#defn-grandpa-catchup-request-msg">Definition 48</a>).</p>
</li>
<li>
<p>\$"id"_(bbb V)\$ is the voter set id with which the serving node is
operating</p>
</li>
<li>
<p>\$r\$ is the round number for which the catch-up is requested for.</p>
</li>
<li>
<p>\$bbb P\$ is the set of immediate peers of node \$v\$.</p>
</li>
<li>
<p>\$tt "Last-Completed-Round"\$ is initiated in <a href="#algo-initiate-grandpa">Algorithm 13</a> and gets updated by <a href="#algo-grandpa-round">Algorithm 14</a>.</p>
</li>
<li>
<p>\$M_(v,i)^("Cat"-s)("id"_(bbb V),r)\$ is the catch-up response
(<a href="#defn-grandpa-catchup-response-msg">Definition 49</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="id-processing-catch-up-responses"><a class="anchor" href="#id-processing-catch-up-responses"></a><a class="link" href="#id-processing-catch-up-responses">6.6.1.3. Processing catch-up responses</a></h5>
<div class="paragraph">
<p>A Catch-up response message contains critical information for the requester node
to update their view on the active rounds which are being voted on by GRANDPA
voters. As such, the requester node should verify the content of the catch-up
response message and subsequently updates its view of the state of the finality
of the Relay chain according to <a href="#algo-process-catchup-response">Algorithm 22</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-process-catchup-response" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 22 </span><span style="font-style:normal;font-variant:small-caps;">Process-Catchup-Response</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mrow><mi>v</mi><mo separator="true">,</mo><mi>i</mi></mrow><mtext>Cat-s</mtext></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_{v,i}^\text{Cat-s}(\text{id}_{\mathbb{V}}, r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2361em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4413em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">Cat-s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mrow><mi>v</mi><mo separator="true">,</mo><mi>i</mi></mrow><mtext>Cat-s</mtext></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>c</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>H</mi><mi>h</mi></msub><mo stretchy="false">(</mo><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo>←</mo><msub><mtext>Dec</mtext><mrow><mi>S</mi><mi>C</mi></mrow></msub><mo stretchy="false">(</mo><msubsup><mi>M</mi><mrow><mi>v</mi><mo separator="true">,</mo><mi>i</mi></mrow><mrow><mi>C</mi><mi>a</mi><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_{v,i}^\text{Cat-s}(\text{id}_{\mathbb{V}}, r).\text{id}_{\mathbb{V}}, r, J^{r, pv}(B), J^{r, pc}(B), H_h(B&#x27;), H_i(B&#x27;) \leftarrow \text{Dec}_{SC}(M_{v, i}^{Cat-s}(\text{id}_{\mathbb{V}}, r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2361em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4413em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">Cat-s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mord">.</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2944em;vertical-align:-0.413em;"></span><span class="mord"><span class="mord text"><span class="mord">Dec</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">SC</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8815em;"><span style="top:-2.4231em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>M</mi><mrow><mi>v</mi><mo separator="true">,</mo><mi>i</mi></mrow><mtext>Cat-s</mtext></msubsup><mo stretchy="false">(</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub><mo mathvariant="normal">≠</mo><msub><mtext>id</mtext><mi mathvariant="double-struck">V</mi></msub></mrow><annotation encoding="application/x-tex">M_{v, i}^\text{Cat-s}(\text{id}_{\mathbb{V}}, r).\text{id}_{\mathbb{V}} \neq \text{id}_{\mathbb{V}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2361em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4413em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">Cat-s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mord">.</span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">id</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3322em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span style="font-weight:bold;">error</span> ‘‘Catching up on different set&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>⩽</mo></mrow><annotation encoding="application/x-tex">r \leqslant</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩽</span></span></span></span> <span style="font-style:normal;font-variant:small-caps;">Leading-Round</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span style="font-weight:bold;">error</span> ‘‘Catching up in to the past&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">8:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J^{r, pv}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> <span style="font-weight:bold;">is not</span>   valid<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">9:</span><span style="font-weight:bold;">error</span> ‘‘Invalid pre-vote justification&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">10:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">11:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>c</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J^{r, pc}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> <span style="font-weight:bold;">is not</span>   valid<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">12:</span><span style="font-weight:bold;">error</span> ‘‘Invalid pre-commit justification&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">13:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">14:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">G \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">GRANDPA-GHOST</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>v</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J^{r, pv}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">15:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>=</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">G = \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">16:</span><span style="font-weight:bold;">error</span> ‘‘GHOST-less Catch-up&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">17:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">18:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> <span style="font-weight:bold;">is not</span>   completable<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">19:</span><span style="font-weight:bold;">error</span> ‘‘Catch-up round is not completable&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">20:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">21:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>J</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>p</mi><mi>c</mi></mrow></msup><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J^{r, pc}(B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> justifies <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">B&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> finalization<span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">22:</span><span style="font-weight:bold;">error</span> ‘‘Unjustified Catch-up target finalization&#39;&#39;</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">23:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">24:</span><span style="font-style:normal;font-variant:small-caps;">Last-Completed-Round</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">\leftarrow r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">25:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">V</mi></mrow><annotation encoding="application/x-tex">i \in \mathbb{V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">V</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">26:</span><span class="ps-funcname">Play-Grandpa-round</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">27:</span><span class="ps-keyword">end if</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 22. <a href="#algo-process-catchup-response">Process-Catchup-Response</a></div>
          </div>
<div class="paragraph">
<p>where \$M_(v,i)^("Cat"-s)("id"_(bbb V),r)\$ is the catch-up response
received from node \$v\$ (<a href="#defn-grandpa-catchup-response-msg">Definition 49</a>).</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-grandpa-beefy"><a class="anchor" href="#sect-grandpa-beefy"></a><a class="link" href="#sect-grandpa-beefy">6.7. Bridge design (BEEFY)</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The BEEFY protocol is currently in early development and subject to
change. The specification has not been completed yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The BEEFY (Bridge Effiency Enabling Finality Yielder) is a secondary protocol to
GRANDPA to support efficient bridging between the Polkadot network (relay chain)
and remote, segregated blockchains, such as Ethereum, which were not built with
the Polkadot interchain operability in mind. The protocol allows participants of
the remote network to verify finality proofs created by the Polkadot relay chain
validators. In other words: clients in the Ethereum network should able to
verify that the Polkadot network is at a specific state.</p>
</div>
<div class="paragraph">
<p>Storing all the information necessary to verify the state of the remote chain,
such as the block headers, is too expensive. BEEFY stores the information in a
space-efficient way and clients can request additional information over the
protocol.</p>
</div>
<div class="sect3">
<h4 id="id-preliminaries-2"><a class="anchor" href="#id-preliminaries-2"></a><a class="link" href="#id-preliminaries-2">6.7.1. Preliminaries</a></h4>
<div id="defn-mmr" class="exampleblock">
<div class="title">Definition 91. <a href="#defn-mmr">Merkle Mountain Ranges</a></div>
<div class="content">
<div class="paragraph">
<p>Merkle Mountain Ranges, <strong>MMR</strong>, are used
as an efficient way to send block headers and signatures to light clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MMRs have not been defined yet.
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="defn-beefy-statement" class="exampleblock">
<div class="title">Definition 92. <a href="#defn-beefy-statement">Statement</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>statement</strong> is the same piece of information which every relay chain
validator is voting on. Namely, the MMR root of all the block header hashes
leading up to the latest, finalized block.</p>
</div>
</div>
</div>
<div id="defn-beefy-witness-data" class="exampleblock">
<div class="title">Definition 93. <a href="#defn-beefy-witness-data">Witness Data</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Witness data</strong> contains the statement (<a href="#defn-beefy-statement">Definition 92</a>), an array
indicating which validator of the Polkadot network voted for the statement (but
not the signatures themselves) and a MMR root of the signatures. The indicators
of which validator voted for the statement are just claims and provide no
proofs. The network message is defined in
<a href="#defn-grandpa-beefy-signed-commitment-witness">Definition 53</a> and the relayer saves it on the
chain of the remote network.</p>
</div>
</div>
</div>
<div id="defn-beefy-light-client" class="exampleblock">
<div class="title">Definition 94. <a href="#defn-beefy-light-client">Light Client</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>light client</strong> is an abstract entity in a remote network such as Ethereum. It
can be a node or a smart contract with the intent of requesting finality proofs
from the Polkadot network. A light client reads the witness data
(<a href="#defn-beefy-witness-data">Definition 93</a> from the chain, then requests the signatures
directly from the relayer in order to verify those.</p>
</div>
<div class="paragraph">
<p>The light client is expected to know who the validators are and has
access to their public keys.</p>
</div>
</div>
</div>
<div id="defn-beefy-relayer" class="exampleblock">
<div class="title">Definition 95. <a href="#defn-beefy-relayer">Relayer</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>relayer</strong> (or "prover") is an abstract entity which takes finality proofs from
the Polkadot network and makes those available to the light clients. Inherently,
the relayer tries to convince the light clients that the finality proofs have
been voted for by the Polkadot relay chain validators. The relayer operates
offchain and can for example be a node or a collection of nodes.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-voting-on-statements"><a class="anchor" href="#id-voting-on-statements"></a><a class="link" href="#id-voting-on-statements">6.7.2. Voting on Statements</a></h4>
<div class="paragraph">
<p>The Polkadot Host signs a statement (<a href="#defn-beefy-statement">Definition 92</a>) and gossips it as
part of a vote (<a href="#defn-msg-beefy-gossip">Definition 51</a>) to its peers on every new, finalized
block. The Polkadot Host uses ECDSA for signing the statement, since Ethereum
has better compatibility for it compared to SR25519 or ED25519.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-beefy-committing-witnesses"><a class="anchor" href="#sect-beefy-committing-witnesses"></a><a class="link" href="#sect-beefy-committing-witnesses">6.7.3. Committing Witnesses</a></h4>
<div class="paragraph">
<p>The relayer (<a href="#defn-beefy-relayer">Definition 95</a>) participates in the Polkadot network by
collecting the gossiped votes (<a href="#defn-msg-beefy-gossip">Definition 51</a>). Those votes are
converted into the witness data structure (<a href="#defn-beefy-witness-data">Definition 93</a>).
The relayer saves the data on the chain of the remote network. The occurrence of
saving witnesses on remote networks is undefined.</p>
</div>
</div>
<div class="sect3">
<h4 id="id-requesting-signed-commitments"><a class="anchor" href="#id-requesting-signed-commitments"></a><a class="link" href="#id-requesting-signed-commitments">6.7.4. Requesting Signed Commitments</a></h4>
<div class="paragraph">
<p>A light client (<a href="#defn-beefy-light-client">Definition 94</a>) fetches the witness data
(<a href="#defn-beefy-witness-data">Definition 93</a>) from the chain. Once the light client knows which
validators apparently voted for the specified statement, it needs to request the
signatures from the relayer to verify whether the claims are actually true. This
is achieved by requesting signed commitments
(<a href="#defn-grandpa-beefy-signed-commitment">Definition 52</a>).</p>
</div>
<div class="paragraph">
<p>How those signed commitments are requested by the light client and delivered by
the relayer varies among networks or implementations. On Ethereum, for example,
the light client can request the signed commitments in form of a transaction,
which results in a response in form of a transaction.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-lightclient"><a class="anchor" href="#sect-lightclient"></a><a class="link" href="#sect-lightclient">7. Light Clients</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect-requirements-lightclient"><a class="anchor" href="#sect-requirements-lightclient"></a><a class="link" href="#sect-requirements-lightclient">7.1. Requirements for Light Clients</a></h3>
<div class="paragraph">
<p>We list requirements of a Light Client categorized along the the three dimensions of Functionality, Efficiency, and Security.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Functional Requirements:</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update state (<a href="#sect-state-storage">Section 2.4</a>) to reflect the latest view of the blockchain via synchronization with full nodes.</p>
</li>
<li>
<p>(Optional) Verify validity of runtime transitions (<a href="#sect-runtime-interaction">Section 2.6</a>).</p>
</li>
<li>
<p>Make queries for data at the latest block height or across a range of blocks.</p>
</li>
<li>
<p>Append extrinsics (<a href="#sect-extrinsics">Section 2.3</a>) to the blockchain via full nodes.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Efficiency Requirements:</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Efficient bootstrapping and syncing: initializations and update functions of the state have tractable computation and communication complexity and grows at most linearly with the chain size. Generally, the complexity is proportional to the GRANDPA validator set change.</p>
</li>
<li>
<p>Querying operations happen by requesting athe key-value pair from a full node.</p>
</li>
<li>
<p>Further, verifying the validity of responses by the full node is logarithmic in the size of the state.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Security Requirements:</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Secure bootstrapping and Synchronizing: Probability that an adversarial full node convincing a light client of a forged blockchain state is negligible.</p>
</li>
<li>
<p>Secure querying: Probability that an adversary convinces  light client to accept a forged account state os negligible.</p>
</li>
<li>
<p>Assure that the submitted extrinsics are appended in a successor block or inform the user incase of failure.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Polkadot Specific Requirements:</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client MUST be able to connect to a relay chain using chain state.</p>
</li>
<li>
<p>The client MUST be able to retrieve checkpoint state from a trusted source to speed up initialization.</p>
</li>
<li>
<p>The client MUST be able to subscribe/unsubscribe to/from any polkadot-spec-conformant relay chain (Polkadot, Westend, Kusama)</p>
</li>
<li>
<p>The client MUST be able to subscribe/unsubscribe to/from parachains that do not use custom protocols or cryptography methods other than those that Polkadot, Westend and Kusama use.</p>
</li>
<li>
<p>The client MUST support the following <a href="https://github.com/paritytech/json-rpc-interface-spec">RPC methods</a>: <code>rpc_methods</code>,  <code>chainHead_unstable_follow</code>, <code>chainHead_unstable_unfollow</code>, <code>chainHead_unstable_unpin</code>, <code>chainHead_unstable_storage</code>, <code>chainHead_unstable_call</code> <code>chainHead_unstable_stopCall</code>. <code>transaction_unstable_submitAndWatch</code>, and <code>transaction_unstable_unwatch</code></p>
</li>
<li>
<p>The client MUST support the @substrate/connect <a href="https://github.com/paritytech/substrate-connect/tree/main/packages/connect-extension-protocol">connection extension protocol</a>:
<code>ToApplicationError</code>, <code>ToApplicationChainReady</code>, <code>ToApplicationRpc</code>, <code>ToExtensionAddChain</code>, <code>ToExtensionAddWellKnownChain</code>, <code>ToExtensionRpc</code>, <code>ToExtensionRemoveChain</code>.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-sync-warp-lightclient"><a class="anchor" href="#sect-sync-warp-lightclient"></a><a class="link" href="#sect-sync-warp-lightclient">7.2. Warp Sync for Light Clients</a></h3>
<div class="paragraph">
<p>Warp sync (<a href="#sect-msg-warp-sync">Section 4.8.4</a>) only downloads the block headers where
authority set changes occurred, so-called fragments (<a href="#defn-warp-sync-proof">Definition 41</a>),
and by verifying the GRANDPA justifications (<a href="#defn-grandpa-justification">Definition 78</a>).
This protocol allows nodes to arrive at the desired state much faster than fast
sync. Warp sync is primarily designed for Light Clients. Although, warp sync could be used by full nodes, the sync process mahy lack information to cater to complete functionality set of full nodes.</p>
</div>
<div class="paragraph">
<p>For light clients, it is too expensive to download the state (approx. 550MB) to respond to queries. Rather, the queries are submitted to the Full node and only the response of the full node is validated using the hash of the state root.   Requests for warp sync are performed using the <code>/dot/sync/warp</code> <em>Request-Response</em> substream, the corresponding network messages are detailed in <a href="#sect-protocols-substreams">Section 4.7</a>.</p>
</div>
<div class="paragraph">
<p>Light clients base their trust in provided snapshots and the ability to slash grandpa votes for equivocation for the period they are syncing via warp sync. Full nodes and above in contrast verify each block indvidually.</p>
</div>
<div class="paragraph">
<p>In theory, the <code>warp sync</code> process takes the Genesis Block as input and outputs the hash of the state trie root at the latest finalized block. This root hash acts as proof to further validate the responses to queries by the full node. The <code>warp sync</code> works by starting from a trusted specified block (for e.g. from a snapshot) and verifying the block headers only at the authority set changes.</p>
</div>
<div class="paragraph">
<p>Eventually, the light client verifies the finality of the block returned by a full node to ensure that the block is indeed the latest finalized block. This entails two things:
    . check the authenticity of GRANDPA Justifications messages from Genesis to the last finalized block,
    . Check the timestamp of the last finalized block to ensure that no other blocks might have been finalized at a later timestamp.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Long-Range Attack Vulnerabilities</strong>: Warp syncing is particularly vulnerable to what is called long-range attacks. The authorities allowed to finalize blocks can generate multiple proofs of finality for
multiple different blocks of the same height, hence, they can finalize more than one chain at a time.
It is possible for two-thirds of the validators that were active at a certain
past block N to collude and decide to finalize a different block N', even when N has been
finalized for the first time several weeks or months in the past. When a client then warp syncs, it can be tricked to consider this alternative block N' as the finalized one. However, in practice, to mitigate Long-Range Attacks, the starting point of the warp syncing is not too far in the past. How far exactly depends on the logic of the runtime of the chain. For example, in Polkadot, the starting block for the sync should be at max 28 days old, to be within the purview of the slashing period for misbehaving nodes. Hence, even though in theory warp sync can start from Genesis Block, it is not advised to implement the same in practice.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We outline the warp sync process, abstracting out details of verifying the finality and how the full node to sync with is selected.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="warp-sync" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 23 </span><span style="font-style:normal;font-variant:small-caps;">Warp-Sync-Light-Clients</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span>BlockHeader startblock, the initial block to start the sync. May not be the Genesis Block.</p>
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Output: </span>CommitmentRootHash <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">root</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">roo</span><span class="mord mathnormal">t</span></span></span></span>, State Tries Root hash of the latest finalized Block.</p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span style="font-style:normal;font-variant:small-caps;">fullnode</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo></mrow><annotation encoding="application/x-tex">\leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span></span></span></span> SelectFullNode</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span style="font-style:normal;font-variant:small-caps;">latestBlockHeader, grandpaJustifications</span>   <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo></mrow><annotation encoding="application/x-tex">\leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span></span></span></span> SyncWithNode(<span style="font-style:normal;font-variant:small-caps;">fullnode</span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span style="font-style:normal;font-variant:small-caps;">isVerified</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo></mrow><annotation encoding="application/x-tex">\leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span></span></span></span> verifyAuthoritySetChange(<span style="font-style:normal;font-variant:small-caps;">grandpaJustifications</span>) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∧</mo></mrow><annotation encoding="application/x-tex">\land</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∧</span></span></span></span> verifyFinality(<span style="font-style:normal;font-variant:small-caps;">latestBlockHeader</span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">if </span><span style="font-style:normal;font-variant:small-caps;">isVerified</span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">return</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">n</span></span></span></span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">SOME</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">SOME</span></span></span></span> getCommitmentRootHash(<span style="font-style:normal;font-variant:small-caps;">latestBlockHeader</span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">7:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">throw</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>R</mi><mi>R</mi><mi>O</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">ERROR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">ERROR</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 23. <a href="#warp-sync">Warp-Sync-Light-Clients</a></div>
          </div>
<div class="paragraph">
<p>Abstraction of Warp Sync and verification of latest block&#8217;s finality.
SelectFullNode: determines the full node that the light client syncs with.
SyncSithNode: Returns the header of latest finalized block and a list of Grandpa Justifications by the full node.
verifyAuthoritySetChange: verification algorithm which checks the authenticity of the header only at the end of an era where the authority set changes iteratively until reaching the latest era.
verifyFinalty: verifies the finalty of the latest block using the Grandpa Justifications messages.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The warp syncing process is closely coupled with the state querying procedure used the light client. We outline the process of querying the state by a light client and validating the response.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-light-clients-query-state" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 24 </span><span style="font-style:normal;font-variant:small-caps;">Querying-State-Light-Clients</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Input: </span>Query q, BlockHeight h, CommitmentRootHash <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">root</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">roo</span><span class="mord mathnormal">t</span></span></span></span></p>
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Output: </span>Maybe Result <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">res</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">res</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">res</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">res</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span>) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>←</mo><mi>Q</mi><mi>u</mi><mi>e</mi><mi>r</mi><mi>y</mi><mi>F</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>N</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo stretchy="false">(</mo><mi>q</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\leftarrow QueryFullNode (q, h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.03588em;">ery</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.10903em;">llN</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">h</span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">if </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>i</mi><mi>t</mi><mi>y</mi><mi>C</mi><mi>h</mi><mi>e</mi><mi>c</mi><msub><mi>k</mi><mrow><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mi>e</mi><mi>s</mi><mo separator="true">,</mo><mi>π</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">validityCheck_{root}(res, \pi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ec</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">roo</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">res</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mclose">)</span></span></span></span><span class="ps-keyword"> then</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">return</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">n</span></span></span></span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">SOME</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">SOME</span></span></span></span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">res</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">res</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">end if</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">throw</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>R</mi><mi>R</mi><mi>O</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">ERROR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">ERROR</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 24. <a href="#algo-light-clients-query-state">Querying-State-Light-Clients</a></div>
          </div>
<div class="paragraph">
<p>Querying State Algorithm.
\(QueryFullNode\): returns the response to the query requested from the Full Node for the query \(q\) at block height \(h\).
\(validityCheck_{root}\): predicate that checks the validity of response \(res\) and associated merkle proof \(\pi\) by matching it against the Commit Root Hash \(root\) obtained as a result of warp sync.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-environment-lightclient"><a class="anchor" href="#sect-runtime-environment-lightclient"></a><a class="link" href="#sect-runtime-environment-lightclient">7.3. Runtime Environment for Light Clients</a></h3>
<div class="paragraph">
<p>Technically, though a runtime execution environment is not necessary to build a light client, most clients require interacting with the Runtime and the state of the blockchain for integrity checks at the minimum. One can imagine an application scenarios like an on-chain light client which only listens to the latest state without ever adding extrinsics. Current implementations of Light Nodes (for e.g. Smoldot) uses the wasmtime as its runtime environment to drastically simplify the code. The performance of wasmtime is satisfying enough to not require a native runtime.
The details of runtime API that the environment needs to suppport can be found in Appendix C (<a href="#chap-runtime-api">Appendix C</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-light-msg"><a class="anchor" href="#sect-light-msg"></a><a class="link" href="#sect-light-msg">7.4. Light Client Messages</a></h3>
<div class="paragraph">
<p>Light clients are applications that fetch the required data that they need from
a Polkadot node with an associated proof to validate the data. This makes it
possible to interact with the Polkadot network without requiring to run a full
node or having to trust the remote peers. The light client messages make this
functionality possible.</p>
</div>
<div class="paragraph">
<p>All light client messages are protobuf encoded and are sent over the
<code>/dot/light/2</code> substream.</p>
</div>
<div class="sect3">
<h4 id="id-request"><a class="anchor" href="#id-request"></a><a class="link" href="#id-request">7.4.1. Request</a></h4>
<div class="paragraph">
<p>A message with all possible request messages. All message are sent as part of
this message.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oneof</code> (<code>request</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request type</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Where the <code>request</code> can be one of the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemoteCallRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A remote call request (<a href="#sect-light-remote-call-request">Definition 96</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemoteReadRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A remote read request (<a href="#sect-light-remote-read-request">Definition 98</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemoteReadChildRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A remote read child request (<a href="#sect-light-remote-read-child-request">Definition 100</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="id-response"><a class="anchor" href="#id-response"></a><a class="link" href="#id-response">7.4.2. Response</a></h4>
<div class="paragraph">
<p>A message with all possible response messages. All message are sent as part of
this message.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oneof</code> (<code>response</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response type</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Where the <code>response</code> can be one of the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemoteCallResponse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A remote call response (<a href="#sect-light-remote-call-response">Definition 97</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemoteReadResponse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A remote read response (<a href="#sect-light-remote-read-response">Definition 99</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="id-remote-call-messages"><a class="anchor" href="#id-remote-call-messages"></a><a class="link" href="#id-remote-call-messages">7.4.3. Remote Call Messages</a></h4>
<div class="paragraph">
<p>Execute a call to a contract at the given block.</p>
</div>
<div id="sect-light-remote-call-request" class="exampleblock">
<div class="title">Definition 96. <a href="#sect-light-remote-call-request">Remote Call Request</a></div>
<div class="content">
<div class="paragraph">
<p>Remote call request.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block at which to perform call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call data</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sect-light-remote-call-response" class="exampleblock">
<div class="title">Definition 97. <a href="#sect-light-remote-call-response">Remote Call Response</a></div>
<div class="content">
<div class="paragraph">
<p>Remote call response.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) containing the call proof or <em>None</em> if proof generation failed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-remote-read-messages"><a class="anchor" href="#id-remote-read-messages"></a><a class="link" href="#id-remote-read-messages">7.4.4. Remote Read Messages</a></h4>
<div class="paragraph">
<p>Read a storage value at the given block.</p>
</div>
<div id="sect-light-remote-read-request" class="exampleblock">
<div class="title">Definition 98. <a href="#sect-light-remote-read-request">Remote Read Request</a></div>
<div class="content">
<div class="paragraph">
<p>Remote read request.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block at which to perform call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repeated bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage keys</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sect-light-remote-read-response" class="exampleblock">
<div class="title">Definition 99. <a href="#sect-light-remote-read-response">Remote Read Response</a></div>
<div class="content">
<div class="paragraph">
<p>Remote read response.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) containing the read proof or <em>None</em> if proof generation failed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-remote-read-child-messages"><a class="anchor" href="#id-remote-read-child-messages"></a><a class="link" href="#id-remote-read-child-messages">7.4.5. Remote Read Child Messages</a></h4>
<div class="paragraph">
<p>Read a child storage value at the given block.</p>
</div>
<div id="sect-light-remote-read-child-request" class="exampleblock">
<div class="title">Definition 100. <a href="#sect-light-remote-read-child-request">Remote Read Child Request</a></div>
<div class="content">
<div class="paragraph">
<p>Remote read child request.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block at which to perform call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Child storage key, this is relative to the child type storage location</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage keys</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph">
<p>The response is the same as for the <em>Remote Read Request</em> message, respectively
<a href="#sect-light-remote-read-response">Definition 99</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-storage-lightclient"><a class="anchor" href="#sect-storage-lightclient"></a><a class="link" href="#sect-storage-lightclient">7.5. Storage for Light Clients</a></h3>
<div class="paragraph">
<p>The light client requires a persistent storage for saving the state of the blockchain. In addition it requires efficient Serialization/ De-serialization methods to transform SCALE (<a href="#sect-scale-codec">Section A.2.2</a>) encoded network traffic for storing and reading from the persistent storage.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-anv"><a class="anchor" href="#chapter-anv"></a><a class="link" href="#chapter-anv">8. Availability &amp; Validity</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Polkadot serves as a replicated shared-state machine designed to resolve
scalability issues and interoperability among blockchains. The validators of
Polkadot execute transactions and participate in the consensus of Polkadots
primary chain, the so called relay chain. Parachains are independent networks
that maintain their own state and are connected to the relay chain. Those
parachains can take advantage of the relay chain consensus mechanism, including
sending and receiving messages to and from other parachains. Parachain nodes
that send parachain blocks, known as candidates, to the validators in order to
be included in relay chain are referred to as collators.</p>
</div>
<div class="paragraph">
<p>The Polkadot relay chain validators are responsible for guaranteeing the
validity of both relay chain and parachain blocks. Additionally, the validators
are required to keep enough parachain blocks that should be included in the
relay chain available in their local storage in order to make those retrievable
by peers, who lack the information, to reliably confirm the issued validity
statements about parachain blocks. The Availability &amp; Validity (AnV) protocol
consists of multiple steps for successfully upholding those responsibilities.</p>
</div>
<div class="paragraph">
<p>Parachain blocks themselves are produced by collators (<a href="#sect-collations">Section 8.1</a>),
whereas the relay chain validators only verify their validity (and later, their
availability). It is possible that the collators of a parachain  produces
multiple parachain block candidates for a child of a specific block.
Subsequently, they send the block candidates to the the relay chain validators
who are assigned to the specific parachain. The assignment is determined by the
Runtime (<a href="#sect-candidate-backing">Section 8.2</a>). Those validators are then required to
check the validity of submitted candidates (<a href="#sect-candidate-validation">Section 8.3</a>), then
issue and collect statements (<a href="#sect-candidate-statements">Section 8.2.1</a>) about the validity
of candidates to other validators. This process is known as candidate backing.
Once a candidate meets a specified criteria for inclusion, the selected relay
chain block author then choses any of the backed candidate for each parachain
and includes those into the relay chain block (<a href="#sect-candidate-inclusion">Section 8.2.2</a>).</p>
</div>
<div class="paragraph">
<p>Every relay chain validator must fetch the proposed candidates and issue votes
on whether they have the candidate saved in their local storage, so called
availability votes (<a href="#sect-availability-votes">Section 8.4.1</a>), then also collect the votes
sent by other validators and include them in the relay chain state
(<a href="#sect-candidate-inclusion">Section 8.2.2</a>). This process ensures that only relay chain
blocks get finalized where each candidate is available on enough nodes of
validators.</p>
</div>
<div class="paragraph">
<p>Parachain candidates contained in non-finalized relay chain blocks must then be
retrieved by a secondary set of relay chain validators, unrelated from the
candidate backing process, who are randomly assigned to determine the validity
of specific parachains based on a VRF lottery and are then required to vote on
the validity of those candidates. This process is known as approval voting
(<a href="#sect-approval-voting">Section 8.5</a>). If a validator does not have the candidate data, it
must recover the candidate data (<a href="#sect-candidate-recovery">Section 8.4.2</a>).</p>
</div>
<div class="sect2">
<h3 id="sect-collations"><a class="anchor" href="#sect-collations"></a><a class="link" href="#sect-collations">8.1. Collations</a></h3>
<div class="paragraph">
<p>Collations are proposed candidates <a href="#defn-candidate">Definition 131</a> to the Polkadot relay
chain validators. The Polkodat network protocol is agnostic on what candidate
productionis mechanism each parachain uses and does not specify or mandate any
of such production methods (e.g. BABE-GRANDPA, Aura, etc). Furthermore, the
relay chain validator host implementation itself does not directly interpret or
process the internal transactions of the candidate, but rather rely on the
parachain Runtime to validate the candidate (<a href="#sect-candidate-validation">Section 8.3</a>).
Collators, which are parachain nodes which produce candidate proposals and send
them to the relay chain validator, must prepare pieces of data
(<a href="#defn-collation">Definition 101</a>) in order to correctly comply with the requirements of the
parachain protocol.</p>
</div>
<div id="defn-collation" class="exampleblock">
<div class="title">Definition 101. <a href="#defn-collation">Collation</a></div>
<div class="content">
<div class="paragraph">
<p>A collation is a datastructure which contains the proposed parachain candidate,
including an optional validation parachain Runtime update and upward messages.
The collation datastructure, C, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$C = (M,H,R,h,P,p,w)\$
\$M = (u_n,…u_m)\$
\$H = (z_n,…z_m)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M\$ is an array of upward messages (<a href="#defn-upward-message">Definition 137</a>), \$u\$,
interpreted by the relay chain itself.</p>
</li>
<li>
<p>\$H\$ is an array of outbound horizontal messages
(<a href="#defn-outbound-hrmp-message">Definition 139</a>), \$z\$, interpreted by other parachains.</p>
</li>
<li>
<p>\$R\$ is an <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) which can contain a
parachain Runtime update. The new Runtime code is an array of bytes.</p>
</li>
<li>
<p>\$h\$ is the head data (<a href="#defn-head-data">Definition 133</a>) produced as a result of
execution of the parachain specific logic.</p>
</li>
<li>
<p>\$P\$ is the PoV block (<a href="#defn-para-block">Definition 132</a>).</p>
</li>
<li>
<p>\$p\$ is an unsigned 32-bit integer indicating the number of processed
downward messages (<a href="#defn-downward-message">Definition 138</a>).</p>
</li>
<li>
<p>\$w\$ is an unsigned 32-bit integer indicating the mark up to which all
inbound HRMP messages have been processed by the parachain.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-candidate-backing"><a class="anchor" href="#sect-candidate-backing"></a><a class="link" href="#sect-candidate-backing">8.2. Candidate Backing</a></h3>
<div class="paragraph">
<p>The Polkadot validator receives an arbitrary number of parachain candidates with
associated proofs from untrusted collators. The assigned validators of each
parachain (<a href="#defn-validator-groups">Definition 136</a>) must verify and select a specific quantity
of the proposed candidates and issue those as backable candidates to its peers.
A candidate is considered backable when at least 2/3 of all assigned validators
have issued a <em>Valid</em> statement about that candidate, as described in
<a href="#sect-candidate-statements">Section 8.2.1</a>. Validators can retrieve information about
assignments via the Runtime APIs <a href="#sect-rt-api-validator-groups">Section C.9.2</a> respectively
<a href="#sect-rt-api-availability-cores">Section C.9.3</a>.</p>
</div>
<div class="sect3">
<h4 id="sect-candidate-statements"><a class="anchor" href="#sect-candidate-statements"></a><a class="link" href="#sect-candidate-statements">8.2.1. Statements</a></h4>
<div class="paragraph">
<p>The assigned validator checks the validity of the proposed parachains blocks
(<a href="#sect-candidate-validation">Section 8.3</a>) and issues <em>Valid</em> statements
(<a href="#defn-statement">Definition 102</a>) to its peers if the verification succeeded.
Broadcasting failed verification as <em>Valid</em> statements is a slashable offense. The
validator must only issue one <em>Seconded</em> statement, based on an arbitrary metric,
which implies an explicit vote for a candidate to be included in the relay
chain.</p>
</div>
<div class="paragraph">
<p>This protocol attempts to produce as many backable candidates as possible, but
does not attempt to determine a final candidate for inclusion. Once a parachain
candidate has been seconded by at least one other validator and enough Valid
statements have been issued about that candidate to meet the 2/3 quorum, the
candidate is ready to be included in the relay chain
(<a href="#sect-candidate-inclusion">Section 8.2.2</a>).</p>
</div>
<div class="paragraph">
<p>The validator issues validity statements votes in form of a validator protocol
message (<a href="#net-msg-validator-protocol-message">Definition 114</a>).</p>
</div>
<div id="defn-statement" class="exampleblock">
<div class="title">Definition 102. <a href="#defn-statement">Statement</a></div>
<div class="content">
<div class="paragraph">
<p>A statement, \$S\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$S = (d,A_i,A_s)\$
\$d = {(1,-&gt;,C_r),(2,-&gt;,C_h):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$d\$ is a varying datatype where <em>1</em> indicates that the validator
“seconds” a candidate, meaning that the candidate should be included in the
relay chain, followed by the committed candidate receipt
(<a href="#defn-committed-candidate-receipt">Definition 105</a>), \$C_r\$. <em>2</em> indicates that the
validator has deemed the candidate valid, followed by the candidate hash.</p>
</li>
<li>
<p>\$C_h\$ is the candidate hash.</p>
</li>
<li>
<p>\$A_i\$ is the validator index in the authority set that signed this statement.</p>
</li>
<li>
<p>\$A_s\$ is the signature of the validator.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-candidate-inclusion"><a class="anchor" href="#sect-candidate-inclusion"></a><a class="link" href="#sect-candidate-inclusion">8.2.2. Inclusion</a></h4>
<div class="paragraph">
<p>The Polkadot validator includes the backed candidates as parachain inherent data
(<a href="#defn-parachain-inherent-data">Definition 103</a>) into a block as described <a href="#sect-inherents">Section 2.3.3</a>.
The relay chain block author decides on whatever metric which candidate should
be selected for inclusion, as long as that candidate is valid and meets the
validity quorum of 2/3+ as described in <a href="#sect-candidate-statements">Section 8.2.1</a>. The
candidate approval process (<a href="#sect-approval-voting">Section 8.5</a>) ensures that only relay
chain blocks are finalized where each candidate for each availability core meets
the requirement of 2/3+ availability votes.</p>
</div>
<div id="defn-parachain-inherent-data" class="exampleblock">
<div class="title">Definition 103. <a href="#defn-parachain-inherent-data">Parachain Inherent Data</a></div>
<div class="content">
<div class="paragraph">
<p>The parachain inherent data contains backed candidates and is included when
authoring a relay chain block. The datastructure, \$I\$, is of the following
format:</p>
</div>
<div class="stemblock">
<div class="content">
\$I = (A,T,D,P_h)\$
\$T = (C_0,…C_n)\$
\$D = (*d_n,…d_m)\$
\$C = (R,V,i)\$
\$V = (a_n,…a_m)\$
\$a = {(1,-&gt;,s),(2,-&gt;,s):}\$
\$A = (L_n,…L_m)\$
\$L = (b,v_i,s)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$A\$ is an array of signed bitfields by validators claiming the candidate
is available (or not). The array must be sorted by validator index corresponding
to the authority set (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$T\$ is an array of backed candidates for inclusing in the current block.</p>
</li>
<li>
<p>\$D\$ is an array of disputes.</p>
</li>
<li>
<p>\$P_h\$ is the parachain parent head data (<a href="#defn-head-data">Definition 133</a>).</p>
</li>
<li>
<p>\$d\$ is a dispute statement (<a href="#net-msg-dispute-request">Section 8.7.2.1</a>).</p>
</li>
<li>
<p>\$R\$ is a committed candidate receipt (<a href="#defn-committed-candidate-receipt">Definition 105</a>).</p>
</li>
<li>
<p>\$V\$ is an array of validity votes themselves, expressed as signatures.</p>
</li>
<li>
<p>\$i\$ is a bitfield of indices of the validators within the validator
group (<a href="#defn-validator-groups">Definition 136</a>).</p>
</li>
<li>
<p>\$a\$ is either an implicit or explicit attestation of the validity of a
parachain candidate, where <em>1</em> implies an implicit vote (in correspondence of a
<em>Seconded</em> statement) and <em>2</em> implies an explicit attestation (in correspondence
of a <em>Valid</em> statement). Both variants are followed by the signature of the
validator.</p>
</li>
<li>
<p>\$s\$ is the signature of the validator.</p>
</li>
<li>
<p>\$b\$ the availability bitfield (<a href="#sect-availability-votes">Section 8.4.1</a>).</p>
</li>
<li>
<p>\$v_i\$ is the validator index of the authority set (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-candidate-receipt" class="exampleblock">
<div class="title">Definition 104. <a href="#defn-candidate-receipt">Candidate Receipt</a></div>
<div class="content">
<div class="paragraph">
<p>A candidate receipt, \$R\$, contains information about the candidate and a
proof of the results of its execution. It&#8217;s a datastructure of the following
format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = (D,C_h)\$
</div>
</div>
<div class="paragraph">
<p>where \$D\$ is the candidate descriptor (<a href="#defn-candidate-descriptor">Definition 106</a>) and
\$C_h\$ is the hash of candidate commitments
(<a href="#defn-candidate-commitments">Definition 107</a>).</p>
</div>
</div>
</div>
<div id="defn-committed-candidate-receipt" class="exampleblock">
<div class="title">Definition 105. <a href="#defn-committed-candidate-receipt">Committed Candidate Receipt</a></div>
<div class="content">
<div class="paragraph">
<p>The committed candidate receipt, \$R\$, contains information about the
candidate and the the result of its execution that is included in the relay
chain. This type is similar to the candidate receipt
(<a href="#defn-candidate-receipt">Definition 104</a>), but actually contains the execution results rather
than just a hash of it. It&#8217;s a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = (D,C)\$
</div>
</div>
<div class="paragraph">
<p>where \$D\$ is the candidate descriptor (<a href="#defn-candidate-descriptor">Definition 106</a>) and
\$C\$ is the candidate commitments (<a href="#defn-candidate-commitments">Definition 107</a>).</p>
</div>
</div>
</div>
<div id="defn-candidate-descriptor" class="exampleblock">
<div class="title">Definition 106. <a href="#defn-candidate-descriptor">Candidate Descriptor</a></div>
<div class="content">
<div class="paragraph">
<p>The candidate descriptor, \$D\$, is a unique descriptor of a candidate
receipt. It&#8217;s a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$D = (p,H,C_i,V,B,r,s,p_h,R_h)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$p\$ is the parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
<li>
<p>\$H\$ is the hash of the relay chain block the candidate is executed in the context of.</p>
</li>
<li>
<p>\$C_i\$ is the collators public key.</p>
</li>
<li>
<p>\$V\$ is the hash of the persisted validation data (<a href="#defn-persisted-validation-data">Definition 227</a>).</p>
</li>
<li>
<p>\$B\$ is the hash of the PoV block.</p>
</li>
<li>
<p>\$r\$ is the root of the block&#8217;s erasure encoding Merkle tree.</p>
</li>
<li>
<p>\$s\$ the collator signature of the concatenated components \$p\$,
\$H\$, \$R_h\$ and \$B\$.</p>
</li>
<li>
<p>\$p_h\$ is the hash of the parachain head data (<a href="#defn-head-data">Definition 133</a>) of this candidate.</p>
</li>
<li>
<p>\$R_h\$ is the hash of the parachain Runtime.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-candidate-commitments" class="exampleblock">
<div class="title">Definition 107. <a href="#defn-candidate-commitments">Candidate Commitments</a></div>
<div class="content">
<div class="paragraph">
<p>The candidate commitments, \$C\$, is the result of the execution and
validation of a parachain (or parathread) candidate whose produced values must
be committed to the relay chain. Those values are retrieved from the validation
result (<a href="#defn-validation-result">Definition 109</a>). A candidate commitment is a datastructure
of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$C =(M_u,M_h,R,h,p,w)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M_u\$ is an array of upward messages sent by the parachain. Each
individual message, m, is an array of bytes.</p>
</li>
<li>
<p>\$M_h\$ is an array of individual outbound horizontal messages
(<a href="#defn-outbound-hrmp-message">Definition 139</a>) sent by the parachain.</p>
</li>
<li>
<p>\$R\$ is an <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) that can contain a new
parachain Runtime in case of an update.</p>
</li>
<li>
<p>\$h\$ is the parachain head data (<a href="#defn-head-data">Definition 133</a>).</p>
</li>
<li>
<p>\$p\$ is a unsigned 32-bit integer indicating the number of downward
messages that were processed by the parachain. It is expected that the parachain
processes the messages from first to last.</p>
</li>
<li>
<p>\$w\$ is a unsigned 32-bit integer indicating the watermark which specifies
the relay chain block number up to which all inbound horizontal messages have
been processed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-candidate-validation"><a class="anchor" href="#sect-candidate-validation"></a><a class="link" href="#sect-candidate-validation">8.3. Candidate Validation</a></h3>
<div class="paragraph">
<p>Received candidates submitted by collators and must have its validity verified
by the assigned Polkadot validators. For each candidate to be valid, the
validator must successfully verify the following conditions in the following
order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The candidate does not exceed any parameters in the persisted validation data
(<a href="#defn-persisted-validation-data">Definition 227</a>).</p>
</li>
<li>
<p>The signature of the collator is valid.</p>
</li>
<li>
<p>Validate the candidate by executing the parachain Runtime (<a href="#sect-parachain-runtime">Section 8.3.1</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If all steps are valid, the Polkadot validator must create the necessary
candidate commitments (<a href="#defn-candidate-commitments">Definition 107</a>) and submit the
appropriate statement for each candidate
(<a href="#sect-candidate-statements">Section 8.2.1</a>).</p>
</div>
<div class="sect3">
<h4 id="sect-parachain-runtime"><a class="anchor" href="#sect-parachain-runtime"></a><a class="link" href="#sect-parachain-runtime">8.3.1. Parachain Runtime</a></h4>
<div class="paragraph">
<p>Parachain Runtimes are stored in the relay chain state, and can either be
fetched by the parachain Id or the Runtime hash via the relay chain Runtime API
as described in <a href="#sect-rt-api-validation-code">Section C.9.7</a> and
<a href="#sect-rt-api-validation-code-by-hash">Section C.9.8</a> respectively. The retrieved parachain
Runtime might need to be decompressed based on the magic identifier as described
in <a href="#sect-runtime-compression">Section 8.3.2</a>.</p>
</div>
<div class="paragraph">
<p>In order to validate a parachain block, the Polkadot validator must prepare the
validation parameters (<a href="#defn-validation-parameters">Definition 108</a>), then use its local Wasm
execution environment (<a href="#sect-code-executor">Section 2.6.3</a>) to execute the validate_block
parachain Runtime API by passing on the validation parameters as an argument.
The parachain Runtime function returns the validation result
(<a href="#defn-validation-result">Definition 109</a>).</p>
</div>
<div id="defn-validation-parameters" class="exampleblock">
<div class="title">Definition 108. <a href="#defn-validation-parameters">Validation Parameters</a></div>
<div class="content">
<div class="paragraph">
<p>The validation parameters structure, \$P\$, is required to validate a
candidate against a parachain Runtime. It&#8217;s a datastructure of the following
format:</p>
</div>
<div class="stemblock">
<div class="content">
\$P = (h,b,B_i,S_r)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$h\$ is the parachain head data (<a href="#defn-head-data">Definition 133</a>).</p>
</li>
<li>
<p>\$b\$ is the block body (<a href="#defn-para-block">Definition 132</a>).</p>
</li>
<li>
<p>\$B_i\$ is the latest relay chain block number.</p>
</li>
<li>
<p>\$S_r\$ is the relay chain block storage root (<a href="#sect-merkl-proof">Section 2.4.4</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-validation-result" class="exampleblock">
<div class="title">Definition 109. <a href="#defn-validation-result">Validation Result</a></div>
<div class="content">
<div class="paragraph">
<p>The validation result is returned by the <code>validate_block</code> parachain Runtime API
after attempting to validate a parachain block. Those results are then used in
candidate commitments (<a href="#defn-candidate-commitments">Definition 107</a>), which then will be
inserted into the relay chain via the parachain inherent data
(<a href="#defn-parachain-inherent-data">Definition 103</a>). The validation result, \$V\$, is a
datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$V   = (h,R,M_u,M_h,p_,w)\$
\$M_u = (m_0,…m_n)\$
\$M_h = (t_0,…t_n)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$h\$ is the parachain head data (<a href="#defn-head-data">Definition 133</a>).</p>
</li>
<li>
<p>\$R\$ is an <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) that can contain a new
parachain Runtime in case of an update.</p>
</li>
<li>
<p>\$M_u\$ is an array of upward messages sent by the parachain. Each
individual message, m, is an array of bytes.</p>
</li>
<li>
<p>\$M_h\$ is an array of individual outbound horizontal messages
(<a href="#defn-outbound-hrmp-message">Definition 139</a>) sent by the parachain.</p>
</li>
<li>
<p>\$p\$ is a unsigned 32-bit integer indicating the number of downward
messages that were processed by the parachain. It is expected that the parachain
processes the messages from first to last.</p>
</li>
<li>
<p>\$w\$ is a unsigned 32-bit integer indicating the watermark which specifies
the relay chain block number up to which all inbound horizontal messages have
been processed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-runtime-compression"><a class="anchor" href="#sect-runtime-compression"></a><a class="link" href="#sect-runtime-compression">8.3.2. Runtime Compression</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Runtime compression is not documented yet.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-availability"><a class="anchor" href="#sect-availability"></a><a class="link" href="#sect-availability">8.4. Availability</a></h3>
<div class="sect3">
<h4 id="sect-availability-votes"><a class="anchor" href="#sect-availability-votes"></a><a class="link" href="#sect-availability-votes">8.4.1. Availability Votes</a></h4>
<div class="paragraph">
<p>The Polkadot validator must issue a bitfield (<a href="#defn-bitfield-array">Definition 141</a>) which
indicates votes for the availability of candidates. Issued bitfields can be used
by the validator and other peers to determine which backed candidates meet the
2/3+ availability quorum.</p>
</div>
<div class="paragraph">
<p>Candidates are inserted into the relay chain in form of parachain inherent data
(<a href="#sect-candidate-inclusion">Section 8.2.2</a>) by a block author. A validator can retrieve that
data by calling the appropriate Runtime API entry
(<a href="#sect-rt-api-availability-cores">Section C.9.3</a>), then create a bitfield indicating for
which candidate the validator has availability data stored and broadcast it to
the network (<a href="#net-msg-bitfield-dist-msg">Definition 118</a>). When sending the bitfield
distrubtion message, the validator must ensure \$B_h\$ is set approriately,
therefore clarifying to which state the bitfield is referring to, given that
candidates can vary based on the chain fork.</p>
</div>
<div class="paragraph">
<p>Missing availability data of candidates must be recovered by the validator as
described in <a href="#sect-candidate-recovery">Section 8.4.2</a>. If previously issued bitfields are no
longer accurate, i.e. the availability data has been recovered or the candidate
of an availability core has changed, the validator must create a new bitfield and
broadcast it to the network. Candidates must be kept available by validators for
a specific amount of time. If a candidate does not receive any backing,
validators should keep it available for about one hour, in case the state of
backing does change. Backed and even approved candidates
(<a href="#sect-approval-voting">Section 8.5</a>) must be kept by validators for about 25 hours, since
disputes (<a href="#sect-disputes">Section 8.6</a>) can occur and the candidate needs to be checked
again.</p>
</div>
<div class="paragraph">
<p>The validator issues availability votes in form of a validator protocol message
(<a href="#net-msg-collator-protocol-message">Definition 115</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-candidate-recovery"><a class="anchor" href="#sect-candidate-recovery"></a><a class="link" href="#sect-candidate-recovery">8.4.2. Candidate Recovery</a></h4>
<div class="paragraph">
<p>The availability distribution of the Polkadot validator must be able to recover
parachain candidates that the validator is assigned to, in order to determine
whether the candidate should be backed (<a href="#sect-candidate-backing">Section 8.2</a>) respectively
whether the candidate should be approved (<a href="#sect-approval-voting">Section 8.5</a>).
Additionally, peers can send availability requests as defined in
<a href="#net-msg-chunk-fetching-request">Definition 122</a> and <a href="#net-msg-available-data-request">Definition 124</a> to the
validator, which the validator should be able to respond to.</p>
</div>
<div class="paragraph">
<p>Candidates are recovered by sending requests for specific indices of erasure
encoded chunks (<a href="#sect-erasure-encoding">Section A.4.1</a>). A validator should request chunks by
picking peers randomly and must recover at least \$f+1\$ chunks, where
\$n=3f+k\$ and \$k in {1,2,3}\$. \$n\$ is the number of validators as
specified in the session info, which can be fetched by the Runtime API as
described in <a href="#sect-rt-api-session-info">Section C.9.11</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-approval-voting"><a class="anchor" href="#sect-approval-voting"></a><a class="link" href="#sect-approval-voting">8.5. Approval Voting</a></h3>
<div class="paragraph">
<p>The approval voting process ensures that only valid parachain blocks are
finalized on the relay chain. After <em>backable</em> parachain candidates were
submitted to the relay chain (<a href="#sect-candidate-inclusion">Section 8.2.2</a>), which can be
retrieved via the Runtime API (<a href="#sect-rt-api-availability-cores">Section C.9.3</a>), validators
need to determine their assignments for each parachain and issue approvals for
valid candidates, respectively disputes for invalid candidates. Since it cannot
be expected that each validator verifies every single parachain candidate, this
mechanism ensures that enough honest validators are selected to verify parachain
candidates in order prevent the finalization of invalid blocks. If an honest
validator detects an invalid block which was approved by one or more validators,
the honest validator must issue a disputes which wil cause escalations,
resulting in consequences for all malicious parties, i.e. slashing. This
mechanism is described more in <a href="#sect-availability-assignment-criteria">Section 8.5.1</a>.</p>
</div>
<div class="sect3">
<h4 id="sect-availability-assignment-criteria"><a class="anchor" href="#sect-availability-assignment-criteria"></a><a class="link" href="#sect-availability-assignment-criteria">8.5.1. Assignment Criteria</a></h4>
<div class="paragraph">
<p>Validators determine their assignment based on a VRF mechanism, similar to the
BABE consensus mechanism. First, validators generate an availability core VRF
assignment (<a href="#defn-availability-core-vrf-assignment">Definition 111</a>), which indicates which
availability core a validator is assigned to. Then a delayed availability core
VRF assignment is generated which indicates at what point a validator should
start the approval process. The delays are based on “tranches”
(<a href="#sect-tranches">Section 8.5.2</a>).</p>
</div>
<div class="paragraph">
<p>An assigned validator never broadcasts their assignment until relevant. Once the
assigned validator is ready to check a candidate, the validator broadcasts their
assignment by issuing an approval distribution message
(<a href="#net-msg-approval-distribution">Definition 119</a>), where \$M\$ is of variant <em>0</em>. Other
assigned validators that receive that network message must keep track of if,
expecting an approval vote following shortly after. Assigned validators can
retrieve the candidate by using the availability recovery
(<a href="#sect-candidate-recovery">Section 8.4.2</a>) and then validate the candidate
(<a href="#sect-candidate-validation">Section 8.3</a>).</p>
</div>
<div class="paragraph">
<p>The validator issues approval votes in form of a validator protocol message
(<a href="#net-msg-validator-protocol-message">Definition 114</a>) respectively disputes
(<a href="#sect-disputes">Section 8.6</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-tranches"><a class="anchor" href="#sect-tranches"></a><a class="link" href="#sect-tranches">8.5.2. Tranches</a></h4>
<div class="paragraph">
<p>Validators use a subjective, tick-based system to determine when the approval
process should start. A validator starts the tick-based system when a new
availability core candidates have been proposed, which can be retrieved via the
Runtime API (<a href="#sect-rt-api-availability-cores">Section C.9.3</a>) , and increments the tick every
<em>500 milliseconds</em>. Each tick/increment is referred to as a “tranche”,
represented as an integer, starting at <em>0</em>.</p>
</div>
<div class="paragraph">
<p>As described in <a href="#sect-availability-assignment-criteria">Section 8.5.1</a>, the validator first
executes the VRF mechanism to determine which parachains (availability cores)
the validator is assigned to, then an additional VRF mechanism for each assigned
parachain to determine the <em>delayed assignment</em>. The delayed assignment
indicates the tranche at which the validator should start the approval process.
A tranche of value <em>0</em> implies that the assignment should be started immediately,
while later assignees of later tranches wait until it&#8217;s their term to issue
assignments, determined by their subjective, tick-based system.</p>
</div>
<div class="paragraph">
<p>Validators are required to track broadcasted assignments by other validators
assigned to the same parachain, including verifying the VRF output. Once a valid
assignment from a peer was received, the validator must wait for the following
approval vote within a certain period as described in
<a href="#sect-rt-api-session-info">Section C.9.11</a> by orienting itself on its local, tick-based
system. If the waiting time after a broadcasted assignment exceeds the specified
period, the validator interprets this behavior as a “no-show”, indicating that
more validators should commit on their tranche until enough approval votes have
been collected.</p>
</div>
<div class="paragraph">
<p>If enough approval votes have been collected as described in
<a href="#sect-rt-api-session-info">Section C.9.11</a>, then assignees of later tranches do not have to
start the approval process. Therefore, this tranche system serves as a mechanism
to ensure that enough candidate approvals from a random set of validators are
created without requiring all assigned validators to check the candidate.</p>
</div>
<div id="defn-relay-vrf-story" class="exampleblock">
<div class="title">Definition 110. <a href="#defn-relay-vrf-story">Relay VRF Story</a></div>
<div class="content">
<div class="paragraph">
<p>The relay VRF story is an array of random bytes derived from the VRF submitted
within the block by the block author. The relay VRF story, T, is used as input
to determine approval voting criteria and generated the following way:</p>
</div>
<div class="stemblock">
<div class="content">
\$T = "Transcript"(b_r,b_s,e_i,A)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"Transcript"\$ constructs a VRF transcript (<a href="#defn-vrf-transcript">Definition 175</a>).</p>
</li>
<li>
<p>\$b_r\$ is the BABE randomness of the current epoch (<a href="#defn-epoch-randomness">Definition 71</a>).</p>
</li>
<li>
<p>\$b_s\$ is the current BABE slot (<a href="#defn-epoch-slot">Definition 54</a>).</p>
</li>
<li>
<p>\$e_i\$ is the current BABE epoch index (<a href="#defn-epoch-slot">Definition 54</a>).</p>
</li>
<li>
<p>\$A\$ is the public key of the authority.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-availability-core-vrf-assignment" class="exampleblock">
<div class="title">Definition 111. <a href="#defn-availability-core-vrf-assignment">Availability Core VRF Assignment</a></div>
<div class="content">
<div class="paragraph">
<p>An availability core VRF assignment is computed by a relay chain validator to
determine which availability core (<a href="#defn-availability-core">Definition 135</a>) a validator is
assigned to and should vote for approvals. Computing this assignement relies on
the VRF mechanism, transcripts and STROBE operations described further in
<a href="#sect-vrf">Section A.1.3</a>.</p>
</div>
<div class="paragraph">
<p>The Runtime dictates how many assignments should be conducted by a validator, as
specified in the session index which can be retrieved via the Runtime API
(<a href="#sect-rt-api-session-info">Section C.9.11</a>). The amount of assignments is referred to as
“samples”. For each iteration of the number of samples, the validator calculates
an individual assignment, \$T\$, where the little-endian encoded sample
number, \$s\$, is incremented by one. At the beginning of the iteration,
\$S\$ starts at value <em>0</em>.</p>
</div>
<div class="paragraph">
<p>The validator executes the following steps to retrieve a (possibly valid) core index:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 larr "Transcript"("'A&amp;V MOD'")\$
\$t_2 larr "append"(t_1, "'RC-VRF'", R_s)\$
\$t_3 larr "append"(t_2, "'sample'", s)\$
\$t_4 larr "append"(t_3, "'vrf-nm-pk'", p_k)\$
\$t_5 larr "meta-ad"(t_4, "'VRFHash'", "False")\$
\$t_6 larr "meta-ad"(t_5, 64_("le"), "True")\$
\$i larr "prf"(t_6, "False")\$
\$o = s_k * i\$
</div>
</div>
<div class="paragraph">
<p>where \$s_k\$ is the secret key, \$p_k\$ is the public key and
\$64_("le")\$ is the integer <em>64</em> encoded as little endian. \$R_s\$ is the
relay VRF story as defined in <a href="#defn-relay-vrf-story">Definition 110</a>. Following:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 larr "Transcript"("'VRFResult'")\$
\$t_2 larr "append"(t_1, "''", "'A&amp;V CORE'")\$
\$t_3 larr "append"(t_2, "'vrf-in'", i)\$
\$t_4 larr "append"(t_3, "'vrf-out'", o)\$
\$t_5 larr "meta-ad"(t_4, "''", "False")\$
\$t_6 larr "meta-ad"(t_5, 4_"le", "True")\$
\$r larr "prf"(t_6, "False")\$
\$c_i = r mod a_c\$
</div>
</div>
<div class="paragraph">
<p>where \$4_("le")\$ is the integer <em>4</em> encoded as little endian, \$r\$ is the
4-byte challenge interpreted as a little endian encoded interger and \$a_c\$
is the number of availability cores used during the active session, as defined
in the session info retrieved by the Runtime API (<a href="#sect-rt-api-session-info">Section C.9.11</a>).
The resulting integer, \$c_i\$, indicates the parachain Id
(<a href="#defn-para-id">Definition 134</a>). If the parachain Id doesn&#8217;t exist, as can be retrieved by the Runtime
API (<a href="#sect-rt-api-availability-cores">Section C.9.3</a>), the validator discards that value and
continues with the next iteration. If the Id does exist, the validators
continues with the following steps:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 larr "Transcript"("'A&amp;V ASSIGNED'")\$
\$t_2 larr "append"(t_1, "'core'", c_i)\$
\$p larr "dleq_prove"(t_2, i)\$
</div>
</div>
<div class="paragraph">
<p>where \$"dleq_prove"\$ is described in <a href="#defn-vrf-dleq-prove">Definition 172</a>. The resulting
values of \$o\$, \$p\$ and \$s\$ are used to construct an assignment
certificate (<a href="#defn-assignment-cert">Definition 113</a>) of kind <em>0</em>.</p>
</div>
</div>
</div>
<div id="delayed-availability-core-vrf-assignment" class="exampleblock">
<div class="title">Definition 112. <a href="#delayed-availability-core-vrf-assignment">Delayed Availability Core VRF Assignment</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>delayed availability core VRF assignments</strong> determined at what point a
validator should start the approval process as described in <a href="#sect-tranches">Section 8.5.2</a>.
Computing this assignement relies on the VRF mechanism, transcripts and STROBE
operations described further in <a href="#sect-vrf">Section A.1.3</a>.</p>
</div>
<div class="paragraph">
<p>The validator executes the following steps:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 larr "Transcript"("'A&amp;V DELAY'")\$
\$t_2 larr "append"(t_1,"'RC-VRF'",R_s)\$
\$t_3 larr "append"(t_2, "'core'",c_i)\$
\$t_4 larr "append"(t_3, "'vrf-nm-pk'", p_k)\$
\$t_5 larr "meta-ad"(t_4, "'VRFHash'", "False")\$
\$t_6 larr "meta-ad"(t_5, 64_("le"), "True")\$
\$i larr "prf"(t_6, "False")\$
\$o = s_k * i\$
\$p larr "dleq_prove"(t_6, i)\$
</div>
</div>
<div class="paragraph">
<p>The resulting value \$p\$ is the VRF proof (<a href="#defn-vrf-proof">Definition 171</a>).
\$"dleq_prove"\$ is described in <a href="#defn-vrf-dleq-prove">Definition 172</a>.</p>
</div>
<div class="paragraph">
<p>The tranche, \$d\$, is determined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 larr "Transcript"("'VRFResult'")\$
\$t_2 larr "append"(t_1, "''", "'A&amp;V TRANCHE'")\$
\$t_3 larr "append"(t_2, "'vrf-in'", i)\$
\$t_4 larr "append"(t_3, "'vrf-out'", o)\$
\$t_5 larr "meta-ad"(t_4, "''", "False")\$
\$t_6 larr "meta-ad"(t_5, 4_("le"), "True")\$
\$c larr "prf"(t_6, "False")\$
\$d = d mod (d_c+d_z) - d_z\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$d_c\$ is the number of delayed tranches by total as specified by the
session info, retrieved via the Runtime API (<a href="#sect-rt-api-session-info">Section C.9.11</a>).</p>
</li>
<li>
<p>\$d_z\$ is the zeroth delay tranche width as specified by the session info,
retrieved via the Runtime API (<a href="#sect-rt-api-session-info">Section C.9.11</a>)..</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The resulting tranche, \$n\$, cannot be less than \$0\$. If the tranche is
less than \$0\$, then \$d=0\$. The resulting values \$o\$, \$p\$ and
\$c_i\$ are used to construct an assignment certificate
(&lt;<a href="#defn-assignment-cert">Definition 113</a>) of kind <em>1</em>.</p>
</div>
</div>
</div>
<div id="defn-assignment-cert" class="exampleblock">
<div class="title">Definition 113. <a href="#defn-assignment-cert">Assignment Certificate</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Assignment Certificate</strong> proves to the network that a Polkadot validator is
assigned to an availability core and is therefore qualified for the approval of
candidates, as clarified in <a href="#defn-availability-core-vrf-assignment">Definition 111</a>. This
certificate contains the computed VRF output and is a datastructure of the
following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(k, o, p)\$
\$k = {(0,-&gt;,s),(1,-&gt;,c_i):}\$
</div>
</div>
<div class="paragraph">
<p>where \$k\$ indicates the kind of the certificate, respectively the value <em>0</em>
proves the availability core assignment
(<a href="#defn-availability-core-vrf-assignment">Definition 111</a>), followed by the sample number
\$s\$, and the value <em>1</em> proves the delayed availability core assignment
(<a href="#delayed-availability-core-vrf-assignment">Definition 112</a>), followed by the core index
\$c_i\$ (<a href="#sect-rt-api-availability-cores">Section C.9.3</a>). \$o\$ is the VRF output and
\$p\$ is the VRF proof.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-disputes"><a class="anchor" href="#sect-disputes"></a><a class="link" href="#sect-disputes">8.6. Disputes</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disputes are not documented yet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-anv-network-messages"><a class="anchor" href="#sect-anv-network-messages"></a><a class="link" href="#sect-anv-network-messages">8.7. Network Messages</a></h3>
<div class="paragraph">
<p>The availability and validity process requires certain network messages to be exchanged between validators and collators.</p>
</div>
<div class="sect3">
<h4 id="id-notification-messges"><a class="anchor" href="#id-notification-messges"></a><a class="link" href="#id-notification-messges">8.7.1. Notification Messges</a></h4>
<div class="paragraph">
<p>The notification messages are exchanged between validators, including messages
sent by collators to validators. The protocol messages are exchanged based on a
streaming notification substream (<a href="#sect-connection-establishment">Section 4.5</a>). The
messages are SCALE encoded (<a href="#sect-scale-codec">Section A.2.2</a>).</p>
</div>
<div id="net-msg-validator-protocol-message" class="exampleblock">
<div class="title">Definition 114. <a href="#net-msg-validator-protocol-message">Validator Protocol Message</a></div>
<div class="content">
<div class="paragraph">
<p>The validator protocol message is a varying datatype used by validators to
broadcast relevant information about certain steps in the A&amp;V process.
Specifically, this includes the backing process (<a href="#sect-candidate-backing">Section 8.2</a>) and
the approval process (<a href="#sect-approval-voting">Section 8.5</a>). The validator protocol message,
\$M\$, is a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M = {(1,-&gt;,M_f),(3,-&gt;,M_s),(4,-&gt;,M_a):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M_f\$ is a bitfield distribution message (<a href="#net-msg-bitfield-dist-msg">Definition 118</a>).</p>
</li>
<li>
<p>\$M_s\$ is a statement distribution message (<a href="#net-msg-statement-distribution">Definition 117</a>).</p>
</li>
<li>
<p>\$M_a\$ is a approval distribution message (<a href="#net-msg-approval-distribution">Definition 119</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="net-msg-collator-protocol-message" class="exampleblock">
<div class="title">Definition 115. <a href="#net-msg-collator-protocol-message">Collation Protocol Message</a></div>
<div class="content">
<div class="paragraph">
<p>The collation protocol message, M, is a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M = {(0,-&gt;,M_c):}\$
</div>
</div>
<div class="paragraph">
<p>where \$M_c\$ is the collator message (<a href="#net-msg-collator-message">Definition 116</a>).</p>
</div>
</div>
</div>
<div id="net-msg-collator-message" class="exampleblock">
<div class="title">Definition 116. <a href="#net-msg-collator-message">Collator Message</a></div>
<div class="content">
<div class="paragraph">
<p>The collator message is sent as part of the collator protocol message
(<a href="#net-msg-collator-protocol-message">Definition 115</a>). The collator message, \$M\$, is a
varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M = {(0,-&gt;,(C_i,P_i,C_s)),(1,-&gt;,H),(4,-&gt;,(B_h,S)):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M\$ is a varying datatype where <em>0</em> indicates the intent to advertise a
collation and <em>1</em> indicates the advertisement of a collation to a validator. <em>4</em>
indicates that a collation sent to a validator was seconded.</p>
</li>
<li>
<p>\$C_i\$ is the public key of the collator.</p>
</li>
<li>
<p>\$P_i\$ is the parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
<li>
<p>\$C_s\$ is the signature of the collator using the <em>PeerId</em> of the collators node.</p>
</li>
<li>
<p>\$H\$ is the hash of the parachain block (<a href="#defn-para-block">Definition 132</a>).</p>
</li>
<li>
<p>\$S\$ is a full statement (<a href="#defn-statement">Definition 102</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="net-msg-statement-distribution" class="exampleblock">
<div class="title">Definition 117. <a href="#net-msg-statement-distribution">Statement Distribution Message</a></div>
<div class="content">
<div class="paragraph">
<p>The statement distribution message is sent as part of the validator protocol
message (<a href="#net-msg-collator-protocol-message">Definition 115</a>) indicates the validity vote of a
validator for a given candidate, described further in
<a href="#sect-candidate-statements">Section 8.2.1</a>. The statement distribution message,
\$M\$, is of varying type of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M   = {(0,-&gt;,(B_h,S)),(1,-&gt;,S_m):}\$
\$S_m = (B_h,C_h,A_i,A_s)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M\$ is a varying datatype where <em>0</em> indicates a signed statement and <em>1</em>
contains metadata about a seconded statement with a larger payload, such as a
runtime upgrade. The candidate itself can be fetched via the request/response
message (<a href="#net-msg-statement-fetching-request">Definition 128</a>).</p>
</li>
<li>
<p>\$B_h\$ is the hash of the relay chain parent, indicating the state this message is for.</p>
</li>
<li>
<p>\$S\$ is a full statement (<a href="#defn-statement">Definition 102</a>).</p>
</li>
<li>
<p>\$A_i\$ is the validator index in the authority set
(<a href="#defn-authority-list">Definition 33</a>) that signed this message.</p>
</li>
<li>
<p>\$A_s\$ is the signature of the validator.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="net-msg-bitfield-dist-msg" class="exampleblock">
<div class="title">Definition 118. <a href="#net-msg-bitfield-dist-msg">Bitfield Distribution Message</a></div>
<div class="content">
<div class="paragraph">
<p>The bitfield distribution message is sent as part of the validator protocol
message (<a href="#net-msg-validator-protocol-message">Definition 114</a>) and indicates the availability
vote of a validator for a given candidate, described further in
<a href="#sect-availability-votes">Section 8.4.1</a>. This message is sent in form of a validator
protocol message (<a href="#net-msg-validator-protocol-message">Definition 114</a>). The bitfield
distribution message, \$M\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M = {(0,-&gt;,(B_h,P)):}\$
\$P = (d,A_i,A_s)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$B_h\$ is the hash of the relay chain parent, indicating the state this message is for.</p>
</li>
<li>
<p>\$d\$ is the bitfield array (<a href="#defn-bitfield-array">Definition 141</a>).</p>
</li>
<li>
<p>\$A_i\$ is the validator index in the authority set
(<a href="#defn-authority-list">Definition 33</a>) that signed this message.</p>
</li>
<li>
<p>\$A_s\$ is the signature of the validator.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="net-msg-approval-distribution" class="exampleblock">
<div class="title">Definition 119. <a href="#net-msg-approval-distribution">Approval Distribution Message</a></div>
<div class="content">
<div class="paragraph">
<p>The approval distribution message is sent as part of the validator protocol
message (<a href="#net-msg-validator-protocol-message">Definition 114</a>) and indicates the approval vote
of a validator for a given candidate, described further in
<a href="#sect-availability-assignment-criteria">Section 8.5.1</a>. The approval distribution message,
\$M\$, is a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$M   = {(0,-&gt;,((C_,I_)_0…(C,I)_n)),(1,-&gt;,(V_0,…V_n)):}\$
\$C   = (B_h,A_i,c_a)\$
\$c_a = (c_k,P_o,P_p)\$
\$c_k = {(0→s),(1→i):}\$
\$V   = (B_h,I,A_i,A_s)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M\$ is a varying datatype where <em>0</em> indicates assignments for candidates in
recent, unfinalized blocks and <em>1</em> indicates approvals for candidates in some
recent, unfinalized block.</p>
</li>
<li>
<p>\$C\$ is an assignment criterion which refers to the candidate under which
the assignment is relevant by the block hash.</p>
</li>
<li>
<p>\$I\$ is an unsigned 32-bit integer indicating the index of the candidate,
corresponding the the order of the availability cores
(<a href="#sect-rt-api-availability-cores">Section C.9.3</a>).</p>
</li>
<li>
<p>\$B_h\$ is the relay chain block hash where the candidate appears.</p>
</li>
<li>
<p>\$A_i\$ is the authority set Id (<a href="#defn-authority-list">Definition 33</a>) of the validator
that created this message.</p>
</li>
<li>
<p>\$A_s\$ is the signature of the validator issuing this message.</p>
</li>
<li>
<p>\$c_a\$ is the certification of the assignment.</p>
</li>
<li>
<p>\$c_k\$ is a varying datatype where <em>0</em> indicates an assignment based on
the VRF that authorized the relay chain block where the candidate was included,
followed by a sample number, \$s\$. <em>1</em> indicates an assignment story based
on the VRF that authorized the relay chain block where the candidate was
included combined with the index of a particular core. This is described further
in <a href="#sect-approval-voting">Section 8.5</a>.</p>
</li>
<li>
<p>\$P_o\$ is a VRF output and \$P_p\$ its corresponding proof.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-request-response"><a class="anchor" href="#id-request-response"></a><a class="link" href="#id-request-response">8.7.2. Request &amp; Response</a></h4>
<div class="paragraph">
<p>The request &amp; response network messages are sent and received between peers in
the Polkadot network, including collators and non-validator nodes. Those
messages are conducted on the request-response substreams
(<a href="#sect-connection-establishment">Section 4.5</a>). The network messages are SCALE encoded as
described in Section ?.</p>
</div>
<div id="net-msg-pov-fetching-request" class="exampleblock">
<div class="title">Definition 120. <a href="#net-msg-pov-fetching-request">PoV Fetching Request</a></div>
<div class="content">
<div class="paragraph">
<p>The PoV fetching request is sent by clients who want to retrieve a PoV block
from a node. The request is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$C_h\$
</div>
</div>
<div class="paragraph">
<p>where \$C_h\$ is the 256-bit hash of the PoV block. The response message is
defined in <a href="#net-msg-pov-fetching-response">Definition 121</a>.</p>
</div>
</div>
</div>
<div id="net-msg-pov-fetching-response" class="exampleblock">
<div class="title">Definition 121. <a href="#net-msg-pov-fetching-response">PoV Fetching Response</a></div>
<div class="content">
<div class="paragraph">
<p>The PoV fetching response is sent by nodes to the clients who issued a PoV
fetching request (<a href="#net-msg-pov-fetching-request">Definition 120</a>). The response, \$R\$, is
a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(0,-&gt;,B),(1,-&gt;,phi):}\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> is followed by the PoV block and <em>1</em> indicates that the PoV block was
not found.</p>
</div>
</div>
</div>
<div id="net-msg-chunk-fetching-request" class="exampleblock">
<div class="title">Definition 122. <a href="#net-msg-chunk-fetching-request">Chunk Fetching Request</a></div>
<div class="content">
<div class="paragraph">
<p>The chunk fetching request is sent by clients who want to retrieve chunks of a
parachain candidate. The request is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(C_h,i)\$
</div>
</div>
<div class="paragraph">
<p>where \$C_h\$ is the 256-bit hash of the parachain candidate and \$i\$ is a
32-bit unsigned integer indicating the index of the chunk to fetch. The response
message is defined in <a href="#net-msg-chunk-fetching-response">Definition 123</a>.</p>
</div>
</div>
</div>
<div id="net-msg-chunk-fetching-response" class="exampleblock">
<div class="title">Definition 123. <a href="#net-msg-chunk-fetching-response">Chunk Fetching Response</a></div>
<div class="content">
<div class="paragraph">
<p>The chunk fetching response is sent by nodes to the clients who issued a chunk
fetching request (<a href="#net-msg-chunk-fetching-request">Definition 122</a>). The response, \$R\$, is
a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(0,-&gt;,C_r),(1,-&gt;,phi):}\$
\$C_r = (c,c_p)\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> is followed by the chunk response, \$C_r\$ and <em>1</em> indicates that
the requested chunk was not found. \$C_r\$ contains the erasure-encoded chunk
of data belonging to the candidate block, \$c\$, and \$c_p\$ is that
chunks proof in the Merkle tree. Both \$c\$ and \$c_p\$ are byte arrays of
type \$(b_n…b_m)\$.</p>
</div>
</div>
</div>
<div id="net-msg-available-data-request" class="exampleblock">
<div class="title">Definition 124. <a href="#net-msg-available-data-request">Available Data Request</a></div>
<div class="content">
<div class="paragraph">
<p>The available data request is sent by clients who want to retrieve the PoV block
of a parachain candidate. The request is a datastructure of the following
format:</p>
</div>
<div class="stemblock">
<div class="content">
\$C_h\$
</div>
</div>
<div class="paragraph">
<p>where \$C_h\$ is the 256-bit candidate hash to get the available data for.
The response message is defined in <a href="#net-msg-available-data-response">Definition 125</a>.</p>
</div>
</div>
</div>
<div id="net-msg-available-data-response" class="exampleblock">
<div class="title">Definition 125. <a href="#net-msg-available-data-response">Available Data Response</a></div>
<div class="content">
<div class="paragraph">
<p>The available data response is sent by nodes to the clients who issued a
available data request (<a href="#net-msg-available-data-request">Definition 124</a>). The response,
\$R\$, is a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(0,-&gt;,A),(1,-&gt;,phi):}\$
\$A = (P_{ov},D_{pv})\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> is followed by the available data, \$A\$, and <em>1</em> indicates the the
requested candidate hash was not found. \$P_{ov}\$ is the PoV block
(<a href="#defn-para-block">Definition 132</a>) and \$D_{pv}\$ is the persisted validation data
(<a href="#defn-persisted-validation-data">Definition 227</a>).</p>
</div>
</div>
</div>
<div id="net-msg-collation-fetching-request" class="exampleblock">
<div class="title">Definition 126. <a href="#net-msg-collation-fetching-request">Collation Fetching Request</a></div>
<div class="content">
<div class="paragraph">
<p>The collation fetching request is sent by clients who want to retrieve the
advertised collation at the specified relay chain block. The request is a
datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(B_h,P_{id})\$
</div>
</div>
<div class="paragraph">
<p>where \$B_h\$ is the hash of the relay chain block and \$P_{id}\$ is the
parachain Id (<a href="#defn-para-id">Definition 134</a>). The response message is defined in
<a href="#net-msg-collation-fetching-response">Definition 127</a>.</p>
</div>
</div>
</div>
<div id="net-msg-collation-fetching-response" class="exampleblock">
<div class="title">Definition 127. <a href="#net-msg-collation-fetching-response">Collation Fetching Response</a></div>
<div class="content">
<div class="paragraph">
<p>The collation fetching response is sent by nodes to the clients who issued a
collation fetching request (<a href="#net-msg-collation-fetching-request">Definition 126</a>). The
response, \$R\$, is a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(0,-&gt;,(C_r,B)):}\$
</div>
</div>
<div class="paragraph">
<p>where \$0\$ is followed by the candidate receipt
(<a href="#defn-candidate-receipt">Definition 104</a>), \$C_r\$, as and the PoV block
(<a href="#defn-para-block">Definition 132</a>), \$B\$. This type does not notify the client about a
statement that was not found.</p>
</div>
</div>
</div>
<div id="net-msg-statement-fetching-request" class="exampleblock">
<div class="title">Definition 128. <a href="#net-msg-statement-fetching-request">Statement Fetching Request</a></div>
<div class="content">
<div class="paragraph">
<p>The statement fetching request is sent by clients who want to retrieve
statements about a given candidate. The request is a datastructure of the
following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(B_h,C_h)\$
</div>
</div>
<div class="paragraph">
<p>where \$B_h\$ is the hash of the relay chain parent and \$C_h\$ is the
candidate hash that was used to create a committed candidate receipt
(<a href="#defn-committed-candidate-receipt">Definition 105</a>). The response message is defined in
<a href="#net-msg-statement-fetching-response">Definition 129</a>.</p>
</div>
</div>
</div>
<div id="net-msg-statement-fetching-response" class="exampleblock">
<div class="title">Definition 129. <a href="#net-msg-statement-fetching-response">Statement Fetching Response</a></div>
<div class="content">
<div class="paragraph">
<p>The statement fetching response is sent by nodes to the clients who issued a
collation fetching request (<a href="#net-msg-statement-fetching-request">Definition 128</a>). The
response, \$R\$, is a varying datatype of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(0,-&gt;,C_r):}\$
</div>
</div>
<div class="paragraph">
<p>where \$C_r\$ is the committed candidate receipt
(<a href="#defn-committed-candidate-receipt">Definition 105</a>). No response is returned if no statement
is found.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="net-msg-dispute-request"><a class="anchor" href="#net-msg-dispute-request"></a><a class="link" href="#net-msg-dispute-request">8.7.2.1. Dispute Request</a></h5>
<div class="paragraph">
<p>The dispute request is sent by clients who want to issue a dispute about a
candidate. The request, \$D_r\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$D_r = (C_r,S_i,I_v,V_v)\$
\$I_v = (A_i,A_s,k_i)\$
\$V_v = (A_i,A_s,k_v)\$
\$k_i = {(0,-&gt;,phi):}\$
\$k_v = {(0,-&gt;,phi),(1,-&gt;,C_h),(2,-&gt;,C_h),(3,-&gt;,phi):}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$C_r\$ is the candidate that is being disputed. The structure is a
candidate receipt (<a href="#defn-candidate-receipt">Definition 104</a>).</p>
</li>
<li>
<p>\$S_i\$ is an unsigned 32-bit integer indicating the session index the candidate appears in.</p>
</li>
<li>
<p>\$I_v\$ is the invalid vote that makes up the request.</p>
</li>
<li>
<p>\$V_v\$ is the valid vote that makes this dispute request valid.</p>
</li>
<li>
<p>\$A_i\$ is an unsigned 32-bit integer indicating the validator index in the
authority set (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$A_s\$ is the signature of the validator.</p>
</li>
<li>
<p>\$k_i\$ is a varying datatype and implies the dispute statement. <em>0</em>
indicates an explicit statement.</p>
</li>
<li>
<p>\$k_v\$ is a varying datatype and implies the dispute statement.</p>
<div class="ulist">
<ul>
<li>
<p>\$0\$ indicates an explicit statement.</p>
</li>
<li>
<p>\$1\$ indicates a seconded statement on a candidate, \$C_h\$, from the
backing phase. \$C_h\$ is the hash of the candidate.</p>
</li>
<li>
<p>\$2\$ indicates a valid statement on a candidate, \$C_h\$, from the
backing phase. \$C_h\$ is the hash of the candidate.</p>
</li>
<li>
<p>\$3\$ indicates an approval vote from the approval checking phase.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The response message is defined in <a href="#net-msg-dispute-response">Section 8.7.2.2</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="net-msg-dispute-response"><a class="anchor" href="#net-msg-dispute-response"></a><a class="link" href="#net-msg-dispute-response">8.7.2.2. Dispute Response</a></h5>
<div class="paragraph">
<p>The dispute response is sent by nodes to the clients who who issued a dispute
request (<a href="#net-msg-dispute-request">Section 8.7.2.1</a>). The response, \$R\$, is a varying type
of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$R = {(0,-&gt;,phi):}\$
</div>
</div>
<div class="paragraph">
<p>where \$0\$ indicates that the dispute was successfully processed.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-anv-definitions"><a class="anchor" href="#sect-anv-definitions"></a><a class="link" href="#sect-anv-definitions">8.8. Definitions</a></h3>
<div id="defn-collator" class="exampleblock">
<div class="title">Definition 130. <a href="#defn-collator">Collator</a></div>
<div class="content">
<div class="paragraph">
<p>A collator is a parachain node that sends parachain blocks, known as candidates
(<a href="#defn-candidate">Definition 131</a>), to the relay chain validators. The relay chain validators
are not concerned how the collator works or how it creates candidates.</p>
</div>
</div>
</div>
<div id="defn-candidate" class="exampleblock">
<div class="title">Definition 131. <a href="#defn-candidate">Candidate</a></div>
<div class="content">
<div class="paragraph">
<p>A candidate is a submitted parachain block (<a href="#defn-para-block">Definition 132</a>) to the relay
chain validators. A parachain block stops being referred to as a candidate as
soon it has been finalized.</p>
</div>
</div>
</div>
<div id="defn-para-block" class="exampleblock">
<div class="title">Definition 132. <a href="#defn-para-block">Parachain Block</a></div>
<div class="content">
<div class="paragraph">
<p>A parachain block or a Proof-of-Validity block (PoV block) contains the
necessary data for the parachain specific state transition logic. Relay chain
validators are not concerned with the inner structure of the block and treat it
as a byte array.</p>
</div>
</div>
</div>
<div id="defn-head-data" class="exampleblock">
<div class="title">Definition 133. <a href="#defn-head-data">Head Data</a></div>
<div class="content">
<div class="paragraph">
<p>The head data is contains information about a parachain block
(<a href="#defn-para-block">Definition 132</a>). The head data is returned by executing the parachain
Runtime and relay chain validators are not concerned with its inner structure
and treat it as a byte arrays.</p>
</div>
</div>
</div>
<div id="defn-para-id" class="exampleblock">
<div class="title">Definition 134. <a href="#defn-para-id">Parachain Id</a></div>
<div class="content">
<div class="paragraph">
<p>The Parachain Id is a unique, unsigned 32-bit integer which serves as an
identifier of a parachain, assigned by the Runtime.</p>
</div>
</div>
</div>
<div id="defn-availability-core" class="exampleblock">
<div class="title">Definition 135. <a href="#defn-availability-core">Availability Core</a></div>
<div class="content">
<div class="paragraph">
<p>Availability cores are slots used to process parachains. The Runtime assigns
each parachain to a availability core and validators can fetch information about
the cores, such as parachain block candidates, by calling the appropriate
Runtime API (<a href="#sect-rt-api-availability-cores">Section C.9.3</a>). Validators are not concerned
with the internal workings from the Runtimes perspective.</p>
</div>
</div>
</div>
<div id="defn-validator-groups" class="exampleblock">
<div class="title">Definition 136. <a href="#defn-validator-groups">Validator Groups</a></div>
<div class="content">
<div class="paragraph">
<p>Validator groups indicate which validators are responsible for creating backable
candidates for parachains (<a href="#sect-candidate-backing">Section 8.2</a>), and are assigned by the
Runtime (<a href="#sect-rt-api-validator-groups">Section C.9.2</a>). Validators are not concerned with
the internal workings from the Runtimes perspective. Collators can use this
information for submitting blocks.</p>
</div>
</div>
</div>
<div id="defn-upward-message" class="exampleblock">
<div class="title">Definition 137. <a href="#defn-upward-message">Upward Message</a></div>
<div class="content">
<div class="paragraph">
<p>An upward message is an opaque byte array sent from a parachain to a relay chain.</p>
</div>
</div>
</div>
<div id="defn-downward-message" class="exampleblock">
<div class="title">Definition 138. <a href="#defn-downward-message">Downward Message</a></div>
<div class="content">
<div class="paragraph">
<p>A downward message is an opaque byte array received by the parachain from the
relay chain.</p>
</div>
</div>
</div>
<div id="defn-outbound-hrmp-message" class="exampleblock">
<div class="title">Definition 139. <a href="#defn-outbound-hrmp-message">Outbound HRMP Message</a></div>
<div class="content">
<div class="paragraph">
<p>An outbound HRMP message (Horizontal Relay-routed Message Passing) is sent from
the perspective of a sender of a parachain to an other parachain by passing it
through the relay chain. It&#8217;s a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(I,M)\$
</div>
</div>
<div class="paragraph">
<p>where \$I\$ is the recipient Id (<a href="#defn-para-id">Definition 134</a>) and \$M\$ is an upward
message (<a href="#defn-upward-message">Definition 137</a>).</p>
</div>
</div>
</div>
<div id="defn-inbound-hrmp-message" class="exampleblock">
<div class="title">Definition 140. <a href="#defn-inbound-hrmp-message">Inbound HRMP Message</a></div>
<div class="content">
<div class="paragraph">
<p>An inbound HRMP message (Horizontal Relay-routed Message Passing) is seen from
the perspective of a recipient parachain sent from an other parachain by passing
it through the relay chain. It&#8217;s a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(N,M)\$
</div>
</div>
<div class="paragraph">
<p>where \$N\$ is the unsigned 32-bit integer indicating the relay chain block
number at which the message was passed down to the recipient parachain and
\$M\$ is a downward message (<a href="#defn-downward-message">Definition 138</a>).</p>
</div>
</div>
</div>
<div id="defn-bitfield-array" class="exampleblock">
<div class="title">Definition 141. <a href="#defn-bitfield-array">Bitfield Array</a></div>
<div class="content">
<div class="paragraph">
<p>A bitfield array contains single-bit values which indidate whether a candidate
is available. The number of items is equal of to the number of availability
cores (<a href="#defn-availability-core">Definition 135</a>) and each bit represents a vote on the
corresponding core in the given order. Respectively, if the single bit equals 1,
then the Polkadot validator claims that the availability core is occupied, there
exists a committed candidate receipt (<a href="#defn-committed-candidate-receipt">Definition 105</a>) and
that the validator has a stored chunk of the parachain block
(<a href="#defn-para-block">Definition 132</a>).</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="part-polkadot-runtime" class="sect0"><a class="anchor" href="#part-polkadot-runtime"></a><a class="link" href="#part-polkadot-runtime">Polkadot Runtime</a></h1>
<div class="openblock partintro">
<div class="content">
Description of various useful Runtime internals
</div>
</div>
<div class="sect1">
<h2 id="id-extrinsics"><a class="anchor" href="#id-extrinsics"></a><a class="link" href="#id-extrinsics">9. Extrinsics</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="id-introduction-5"><a class="anchor" href="#id-introduction-5"></a><a class="link" href="#id-introduction-5">9.1. Introduction</a></h3>
<div class="paragraph">
<p>An extrinsic is a SCALE encoded array consisting of a version number,
signature, and varying data types indicating the resulting Runtime
function to be called, including the parameters required for that
function to be executed.</p>
</div>
</div>
<div class="sect2">
<h3 id="id-preliminaries-3"><a class="anchor" href="#id-preliminaries-3"></a><a class="link" href="#id-preliminaries-3">9.2. Preliminaries</a></h3>
<div id="defn-extrinsic" class="exampleblock">
<div class="title">Definition 142. Extrinsic</div>
<div class="content">
<div class="paragraph">
<p>An extrinsic , \(tx\), is a tuple consisting of the extrinsic
version, \(T_v\) (<a href="#defn-extrinsic-version">Definition 143</a>), and the body of
the extrinsic, \(T_b\).</p>
</div>
<div class="stemblock">
<div class="content">
\[tx := (T_v, T_b)\]
</div>
</div>
<div class="paragraph">
<p>The value of \(T_b\) varies for each version. The current
version 4 is described in <a href="#sect-version-four">Section 9.3.1</a>.</p>
</div>
</div>
</div>
<div id="defn-extrinsic-version" class="exampleblock">
<div class="title">Definition 143. Extrinsic Version</div>
<div class="content">
<div class="paragraph">
<p>\(T_v\) is a 8-bit bitfield and defines the extrinsic version. The
required format of an extrinsic body, \(T_b\), is dictated by the
Runtime. Older or unsupported version are rejected.</p>
</div>
<div class="paragraph">
<p>The most significant bit of \(T_v\) indicates whether the transaction is
<strong>signed</strong> (\(1\)) or <strong>unsigned</strong> (\(0\)). The
remaining 7-bits represent the version number. As an example, for
extrinsic format version 4, an signed extrinsic represents
\(T_v\) as <code>132</code> while a unsigned extrinsic represents it as <code>4</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-extrinsics-body"><a class="anchor" href="#id-extrinsics-body"></a><a class="link" href="#id-extrinsics-body">9.3. Extrinsics Body</a></h3>
<div class="sect3">
<h4 id="sect-version-four"><a class="anchor" href="#sect-version-four"></a><a class="link" href="#sect-version-four">9.3.1. Version 4</a></h4>
<div class="paragraph">
<p>Version 4 of the Polkadot extrinsic format is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_b := (A_i, Sig, E, M_i, F_i(m))\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(A_i\): the 32-byte address of the sender (<a href="#defn-extrinsic-address">Definition 144</a>).</p>
</li>
<li>
<p>\(Sig\): the signature of the sender (<a href="#defn-extrinsic-signature">Definition 145</a>).</p>
</li>
<li>
<p>\(E\): the extra data for the extrinsic (<a href="#defn-extra-data">Definition 146</a>).</p>
</li>
<li>
<p>\(M_i\): the indicator of the Polkadot module (<a href="#defn-module-indicator">Definition 147</a>).</p>
</li>
<li>
<p>\(F_i(m)\): the indicator of the function of the Polkadot module (<a href="#defn-function-indicator">Definition 148</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="defn-extrinsic-address" class="exampleblock">
<div class="title">Definition 144. Extrinsic Address</div>
<div class="content">
<div class="paragraph">
<p>Account Id, \(A_i\), is the 32-byte address of the sender of the
extrinsic as described in the
<a href="https://github.com/paritytech/substrate/wiki/External-Address-Format-(SS58)">external
SS58 address format</a>.</p>
</div>
</div>
</div>
<div id="defn-extrinsic-signature" class="exampleblock">
<div class="title">Definition 145. Extrinsic Signature</div>
<div class="content">
<div class="paragraph">
<p>The signature, \(Sig\), is a varying data type indicating the used
signature type, followed by the signature created by the extrinsic author.
The following types are supported:</p>
</div>
<div class="stemblock">
<div class="content">
\[Sig := \begin{cases}
         0, &amp; \text{Ed25519, followed by: } (b_0, ...,b_{63}) \\
         1, &amp; \text{Sr25519, followed by: } (b_0, ...,b_{63}) \\
         2, &amp; \text{Ecdsa, followed by: } (b_0, ...,b_{64})
       \end{cases}\]
</div>
</div>
<div class="paragraph">
<p>Signature types vary in sizes, but each individual type is always
fixed-size and therefore does not contain a length prefix. <code>Ed25519</code> and
<code>Sr25519</code> signatures are 512-bit while <code>Ecdsa</code> is 520-bit, where the
last 8 bits are the recovery ID.</p>
</div>
<div class="paragraph">
<p>The signature is created by signing payload \(P\).</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
  P &amp;:= \begin{cases}
          Raw, &amp; \text{if } |Raw| \leq 256 \\
          Blake2(Raw), &amp; \text{if } |Raw| &gt; 256 \\
        \end{cases} \\
  Raw &amp;:= (M_i, F_i(m), E, R_v, F_v, H_h(G), H_h(B)) \\
\end{aligned}\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(M_i\): the module indicator (<a href="#defn-module-indicator">Definition 147</a>).</p>
</li>
<li>
<p>\(F_i(m)\): the function indicator of the module (<a href="#defn-function-indicator">Definition 148</a>).</p>
</li>
<li>
<p>\(E\): the extra data (<a href="#defn-extra-data">Definition 146</a>).</p>
</li>
<li>
<p>\(R_v\): a UINT32 containing the specification version of <code>14</code>.</p>
</li>
<li>
<p>\(F_v\): a UINT32 containing the format version of <code>2</code>.</p>
</li>
<li>
<p>\(H_h(G)\): a 32-byte array containing the genesis hash.</p>
</li>
<li>
<p>\(H_h(B)\): a 32-byte array containing the hash of the block
which starts the mortality period, as described in <a href="#defn-extrinsic-mortality">Definition 149</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-extra-data" class="exampleblock">
<div class="title">Definition 146. Extra Data</div>
<div class="content">
<div class="paragraph">
<p>Extra data, \(E\), is a tuple containing additional meta data about
the extrinsic and the system it is meant to be executed in.</p>
</div>
<div class="stemblock">
<div class="content">
\[E := (T_{mor}, N, P_t)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(T_{mor}\): contains the SCALE encoded mortality of the
extrinsic (<a href="#defn-extrinsic-mortality">Definition 149</a>).</p>
</li>
<li>
<p>\(N\): a compact integer containing the nonce of the sender.
The nonce must be incremented by one for each extrinsic created,
otherwise the Polkadot network will reject the extrinsic.</p>
</li>
<li>
<p>\(P_t\): a compact integer containing the transactor pay
including tip.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div id="defn-module-indicator" class="exampleblock">
<div class="title">Definition 147. Module Indicator</div>
<div class="content">
<div class="paragraph">
<p>\(M_i\) is an indicator for the Runtime to which Polkadot <em>module</em>,
\(m\), the extrinsic should be forwarded to.</p>
</div>
<div class="paragraph">
<p>\(M_i\) is a varying data type pointing to every module
exposed to the network.</p>
</div>
<div class="stemblock">
<div class="content">
\[M_i := \begin{cases}
  0, &amp; \text{System} \\
  1, &amp; \text{Utility} \\
  ... &amp; \\
  7, &amp; \text{Balances} \\
  ... &amp;
\end{cases}\]
</div>
</div>
</div>
</div>
<div id="defn-function-indicator" class="exampleblock">
<div class="title">Definition 148. Function Indicator</div>
<div class="content">
<div class="paragraph">
<p>\(F_i(m)\) is a tuple which contains an indicator,
\(m_i\), for the Runtime to which <em>function</em> within the
Polkadot <em>module</em>, \(m\), the extrinsic should be forwarded
to. This indicator is followed by the concatenated and SCALE encoded
parameters of the corresponding function, \(params\).</p>
</div>
<div class="stemblock">
<div class="content">
\[F_i(m) := (m_i, params)\]
</div>
</div>
<div class="paragraph">
<p>The value of \(m_i\) varies for each Polkadot module, since
every module offers different functions. As an example, the <code>Balances</code>
module has the following functions:</p>
</div>
<div class="stemblock">
<div class="content">
\[Balances_i := \begin{cases}
  0, &amp; \text{transfer} \\
  1, &amp; \text{set_balance} \\
  2, &amp; \text{force_transfer} \\
  3, &amp; \text{transfer_keep_alive} \\
  ... &amp;
\end{cases}\]
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-mortality"><a class="anchor" href="#id-mortality"></a><a class="link" href="#id-mortality">9.3.2. Mortality</a></h4>
<div id="defn-extrinsic-mortality" class="exampleblock">
<div class="title">Definition 149. Extrinsic Mortality</div>
<div class="content">
<div class="paragraph">
<p>Extrinsic <strong>mortality</strong> is a mechanism which ensures that an extrinsic is only
valid within a certain period of the ongoing Polkadot lifetime. Extrinsics can
also be immortal, as clarified in <a href="#sect-mortality-encoding">Section 9.3.2.2</a>.</p>
</div>
<div class="paragraph">
<p>The mortality mechanism works with two related values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(M_{per}\): the period of validity in terms of block
numbers from the block hash specified as \(H_h(B)\) in the
payload (<a href="#defn-extrinsic-signature">Definition 145</a>). The
requirement is \(M_{per} \geq 4\) and \(M_{per}\)
must be the power of two, such as <code>32</code>, <code>64</code>, <code>128</code>, etc.</p>
</li>
<li>
<p>\(M_{pha}\): the phase in the period that this extrinsic’s
lifetime begins. This value is calculated with a formula and validators
can use this value in order to determine which block hash is included in
the payload. The requirement is \(M_{pha} &lt; M_{per}\).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to tie a transaction’s lifetime to a certain block
(\(H_i(B)\)) after it was issued, without wasting precious
space for block hashes, block numbers are divided into regular periods
and the lifetime is instead expressed as a "phase"
(\(M_{pha}\)) from these regular boundaries:</p>
</div>
<div class="stemblock">
<div class="content">
\[M_{pha} = H_i(B)\ mod\ M_{per}\]
</div>
</div>
<div class="paragraph">
<p>\(M_{per}\) and \(M_{pha}\) are then included in the
extrinsic, as clarified in <a href="#defn-extra-data">Definition 146</a>, in the SCALE encoded form of
\(T_{mor}\) (<a href="#sect-mortality-encoding">Section 9.3.2.2</a>). Polkadot validators can use
\(M_{pha}\) to figure out the block hash included in the payload,
which will therefore result in a valid signature if the extrinsic is within the
specified period or an invalid signature if the extrinsic "died".</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="id-example"><a class="anchor" href="#id-example"></a><a class="link" href="#id-example">9.3.2.1. Example</a></h5>
<div class="paragraph">
<p>The extrinsic author choses \(M_{per} = 256\) at block
<code>10'000</code>, resulting with \(M_{pha} = 16\). The extrinsic is
then valid for blocks ranging from <code>10'000</code> to <code>10'256</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sect-mortality-encoding"><a class="anchor" href="#sect-mortality-encoding"></a><a class="link" href="#sect-mortality-encoding">9.3.2.2. Encoding</a></h5>
<div class="paragraph">
<p>\(T_{mor}\) refers to the SCALE encoded form of type
\(M_{per}\) and \(M_{pha}\). \(T_{mor}\)
is the size of two bytes if the extrinsic is considered mortal, or
simply one bytes with the value equal to zero if the extrinsic is
considered immortal.</p>
</div>
<div class="stemblock">
<div class="content">
\[T_{mor} := Enc_{SC}(M_{per}, M_{pha})\]
</div>
</div>
<div class="paragraph">
<p>The SCALE encoded representation of mortality \(T_{mor}\)
deviates from most other types, as it’s specialized to be the smallest
possible value, as described in <a href="#algo-mortality-encode">Algorithm 25</a> and <a href="#algo-mortality-decode">Algorithm 26</a>.</p>
</div>
<div class="paragraph">
<p>If the extrinsic is immortal, specify a single byte with the value equal
to zero.</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-mortality-encode" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 25 </span><span style="font-style:normal;font-variant:small-caps;">Encode Mortality</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub><mo separator="true">,</mo><msub><mi>M</mi><mrow><mi>p</mi><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{per}, M_{pha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mspace width="0.5em"/><mtext mathvariant="bold">if</mtext><mspace width="0.5em"/><mrow><mtext mathvariant="italic">extrinsic</mtext><mtext> </mtext><mtext mathvariant="italic">is</mtext><mtext> </mtext><mtext mathvariant="italic">immortal</mtext></mrow></mrow><annotation encoding="application/x-tex">0 \enspace \textbf{if} \enspace \textit{extrinsic is immortal}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.5em;"></span><span class="mord text"><span class="mord textbf">if</span></span><span class="mspace" style="margin-right:0.5em;"></span><span class="mord text"><span class="mord textit">extrinsic is immortal</span></span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">factor = </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span><span class="ps-funcname">Limit</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>&gt;</mo><mo>&gt;</mo><mn>12</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">M_{per} &gt;&gt; 12, 1, \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">12</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">left = </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span><span class="ps-funcname">Limit</span>(<span class="ps-funcname">TZ</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{per}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>15</mn></mrow><annotation encoding="application/x-tex"> - 1, 1, 15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">15</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo>=</mo><mfrac><msub><mi>M</mi><mrow><mi>p</mi><mi>h</mi><mi>a</mi></mrow></msub><mrow><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mfrac><mo>&lt;</mo><mo>&lt;</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">right = \frac{M_{pha}}{factor} &lt;&lt; 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4725em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9914em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5131em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi mathvariant="normal">∣</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">left|right</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 25. <a href="#algo-mortality-encode">Encode Mortality</a></div>
          </div>
          <div id="algo-mortality-decode" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 26 </span><span style="font-style:normal;font-variant:small-caps;">Decode Mortality</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>m</mi><mi>o</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{mor}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">Immortal</mtext><mspace width="0.5em"/><mtext mathvariant="bold">if</mtext><mspace width="0.5em"/><msubsup><mi>T</mi><mrow><mi>m</mi><mi>o</mi><mi>r</mi></mrow><mrow><mi>b</mi><mn>0</mn></mrow></msubsup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\textit{Immortal} \enspace \textbf{if} \enspace T^{b0}_{mor} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0961em;vertical-align:-0.247em;"></span><span class="mord text"><span class="mord textit">Immortal</span></span><span class="mspace" style="margin-right:0.5em;"></span><span class="mord text"><span class="mord textbf">if</span></span><span class="mspace" style="margin-right:0.5em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>n</mi><mi>c</mi><mo>=</mo><msubsup><mi>T</mi><mrow><mi>m</mi><mi>o</mi><mi>r</mi></mrow><mrow><mi>b</mi><mn>0</mn></mrow></msubsup><mo>+</mo><mo stretchy="false">(</mo><msubsup><mi>T</mi><mrow><mi>m</mi><mi>o</mi><mi>r</mi></mrow><mrow><mi>b</mi><mn>1</mn></mrow></msubsup><mo>&lt;</mo><mo>&lt;</mo><mn>8</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">enc = T^{b0}_{mor} + (T^{b1}_{mor} &lt;&lt; 8)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0961em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">8</span><span class="mclose">)</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">3:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>=</mo><mn>2</mn><mo>&lt;</mo><mo>&lt;</mo><mo stretchy="false">(</mo><mi>e</mi><mi>n</mi><mi>c</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mo stretchy="false">(</mo><mn>1</mn><mo>&lt;</mo><mo>&lt;</mo><mn>4</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M_{per} = 2 &lt;&lt; (enc\ mod\ (1 &lt;&lt; 4))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">))</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">factor =</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span> <span class="ps-funcname">Limit</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>&gt;</mo><mo>&gt;</mo><mn>12</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">M_{per} &gt;&gt; 12, 1, \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">12</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>p</mi><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi>e</mi><mi>n</mi><mi>c</mi><mo>&gt;</mo><mo>&gt;</mo><mn>4</mn><mo stretchy="false">)</mo><mo>∗</mo><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">M_{pha} = (enc &gt;&gt; 4) * factor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">6:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>M</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub><mo separator="true">,</mo><msub><mi>M</mi><mrow><mi>p</mi><mi>h</mi><mi>a</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(M_{per}, M_{pha})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 26. <a href="#algo-mortality-decode">Decode Mortality</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(T^{b0}_{mor}\): the first byte of \(T_{mor}\).</p>
</li>
<li>
<p>\(T^{b1}_{mor}\): the second byte of \(T_{mor}\).</p>
</li>
<li>
<p>Limit(\(num\), \(min\), \(max\)):
Ensures that \(num\) is between \(min\) and
\(max\). If \(min\) or \(max\) is defined
as \(\phi\), then there is no requirement for the specified
minimum/maximum.</p>
</li>
<li>
<p>TZ(\(num\)): returns the number of trailing zeros in the
binary representation of \(num\). For example, the binary
representation of <code>40</code> is <code>0010 1000</code>, which has three trailing zeros.</p>
</li>
<li>
<p>\(&gt;&gt;\): performs a binary right shift operation.</p>
</li>
<li>
<p>\(&lt;&lt;\): performs a binary left shift operation.</p>
</li>
<li>
<p>\(|\) : performs a bitwise OR operation.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id-weights"><a class="anchor" href="#id-weights"></a><a class="link" href="#id-weights">10. Weights</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="id-motivation"><a class="anchor" href="#id-motivation"></a><a class="link" href="#id-motivation">10.1. Motivation</a></h3>
<div class="paragraph">
<p>The Polkadot network, like any other permissionless system, needs to
implement a mechanism to measure and to limit the usage in order to
establish an economic incentive structure, to prevent the network
overload, and to mitigate DoS vulnerabilities. In particular, Polkadot
enforces a limited time-window for block producers to create a block,
including limitations on block size, which can make the selection and
execution of certain extrinsics too expensive and decelerate the
network.</p>
</div>
<div class="paragraph">
<p>In contrast to some other systems such as Ethereum which implement fine
measurement for each executed low-level operation by smart contracts,
known as gas metering, Polkadot takes a more relaxed approach by
implementing a measuring system where the cost of the transactions
(referred to as ’extrinsics’) are determined before execution and are
known as the weight system.</p>
</div>
<div class="paragraph">
<p>The Polkadot weight system introduces a mechanism for block producers to
measure the cost of running the extrinsics and determine how "heavy" it
is in terms of execution time. Within this mechanism, block producers
can select a set of extrinsics and saturate the block to its fullest
potential without exceeding any limitations (as described in
<a href="#sect-limitations">Section 10.2.1</a>). Moreover, the weight system can be used to
calculate a fee for executing each extrinsics according to its weight
(as described in <a href="#sect-fee-calculation">Section 10.6.1</a>).</p>
</div>
<div class="paragraph">
<p>Additionally, Polkadot introduces a specified block ratio (as defined in
<a href="#sect-limitations">Section 10.2.1</a>), ensuring that only a certain portion of the total block
size gets used for regular extrinsics. The remaining space is reserved for
critical, operational extrinsics required for the functionality by Polkadot
itself.</p>
</div>
<div class="paragraph">
<p>To begin, we introduce in <a href="#sect-assumptions">Section 10.2</a> the assumption upon which the
Polkadot transaction weight system is designed. In <a href="#sect-limitations">Section 10.2.1</a>, we
discuss the limitation Polkadot needs to enforce on the block size. In
<a href="#sect-runtime-primitives">Section 10.3</a>, we describe in detail the procedure upon which the
weight of any transaction should be calculated. In <a href="#sect-practical-examples">Section 10.5</a>,
we present how we apply this procedure to compute the weight of particular
runtime functions.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-assumptions"><a class="anchor" href="#sect-assumptions"></a><a class="link" href="#sect-assumptions">10.2. Assumptions</a></h3>
<div class="paragraph">
<p>In this section, we define the concept of weight and we discuss the
considerations that need to be accounted for when assigning weight to
transactions. These considerations are essential in order for the weight
system to deliver its fundamental mission, i.e. the fair distribution of
network resources and preventing a network overload. In this regard,
weights serve as an indicator on whether a block is considered full and
how much space is left for remaining, pending extrinsics. Extrinsics
which require too many resources are discarded. More formally, the
weight system should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prevent the block from being filled with too many extrinsics</p>
</li>
<li>
<p>avoid extrinsics where its execution takes too long, by assigning a
transaction fee to each extrinsic proportional to their resource
consumption.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These concepts are formalized in <a href="#defn-block-length">Definition 150</a> and
<a href="#defn-polkadot-block-limits">Definition 153</a>:</p>
</div>
<div id="defn-block-length" class="exampleblock">
<div class="title">Definition 150. Block Length</div>
<div class="content">
<div class="paragraph">
<p>For a block \(B\) with \(Head(B)\) and \(Body(B)\) the
block length of \(B\), \(Len(B)\), is defined as the amount of
raw bytes of \(B\).</p>
</div>
</div>
</div>
<div id="defn-target-time-per-block" class="exampleblock">
<div class="title">Definition 151. Target Time per Block</div>
<div class="content">
<div class="paragraph">
<p>Ṯargeted time per block denoted by \(T(B)\) implies the amount of
seconds that a new block should be produced by a validator. The transaction
weights must consider \(T(B)\) in order to set restrictions on time
intensive transactions in order to saturate the block to its fullest potential
until \(T(B)\) is reached.</p>
</div>
</div>
</div>
<div id="def:block-target-time" class="exampleblock">
<div class="title">Definition 152. Block Target Time</div>
<div class="content">
<div class="paragraph">
<p>Available block ration reserved for normal, noted by \(R(B)\), is
defined as the maximum weight of none-operational transactions in the Body of
\(B\) divided by \(Len(B)\).</p>
</div>
</div>
</div>
<div id="defn-polkadot-block-limits" class="exampleblock">
<div class="title">Definition 153. Block Limits</div>
<div class="content">
<div class="paragraph">
<p>P̱olkadot block limits as defined here should be respected by each block producer
for the produced block \(B\) to be deemed valid:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(Len(B) \le 5 \times 1'024 \times 1'024 = 5'242'880\) Bytes</p>
</li>
<li>
<p>\(T(B) = 6\ seconds\)</p>
</li>
<li>
<p>\(R(B) \le 0.75\)</p>
</li>
</ul>
</div>
</div>
</div>
<div id="defn:weight-function" class="exampleblock">
<div class="title">Definition 154. Weight Function</div>
<div class="content">
<div class="paragraph">
<p>The P̱olkadot transaction weight function denoted by \(\mathcal{W}\) as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
  \mathcal{W} &amp;: \mathcal{E} \rightarrow \mathbb{N} \\
  \mathcal{W} &amp;: E \mapsto w
\end{aligned}\]
</div>
</div>
<div class="paragraph">
<p>where \(w\) is a non-negative integer representing the weight of the
extrinsic \(E\). We define the weight of all inherent extrinsics as
defined in the <a href="#sect-inherents">Section 2.3.3</a> to be equal to 0. We extend the definition of
\(\mathcal{W}\) function to compute the weight of the block as sum of
weight of all extrinsics it includes:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
  \mathcal{W} &amp;: \mathcal{B}\rightarrow \mathbb{N} \\
  \mathcal{W} &amp;: B \mapsto \sum_{E\in B}(W(E))
\end{aligned}\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the remainder of this section, we discuss the requirements to which
the weight function needs to comply to.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Computations of function \(\mathcal{W}(E)\) must be
determined before execution of that \(E\).</p>
</li>
<li>
<p>Due to the limited time window, computations of \(\mathcal{W}\)
must be done quickly and consume few resources themselves.</p>
</li>
<li>
<p>\(\mathcal{W}\) must be self contained and must not require I/O on
the chain state. \(\mathcal{W}(E)\) must depend solely on the Runtime
function representing \(E\) and its parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Heuristically, "heaviness" corresponds to the execution time of an
extrinsic. In that way, the \(\mathcal{W}\) value for various extrinsics should be
proportional to their execution time. For example, if Extrinsic A takes
three times longer to execute than Extrinsic B, then Extrinsic A should
roughly weighs 3 times of Extrinsic B. Or:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathcal{W}(A) \approx 3 \times \mathcal{W}(B)\]
</div>
</div>
<div class="paragraph">
<p>Nonetheless, \(\mathcal{W}(E)\) can be manipulated depending on the
priority of \(E\) the chain is supposed to endorse.</p>
</div>
<div class="sect3">
<h4 id="sect-limitations"><a class="anchor" href="#sect-limitations"></a><a class="link" href="#sect-limitations">10.2.1. Limitations</a></h4>
<div class="paragraph">
<p>In this section we discuss how applying the limitation defined in
<a href="#defn-polkadot-block-limits">Definition 153</a> can be translated to limitation \(\mathcal{W}\).
In order to be able to translate those into concrete numbers, we need to
identify an arbitrary maximum weight to which we scale all other computations.
For that we first define the block weight and then assume a maximum on it block
length in <a href="#defn-block-weight">Definition 155</a>:</p>
</div>
<div id="defn-block-weight" class="exampleblock">
<div class="title">Definition 155. Block Weight</div>
<div class="content">
<div class="paragraph">
<p>We define the block weight of block \(B\), formally denoted as
\(\mathcal{W}(B)\), to be:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathcal{W}(B) = \sum^{|\mathcal{E}|}_{n = 0} (W(E_n))\]
</div>
</div>
<div class="paragraph">
<p>We require that:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathcal{W}(B) &lt; 2'000'000'000'000\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The weights must fulfill the requirements as noted by the fundamentals
and limitations, and can be assigned as the author sees fit. As a simple
example, consider a maximum block weight of 1’000’000’000, an available
ratio of 75% and a targeted transaction throughput of 500 transactions,
we could assign the (average) weight for each transaction at about
1’500’000. Block producers have economic incentive to include as many
extrinsics as possible (without exceeding limitations) into a block
before reaching the targeted block time. Weights give indicators to
block producers on which extrinsics to include in order to reach the
blocks fullest potential.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-primitives"><a class="anchor" href="#sect-runtime-primitives"></a><a class="link" href="#sect-runtime-primitives">10.3. Calculation of the weight function</a></h3>
<div class="paragraph">
<p>In order to calculate weight of block \(B\),
\(\mathcal{W}(B)\), one needs to evaluate the weight of each
transaction included in the block. Each transaction causes the execution
certain Runtime functions. As such, to calculate the weight of a
transaction, those functions must be analyzed in order to determine
parts of the code which can significantly contribute to the execution
time and consume resources such as loops, I/O operations, and data
manipulation. Subsequently the performance and execution time of each
part will be evaluated based on variety of input parameters. Based on
those observations, weights are assigned Runtime functions or parameters
which contribute to long execution times. These sub component of the
code are discussed in <a href="#sect-primitive-types">Section 10.4.1</a>.</p>
</div>
<div class="paragraph">
<p>The general algorithm to calculate \(\mathcal{W}(E)\) is described in
the <a href="#sect-benchmarking">Section 10.4</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-benchmarking"><a class="anchor" href="#sect-benchmarking"></a><a class="link" href="#sect-benchmarking">10.4. Benchmarking</a></h3>
<div class="paragraph">
<p>Calculating the extrinsic weight solely based on theoretical complexity
of the underlying implementation proves to be too complicated and
unreliable at the same time. Certain decisions in the source code
architecture, internal communication within the Runtime or other design
choices could add enough overhead to make the asymptotic complexity
practically meaningless.</p>
</div>
<div class="paragraph">
<p>On the other hand, benchmarking an extrinsics in a black-box fashion
could (using random parameters) most centainly results in missing corner
cases and worst case scenarios. Instead, we benchmark all available
Runtime functions which are invoked in the course of execution of
extrinsics with a large collection of carefully selected input
parameters and use the result of the benchmarking process to evaluate
\(\mathcal{W}(E)\).</p>
</div>
<div class="paragraph">
<p>In order to select useful parameters, the Runtime functions have to be
analyzed to fully understand which behaviors or conditions can result in
expensive execution times, which is described closer in <a href="#sect-primitive-types">Section 10.4.1</a>.
Not every possible benchmarking outcome can be invoked by varying input
parameters of the Runtime function. In some circumstances, preliminary work
is required before a specific benchmark can be reliably measured, such as
creating certain preexisting entries in the storage or other changes to the
environment.</p>
</div>
<div class="paragraph">
<p>The Practical Examples (<a href="#sect-practical-examples">Section 10.5</a>) covers the
analysis process and the implementation of preliminary work in more
detail.</p>
</div>
<div class="sect3">
<h4 id="sect-primitive-types"><a class="anchor" href="#sect-primitive-types"></a><a class="link" href="#sect-primitive-types">10.4.1. Primitive Types</a></h4>
<div class="paragraph">
<p>The Runtime reuses components, known as "primitives", to interact with
the state storage. The execution cost of those primitives can be
measured and a weight should be applied for each occurrence within the
Runtime code.</p>
</div>
<div class="paragraph">
<p>For storage, Polkadot uses three different types of storage types across
its modules, depending on the context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Value</strong>: Operations on a single value. The final key-value pair is
stored under the key:</p>
<div class="listingblock">
<div class="content">
<pre>    hash(module_prefix) + hash(storage_prefix)</pre>
</div>
</div>
</li>
<li>
<p><strong>Map</strong>: Operations on multiple values, datasets, where each entry has
its corresponding, unique key. The final key-value pair is stored under
the key:</p>
<div class="listingblock">
<div class="content">
<pre>    hash(module_prefix) + hash(storage_prefix) + hash(encode(key))</pre>
</div>
</div>
</li>
<li>
<p><strong>Double map</strong>: Just like <strong>Map</strong>, but uses two keys instead of one. This
type is also known as "child storage", where the first key is the
"parent key" and the second key is the "child key". This is useful in
order to scope storage entries (child keys) under a certain <code>context</code>
(parent key), which is arbitrary. Therefore, one can have separated
storage entries based on the context. The final key-value pair is stored
under the key:</p>
<div class="listingblock">
<div class="content">
<pre>    hash(module_prefix) + hash(storage_prefix)
      + hash(encode(key1)) + hash(encode(key2))</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>It depends on the functionality of the Runtime module (or its
sub-processes, rather) which storage type to use. In some cases, only a
single value is required. In others, multiple values need to be fetched
or inserted from/into the database.</p>
</div>
<div class="paragraph">
<p>Those lower level types get abstracted over in each individual Runtime
module using the <code>decl_storage!</code> macro. Therefore, each module specifies
its own types that are used as input and output values. The abstractions
do give indicators on what operations must be closely observed and where
potential performance penalties and attack vectors are possible.</p>
</div>
<div class="sect4">
<h5 id="sect-primitive-types-considerations"><a class="anchor" href="#sect-primitive-types-considerations"></a><a class="link" href="#sect-primitive-types-considerations">10.4.1.1. Considerations</a></h5>
<div class="paragraph">
<p>The storage layout is mostly the same for every primitive type,
primarily differentiated by using special prefixes for the storage key.
Big differences arise on how the primitive types are used in the Runtime
function, on whether single values or entire datasets are being worked
on. Single value operations are generally quite cheap and its execution
time does not vary depending on the data that’s being processed.
However, excessive overhead can appear when I/O operations are executed
repeatedly, such as in loops. Especially, when the amount of loop
iterations can be influenced by the caller of the function or by certain
conditions in the state storage.</p>
</div>
<div class="paragraph">
<p>Maps, in contrast, have additional overhead when inserting or retrieving
datasets, which vary in sizes. Additionally, the Runtime function has to
process each item inside that list.</p>
</div>
<div class="paragraph">
<p>Indicators for performance penalties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fixed iterations and datasets</strong> - Fixed iterations and datasets can
increase the overall cost of the Runtime functions, but the execution
time does not vary depending on the input parameters or storage entries.
A base Weight is appropriate in this case.</p>
</li>
<li>
<p><strong>Adjustable iterations and datasets</strong> - If the amount of iterations or
datasets depend on the input parameters of the caller or specific
entries in storage, then a certain weight should be applied for each
(additional) iteration or item. The Runtime defines the maximum value
for such cases. If it doesn’t, it unconditionally has to and the Runtime
module must be adjusted. When selecting parameters for benchmarking, the
benchmarks should range from the minimum value to the maximum value, as
described in <a href="#defn-max-value">Definition 156</a>.</p>
</li>
<li>
<p><strong>Input parameters</strong> - Input parameters that users pass on to the
Runtime function can result in expensive operations. Depending on the
data type, it can be appropriate to add additional weights based on
certain properties, such as data size, assuming the data type allows
varying sizes. The Runtime must define limits on those properties. If it
doesn’t, it unconditionally has to and the Runtime module must be
adjusted. When selecting parameters for benchmarking, the benchmarks
should range from the minimum values to the maximum value, as described
in paragraph <a href="#defn-max-value">Definition 156</a>.</p>
</li>
</ul>
</div>
<div id="defn-max-value" class="exampleblock">
<div class="title">Definition 156. Maximum Value</div>
<div class="content">
<div class="paragraph">
<p>What the maximum value should be really depends on the functionality that the
Runtime function is trying to provide. If the choice for that value is not
obvious, then it’s advised to run benchmarks on a big range of values and pick a
conservative value below the <code>targeted time per block</code> limit as described in
section <a href="#sect-limitations">Section 10.2.1</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-parameters"><a class="anchor" href="#id-parameters"></a><a class="link" href="#id-parameters">10.4.2. Parameters</a></h4>
<div class="paragraph">
<p>The inputs parameters highly vary depending on the Runtime function and
must therefore be carefully selected. The benchmarks should use input
parameters which will most likely be used in regular cases, as intended
by the authors, but must also consider worst case scenarios and inputs
which might decelerate or heavily impact performance of the function.
The input parameters should be randomized in order to cause various
effects in behaviors on certain values, such as memory relocations and
other outcomes that can impact performance.</p>
</div>
<div class="paragraph">
<p>It’s not possible to benchmark every single value. However, one should
select a range of inputs to benchmark, spanning from the minimum value
to the maximum value which will most likely exceed the expected usage of
that function. This is described in more detail in
<a href="#sect-primitive-types-considerations">Section 10.4.1.1</a>. The benchmarks should run
individual executions/iterations within that range, where the chosen
parameters should give insight on the execution time. Selecting
imprecise parameters or too extreme ranges might indicate an inaccurate
result of the function as it will be used in production. Therefore, when
a range of input parameters gets benchmarked, the result of each
individual parameter should be recorded and optionally visualized, then
the necessary adjustment can be made. Generally, the worst case scenario
should be assigned as the weight value for the corresponding runtime
function.</p>
</div>
<div class="paragraph">
<p>Additionally, given the distinction theoretical and practical usage, the
author reserves the right to make adjustments to the input parameters
and assigned weights according to the observed behavior of the actual,
real-world network.</p>
</div>
<div class="sect4">
<h5 id="id-weight-refunds"><a class="anchor" href="#id-weight-refunds"></a><a class="link" href="#id-weight-refunds">10.4.2.1. Weight Refunds</a></h5>
<div class="paragraph">
<p>When assigning the final weight, the worst case scenario of each runtime
function should be used. The runtime can then additional "refund" the
amount of weights which were overestimated once the runtime function is
actually executed.</p>
</div>
<div class="paragraph">
<p>The Polkadot runtime only returns weights if the difference between the
assigned weight and the actual weight calculated during execution is
greater than 20%.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-storage-io-cost"><a class="anchor" href="#id-storage-io-cost"></a><a class="link" href="#id-storage-io-cost">10.4.3. Storage I/O cost</a></h4>
<div class="paragraph">
<p>It is advised to benchmark the raw I/O operations of the database and
assign "base weights" for each I/O operation type, such as insertion,
deletion, querying, etc. When a runtime function is executed, the
runtime can then add those base weights of each used operation in order
to calculate the final weight.</p>
</div>
</div>
<div class="sect3">
<h4 id="id-environment"><a class="anchor" href="#id-environment"></a><a class="link" href="#id-environment">10.4.4. Environment</a></h4>
<div class="paragraph">
<p>The benchmarks should be executed on clean systems without interference
of other processes or software. Additionally, the benchmarks should be
executed on multiple machines with different system resources, such as
CPU performance, CPU cores, RAM and storage speed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-practical-examples"><a class="anchor" href="#sect-practical-examples"></a><a class="link" href="#sect-practical-examples">10.5. Practical examples</a></h3>
<div class="paragraph">
<p>This section walks through Runtime functions available in the Polkadot
Runtime to demonstrate the analysis process as described in
<a href="#sect-primitive-types">Section 10.4.1</a>.</p>
</div>
<div class="paragraph">
<p>In order for certain benchmarks to produce conditions where resource
heavy computation or excessive I/O can be observed, the benchmarks might
require some preliminary work on the environment, since those conditions
cannot be created with simply selected parameters. The analysis process
shows indicators on how the preliminary work should be implemented.</p>
</div>
<div class="sect3">
<h4 id="id-practical-example-1-request_judgement"><a class="anchor" href="#id-practical-example-1-request_judgement"></a><a class="link" href="#id-practical-example-1-request_judgement">10.5.1. Practical Example #1: <code>request_judgement</code></a></h4>
<div class="paragraph">
<p>In Polkadot, accounts can save information about themselves on-chain,
known as the "Identity Info". This includes information such as display
name, legal name, email address and so on. Polkadot offers a set of
trusted registrars, entities elected by a Polkadot public referendum,
which can verify the specified contact addresses of the identities, such
as Email, and vouch on whether the identity actually owns those
accounts. This can be achieved, for example, by sending a challenge to
the specified address and requesting a signature as a response. The
verification is done off-chain, while the final judgement is saved
onchain, directly in the corresponding Identity Info. It’s also note
worthy that Identity Info can contain additional fields, set manually by
the corresponding account holder.</p>
</div>
<div class="paragraph">
<p>Information such as legal name must be verified by ID card or passport
submission.</p>
</div>
<div class="paragraph">
<p>The function <code>request_judgement</code> from the <code>identity</code> pallet allows users
to request judgement from a specific registrar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $request_judgement (param $req_index int) (param $max_fee int))</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>req_index</code>: the index which is assigned to the registrar.</p>
</li>
<li>
<p><code>max_fee</code>: the maximum fee the requester is willing to pay. The
judgement fee varies for each registrar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Studying this function reveals multiple design choices that can impact
performance, as it will be revealed by this analysis.</p>
</div>
<div class="sect4">
<h5 id="id-analysis"><a class="anchor" href="#id-analysis"></a><a class="link" href="#id-analysis">10.5.1.1. Analysis</a></h5>
<div class="paragraph">
<p>First, it fetches a list of current registrars from storage and then
searches that list for the specified registrar index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="n">registrars</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Registrars</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">get</span><span class="p">();</span>
<span class="k">let</span> <span class="n">registrar</span> <span class="o">=</span> <span class="n">registrars</span><span class="nf">.get</span><span class="p">(</span><span class="n">reg_index</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">)</span><span class="nf">.and_then</span><span class="p">(</span><span class="nn">Option</span><span class="p">::</span><span class="n">as_ref</span><span class="p">)</span>
  <span class="nf">.ok_or</span><span class="p">(</span><span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">EmptyIndex</span><span class="p">)</span><span class="o">?</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, it searches for the Identity Info from storage, based on the
sender of the transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="k">mut</span> <span class="n">id</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">IdentityOf</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sender</span><span class="p">)</span><span class="nf">.ok_or</span><span class="p">(</span><span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">NoIdentity</span><span class="p">)</span><span class="o">?</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Identity Info contains all fields that have a data in them, set by
the corresponding owner of the identity, in an ordered form. It then
proceeds to search for the specific field type that will be inserted or
updated, such as email address. If the entry can be found, the
corresponding value is to the value passed on as the function parameters
(assuming the registrar is not "stickied", which implies it cannot be
changed). If the entry cannot be found, the value is inserted into the
index where a matching element can be inserted while maintaining sorted
order. This results in memory reallocation, which increases resource
consumption.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">match</span> <span class="n">id</span><span class="py">.judgements</span><span class="nf">.binary_search_by_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg_index</span><span class="p">,</span> <span class="p">|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="na">.0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">Ok</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">if</span> <span class="n">id</span><span class="py">.judgements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="na">.1</span><span class="nf">.is_sticky</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">Err</span><span class="p">(</span><span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">StickyJudgement</span><span class="p">)</span><span class="o">?</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">id</span><span class="py">.judgements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
  <span class="p">},</span>
  <span class="nf">Err</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">id</span><span class="py">.judgements</span><span class="nf">.insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">),</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the end, the function deposits the specified <code>max_fee</code> balance, which
can later be redeemed by the registrar. Then, an event is created to
insert the Identity Info into storage. The creation of events is
lightweight, but its execution is what will actually commit the state
changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="nn">T</span><span class="p">::</span><span class="nn">Currency</span><span class="p">::</span><span class="nf">reserve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sender</span><span class="p">,</span> <span class="n">registrar</span><span class="py">.fee</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="o">&lt;</span><span class="n">IdentityOf</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sender</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
<span class="k">Self</span><span class="p">::</span><span class="nf">deposit_event</span><span class="p">(</span><span class="nn">RawEvent</span><span class="p">::</span><span class="nf">JudgementRequested</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">reg_index</span><span class="p">));</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-considerations"><a class="anchor" href="#sect-considerations"></a><a class="link" href="#sect-considerations">10.5.1.2. Considerations</a></h5>
<div class="paragraph">
<p>The following points must be considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Varying count of registrars.</p>
</li>
<li>
<p>Varying count of preexisting accounts in storage.</p>
</li>
<li>
<p>The specified registrar is searched for in the Identity Info. An
identity can be judged by as many registrars as the identity owner
issues requests for, therefore increase its footprint in the state
storage. Additionally, if a new value gets inserted into the byte array,
memory get reallocated. Depending on the size of the Identity Info, the
execution time can vary.</p>
</li>
<li>
<p>The Identity Info can contain only a few fields or many. It is
legitimate to introduce additional weights for changes the owner/sender
has influence over, such as the additional fields in the Identity Info.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="id-benchmarking-framework"><a class="anchor" href="#id-benchmarking-framework"></a><a class="link" href="#id-benchmarking-framework">10.5.1.3. Benchmarking Framework</a></h5>
<div class="paragraph">
<p>The Polkadot Runtime specifies the <code>MaxRegistrars</code> constant, which will
prevent the list of registrars of reaching an undesired length. This
value should have some influence on the benchmarking process.</p>
</div>
<div class="paragraph">
<p>The benchmarking implementation of for the function
\(request\_judgement\) can be defined as follows:</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-27" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 27 </span><span style="font-style:normal;font-variant:small-caps;">&quot;request_judgement&quot;` Runtime function benchmark</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Ensure: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">collection = \{\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo>←</mo><mn>1</mn><mo separator="true">,</mo><mi>M</mi><mi>a</mi><mi>x</mi><mi>R</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>r</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">amount \leftarrow 1,MaxRegistrars</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">am</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">rs</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="ps-funcname">Generate-Registrars</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">amount</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">am</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">caller \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Create-Account</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">caller, 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">5:</span><span class="ps-funcname">Set-Balance</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">caller, 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">100</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">6:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">time \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Timer</span>(<span class="ps-funcname">Request-Judgement</span>(<span class="ps-funcname">Random</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">amount</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">am</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo separator="true">,</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">, 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">100</span></span></span></span>))</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">7:</span><span class="ps-funcname">Add-To</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo separator="true">,</mo><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">collection, time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">8:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">9:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{W} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Compute-Weight</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">collection</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">10:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 27. <a href="#algo-27">"request\_judgement"` Runtime function benchmark</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Generate-Registrars(\(amount\))</p>
<div class="paragraph">
<p>Creates number of registrars and inserts those records into storage.</p>
</div>
</li>
<li>
<p>Create-Account(\(name\), \(index\))</p>
<div class="paragraph">
<p>Creates a Blake2 hash of the concatenated input of name and index represent-
ing the address of a account. This function only creates an address and does not
conduct any I/O.</p>
</div>
</li>
<li>
<p>Set-Balance(\(account\), \(balance\))</p>
<div class="paragraph">
<p>Sets a initial balance for the specified account in the storage state.</p>
</div>
</li>
<li>
<p>Timer(\(function\))</p>
<div class="paragraph">
<p>Measures the time from the start of the specified f unction to its completion.</p>
</div>
</li>
<li>
<p>Request-Judgement(\(registrar\_index\), \(max\_fee\))</p>
<div class="paragraph">
<p>Calls the corresponding request_judgement Runtime function and passes on
the required parameters.</p>
</div>
</li>
<li>
<p>Random(\(num\))</p>
<div class="paragraph">
<p>Picks a random number between 0 and num. This should be used when the
benchmark should account for unpredictable values.</p>
</div>
</li>
<li>
<p>Add-To(\(collection\), \(time\))</p>
<div class="paragraph">
<p>Adds a returned time measurement (time) to collection.</p>
</div>
</li>
<li>
<p>Compute-Weight(\(collection\))</p>
<div class="paragraph">
<p>Computes the resulting weight based on the time measurements in the collection.
The worst case scenario should be chosen (the highest value).</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-practical-example-payout-stakers"><a class="anchor" href="#sect-practical-example-payout-stakers"></a><a class="link" href="#sect-practical-example-payout-stakers">10.5.2. Practical Example #2: <code>payout_stakers</code></a></h4>
<div class="sect4">
<h5 id="id-analysis-2"><a class="anchor" href="#id-analysis-2"></a><a class="link" href="#id-analysis-2">10.5.2.1. Analysis</a></h5>
<div class="paragraph">
<p>The function <code>payout_stakers</code> from the <code>staking</code> Pallet can be called by
a single account in order to payout the reward for all nominators who
back a particular validator. The reward also covers the validator’s
share. This function is interesting because it iterates over a range of
nominators, which varies, and does I/O operation for each of them.</p>
</div>
<div class="paragraph">
<p>First, this function makes few basic checks to verify if the specified
era is not higher then the current era (as it is not in the future) and
is within the allowed range also known as "history depth", as specified
by the Runtime. After that, it fetches the era payout from storage and
additionally verifies whether the specified account is indeed a
validator and receives the corresponding "Ledger". The Ledger keeps
information about the stash key, controller key and other informatin
such as actively bonded balance and a list of tracked rewards. The
function only retains the entries of the history depth, and conducts a
binary search for the specified era.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="n">era_payout</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErasValidatorReward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">era</span><span class="p">)</span>
  <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">InvalidEraToReward</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="k">let</span> <span class="n">controller</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">bonded</span><span class="p">(</span><span class="o">&amp;</span><span class="n">validator_stash</span><span class="p">)</span><span class="nf">.ok_or</span><span class="p">(</span><span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">NotStash</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="k">let</span> <span class="k">mut</span> <span class="n">ledger</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Ledger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">controller</span><span class="p">)</span><span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">NotController</span><span class="p">)</span><span class="o">?</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="n">ledger</span><span class="py">.claimed_rewards</span><span class="nf">.retain</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">current_era</span><span class="nf">.saturating_sub</span><span class="p">(</span><span class="n">history_depth</span><span class="p">));</span>
<span class="k">match</span> <span class="n">ledger</span><span class="py">.claimed_rewards</span><span class="nf">.binary_search</span><span class="p">(</span><span class="o">&amp;</span><span class="n">era</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">Error</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">AlreadyClaimed</span><span class="p">)</span><span class="o">?</span><span class="p">,</span>
  <span class="nf">Err</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">ledger</span><span class="py">.claimed_rewards</span><span class="nf">.insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">era</span><span class="p">),</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The retained claimed rewards are inserted back into storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="o">&lt;</span><span class="n">Ledger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ledger</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an optimization, Runtime only fetches a list of the 64 highest staked
nominators, although this might be changed in the future. Accordingly,
any lower staked nominator gets no reward.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="n">exposure</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErasStakersClipped</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">era</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ledger</span><span class="py">.stash</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the function gets the era reward points from storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="n">era_reward_points</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErasRewardPoints</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">era</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, the payout is split among the validator and its nominators.
The validators receives the payment first, creating an insertion into
storage and sending a deposit event to the scheduler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">imbalance</span><span class="p">)</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">make_payout</span><span class="p">(</span>
  <span class="o">&amp;</span><span class="n">ledger</span><span class="py">.stash</span><span class="p">,</span>
  <span class="n">validator_staking_payout</span> <span class="o">+</span> <span class="n">validator_commission_payout</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">Self</span><span class="p">::</span><span class="nf">deposit_event</span><span class="p">(</span><span class="nn">RawEvent</span><span class="p">::</span><span class="nf">Reward</span><span class="p">(</span><span class="n">ledger</span><span class="py">.stash</span><span class="p">,</span> <span class="n">imbalance</span><span class="nf">.peek</span><span class="p">()));</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, the nominators receive their payout rewards. The functions loops
over the nominator list, conducting an insertion into storage and a
creation of a deposit event for each of the nominators.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">for</span> <span class="n">nominator</span> <span class="k">in</span> <span class="n">exposure</span><span class="py">.others</span><span class="nf">.iter</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">let</span> <span class="n">nominator_exposure_part</span> <span class="o">=</span> <span class="nn">Perbill</span><span class="p">::</span><span class="nf">from_rational_approximation</span><span class="p">(</span>
    <span class="n">nominator</span><span class="py">.value</span><span class="p">,</span>
    <span class="n">exposure</span><span class="py">.total</span><span class="p">,</span>
  <span class="p">);</span>

  <span class="k">let</span> <span class="n">nominator_reward</span><span class="p">:</span> <span class="n">BalanceOf</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">nominator_exposure_part</span> <span class="o">*</span> <span class="n">validator_leftover_payout</span><span class="p">;</span>
  <span class="c1">// We can now make nominator payout:</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">imbalance</span><span class="p">)</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">make_payout</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nominator</span><span class="py">.who</span><span class="p">,</span> <span class="n">nominator_reward</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">Self</span><span class="p">::</span><span class="nf">deposit_event</span><span class="p">(</span><span class="nn">RawEvent</span><span class="p">::</span><span class="nf">Reward</span><span class="p">(</span><span class="n">nominator</span><span class="py">.who</span><span class="nf">.clone</span><span class="p">(),</span> <span class="n">imbalance</span><span class="nf">.peek</span><span class="p">()));</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="considerations-1"><a class="anchor" href="#considerations-1"></a><a class="link" href="#considerations-1">10.5.2.2. Considerations</a></h5>
<div class="paragraph">
<p>The following points must be considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Ledger contains a varying list of claimed rewards. Fetching,
retaining and searching through it can affect execution time. The
retained list is inserted back into storage.</p>
</li>
<li>
<p>Looping through a list of nominators and creating I/O operations for
each increases execution time. The Runtime fetches up to 64 nominators.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="id-benchmarking-framework-2"><a class="anchor" href="#id-benchmarking-framework-2"></a><a class="link" href="#id-benchmarking-framework-2">10.5.2.3. Benchmarking Framework</a></h5>
<div id="defn-history-depth" class="exampleblock">
<div class="title">Definition 157. History Depth</div>
<div class="content">
<div class="paragraph">
<p>H̱istory Depth indicated as <code>MaxNominatorRewardedPerValidator</code> is a fixed
constant specified by the Polkadot Runtime which dictates the number of Eras
the Runtime will reward nominators and validators for.</p>
</div>
</div>
</div>
<div id="defn-max_nominator_reward_per_validator" class="exampleblock">
<div class="title">Definition 158. Maximum Nominator Reward</div>
<div class="content">
<div class="paragraph">
<p>M̱aximum Nominator Rewarded Per Validator indicated as
<code>MaxNominatorRewardedPerValidator</code>, specifies the maximum amount of the
highest-staked nominators which will get a reward. Those values should have
some influence in the benchmarking process.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The benchmarking implementation for the function
\(payout\_stakers\) can be defined as follows:</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-28" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 28 </span><span style="font-style:normal;font-variant:small-caps;">&quot;payout_stakers&quot; Runtime function benchmark</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Ensure: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">collection = \{\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo>←</mo><mn>1</mn><mo separator="true">,</mo><mi>M</mi><mi>a</mi><mi>x</mi><mi>N</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>R</mi><mi>e</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>d</mi><mi>P</mi><mi>e</mi><mi>r</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">amount \leftarrow 1,MaxNominatorRewardedPerValidator</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">am</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>r</mi><mi>a</mi><mi mathvariant="normal">_</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo>←</mo><mn>1</mn><mo separator="true">,</mo><mi>H</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>y</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">era\_depth \leftarrow 1,HistoryDepth</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">oryDe</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">h</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">validator \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Generate-Validator</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">5:</span><span class="ps-funcname">Validate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">validator</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">6:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>s</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">nominators \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ors</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Generate-Nominators</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">amount</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">am</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>∈</mo><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">nominator \in nominators</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ors</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-4.5em;">8:</span><span class="ps-funcname">Nominate</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">validator, nominator</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">9:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">10:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>r</mi><mi>a</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">era\_index \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Create-Rewards</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>s</mi><mo separator="true">,</mo><mi>e</mi><mi>r</mi><mi>a</mi><mi mathvariant="normal">_</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">validator, nominators, era\_depth</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ors</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">h</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">11:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">time \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Timer</span>(<span class="ps-funcname">Payout-Stakers</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">validator</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo separator="true">,</mo><mi>e</mi><mi>r</mi><mi>a</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">, era\_index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">12:</span><span class="ps-funcname">Add-To</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo separator="true">,</mo><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">collection, time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">13:</span><span class="ps-keyword">end for</span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">14:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">15:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{W} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Compute-Weight</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">collection</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">16:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 28. <a href="#algo-28">"payout\_stakers" Runtime function benchmark</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Generate-Validator()</p>
<div class="paragraph">
<p>Creates a validators with some unbonded balances.</p>
</div>
</li>
<li>
<p>Validate(\(validator\))</p>
<div class="paragraph">
<p>Bonds balances of validator and bonds balances.</p>
</div>
</li>
<li>
<p>Generate-Nominators(\(amount\))</p>
<div class="paragraph">
<p>Creates the amount of nominators with some unbonded balances.</p>
</div>
</li>
<li>
<p>Nominate(\(validator\), \(nominator\))</p>
<div class="paragraph">
<p>Starts nomination of nominator for validator by bonding balances.</p>
</div>
</li>
<li>
<p>Create-Rewards(\(validator\), \(nominators\), \(era\_depth\))</p>
<div class="paragraph">
<p>Starts an Era and creates pending rewards for validator and nominators.</p>
</div>
</li>
<li>
<p>Timer(\(function\))</p>
<div class="paragraph">
<p>Measures the time from the start of the specified f unction to its completion.</p>
</div>
</li>
<li>
<p>Add-To(\(collection\), \(time\))</p>
<div class="paragraph">
<p>Adds a returned time measurement (time) to collection.</p>
</div>
</li>
<li>
<p>Compute-Weight(\(collection\))</p>
<div class="paragraph">
<p>Computes the resulting weight based on the time measurements in the collection.
The worst case scenario should be chosen (the highest value).</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-practical-example-3-transfer"><a class="anchor" href="#id-practical-example-3-transfer"></a><a class="link" href="#id-practical-example-3-transfer">10.5.3. Practical Example #3: <code>transfer</code></a></h4>
<div class="paragraph">
<p>The \(transfer\) function of the <code>balances</code> module is designed
to move the specified balance by the sender to the receiver.</p>
</div>
<div class="sect4">
<h5 id="id-analysis-3"><a class="anchor" href="#id-analysis-3"></a><a class="link" href="#id-analysis-3">10.5.3.1. Analysis</a></h5>
<div class="paragraph">
<p>The source code of this function is quite short:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="n">transactor</span> <span class="o">=</span> <span class="nf">ensure_signed</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="k">let</span> <span class="n">dest</span> <span class="o">=</span> <span class="nn">T</span><span class="p">::</span><span class="nn">Lookup</span><span class="p">::</span><span class="nf">lookup</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="o">&lt;</span><span class="k">Self</span> <span class="k">as</span> <span class="n">Currency</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">transfer</span><span class="p">(</span>
  <span class="o">&amp;</span><span class="n">transactor</span><span class="p">,</span>
  <span class="o">&amp;</span><span class="n">dest</span><span class="p">,</span>
  <span class="n">value</span><span class="p">,</span>
  <span class="nn">ExistenceRequirement</span><span class="p">::</span><span class="n">AllowDeath</span>
<span class="p">)</span><span class="o">?</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, one need to pay close attention to the property <code>AllowDeath</code>
and to how the function treat existingand non-existing accounts
differently. Two types of behaviors are to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the transfer completely depletes the sender account balance to zero
(or bellow the minimum "keep-alive" requirement), it removes the address
and all associated data from storage.</p>
</li>
<li>
<p>If recipient account has no balance, the transfer also needs to create
the recipient account.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="considerations-2"><a class="anchor" href="#considerations-2"></a><a class="link" href="#considerations-2">10.5.3.2. Considerations</a></h5>
<div class="paragraph">
<p>Specific parameters can could have a significant impact for this
specific function. In order to trigger the two behaviors mentioned
above, the following parameters are selected:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>From</strong></th>
<th class="tableblock halign-left valign-top"><strong>To</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account index</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>index</code> in&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used as a seed for account
creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balance</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>balance</code> in&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sender balance and transfer amount</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Executing a benchmark for each balance increment within the balance
range for each index increment within the index range will generate too
many variants (\(1000 \times 999\)) and highly increase
execution time. Therefore, this benchmark is configured to first set the
balance at value 1’000 and then to iterate from 1 to 1’000 for the index
value. Once the index value reaches 1’000, the balance value will reset
to 2 and iterate to 1’000 (see <a href="#algo-benchmark-transfer">Algorithm 29</a> for more
detail):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>index</code>: 1, <code>balance</code>: 1000</p>
</li>
<li>
<p><code>index</code>: 2, <code>balance</code>: 1000</p>
</li>
<li>
<p><code>index</code>: 3, <code>balance</code>: 1000</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
<li>
<p><code>index</code>: 1000, <code>balance</code>: 1000</p>
</li>
<li>
<p><code>index</code>: 1000, <code>balance</code>: 2</p>
</li>
<li>
<p><code>index</code>: 1000, <code>balance</code>: 3</p>
</li>
<li>
<p><code>index</code>: 1000, <code>balance</code>: 4</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parameters itself do not influence or trigger the two worst
conditions and must be handled by the implemented benchmarking tool. The
\(transfer\) benchmark is implemented as defined in
<a href="#algo-benchmark-transfer">Algorithm 29</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="id-benchmarking-framework-3"><a class="anchor" href="#id-benchmarking-framework-3"></a><a class="link" href="#id-benchmarking-framework-3">10.5.3.3. Benchmarking Framework</a></h5>
<div class="paragraph">
<p>The benchmarking implementation for the Polkadot Runtime function
\(transfer\) is defined as follows (starting with the Main
function):</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-benchmark-transfer" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 29 </span><span style="font-style:normal;font-variant:small-caps;">&quot;transfer&quot; Runtime function benchmark</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Ensure: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">collection</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>: a collection of time measurements of all benchmark iterations</p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">function </span><span class="ps-funcname">Main</span>()</p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">2:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">collection = \{ \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>=</mo><msup><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mn>000</mn></mrow><annotation encoding="application/x-tex">balance = 1&#x27;000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">000</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">4:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>←</mo><mn>1</mn><mo separator="true">,</mo><msup><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mn>000</mn></mrow><annotation encoding="application/x-tex">index \gets 1,1&#x27;000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">000</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">time \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Run-Benchmark</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">index, balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">6:</span><span class="ps-funcname">Add-To</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo separator="true">,</mo><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">collection, time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">7:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">8:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>=</mo><msup><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mn>000</mn></mrow><annotation encoding="application/x-tex">index = 1&#x27;000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">000</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">9:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>←</mo><mn>2</mn><mo separator="true">,</mo><msup><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mn>000</mn></mrow><annotation encoding="application/x-tex">balance \gets 2,1&#x27;000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">000</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">10:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">time \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Run-Benchmark</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">index, balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">11:</span><span class="ps-funcname">Add-To</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo separator="true">,</mo><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">collection, time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">12:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">13:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{W} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Compute-Weight</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">collection</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">14:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">15:</span><span class="ps-keyword">end function</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">16:</span><span class="ps-keyword">function </span><span class="ps-funcname">Run-Benchmark</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>)</p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">17:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">sender \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">se</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Create-Account</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">caller, index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">18:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>p</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">recipient \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">rec</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Create-Accouny</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>p</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo separator="true">,</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">recipient, index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">rec</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">19:</span><span class="ps-funcname">Set-Balance</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">sender, balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">se</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">20:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">time \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Timer</span>(<span class="ps-funcname">Transfer</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>p</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">sender, recipient, balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">se</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">rec</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>))</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">21:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">22:</span><span class="ps-keyword">end function</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 29. <a href="#algo-benchmark-transfer">"transfer" Runtime function benchmark</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create-Account(\(name\), \(index\))</p>
<div class="paragraph">
<p>Creates a Blake2 hash of the concatenated input of name and index representing the address of a account. This function only creates an address and does not conduct any I/O.</p>
</div>
</li>
<li>
<p>Set-Balance(\(account\), \(balance\))</p>
<div class="paragraph">
<p>Sets a initial balance for the specified account in the storage state.</p>
</div>
</li>
<li>
<p>Transfer(\(sender\), \(recipient\), \(balance\))</p>
<div class="paragraph">
<p>Transfers the specified balance from sender to recipient by calling the corresponding Runtime function. This represents the target Runtime function to be benchmarked.</p>
</div>
</li>
<li>
<p>Add-To(\(collection\), \(time\))</p>
<div class="paragraph">
<p>Adds a returned time measurement (time) to collection.</p>
</div>
</li>
<li>
<p>Timer(\(function\))</p>
<div class="paragraph">
<p>Adds a returned time measurement (time) to collection.</p>
</div>
</li>
<li>
<p>Compute-Weight(\(collection\))</p>
<div class="paragraph">
<p>Computes the resulting weight based on the time measurements in the collection. The worst case scenario should be chosen (the highest value).</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-practical-example-4-withdraw_unbounded"><a class="anchor" href="#id-practical-example-4-withdraw_unbounded"></a><a class="link" href="#id-practical-example-4-withdraw_unbounded">10.5.4. Practical Example #4: <code>withdraw_unbounded</code></a></h4>
<div class="paragraph">
<p>The <code>withdraw_unbonded</code> function of the <code>staking</code> module is designed to
move any unlocked funds from the staking management system to be ready
for transfer. It contains some operations which have some I/O overhead.</p>
</div>
<div class="sect4">
<h5 id="id-analysis-4"><a class="anchor" href="#id-analysis-4"></a><a class="link" href="#id-analysis-4">10.5.4.1. Analysis</a></h5>
<div class="paragraph">
<p>Similarly to the <code>payout_stakers</code> function
(<a href="#sect-practical-example-payout-stakers">Section 10.5.2</a>), this function fetches
the Ledger which contains information about the stash, such as bonded
balance and unlocking balance (balance that will eventually be freed and
can be withdrawn).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">current_era</span><span class="p">)</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">current_era</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">ledger</span> <span class="o">=</span> <span class="n">ledger</span><span class="nf">.consolidate_unlocked</span><span class="p">(</span><span class="n">current_era</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The function <code>consolidate_unlocked</code> does some cleaning up on the ledger,
where it removes outdated entries from the unlocking balance (which
implies that balance is now free and is no longer awaiting unlock).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="k">mut</span> <span class="n">total</span> <span class="o">=</span> <span class="k">self</span><span class="py">.total</span><span class="p">;</span>
<span class="k">let</span> <span class="n">unlocking</span> <span class="o">=</span> <span class="k">self</span><span class="py">.unlocking</span><span class="nf">.into_iter</span><span class="p">()</span>
  <span class="nf">.filter</span><span class="p">(|</span><span class="n">chunk</span><span class="p">|</span> <span class="k">if</span> <span class="n">chunk</span><span class="py">.era</span> <span class="o">&gt;</span> <span class="n">current_era</span> <span class="p">{</span>
    <span class="k">true</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">total</span><span class="nf">.saturating_sub</span><span class="p">(</span><span class="n">chunk</span><span class="py">.value</span><span class="p">);</span>
    <span class="k">false</span>
  <span class="p">})</span>
  <span class="nf">.collect</span><span class="p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This function does a check on wether the updated ledger has any balance
left in regards to staking, both in terms of locked, staking balance and
unlocking balance. If not amount is left, the all information related to
the stash will be deleted. This results in multiple I/O calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">if</span> <span class="n">ledger</span><span class="py">.unlocking</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">ledger</span><span class="py">.active</span><span class="nf">.is_zero</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// This account must have called `unbond()` with some value that caused the active</span>
  <span class="c1">// portion to fall below existential deposit + will have no more unlocking chunks</span>
  <span class="c1">// left. We can now safely remove all staking-related information.</span>
  <span class="k">Self</span><span class="p">::</span><span class="nf">kill_stash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stash</span><span class="p">,</span> <span class="n">num_slashing_spans</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
  <span class="c1">// remove the lock.</span>
  <span class="nn">T</span><span class="p">::</span><span class="nn">Currency</span><span class="p">::</span><span class="nf">remove_lock</span><span class="p">(</span><span class="n">STAKING_ID</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stash</span><span class="p">);</span>
  <span class="c1">// This is worst case scenario, so we use the full weight and return None</span>
  <span class="nb">None</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting call to <code>Self::kill_stash()</code> triggers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="nn">slashing</span><span class="p">::</span><span class="nn">clear_stash_metadata</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">stash</span><span class="p">,</span> <span class="n">num_slashing_spans</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="o">&lt;</span><span class="n">Bonded</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="n">stash</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">Ledger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">controller</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">Payee</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="n">stash</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">Validators</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="n">stash</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">Nominators</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="n">stash</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if there’s some balance left, the adjusted ledger simply
gets updated back into storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="c1">// This was the consequence of a partial unbond. just update the ledger and move on.</span>
<span class="k">Self</span><span class="p">::</span><span class="nf">update_ledger</span><span class="p">(</span><span class="o">&amp;</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ledger</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, it withdraws the unlocked balance, making it ready for
transfer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">let</span> <span class="n">value</span> <span class="o">=</span> <span class="n">old_total</span> <span class="o">-</span> <span class="n">ledger</span><span class="py">.total</span><span class="p">;</span>
<span class="k">Self</span><span class="p">::</span><span class="nf">deposit_event</span><span class="p">(</span><span class="nn">RawEvent</span><span class="p">::</span><span class="nf">Withdrawn</span><span class="p">(</span><span class="n">stash</span><span class="p">,</span> <span class="n">value</span><span class="p">));</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="id-parameters-2"><a class="anchor" href="#id-parameters-2"></a><a class="link" href="#id-parameters-2">10.5.4.2. Parameters</a></h5>
<div class="paragraph">
<p>The following parameters are selected:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>From</strong></th>
<th class="tableblock halign-left valign-top"><strong>To</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account index</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>index</code> in&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used as a seed for account
creation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This benchmark does not require complex parameters. The values are used
solely for account generation.</p>
</div>
</div>
<div class="sect4">
<h5 id="considerations-3"><a class="anchor" href="#considerations-3"></a><a class="link" href="#considerations-3">10.5.4.3. Considerations</a></h5>
<div class="paragraph">
<p>Two important points in the <code>withdraw_unbonded</code> function must be
considered. The benchmarks should trigger both conditions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The updated ledger is inserted back into storage.</p>
</li>
<li>
<p>If the stash gets killed, then multiple, repetitive deletion calls are
performed in the storage.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="id-benchmarking-framework-4"><a class="anchor" href="#id-benchmarking-framework-4"></a><a class="link" href="#id-benchmarking-framework-4">10.5.4.4. Benchmarking Framework</a></h5>
<div class="paragraph">
<p>The benchmarking implementation for the Polkadot Runtime function
<code>withdraw_unbonded</code> is defined as follows:</p>
</div>
<div class="sidebarblock">
<div class="content">
          <div id="algo-benchmark-withdraw" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 30 </span><span style="font-style:normal;font-variant:small-caps;">&quot;withdraw_unbonded&quot; Runtime function benchmark</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Ensure: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span class="ps-keyword">function </span><span class="ps-funcname">Main</span>()</p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">2:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">collection = \{\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mclose">}</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>←</mo><mn>1</mn><mo separator="true">,</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">balance \gets 1,100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">100</span></span></span></span><span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">4:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">stash \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Create-Account</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo separator="true">,</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">stash, 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">5:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">controller \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Create-Account</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">controller, 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">6:</span><span class="ps-funcname">Set-Balance</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo separator="true">,</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">stash, 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">100</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">7:</span><span class="ps-funcname">Set-Balance</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">controller, 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">8:</span><span class="ps-funcname">Bond</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo separator="true">,</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">stash, controller, balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">9:</span><span class="ps-funcname">Pass-Era</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">10:</span><span class="ps-funcname">UnBond</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>b</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">controller, balance</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">11:</span><span class="ps-funcname">Pass-Era</span>()</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">12:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">time \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Timer</span>(<span class="ps-funcname">Withdraw-Unbonded</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">controller</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span></span>))</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-3em;">13:</span><span class="ps-funcname">Add-To</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo separator="true">,</mo><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">collection, time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>)</p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">14:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">15:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi><mo>←</mo></mrow><annotation encoding="application/x-tex">\mathcal{W} \leftarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span></span></span></span> <span class="ps-funcname">Compute-Weight</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">collection</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>)</p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">16:</span><span class="ps-keyword">return </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">W</mi></mrow><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">17:</span><span class="ps-keyword">end function</span></p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 30. <a href="#algo-benchmark-withdraw">"withdraw\_unbonded" Runtime function benchmark</a></div>
          </div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create-Account(\(name\), \(index\))</p>
<div class="paragraph">
<p>Creates a Blake2 hash of the concatenated input of name and index representing
the address of a account. This function only creates an address and does not
conduct any I/O.</p>
</div>
</li>
<li>
<p>Set-Balance(\(account\), \(balance\))</p>
<div class="paragraph">
<p>Sets a initial balance for the specified account in the storage state.</p>
</div>
</li>
<li>
<p>Bond(\(stash\), \(controller\), \(amount\))</p>
<div class="paragraph">
<p>Bonds the specified amount for the stash and controller pair.</p>
</div>
</li>
<li>
<p>UnBond(\(account\), \(amount\))</p>
<div class="paragraph">
<p>Unbonds the specified amount for the given account.</p>
</div>
</li>
<li>
<p>Pass-Era()</p>
<div class="paragraph">
<p>Pass one era. Forces the function <code>withdraw_unbonded</code> to update the ledger and
eventually delete information.</p>
</div>
</li>
<li>
<p>Withdraw-Unbonded(\(controller\))</p>
<div class="paragraph">
<p>Withdraws the the full unbonded amount of the specified controller account. This
represents the target Runtime function to be benchmarked.</p>
</div>
</li>
<li>
<p>Add-To(\(collection\), \(time\))</p>
<div class="paragraph">
<p>Adds a returned time measurement (time) to collection.</p>
</div>
</li>
<li>
<p>Timer(\(function\))</p>
<div class="paragraph">
<p>Measures the time from the start of the specified f unction to its completion.</p>
</div>
</li>
<li>
<p>Compute-Weight(\(collection\))</p>
<div class="paragraph">
<p>Computes the resulting weight based on the time measurements in the collection.
The worst case scenario should be chosen (the highest value).</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-fees"><a class="anchor" href="#id-fees"></a><a class="link" href="#id-fees">10.6. Fees</a></h3>
<div class="paragraph">
<p>Block producers charge a fee in order to be economically sustainable.
That fee must always be covered by the sender of the transaction.
Polkadot has a flexible mechanism to determine the minimum cost to
include transactions in a block.</p>
</div>
<div class="sect3">
<h4 id="sect-fee-calculation"><a class="anchor" href="#sect-fee-calculation"></a><a class="link" href="#sect-fee-calculation">10.6.1. Fee Calculation</a></h4>
<div class="paragraph">
<p>Polkadot fees consists of three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base fee: a fixed fee that is applied to every transaction and set by
the Runtime.</p>
</li>
<li>
<p>Length fee: a fee that gets multiplied by the length of the
transaction, in bytes.</p>
</li>
<li>
<p>Weight fee: a fee for each, varying Runtime function. Runtime
implementers need to implement a conversion mechanism which determines
the corresponding currency amount for the calculated weight.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The final fee can be summarized as:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
fee &amp;= base\ fee \\
    &amp;{} + length\ of\ transaction\ in\ bytes \times length\ fee \\
    &amp;{} + weight\ to\ fee \\
\end{aligned}\]
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-definitions-in-polkadot"><a class="anchor" href="#id-definitions-in-polkadot"></a><a class="link" href="#id-definitions-in-polkadot">10.6.2. Definitions in Polkadot</a></h4>
<div class="paragraph">
<p>The Polkadot Runtime defines the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base fee: 100 uDOTs</p>
</li>
<li>
<p>Length fee: 0.1 uDOTs</p>
</li>
<li>
<p>Weight to fee conversion:</p>
<div class="stemblock">
<div class="content">
\[weight\ fee = weight \times (100\ uDOTs \div (10 \times 10'000))\]
</div>
</div>
<div class="paragraph">
<p>A weight of 10’000 (the smallest non-zero weight) is mapped to
\(\frac{1}{10}\) of 100 uDOT. This fee will never exceed the
max size of an unsigned 128 bit integer.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="id-fee-multiplier"><a class="anchor" href="#id-fee-multiplier"></a><a class="link" href="#id-fee-multiplier">10.6.3. Fee Multiplier</a></h4>
<div class="paragraph">
<p>Polkadot can add a additional fee to transactions if the network becomes
too busy and starts to decelerate the system. This fee can create an
incentive to avoid the production of low priority or insignificant
transactions. In contrast, those additional fees will decrease if the
network calms down and it can execute transactions without much
difficulties.</p>
</div>
<div class="paragraph">
<p>That additional fee is known as the <code>Fee Multiplier</code> and its value is
defined by the Polkadot Runtime. The multiplier works by comparing the
saturation of blocks; if the previous block is less saturated than the
current block (implying an uptrend), the fee is slightly increased.
Similarly, if the previous block is more saturated than the current
block (implying a downtrend), the fee is slightly decreased.</p>
</div>
<div class="paragraph">
<p>The final fee is calculated as:</p>
</div>
<div class="stemblock">
<div class="content">
\[final\ fee = fee \times Fee\ Multiplier\]
</div>
</div>
<div class="sect4">
<h5 id="id-update-multiplier"><a class="anchor" href="#id-update-multiplier"></a><a class="link" href="#id-update-multiplier">10.6.3.1. Update Multiplier</a></h5>
<div class="paragraph">
<p>The <code>Update Multiplier</code> defines how the multiplier can change. The
Polkadot Runtime internally updates the multiplier after each block
according the following formula:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
  diff &amp;=&amp; (target\ weight - previous\ block\ weight) \\
  v &amp;=&amp; 0.00004 \\
  next\ weight &amp;=&amp; weight \times (1 + (v \times diff) + (v \times diff)^2 / 2) \\
\end{aligned}\]
</div>
</div>
<div class="paragraph">
<p>Polkadot defines the <code>target_weight</code> as 0.25 (25%). More information
about this algorithm is described in the
<a href="https://research.web3.foundation/en/latest/polkadot/Token%20Economics.html#relay-chain-transaction-fees-and-per-block-transaction-limits">Web3 Foundation research paper</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id-consensus"><a class="anchor" href="#id-consensus"></a><a class="link" href="#id-consensus">11. Consensus</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="id-babe-digest-messages"><a class="anchor" href="#id-babe-digest-messages"></a><a class="link" href="#id-babe-digest-messages">11.1. BABE digest messages</a></h3>
<div class="paragraph">
<p>The Runtime is required to provide the BABE authority list and
randomness to the host via a consensus message in the header of the
first block of each epoch.</p>
</div>
<div class="paragraph">
<p>The digest published in Epoch \(\mathcal{E}_n\) is enacted in
\(\mathcal{E}_{n+1}\). The randomness in this digest is
computed based on the all the VRF outputs up to including Epoch
\(\mathcal{E}_{n-2}\) while the authority set is based on all
transaction included up to Epoch \(\mathcal{E}_{n-1}\).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The computation of the randomeness seed is described in
<a href="#algo-epoch-randomness">Algorithm 31</a> which uses the
concept of epoch subchain as described in host specification and the
value \(d_B\), which is the VRF output computed for slot
\(s_B\).</p>
</div>
          <div id="algo-epoch-randomness" class="imageblock">
            <div class="content"><div class="ps-root">
<div class="ps-algorithm with-caption">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Algorithm 31 </span><span style="font-style:normal;font-variant:small-caps;">Epoch-Randomness</span></p>
<div class="ps-algorithmic with-linenum">
<p class="ps-line" style="text-indent:-1.2em;padding-left:1.2em;">
<span class="ps-keyword">Require: </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n &gt; 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></p>
<div class="ps-block" style="margin-left:1.7999999999999998em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">1:</span><span style="font-weight:bold;">init</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>←</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\rho \leftarrow \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ρ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">2:</span><span class="ps-keyword">for </span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> in <span class="ps-funcname">SubChain</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">E</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathcal{E}_{n-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08944em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0894em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>)<span class="ps-keyword"> do</span></p>
<div class="ps-block" style="margin-left:1.2em;">
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:-1.5em;">3:</span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>←</mo><mi>ρ</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>d</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">\rho \leftarrow \rho || d_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ρ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ρ</span><span class="mord">∣∣</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
</div>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">4:</span><span class="ps-keyword">end for</span></p>
<p class="ps-line ps-code">
<span class="ps-linenum" style="left:0em;">5:</span><span class="ps-keyword">return </span><span class="ps-funcname">Blake2b</span>(<span class="ps-funcname">Epoch-Randomness</span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>n</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>ρ</mi></mrow><annotation encoding="application/x-tex">||n||\rho</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣∣</span><span class="mord mathnormal">n</span><span class="mord">∣∣</span><span class="mord mathnormal">ρ</span></span></span></span>)</p>
</div>
</div>
</div>
</div></div>
            <div class="title">Algorithm 31. <a href="#algo-epoch-randomness">Epoch-Randomness</a></div>
          </div>
<div class="paragraph">
<p>where \$n\$ is the epoch index.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-metadata"><a class="anchor" href="#sect-metadata"></a><a class="link" href="#sect-metadata">12. Metadata</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The runtime metadata structure contains all the information necessary on how to
interact with the Polkadot runtime. Considering that Polkadot runtimes are
upgradable and therefore any interfaces are subject to change, the metadata
allows developers to structure any extrinsics or storage entries accordingly.</p>
</div>
<div class="paragraph">
<p>The metadata of a runtime is provided by a call to <code>Metadata_metadata</code> (<a href="#sect-rte-metadata-metadata">Section C.5.1</a>)
and is returned as a scale encoded (<a href="#sect-scale-codec">Section A.2.2</a>) binary blob. How to interpret and decode this
data is described in this chapter.</p>
</div>
<div class="sect2">
<h3 id="sect-rtm-structure"><a class="anchor" href="#sect-rtm-structure"></a><a class="link" href="#sect-rtm-structure">12.1. Structure</a></h3>
<div class="paragraph">
<p>The Runtime Metadata is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$(M, v_m, R, P, t_e, v_e, E, t_r)\$
\$R = (r_0, ...,r_n)\$
\$P = (p_0, ...,p_n)\$
\$E = (e_0, ...,e_n)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$M\$ are the first four constant bytes, spelling "meta" in ASCII.</p>
</li>
<li>
<p>\$v_m\$ is an unsigned 8-bit integer indicating the format version of the
metadata structure (currently the value of <code>14</code>).</p>
</li>
<li>
<p>\$R\$ is a sequence (<a href="#defn-scale-list">Definition 192</a>) of type definitions \$r_i\$
(<a href="#defn-rtm-registry-entry">Definition 159</a>).</p>
</li>
<li>
<p>\$P\$ is a sequence (<a href="#defn-scale-list">Definition 192</a>) of pallet metadata \$p_i\$
(<a href="#sect-rtm-pallet-metadata">Section 12.2</a>).</p>
</li>
<li>
<p>\$t_e\$ is the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of the extrinsics.</p>
</li>
<li>
<p>\$v_e\$ is an unsigned 8-bit integer indicating the format version of the
extrinsics (implying a possible breaking change).</p>
</li>
<li>
<p>\$E\$ is a sequence (<a href="#defn-scale-list">Definition 192</a>) of extrinsics metadata \$e_i\$
(<a href="#defn-rtm-signed-extension-metadata">Definition 170</a>).</p>
</li>
<li>
<p>\$t_r\$ is the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of the runtime.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="metadata" class="imageblock">
<div class="content">
<svg width="562pt" height="387pt"
 viewBox="0.00 0.00 562.00 387.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 383)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-383 558,-383 558,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-371 377,-371 377,-8 8,-8"/>
<text text-anchor="middle" x="192.5" y="-355.8" font-family="Times,serif" font-size="14.00">Metadata</text>
</g>
<!-- metadata__seq -->
<g id="node1" class="node">
<title>metadata__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-314 24.5,-335 55.5,-335 55.5,-314 24.5,-314"/>
<polygon fill="none" stroke="black" points="24.5,-314 24.5,-335 55.5,-335 55.5,-314 24.5,-314"/>
<text text-anchor="start" x="27.5" y="-320.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-314 55.5,-335 89.5,-335 89.5,-314 55.5,-314"/>
<polygon fill="none" stroke="black" points="55.5,-314 55.5,-335 89.5,-335 89.5,-314 55.5,-314"/>
<text text-anchor="start" x="58.5" y="-320.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-314 89.5,-335 228.5,-335 228.5,-314 89.5,-314"/>
<polygon fill="none" stroke="black" points="89.5,-314 89.5,-335 228.5,-335 228.5,-314 89.5,-314"/>
<text text-anchor="start" x="143" y="-320.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="228.5,-314 228.5,-335 361.5,-335 361.5,-314 228.5,-314"/>
<polygon fill="none" stroke="black" points="228.5,-314 228.5,-335 361.5,-335 361.5,-314 228.5,-314"/>
<text text-anchor="start" x="288" y="-320.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-293 24.5,-314 55.5,-314 55.5,-293 24.5,-293"/>
<text text-anchor="start" x="35" y="-299.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-293 55.5,-314 89.5,-314 89.5,-293 55.5,-293"/>
<text text-anchor="start" x="67.5" y="-299.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="89.5,-293 89.5,-314 228.5,-314 228.5,-293 89.5,-293"/>
<polygon fill="none" stroke="black" points="228.5,-293 228.5,-314 361.5,-314 361.5,-293 228.5,-293"/>
<text text-anchor="start" x="273.5" y="-299.8" font-family="Times,serif" font-size="14.00">magic</text>
<polygon fill="none" stroke="black" points="24.5,-272 24.5,-293 55.5,-293 55.5,-272 24.5,-272"/>
<text text-anchor="start" x="35" y="-278.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="55.5,-272 55.5,-293 89.5,-293 89.5,-272 55.5,-272"/>
<text text-anchor="start" x="67.5" y="-278.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89.5,-272 89.5,-293 228.5,-293 228.5,-272 89.5,-272"/>
<text text-anchor="start" x="149.5" y="-278.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="228.5,-272 228.5,-293 361.5,-293 361.5,-272 228.5,-272"/>
<text text-anchor="start" x="231.5" y="-278.8" font-family="Times,serif" font-size="14.00">metadata_version</text>
<polygon fill="none" stroke="black" points="24.5,-251 24.5,-272 55.5,-272 55.5,-251 24.5,-251"/>
<text text-anchor="start" x="35" y="-257.8" font-family="Times,serif" font-size="14.00">5</text>
<polygon fill="none" stroke="black" points="55.5,-251 55.5,-272 89.5,-272 89.5,-251 55.5,-251"/>
<text text-anchor="start" x="65.5" y="-257.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-251 89.5,-272 228.5,-272 228.5,-251 89.5,-251"/>
<text text-anchor="start" x="93.5" y="-257.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="228.5,-251 228.5,-272 361.5,-272 361.5,-251 228.5,-251"/>
<text text-anchor="start" x="256" y="-257.8" font-family="Times,serif" font-size="14.00">num_types</text>
<polygon fill="none" stroke="black" points="24.5,-230 24.5,-251 55.5,-251 55.5,-230 24.5,-230"/>
<text text-anchor="start" x="33" y="-236.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-230 55.5,-251 89.5,-251 89.5,-230 55.5,-230"/>
<text text-anchor="start" x="65.5" y="-236.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-230 89.5,-251 228.5,-251 228.5,-230 89.5,-230"/>
<text text-anchor="start" x="107.5" y="-236.8" font-family="Times,serif" font-size="14.00">MetadataType</text>
<polygon fill="none" stroke="black" points="228.5,-230 228.5,-251 361.5,-251 361.5,-230 228.5,-230"/>
<text text-anchor="start" x="275" y="-236.8" font-family="Times,serif" font-size="14.00">types</text>
<polygon fill="none" stroke="black" points="24.5,-209 24.5,-230 361.5,-230 361.5,-209 24.5,-209"/>
<text text-anchor="start" x="85" y="-215.8" font-family="Times,serif" font-size="14.00">repeat num_types.value times</text>
<polygon fill="none" stroke="black" points="24.5,-188 24.5,-209 55.5,-209 55.5,-188 24.5,-188"/>
<text text-anchor="start" x="33" y="-194.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-188 55.5,-209 89.5,-209 89.5,-188 55.5,-188"/>
<text text-anchor="start" x="65.5" y="-194.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-188 89.5,-209 228.5,-209 228.5,-188 89.5,-188"/>
<text text-anchor="start" x="93.5" y="-194.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="228.5,-188 228.5,-209 361.5,-209 361.5,-188 228.5,-188"/>
<text text-anchor="start" x="251.5" y="-194.8" font-family="Times,serif" font-size="14.00">num_pallets</text>
<polygon fill="none" stroke="black" points="24.5,-167 24.5,-188 55.5,-188 55.5,-167 24.5,-167"/>
<text text-anchor="start" x="33" y="-173.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-167 55.5,-188 89.5,-188 89.5,-167 55.5,-167"/>
<text text-anchor="start" x="65.5" y="-173.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-167 89.5,-188 228.5,-188 228.5,-167 89.5,-167"/>
<text text-anchor="start" x="104.5" y="-173.8" font-family="Times,serif" font-size="14.00">MetadataPallet</text>
<polygon fill="none" stroke="black" points="228.5,-167 228.5,-188 361.5,-188 361.5,-167 228.5,-167"/>
<text text-anchor="start" x="270.5" y="-173.8" font-family="Times,serif" font-size="14.00">pallets</text>
<polygon fill="none" stroke="black" points="24.5,-146 24.5,-167 361.5,-167 361.5,-146 24.5,-146"/>
<text text-anchor="start" x="80.5" y="-152.8" font-family="Times,serif" font-size="14.00">repeat num_pallets.value times</text>
<polygon fill="none" stroke="black" points="24.5,-125 24.5,-146 55.5,-146 55.5,-125 24.5,-125"/>
<text text-anchor="start" x="33" y="-131.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-125 55.5,-146 89.5,-146 89.5,-125 55.5,-125"/>
<text text-anchor="start" x="65.5" y="-131.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-125 89.5,-146 228.5,-146 228.5,-125 89.5,-125"/>
<text text-anchor="start" x="93.5" y="-131.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="228.5,-125 228.5,-146 361.5,-146 361.5,-125 228.5,-125"/>
<text text-anchor="start" x="244.5" y="-131.8" font-family="Times,serif" font-size="14.00">extrinsic_type</text>
<polygon fill="none" stroke="black" points="24.5,-104 24.5,-125 55.5,-125 55.5,-104 24.5,-104"/>
<text text-anchor="start" x="33" y="-110.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-104 55.5,-125 89.5,-125 89.5,-104 55.5,-104"/>
<text text-anchor="start" x="67.5" y="-110.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89.5,-104 89.5,-125 228.5,-125 228.5,-104 89.5,-104"/>
<text text-anchor="start" x="149.5" y="-110.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="228.5,-104 228.5,-125 361.5,-125 361.5,-104 228.5,-104"/>
<text text-anchor="start" x="234" y="-110.8" font-family="Times,serif" font-size="14.00">extrinsic_version</text>
<polygon fill="none" stroke="black" points="24.5,-83 24.5,-104 55.5,-104 55.5,-83 24.5,-83"/>
<text text-anchor="start" x="33" y="-89.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-83 55.5,-104 89.5,-104 89.5,-83 55.5,-83"/>
<text text-anchor="start" x="65.5" y="-89.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-83 89.5,-104 228.5,-104 228.5,-83 89.5,-83"/>
<text text-anchor="start" x="93.5" y="-89.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="228.5,-83 228.5,-104 361.5,-104 361.5,-83 228.5,-83"/>
<text text-anchor="start" x="240.5" y="-89.8" font-family="Times,serif" font-size="14.00">num_extrinsics</text>
<polygon fill="none" stroke="black" points="24.5,-62 24.5,-83 55.5,-83 55.5,-62 24.5,-62"/>
<text text-anchor="start" x="33" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-62 55.5,-83 89.5,-83 89.5,-62 55.5,-62"/>
<text text-anchor="start" x="65.5" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-62 89.5,-83 228.5,-83 228.5,-62 89.5,-62"/>
<text text-anchor="start" x="92.5" y="-68.8" font-family="Times,serif" font-size="14.00">MetadataExtrinsic</text>
<polygon fill="none" stroke="black" points="228.5,-62 228.5,-83 361.5,-83 361.5,-62 228.5,-62"/>
<text text-anchor="start" x="260" y="-68.8" font-family="Times,serif" font-size="14.00">extrinsics</text>
<polygon fill="none" stroke="black" points="24.5,-41 24.5,-62 361.5,-62 361.5,-41 24.5,-41"/>
<text text-anchor="start" x="69.5" y="-47.8" font-family="Times,serif" font-size="14.00">repeat num_extrinsics.value times</text>
<polygon fill="none" stroke="black" points="24.5,-20 24.5,-41 55.5,-41 55.5,-20 24.5,-20"/>
<text text-anchor="start" x="33" y="-26.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-20 55.5,-41 89.5,-41 89.5,-20 55.5,-20"/>
<text text-anchor="start" x="65.5" y="-26.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-20 89.5,-41 228.5,-41 228.5,-20 89.5,-20"/>
<text text-anchor="start" x="93.5" y="-26.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="228.5,-20 228.5,-41 361.5,-41 361.5,-20 228.5,-20"/>
<text text-anchor="start" x="247" y="-26.8" font-family="Times,serif" font-size="14.00">runtime_type</text>
</g>
<!-- metadata_type__seq -->
<g id="node2" class="node">
<title>metadata_type__seq</title>
<g id="a_node2"><a xlink:href="#metadata_type" xlink:title="MetadataType">
<text text-anchor="middle" x="479.5" y="-237.3" font-family="Times,serif" font-size="14.00">MetadataType</text>
</a>
</g>
</g>
<!-- metadata__seq&#45;&gt;metadata_type__seq -->
<g id="edge1" class="edge">
<title>metadata__seq:types_type&#45;&gt;metadata_type__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M362.5,-241C377.78,-241 394.19,-241 409.73,-241"/>
<polygon fill="black" stroke="black" stroke-width="2" points="409.79,-244.5 419.79,-241 409.79,-237.5 409.79,-244.5"/>
</g>
<!-- metadata_pallet__seq -->
<g id="node3" class="node">
<title>metadata_pallet__seq</title>
<g id="a_node3"><a xlink:href="#metadata_pallet" xlink:title="MetadataPallet">
<text text-anchor="middle" x="479.5" y="-173.3" font-family="Times,serif" font-size="14.00">MetadataPallet</text>
</a>
</g>
</g>
<!-- metadata__seq&#45;&gt;metadata_pallet__seq -->
<g id="edge2" class="edge">
<title>metadata__seq:pallets_type&#45;&gt;metadata_pallet__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M362.5,-177C376.82,-177 392.13,-177 406.78,-177"/>
<polygon fill="black" stroke="black" stroke-width="2" points="406.79,-180.5 416.79,-177 406.79,-173.5 406.79,-180.5"/>
</g>
<!-- metadata_extrinsic__seq -->
<g id="node4" class="node">
<title>metadata_extrinsic__seq</title>
<g id="a_node4"><a xlink:href="#metadata_extrinsic" xlink:title="MetadataExtrinsic">
<text text-anchor="middle" x="479.5" y="-68.3" font-family="Times,serif" font-size="14.00">MetadataExtrinsic</text>
</a>
</g>
</g>
<!-- metadata__seq&#45;&gt;metadata_extrinsic__seq -->
<g id="edge3" class="edge">
<title>metadata__seq:extrinsics_type&#45;&gt;metadata_extrinsic__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M362.5,-72C372.88,-72 383.78,-72 394.57,-72"/>
<polygon fill="black" stroke="black" stroke-width="2" points="394.86,-75.5 404.86,-72 394.86,-68.5 394.86,-75.5"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 3. Polkadot Runtime Metadata</div>
</div>
<div id="defn-rtm-registry-entry" class="exampleblock">
<div class="title">Definition 159. <a href="#defn-rtm-registry-entry">Runtime Registry Type Entry</a></div>
<div class="content">
<div class="paragraph">
<p>A registry entry contains information about a type in its portable form for
serialization. The entry is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$r_i = ("id"_t,p,T,D,c)\$
\$T = (t_0, ...,t_n)\$
\$t_i = (n, y)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$"id"_t\$ is a compact integer indicating the identifier of the type.</p>
</li>
<li>
<p>\$p\$ is the path of the type, optional and based on source file location. Encoded as a sequence (<a href="#defn-scale-list">Definition 192</a>) of strings.</p>
</li>
<li>
<p>\$T\$ is a sequence (<a href="#defn-scale-list">Definition 192</a>) of generic parameters (empty for non-generic types).</p>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is the name string of the generic type parameter</p>
</li>
<li>
<p>\$y\$ is a <em>Option</em> type containing a type Id (<a href="#defn-rtm-type-id">Definition 160</a>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>\$D\$ is the type definition (<a href="#defn-rtm-type-definition">Definition 161</a>).</p>
</li>
<li>
<p>\$c\$ is the documentation as sequence (<a href="#defn-scale-list">Definition 192</a>) of strings.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="metadata_type" class="imageblock">
<div class="content">
<svg width="754pt" height="275pt"
 viewBox="0.00 0.00 754.00 275.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 271)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-271 750,-271 750,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata_type</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-44 8,-259 738,-259 738,-44 8,-44"/>
<text text-anchor="middle" x="373" y="-243.8" font-family="Times,serif" font-size="14.00">MetadataType</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__param</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="402,-85 402,-196 730,-196 730,-85 402,-85"/>
<text text-anchor="middle" x="566" y="-180.8" font-family="Times,serif" font-size="14.00">MetadataType::Param</text>
</g>
<!-- metadata_type__seq -->
<g id="node1" class="node">
<title>metadata_type__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24,-203 24,-224 55,-224 55,-203 24,-203"/>
<polygon fill="none" stroke="black" points="24,-203 24,-224 55,-224 55,-203 24,-203"/>
<text text-anchor="start" x="27" y="-209.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55,-203 55,-224 89,-224 89,-203 55,-203"/>
<polygon fill="none" stroke="black" points="55,-203 55,-224 89,-224 89,-203 55,-203"/>
<text text-anchor="start" x="58" y="-209.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89,-203 89,-224 268,-224 268,-203 89,-203"/>
<polygon fill="none" stroke="black" points="89,-203 89,-224 268,-224 268,-203 89,-203"/>
<text text-anchor="start" x="162.5" y="-209.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="268,-203 268,-224 366,-224 366,-203 268,-203"/>
<polygon fill="none" stroke="black" points="268,-203 268,-224 366,-224 366,-203 268,-203"/>
<text text-anchor="start" x="310" y="-209.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-182 24,-203 55,-203 55,-182 24,-182"/>
<text text-anchor="start" x="34.5" y="-188.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55,-182 55,-203 89,-203 89,-182 55,-182"/>
<text text-anchor="start" x="65" y="-188.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-182 89,-203 268,-203 268,-182 89,-182"/>
<text text-anchor="start" x="113" y="-188.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="268,-182 268,-203 366,-203 366,-182 268,-182"/>
<text text-anchor="start" x="310" y="-188.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-161 24,-182 55,-182 55,-161 24,-161"/>
<text text-anchor="start" x="32.5" y="-167.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-161 55,-182 89,-182 89,-161 55,-161"/>
<text text-anchor="start" x="65" y="-167.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-161 89,-182 268,-182 268,-161 89,-161"/>
<text text-anchor="start" x="118.5" y="-167.8" font-family="Times,serif" font-size="14.00">Scale::StringList</text>
<polygon fill="none" stroke="black" points="268,-161 268,-182 366,-182 366,-161 268,-161"/>
<text text-anchor="start" x="300.5" y="-167.8" font-family="Times,serif" font-size="14.00">path</text>
<polygon fill="none" stroke="black" points="24,-140 24,-161 55,-161 55,-140 24,-140"/>
<text text-anchor="start" x="32.5" y="-146.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-140 55,-161 89,-161 89,-140 55,-140"/>
<text text-anchor="start" x="65" y="-146.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-140 89,-161 268,-161 268,-140 89,-140"/>
<text text-anchor="start" x="113" y="-146.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="268,-140 268,-161 366,-161 366,-140 268,-140"/>
<text text-anchor="start" x="271" y="-146.8" font-family="Times,serif" font-size="14.00">num_params</text>
<polygon fill="none" stroke="black" points="24,-119 24,-140 55,-140 55,-119 24,-119"/>
<text text-anchor="start" x="32.5" y="-125.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-119 55,-140 89,-140 89,-119 55,-119"/>
<text text-anchor="start" x="65" y="-125.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-119 89,-140 268,-140 268,-119 89,-119"/>
<text text-anchor="start" x="155.5" y="-125.8" font-family="Times,serif" font-size="14.00">Param</text>
<polygon fill="none" stroke="black" points="268,-119 268,-140 366,-140 366,-119 268,-119"/>
<text text-anchor="start" x="290" y="-125.8" font-family="Times,serif" font-size="14.00">params</text>
<polygon fill="none" stroke="black" points="24,-98 24,-119 366,-119 366,-98 24,-98"/>
<text text-anchor="start" x="80" y="-104.8" font-family="Times,serif" font-size="14.00">repeat num_params.value times</text>
<polygon fill="none" stroke="black" points="24,-77 24,-98 55,-98 55,-77 24,-77"/>
<text text-anchor="start" x="32.5" y="-83.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-77 55,-98 89,-98 89,-77 55,-77"/>
<text text-anchor="start" x="65" y="-83.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-77 89,-98 268,-98 268,-77 89,-77"/>
<text text-anchor="start" x="92" y="-83.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition</text>
<polygon fill="none" stroke="black" points="268,-77 268,-98 366,-98 366,-77 268,-77"/>
<text text-anchor="start" x="283" y="-83.8" font-family="Times,serif" font-size="14.00">definition</text>
<polygon fill="none" stroke="black" points="24,-56 24,-77 55,-77 55,-56 24,-56"/>
<text text-anchor="start" x="32.5" y="-62.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-56 55,-77 89,-77 89,-56 55,-56"/>
<text text-anchor="start" x="65" y="-62.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-56 89,-77 268,-77 268,-56 89,-56"/>
<text text-anchor="start" x="118.5" y="-62.8" font-family="Times,serif" font-size="14.00">Scale::StringList</text>
<polygon fill="none" stroke="black" points="268,-56 268,-77 366,-77 366,-56 268,-56"/>
<text text-anchor="start" x="300.5" y="-62.8" font-family="Times,serif" font-size="14.00">docs</text>
</g>
<!-- param__seq -->
<g id="node2" class="node">
<title>param__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="418,-139 418,-160 449,-160 449,-139 418,-139"/>
<polygon fill="none" stroke="black" points="418,-139 418,-160 449,-160 449,-139 418,-139"/>
<text text-anchor="start" x="421" y="-145.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="449,-139 449,-160 483,-160 483,-139 449,-139"/>
<polygon fill="none" stroke="black" points="449,-139 449,-160 483,-160 483,-139 449,-139"/>
<text text-anchor="start" x="452" y="-145.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="483,-139 483,-160 668,-160 668,-139 483,-139"/>
<polygon fill="none" stroke="black" points="483,-139 483,-160 668,-160 668,-139 483,-139"/>
<text text-anchor="start" x="559.5" y="-145.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="668,-139 668,-160 714,-160 714,-139 668,-139"/>
<polygon fill="none" stroke="black" points="668,-139 668,-160 714,-160 714,-139 668,-139"/>
<text text-anchor="start" x="684" y="-145.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="418,-118 418,-139 449,-139 449,-118 418,-118"/>
<text text-anchor="start" x="428.5" y="-124.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="449,-118 449,-139 483,-139 483,-118 449,-118"/>
<text text-anchor="start" x="459" y="-124.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="483,-118 483,-139 668,-139 668,-118 483,-118"/>
<text text-anchor="start" x="529" y="-124.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="668,-118 668,-139 714,-139 714,-118 668,-118"/>
<text text-anchor="start" x="671" y="-124.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="418,-97 418,-118 449,-118 449,-97 418,-97"/>
<text text-anchor="start" x="426.5" y="-103.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="449,-97 449,-118 483,-118 483,-97 449,-97"/>
<text text-anchor="start" x="459" y="-103.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="483,-97 483,-118 668,-118 668,-97 483,-97"/>
<text text-anchor="start" x="486" y="-103.8" font-family="Times,serif" font-size="14.00">Scale::MaybeCompactInt</text>
<polygon fill="none" stroke="black" points="668,-97 668,-118 714,-118 714,-97 668,-97"/>
<text text-anchor="start" x="675" y="-103.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_type__seq&#45;&gt;param__seq -->
<g id="edge1" class="edge">
<title>metadata_type__seq:params_type&#45;&gt;param__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M367,-129C377.66,-129 388.64,-129 399.71,-129"/>
<polygon fill="black" stroke="black" stroke-width="2" points="399.89,-132.5 409.89,-129 399.89,-125.5 399.89,-132.5"/>
</g>
<!-- metadata_type_definition__seq -->
<g id="node3" class="node">
<title>metadata_type_definition__seq</title>
<g id="a_node3"><a xlink:href="#metadata_type_definition" xlink:title="MetadataTypeDefinition">
<text text-anchor="middle" x="566" y="-14.3" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition</text>
</a>
</g>
</g>
<!-- metadata_type__seq&#45;&gt;metadata_type_definition__seq -->
<g id="edge2" class="edge">
<title>metadata_type__seq:definition_type&#45;&gt;metadata_type_definition__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M367,-87C396.01,-87 465.64,-60.26 514.07,-40.07"/>
<polygon fill="black" stroke="black" stroke-width="2" points="515.59,-43.23 523.45,-36.13 512.88,-36.77 515.59,-43.23"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 4. Runtime Metadata Type</div>
</div>
</div>
</div>
<div id="defn-rtm-type-id" class="exampleblock">
<div class="title">Definition 160. <a href="#defn-rtm-type-id">Runtime Type Id</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>runtime type Id</strong> is a compact integer representing the index of the entry
(<a href="#defn-rtm-registry-entry">Definition 159</a>) in \$R, P\$ or \$E\$ of the runtime metadata
structure (<a href="#sect-rtm-structure">Section 12.1</a>), depending on context (starting at \$0\$).</p>
</div>
</div>
</div>
<div id="defn-rtm-type-definition" class="exampleblock">
<div class="title">Definition 161. <a href="#defn-rtm-type-definition">Type Variant</a></div>
<div class="content">
<div class="paragraph">
<p>The type definition \$D\$ is a varying datatype (<a href="#defn-varrying-data-type">Definition 188</a>)
and indicates all the possible types of encodable values a type can have.</p>
</div>
<div class="stemblock">
<div class="content">
\$D = {
	(0,-&gt;,C,"composite type (e.g. structure or tuple)"),
	(1,-&gt;,V,"variant type"),
	(2,-&gt;,s_v,"sequence type varying length"),
	(3,-&gt;,S,"sequence with fixed length"),
	(4,-&gt;,T,"tuple type"),
	(5,-&gt;,P,"primitive type"),
	(6,-&gt;,e,"compact encoded type"),
	(7,-&gt;,B,"sequence of bits")
:}\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$C\$ is a sequence of the following format:</p>
<div class="stemblock">
<div class="content">
\$C = (f_0, ..., f_n)\$
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>\$f_i\$ is a field (<a href="#defn-rtm-field">Definition 162</a>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>\$V\$ is a sequence of the following format:</p>
<div class="stemblock">
<div class="content">
\$V = (v_0, ..., v_n)\$
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>\$v_i\$ is a variant (<a href="#defn-rtm-variant">Definition 163</a>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>\$s_v\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>).</p>
</li>
<li>
<p>\$S\$ is of the following format:</p>
<div class="stemblock">
<div class="content">
\$S = (l, y)\$
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>\$l\$ is a unsigned 32-bit integer indicating the length</p>
</li>
<li>
<p>\$y\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>\$T\$ is a sequence (<a href="#defn-scale-list">Definition 192</a>) of type Ids (<a href="#defn-rtm-type-id">Definition 160</a>).</p>
</li>
<li>
<p>\$P\$ is a varying datatype (<a href="#defn-varrying-data-type">Definition 188</a>) of the following
structure:</p>
<div class="stemblock">
<div class="content">
\$P = {
	(0,"boolean"),
	(1,"char"),
	(2,"string"),
	(3,"unsigned 8-bit integer"),
	(4,"unsigned 16-bit integer"),
	(5,"unsigned 32-bit integer"),
	(6,"unsigned 64-bit integer"),
	(7,"unsigned 128-bit integer"),
	(8,"unsigned 256-bit integer"),
	(9,"signed 8-bit integer"),
	(10,"signed 16-bit integer"),
	(11,"signed 32-bit integer"),
	(12,"signed 64-bit integer"),
	(13,"signed 128-bit integer"),
	(14,"signed 256-bit integer")
:}\$
</div>
</div>
</li>
<li>
<p>\$e\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>).</p>
</li>
<li>
<p>\$B\$ is a datastructure of the following format:</p>
<div class="stemblock">
<div class="content">
\$B = (s, o)\$
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>\$s\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>) representing the bit store
order (<a href="https://docs.rs/bitvec/latest/bitvec/store/trait.BitStore.html">external
reference</a>)</p>
</li>
<li>
<p>\$o\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>) the bit order type
(<a href="https://docs.rs/bitvec/latest/bitvec/order/trait.BitOrder.html">external
reference</a>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="metadata_type_definition" class="imageblock">
<div class="content">
<svg width="965pt" height="813pt"
 viewBox="0.00 0.00 965.00 813.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 809)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-809 961,-809 961,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata_type_definition</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-98 8,-797 949,-797 949,-98 8,-98"/>
<text text-anchor="middle" x="478.5" y="-781.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__array</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="639,-536 639,-647 925,-647 925,-536 639,-536"/>
<text text-anchor="middle" x="782" y="-631.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition::Array</text>
</g>
<g id="clust3" class="cluster">
<title>cluster__sequence</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="646,-439 646,-528 918,-528 918,-439 646,-439"/>
<text text-anchor="middle" x="782" y="-512.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition::Sequence</text>
</g>
<g id="clust4" class="cluster">
<title>cluster__primitive</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="650.5,-342 650.5,-431 914.5,-431 914.5,-342 650.5,-342"/>
<text text-anchor="middle" x="782.5" y="-415.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition::Primitive</text>
</g>
<g id="clust5" class="cluster">
<title>cluster__tuple</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="623,-106 623,-237 941,-237 941,-106 623,-106"/>
<text text-anchor="middle" x="782" y="-221.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition::Tuple</text>
</g>
<g id="clust6" class="cluster">
<title>cluster__bits</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="642,-655 642,-766 922,-766 922,-655 642,-655"/>
<text text-anchor="middle" x="782" y="-750.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition::Bits</text>
</g>
<g id="clust7" class="cluster">
<title>cluster__compact</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="646,-245 646,-334 918,-334 918,-245 646,-245"/>
<text text-anchor="middle" x="782" y="-318.8" font-family="Times,serif" font-size="14.00">MetadataTypeDefinition::Compact</text>
</g>
<!-- metadata_type_definition__seq -->
<g id="node1" class="node">
<title>metadata_type_definition__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24,-391 24,-412 55,-412 55,-391 24,-391"/>
<polygon fill="none" stroke="black" points="24,-391 24,-412 55,-412 55,-391 24,-391"/>
<text text-anchor="start" x="27" y="-397.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55,-391 55,-412 89,-412 89,-391 55,-391"/>
<polygon fill="none" stroke="black" points="55,-391 55,-412 89,-412 89,-391 55,-391"/>
<text text-anchor="start" x="58" y="-397.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89,-391 89,-412 189,-412 189,-391 89,-391"/>
<polygon fill="none" stroke="black" points="89,-391 89,-412 189,-412 189,-391 89,-391"/>
<text text-anchor="start" x="123" y="-397.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="189,-391 189,-412 244,-412 244,-391 189,-391"/>
<polygon fill="none" stroke="black" points="189,-391 189,-412 244,-412 244,-391 189,-391"/>
<text text-anchor="start" x="209.5" y="-397.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-370 24,-391 55,-391 55,-370 24,-370"/>
<text text-anchor="start" x="34.5" y="-376.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55,-370 55,-391 89,-391 89,-370 55,-370"/>
<text text-anchor="start" x="67" y="-376.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-370 89,-391 189,-391 189,-370 89,-370"/>
<text text-anchor="start" x="106.5" y="-376.8" font-family="Times,serif" font-size="14.00">u1→Type</text>
<polygon fill="none" stroke="black" points="189,-370 189,-391 244,-391 244,-370 189,-370"/>
<text text-anchor="start" x="200.5" y="-376.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="24,-349 24,-370 55,-370 55,-349 24,-349"/>
<text text-anchor="start" x="34.5" y="-355.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="55,-349 55,-370 89,-370 89,-349 55,-349"/>
<text text-anchor="start" x="65" y="-355.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-349 89,-370 189,-370 189,-349 89,-349"/>
<text text-anchor="start" x="92" y="-355.8" font-family="Times,serif" font-size="14.00">switch (type)</text>
<polygon fill="none" stroke="black" points="189,-349 189,-370 244,-370 244,-349 189,-349"/>
<text text-anchor="start" x="192" y="-355.8" font-family="Times,serif" font-size="14.00">details</text>
</g>
<!-- metadata_type_definition__seq&#45;&gt;metadata_type_definition__seq -->
<g id="edge10" class="edge">
<title>metadata_type_definition__seq:type_type&#45;&gt;metadata_type_definition__seq:details_type</title>
<path fill="none" stroke="#404040" d="M188.94,-388.62C142.06,-407.54 151.41,-434.5 217,-434.5 278.66,-434.5 290.62,-397.04 252.89,-373.17"/>
<polygon fill="#404040" stroke="#404040" points="254.53,-370.08 244.09,-368.3 251.14,-376.2 254.53,-370.08"/>
</g>
<!-- metadata_type_definition__seq_details_switch -->
<g id="node2" class="node">
<title>metadata_type_definition__seq_details_switch</title>
<polygon fill="#f0f2e4" stroke="transparent" points="296.5,-432 296.5,-453 418.5,-453 418.5,-432 296.5,-432"/>
<polygon fill="none" stroke="black" points="296.5,-432 296.5,-453 418.5,-453 418.5,-432 296.5,-432"/>
<text text-anchor="start" x="341.5" y="-438.8" font-family="Times,serif" font-size="14.00">case</text>
<polygon fill="#f0f2e4" stroke="transparent" points="418.5,-432 418.5,-453 587.5,-453 587.5,-432 418.5,-432"/>
<polygon fill="none" stroke="black" points="418.5,-432 418.5,-453 587.5,-453 587.5,-432 418.5,-432"/>
<text text-anchor="start" x="487" y="-438.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="296.5,-411 296.5,-432 418.5,-432 418.5,-411 296.5,-411"/>
<text text-anchor="start" x="299.5" y="-417.8" font-family="Times,serif" font-size="14.00">:type_composite</text>
<polygon fill="none" stroke="black" points="418.5,-411 418.5,-432 587.5,-432 587.5,-411 418.5,-411"/>
<text text-anchor="start" x="429.5" y="-417.8" font-family="Times,serif" font-size="14.00">MetadataTypeFields</text>
<polygon fill="none" stroke="black" points="296.5,-390 296.5,-411 418.5,-411 418.5,-390 296.5,-390"/>
<text text-anchor="start" x="322.5" y="-396.8" font-family="Times,serif" font-size="14.00">:type_bits</text>
<polygon fill="none" stroke="black" points="418.5,-390 418.5,-411 587.5,-411 587.5,-390 418.5,-390"/>
<text text-anchor="start" x="488.5" y="-396.8" font-family="Times,serif" font-size="14.00">Bits</text>
<polygon fill="none" stroke="black" points="296.5,-369 296.5,-390 418.5,-390 418.5,-369 296.5,-369"/>
<text text-anchor="start" x="316.5" y="-375.8" font-family="Times,serif" font-size="14.00">:type_array</text>
<polygon fill="none" stroke="black" points="418.5,-369 418.5,-390 587.5,-390 587.5,-369 418.5,-369"/>
<text text-anchor="start" x="483" y="-375.8" font-family="Times,serif" font-size="14.00">Array</text>
<polygon fill="none" stroke="black" points="296.5,-348 296.5,-369 418.5,-369 418.5,-348 296.5,-348"/>
<text text-anchor="start" x="302.5" y="-354.8" font-family="Times,serif" font-size="14.00">:type_sequence</text>
<polygon fill="none" stroke="black" points="418.5,-348 418.5,-369 587.5,-369 587.5,-348 418.5,-348"/>
<text text-anchor="start" x="468" y="-354.8" font-family="Times,serif" font-size="14.00">Sequence</text>
<polygon fill="none" stroke="black" points="296.5,-327 296.5,-348 418.5,-348 418.5,-327 296.5,-327"/>
<text text-anchor="start" x="303" y="-333.8" font-family="Times,serif" font-size="14.00">:type_primitive</text>
<polygon fill="none" stroke="black" points="418.5,-327 418.5,-348 587.5,-348 587.5,-327 418.5,-327"/>
<text text-anchor="start" x="469.5" y="-333.8" font-family="Times,serif" font-size="14.00">Primitive</text>
<polygon fill="none" stroke="black" points="296.5,-306 296.5,-327 418.5,-327 418.5,-306 296.5,-306"/>
<text text-anchor="start" x="306" y="-312.8" font-family="Times,serif" font-size="14.00">:type_compact</text>
<polygon fill="none" stroke="black" points="418.5,-306 418.5,-327 587.5,-327 587.5,-306 418.5,-306"/>
<text text-anchor="start" x="471" y="-312.8" font-family="Times,serif" font-size="14.00">Compact</text>
<polygon fill="none" stroke="black" points="296.5,-285 296.5,-306 418.5,-306 418.5,-285 296.5,-285"/>
<text text-anchor="start" x="310.5" y="-291.8" font-family="Times,serif" font-size="14.00">:type_variant</text>
<polygon fill="none" stroke="black" points="418.5,-285 418.5,-306 587.5,-306 587.5,-285 418.5,-285"/>
<text text-anchor="start" x="421.5" y="-291.8" font-family="Times,serif" font-size="14.00">MetadataTypeVariants</text>
<polygon fill="none" stroke="black" points="296.5,-264 296.5,-285 418.5,-285 418.5,-264 296.5,-264"/>
<text text-anchor="start" x="317.5" y="-270.8" font-family="Times,serif" font-size="14.00">:type_tuple</text>
<polygon fill="none" stroke="black" points="418.5,-264 418.5,-285 587.5,-285 587.5,-264 418.5,-264"/>
<text text-anchor="start" x="483" y="-270.8" font-family="Times,serif" font-size="14.00">Tuple</text>
</g>
<!-- metadata_type_definition__seq&#45;&gt;metadata_type_definition__seq_details_switch -->
<g id="edge1" class="edge">
<title>metadata_type_definition__seq:details_type&#45;&gt;metadata_type_definition__seq_details_switch</title>
<path fill="none" stroke="black" stroke-width="2" d="M245,-359C255.65,-359 266.64,-359 277.7,-359"/>
<polygon fill="black" stroke="black" stroke-width="2" points="277.88,-362.5 287.88,-359 277.88,-355.5 277.88,-362.5"/>
</g>
<!-- array__seq -->
<g id="node3" class="node">
<title>array__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="655,-590 655,-611 686,-611 686,-590 655,-590"/>
<polygon fill="none" stroke="black" points="655,-590 655,-611 686,-611 686,-590 655,-590"/>
<text text-anchor="start" x="658" y="-596.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="686,-590 686,-611 720,-611 720,-590 686,-590"/>
<polygon fill="none" stroke="black" points="686,-590 686,-611 720,-611 720,-590 686,-590"/>
<text text-anchor="start" x="689" y="-596.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="720,-590 720,-611 857,-611 857,-590 720,-590"/>
<polygon fill="none" stroke="black" points="720,-590 720,-611 857,-611 857,-590 720,-590"/>
<text text-anchor="start" x="772.5" y="-596.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="857,-590 857,-611 909,-611 909,-590 857,-590"/>
<polygon fill="none" stroke="black" points="857,-590 857,-611 909,-611 909,-590 857,-590"/>
<text text-anchor="start" x="876" y="-596.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="655,-569 655,-590 686,-590 686,-569 655,-569"/>
<text text-anchor="start" x="665.5" y="-575.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="686,-569 686,-590 720,-590 720,-569 686,-569"/>
<text text-anchor="start" x="698" y="-575.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="720,-569 720,-590 857,-590 857,-569 720,-569"/>
<text text-anchor="start" x="773" y="-575.8" font-family="Times,serif" font-size="14.00">u4le</text>
<polygon fill="none" stroke="black" points="857,-569 857,-590 909,-590 909,-569 857,-569"/>
<text text-anchor="start" x="860" y="-575.8" font-family="Times,serif" font-size="14.00">length</text>
<polygon fill="none" stroke="black" points="655,-548 655,-569 686,-569 686,-548 655,-548"/>
<text text-anchor="start" x="665.5" y="-554.8" font-family="Times,serif" font-size="14.00">4</text>
<polygon fill="none" stroke="black" points="686,-548 686,-569 720,-569 720,-548 686,-548"/>
<text text-anchor="start" x="696" y="-554.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="720,-548 720,-569 857,-569 857,-548 720,-548"/>
<text text-anchor="start" x="723" y="-554.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="857,-548 857,-569 909,-569 909,-548 857,-548"/>
<text text-anchor="start" x="867" y="-554.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;array__seq -->
<g id="edge4" class="edge">
<title>metadata_type_definition__seq_details_switch:case2&#45;&gt;array__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-380C657.77,-380 575.8,-481.29 623,-532 627.66,-537.01 632.82,-541.49 638.35,-545.52"/>
<polygon fill="black" stroke="black" stroke-width="2" points="636.44,-548.46 646.7,-551.09 640.33,-542.63 636.44,-548.46"/>
</g>
<!-- sequence__seq -->
<g id="node4" class="node">
<title>sequence__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="662,-472 662,-493 693,-493 693,-472 662,-472"/>
<polygon fill="none" stroke="black" points="662,-472 662,-493 693,-493 693,-472 662,-472"/>
<text text-anchor="start" x="665" y="-478.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="693,-472 693,-493 727,-493 727,-472 693,-472"/>
<polygon fill="none" stroke="black" points="693,-472 693,-493 727,-493 727,-472 693,-472"/>
<text text-anchor="start" x="696" y="-478.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="727,-472 727,-493 864,-493 864,-472 727,-472"/>
<polygon fill="none" stroke="black" points="727,-472 727,-493 864,-493 864,-472 727,-472"/>
<text text-anchor="start" x="779.5" y="-478.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="864,-472 864,-493 902,-493 902,-472 864,-472"/>
<polygon fill="none" stroke="black" points="864,-472 864,-493 902,-493 902,-472 864,-472"/>
<text text-anchor="start" x="876" y="-478.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="662,-451 662,-472 693,-472 693,-451 662,-451"/>
<text text-anchor="start" x="672.5" y="-457.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="693,-451 693,-472 727,-472 727,-451 693,-451"/>
<text text-anchor="start" x="703" y="-457.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="727,-451 727,-472 864,-472 864,-451 727,-451"/>
<text text-anchor="start" x="730" y="-457.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="864,-451 864,-472 902,-472 902,-451 864,-451"/>
<text text-anchor="start" x="867" y="-457.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;sequence__seq -->
<g id="edge5" class="edge">
<title>metadata_type_definition__seq_details_switch:case3&#45;&gt;sequence__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-358C626,-358 594.07,-411.14 623,-435 629.64,-440.48 636.94,-445.17 644.66,-449.2"/>
<polygon fill="black" stroke="black" stroke-width="2" points="643.36,-452.46 653.89,-453.62 646.38,-446.14 643.36,-452.46"/>
</g>
<!-- primitive__seq -->
<g id="node5" class="node">
<title>primitive__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="710,-375 710,-396 741,-396 741,-375 710,-375"/>
<polygon fill="none" stroke="black" points="710,-375 710,-396 741,-396 741,-375 710,-375"/>
<text text-anchor="start" x="713" y="-381.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="741,-375 741,-396 775,-396 775,-375 741,-375"/>
<polygon fill="none" stroke="black" points="741,-375 741,-396 775,-396 775,-375 741,-375"/>
<text text-anchor="start" x="744" y="-381.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="775,-375 775,-396 835,-396 835,-375 775,-375"/>
<polygon fill="none" stroke="black" points="775,-375 775,-396 835,-396 835,-375 775,-375"/>
<text text-anchor="start" x="789" y="-381.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="835,-375 835,-396 855,-396 855,-375 835,-375"/>
<polygon fill="none" stroke="black" points="835,-375 835,-396 855,-396 855,-375 835,-375"/>
<text text-anchor="start" x="838" y="-381.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="710,-354 710,-375 741,-375 741,-354 710,-354"/>
<text text-anchor="start" x="720.5" y="-360.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="741,-354 741,-375 775,-375 775,-354 741,-354"/>
<text text-anchor="start" x="753" y="-360.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="775,-354 775,-375 835,-375 835,-354 775,-354"/>
<text text-anchor="start" x="778" y="-360.8" font-family="Times,serif" font-size="14.00">u1→Pid</text>
<polygon fill="none" stroke="black" points="835,-354 835,-375 855,-375 855,-354 835,-354"/>
<text text-anchor="start" x="838" y="-360.8" font-family="Times,serif" font-size="14.00">id</text>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;primitive__seq -->
<g id="edge6" class="edge">
<title>metadata_type_definition__seq_details_switch:case4&#45;&gt;primitive__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-337C622.46,-337 659.16,-342.76 691.32,-349.8"/>
<polygon fill="black" stroke="black" stroke-width="2" points="690.62,-353.23 701.14,-352.02 692.16,-346.4 690.62,-353.23"/>
</g>
<!-- tuple__seq -->
<g id="node6" class="node">
<title>tuple__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="639,-181 639,-202 670,-202 670,-181 639,-181"/>
<polygon fill="none" stroke="black" points="639,-181 639,-202 670,-202 670,-181 639,-181"/>
<text text-anchor="start" x="642" y="-187.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="670,-181 670,-202 704,-202 704,-181 670,-181"/>
<polygon fill="none" stroke="black" points="670,-181 670,-202 704,-202 704,-181 670,-181"/>
<text text-anchor="start" x="673" y="-187.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="704,-181 704,-202 841,-202 841,-181 704,-181"/>
<polygon fill="none" stroke="black" points="704,-181 704,-202 841,-202 841,-181 704,-181"/>
<text text-anchor="start" x="756.5" y="-187.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="841,-181 841,-202 925,-202 925,-181 841,-181"/>
<polygon fill="none" stroke="black" points="841,-181 841,-202 925,-202 925,-181 841,-181"/>
<text text-anchor="start" x="876" y="-187.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="639,-160 639,-181 670,-181 670,-160 639,-160"/>
<text text-anchor="start" x="649.5" y="-166.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="670,-160 670,-181 704,-181 704,-160 670,-160"/>
<text text-anchor="start" x="680" y="-166.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="704,-160 704,-181 841,-181 841,-160 704,-160"/>
<text text-anchor="start" x="707" y="-166.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="841,-160 841,-181 925,-181 925,-160 841,-160"/>
<text text-anchor="start" x="844" y="-166.8" font-family="Times,serif" font-size="14.00">num_types</text>
<polygon fill="none" stroke="black" points="639,-139 639,-160 670,-160 670,-139 639,-139"/>
<text text-anchor="start" x="647.5" y="-145.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="670,-139 670,-160 704,-160 704,-139 670,-139"/>
<text text-anchor="start" x="680" y="-145.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="704,-139 704,-160 841,-160 841,-139 704,-139"/>
<text text-anchor="start" x="707" y="-145.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="841,-139 841,-160 925,-160 925,-139 841,-139"/>
<text text-anchor="start" x="863" y="-145.8" font-family="Times,serif" font-size="14.00">types</text>
<polygon fill="none" stroke="black" points="639,-118 639,-139 925,-139 925,-118 639,-118"/>
<text text-anchor="start" x="674" y="-124.8" font-family="Times,serif" font-size="14.00">repeat num_types.value times</text>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;tuple__seq -->
<g id="edge9" class="edge">
<title>metadata_type_definition__seq_details_switch:case7&#45;&gt;tuple__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-274C609.72,-274 605.71,-253.3 623,-241 637.94,-230.37 654.47,-220.31 671.04,-211.12"/>
<polygon fill="black" stroke="black" stroke-width="2" points="673.13,-213.96 680.24,-206.11 669.78,-207.82 673.13,-213.96"/>
</g>
<!-- bits__seq -->
<g id="node7" class="node">
<title>bits__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="658,-709 658,-730 689,-730 689,-709 658,-709"/>
<polygon fill="none" stroke="black" points="658,-709 658,-730 689,-730 689,-709 658,-709"/>
<text text-anchor="start" x="661" y="-715.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="689,-709 689,-730 723,-730 723,-709 689,-709"/>
<polygon fill="none" stroke="black" points="689,-709 689,-730 723,-730 723,-709 689,-709"/>
<text text-anchor="start" x="692" y="-715.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="723,-709 723,-730 860,-730 860,-709 723,-709"/>
<polygon fill="none" stroke="black" points="723,-709 723,-730 860,-730 860,-709 723,-709"/>
<text text-anchor="start" x="775.5" y="-715.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="860,-709 860,-730 906,-730 906,-709 860,-709"/>
<polygon fill="none" stroke="black" points="860,-709 860,-730 906,-730 906,-709 860,-709"/>
<text text-anchor="start" x="876" y="-715.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="658,-688 658,-709 689,-709 689,-688 658,-688"/>
<text text-anchor="start" x="668.5" y="-694.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="689,-688 689,-709 723,-709 723,-688 689,-688"/>
<text text-anchor="start" x="699" y="-694.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="723,-688 723,-709 860,-709 860,-688 723,-688"/>
<text text-anchor="start" x="726" y="-694.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="860,-688 860,-709 906,-709 906,-688 860,-688"/>
<text text-anchor="start" x="867" y="-694.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="658,-667 658,-688 689,-688 689,-667 658,-667"/>
<text text-anchor="start" x="666.5" y="-673.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="689,-667 689,-688 723,-688 723,-667 689,-667"/>
<text text-anchor="start" x="699" y="-673.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="723,-667 723,-688 860,-688 860,-667 723,-667"/>
<text text-anchor="start" x="726" y="-673.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="860,-667 860,-688 906,-688 906,-667 860,-667"/>
<text text-anchor="start" x="863" y="-673.8" font-family="Times,serif" font-size="14.00">order</text>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;bits__seq -->
<g id="edge3" class="edge">
<title>metadata_type_definition__seq_details_switch:case1&#45;&gt;bits__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-401C644.58,-401 586.59,-608.34 623,-651 628.3,-657.21 634.38,-662.63 640.99,-667.36"/>
<polygon fill="black" stroke="black" stroke-width="2" points="639.35,-670.47 649.64,-673 643.17,-664.61 639.35,-670.47"/>
</g>
<!-- compact__seq -->
<g id="node8" class="node">
<title>compact__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="662,-278 662,-299 693,-299 693,-278 662,-278"/>
<polygon fill="none" stroke="black" points="662,-278 662,-299 693,-299 693,-278 662,-278"/>
<text text-anchor="start" x="665" y="-284.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="693,-278 693,-299 727,-299 727,-278 693,-278"/>
<polygon fill="none" stroke="black" points="693,-278 693,-299 727,-299 727,-278 693,-278"/>
<text text-anchor="start" x="696" y="-284.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="727,-278 727,-299 864,-299 864,-278 727,-278"/>
<polygon fill="none" stroke="black" points="727,-278 727,-299 864,-299 864,-278 727,-278"/>
<text text-anchor="start" x="779.5" y="-284.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="864,-278 864,-299 902,-299 902,-278 864,-278"/>
<polygon fill="none" stroke="black" points="864,-278 864,-299 902,-299 902,-278 864,-278"/>
<text text-anchor="start" x="876" y="-284.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="662,-257 662,-278 693,-278 693,-257 662,-257"/>
<text text-anchor="start" x="672.5" y="-263.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="693,-257 693,-278 727,-278 727,-257 693,-257"/>
<text text-anchor="start" x="703" y="-263.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="727,-257 727,-278 864,-278 864,-257 727,-257"/>
<text text-anchor="start" x="730" y="-263.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="864,-257 864,-278 902,-278 902,-257 864,-257"/>
<text text-anchor="start" x="867" y="-263.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;compact__seq -->
<g id="edge7" class="edge">
<title>metadata_type_definition__seq_details_switch:case5&#45;&gt;compact__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-316C619.26,-316 652.27,-311.27 682.11,-305.15"/>
<polygon fill="black" stroke="black" stroke-width="2" points="683.05,-308.53 692.1,-303.03 681.59,-301.68 683.05,-308.53"/>
</g>
<!-- metadata_type_fields__seq -->
<g id="node9" class="node">
<title>metadata_type_fields__seq</title>
<g id="a_node9"><a xlink:href="#metadata_type_fields" xlink:title="MetadataTypeFields">
<text text-anchor="middle" x="782" y="-68.3" font-family="Times,serif" font-size="14.00">MetadataTypeFields</text>
</a>
</g>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;metadata_type_fields__seq -->
<g id="edge2" class="edge">
<title>metadata_type_definition__seq_details_switch:case0&#45;&gt;metadata_type_fields__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-422C660.02,-422 574.49,-154.56 623,-102 640.3,-83.25 665.38,-74.06 690.48,-70"/>
<polygon fill="black" stroke="black" stroke-width="2" points="691.02,-73.46 700.46,-68.65 690.08,-66.53 691.02,-73.46"/>
</g>
<!-- metadata_type_variants__seq -->
<g id="node10" class="node">
<title>metadata_type_variants__seq</title>
<g id="a_node10"><a xlink:href="#metadata_type_variants" xlink:title="MetadataTypeVariants">
<text text-anchor="middle" x="782" y="-14.3" font-family="Times,serif" font-size="14.00">MetadataTypeVariants</text>
</a>
</g>
</g>
<!-- metadata_type_definition__seq_details_switch&#45;&gt;metadata_type_variants__seq -->
<g id="edge8" class="edge">
<title>metadata_type_definition__seq_details_switch:case6&#45;&gt;metadata_type_variants__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M588.5,-295C644.58,-295 583.99,-85.29 623,-45 638.61,-28.88 660.07,-20.23 682.14,-15.96"/>
<polygon fill="black" stroke="black" stroke-width="2" points="683,-19.36 692.3,-14.29 681.87,-12.45 683,-19.36"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 5. Runtime Metadata Type Definition</div>
</div>
</div>
</div>
<div id="defn-rtm-field" class="exampleblock">
<div class="title">Definition 162. <a href="#defn-rtm-field">Field</a></div>
<div class="content">
<div class="paragraph">
<p>A field of a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$f_i = (n, y, y_n, C)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is an <em>Option</em> type containing the string that indicates the field name.</p>
</li>
<li>
<p>\$y\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>).</p>
</li>
<li>
<p>\$y_n\$ is an <em>Option</em> type containing a string that indicates the name of the
type as it appears in the source code.</p>
</li>
<li>
<p>\$C\$ is a sequence of varying length containing strings of documentation.</p>
</li>
</ul>
</div>
<div id="metadata_type_fields" class="imageblock">
<div class="content">
<svg width="690pt" height="216pt"
 viewBox="0.00 0.00 690.00 216.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 212)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-212 686,-212 686,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata_type_fields</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-200 674,-200 674,-8 8,-8"/>
<text text-anchor="middle" x="341" y="-184.8" font-family="Times,serif" font-size="14.00">MetadataTypeFields</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__field</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="345,-16 345,-169 666,-169 666,-16 345,-16"/>
<text text-anchor="middle" x="505.5" y="-153.8" font-family="Times,serif" font-size="14.00">MetadataTypeFields::Field</text>
</g>
<!-- metadata_type_fields__seq -->
<g id="node1" class="node">
<title>metadata_type_fields__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-113 24.5,-134 55.5,-134 55.5,-113 24.5,-113"/>
<polygon fill="none" stroke="black" points="24.5,-113 24.5,-134 55.5,-134 55.5,-113 24.5,-113"/>
<text text-anchor="start" x="27.5" y="-119.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-113 55.5,-134 89.5,-134 89.5,-113 55.5,-113"/>
<polygon fill="none" stroke="black" points="55.5,-113 55.5,-134 89.5,-134 89.5,-113 55.5,-113"/>
<text text-anchor="start" x="58.5" y="-119.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-113 89.5,-134 226.5,-134 226.5,-113 89.5,-113"/>
<polygon fill="none" stroke="black" points="89.5,-113 89.5,-134 226.5,-134 226.5,-113 89.5,-113"/>
<text text-anchor="start" x="142" y="-119.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226.5,-113 226.5,-134 309.5,-134 309.5,-113 226.5,-113"/>
<polygon fill="none" stroke="black" points="226.5,-113 226.5,-134 309.5,-134 309.5,-113 226.5,-113"/>
<text text-anchor="start" x="261" y="-119.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-92 24.5,-113 55.5,-113 55.5,-92 24.5,-92"/>
<text text-anchor="start" x="35" y="-98.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-92 55.5,-113 89.5,-113 89.5,-92 55.5,-92"/>
<text text-anchor="start" x="65.5" y="-98.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-92 89.5,-113 226.5,-113 226.5,-92 89.5,-92"/>
<text text-anchor="start" x="92.5" y="-98.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226.5,-92 226.5,-113 309.5,-113 309.5,-92 226.5,-92"/>
<text text-anchor="start" x="229.5" y="-98.8" font-family="Times,serif" font-size="14.00">num_fields</text>
<polygon fill="none" stroke="black" points="24.5,-71 24.5,-92 55.5,-92 55.5,-71 24.5,-71"/>
<text text-anchor="start" x="33" y="-77.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-71 55.5,-92 89.5,-92 89.5,-71 55.5,-71"/>
<text text-anchor="start" x="65.5" y="-77.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-71 89.5,-92 226.5,-92 226.5,-71 89.5,-71"/>
<text text-anchor="start" x="139.5" y="-77.8" font-family="Times,serif" font-size="14.00">Field</text>
<polygon fill="none" stroke="black" points="226.5,-71 226.5,-92 309.5,-92 309.5,-71 226.5,-71"/>
<text text-anchor="start" x="248.5" y="-77.8" font-family="Times,serif" font-size="14.00">fields</text>
<polygon fill="none" stroke="black" points="24.5,-50 24.5,-71 309.5,-71 309.5,-50 24.5,-50"/>
<text text-anchor="start" x="59.5" y="-56.8" font-family="Times,serif" font-size="14.00">repeat num_fields.value times</text>
</g>
<!-- field__seq -->
<g id="node2" class="node">
<title>field__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="361.5,-112 361.5,-133 392.5,-133 392.5,-112 361.5,-112"/>
<polygon fill="none" stroke="black" points="361.5,-112 361.5,-133 392.5,-133 392.5,-112 361.5,-112"/>
<text text-anchor="start" x="364.5" y="-118.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="392.5,-112 392.5,-133 426.5,-133 426.5,-112 392.5,-112"/>
<polygon fill="none" stroke="black" points="392.5,-112 392.5,-133 426.5,-133 426.5,-112 392.5,-112"/>
<text text-anchor="start" x="395.5" y="-118.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="426.5,-112 426.5,-133 573.5,-133 573.5,-112 426.5,-112"/>
<polygon fill="none" stroke="black" points="426.5,-112 426.5,-133 573.5,-133 573.5,-112 426.5,-112"/>
<text text-anchor="start" x="484" y="-118.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="573.5,-112 573.5,-133 650.5,-133 650.5,-112 573.5,-112"/>
<polygon fill="none" stroke="black" points="573.5,-112 573.5,-133 650.5,-133 650.5,-112 573.5,-112"/>
<text text-anchor="start" x="605" y="-118.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="361.5,-91 361.5,-112 392.5,-112 392.5,-91 361.5,-91"/>
<text text-anchor="start" x="372" y="-97.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="392.5,-91 392.5,-112 426.5,-112 426.5,-91 392.5,-91"/>
<text text-anchor="start" x="402.5" y="-97.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="426.5,-91 426.5,-112 573.5,-112 573.5,-91 426.5,-91"/>
<text text-anchor="start" x="429.5" y="-97.8" font-family="Times,serif" font-size="14.00">Scale::MaybeString</text>
<polygon fill="none" stroke="black" points="573.5,-91 573.5,-112 650.5,-112 650.5,-91 573.5,-91"/>
<text text-anchor="start" x="592" y="-97.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="361.5,-70 361.5,-91 392.5,-91 392.5,-70 361.5,-70"/>
<text text-anchor="start" x="370" y="-76.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="392.5,-70 392.5,-91 426.5,-91 426.5,-70 392.5,-70"/>
<text text-anchor="start" x="402.5" y="-76.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="426.5,-70 426.5,-91 573.5,-91 573.5,-70 426.5,-70"/>
<text text-anchor="start" x="434.5" y="-76.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="573.5,-70 573.5,-91 650.5,-91 650.5,-70 573.5,-70"/>
<text text-anchor="start" x="596" y="-76.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="361.5,-49 361.5,-70 392.5,-70 392.5,-49 361.5,-49"/>
<text text-anchor="start" x="370" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="392.5,-49 392.5,-70 426.5,-70 426.5,-49 392.5,-49"/>
<text text-anchor="start" x="402.5" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="426.5,-49 426.5,-70 573.5,-70 573.5,-49 426.5,-49"/>
<text text-anchor="start" x="429.5" y="-55.8" font-family="Times,serif" font-size="14.00">Scale::MaybeString</text>
<polygon fill="none" stroke="black" points="573.5,-49 573.5,-70 650.5,-70 650.5,-49 573.5,-49"/>
<text text-anchor="start" x="576.5" y="-55.8" font-family="Times,serif" font-size="14.00">typename</text>
<polygon fill="none" stroke="black" points="361.5,-28 361.5,-49 392.5,-49 392.5,-28 361.5,-28"/>
<text text-anchor="start" x="370" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="392.5,-28 392.5,-49 426.5,-49 426.5,-28 392.5,-28"/>
<text text-anchor="start" x="402.5" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="426.5,-28 426.5,-49 573.5,-49 573.5,-28 426.5,-28"/>
<text text-anchor="start" x="440" y="-34.8" font-family="Times,serif" font-size="14.00">Scale::StringList</text>
<polygon fill="none" stroke="black" points="573.5,-28 573.5,-49 650.5,-49 650.5,-28 573.5,-28"/>
<text text-anchor="start" x="595.5" y="-34.8" font-family="Times,serif" font-size="14.00">docs</text>
</g>
<!-- metadata_type_fields__seq&#45;&gt;field__seq -->
<g id="edge1" class="edge">
<title>metadata_type_fields__seq:fields_type&#45;&gt;field__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M310.5,-81C321.01,-81 331.84,-81 342.75,-81"/>
<polygon fill="black" stroke="black" stroke-width="2" points="342.79,-84.5 352.79,-81 342.79,-77.5 342.79,-84.5"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 6. Runtime Metadata Fields Type</div>
</div>
</div>
</div>
<div id="defn-rtm-variant" class="exampleblock">
<div class="title">Definition 163. <a href="#defn-rtm-variant">Variant</a></div>
<div class="content">
<div class="paragraph">
<p>A struct variant of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$v_i = (n,F,k,C)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is a string representing the name of the variant.</p>
</li>
<li>
<p>\$F\$ is a possible empty array of varying length containing field
(<a href="#defn-rtm-field">Definition 162</a>) elements.</p>
</li>
<li>
<p>\$k\$ is an unsigned 8-bit integer indicating the index of the variant.</p>
</li>
<li>
<p>\$C\$ is a sequence of strings containing the documentation.</p>
</li>
</ul>
</div>
<div id="metadata_type_variants" class="imageblock">
<div class="content">
<svg width="893pt" height="216pt"
 viewBox="0.00 0.00 893.00 216.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 212)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-212 889,-212 889,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata_type_variants</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-200 702,-200 702,-8 8,-8"/>
<text text-anchor="middle" x="355" y="-184.8" font-family="Times,serif" font-size="14.00">MetadataTypeVariants</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__variant</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="365,-16 365,-169 694,-169 694,-16 365,-16"/>
<text text-anchor="middle" x="529.5" y="-153.8" font-family="Times,serif" font-size="14.00">MetadataTypeVariants::Variant</text>
</g>
<!-- metadata_type_variants__seq -->
<g id="node1" class="node">
<title>metadata_type_variants__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-113 24.5,-134 55.5,-134 55.5,-113 24.5,-113"/>
<polygon fill="none" stroke="black" points="24.5,-113 24.5,-134 55.5,-134 55.5,-113 24.5,-113"/>
<text text-anchor="start" x="27.5" y="-119.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-113 55.5,-134 89.5,-134 89.5,-113 55.5,-113"/>
<polygon fill="none" stroke="black" points="55.5,-113 55.5,-134 89.5,-134 89.5,-113 55.5,-113"/>
<text text-anchor="start" x="58.5" y="-119.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-113 89.5,-134 226.5,-134 226.5,-113 89.5,-113"/>
<polygon fill="none" stroke="black" points="89.5,-113 89.5,-134 226.5,-134 226.5,-113 89.5,-113"/>
<text text-anchor="start" x="142" y="-119.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226.5,-113 226.5,-134 329.5,-134 329.5,-113 226.5,-113"/>
<polygon fill="none" stroke="black" points="226.5,-113 226.5,-134 329.5,-134 329.5,-113 226.5,-113"/>
<text text-anchor="start" x="271" y="-119.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-92 24.5,-113 55.5,-113 55.5,-92 24.5,-92"/>
<text text-anchor="start" x="35" y="-98.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-92 55.5,-113 89.5,-113 89.5,-92 55.5,-92"/>
<text text-anchor="start" x="65.5" y="-98.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-92 89.5,-113 226.5,-113 226.5,-92 89.5,-92"/>
<text text-anchor="start" x="92.5" y="-98.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226.5,-92 226.5,-113 329.5,-113 329.5,-92 226.5,-92"/>
<text text-anchor="start" x="229.5" y="-98.8" font-family="Times,serif" font-size="14.00">num_variants</text>
<polygon fill="none" stroke="black" points="24.5,-71 24.5,-92 55.5,-92 55.5,-71 24.5,-71"/>
<text text-anchor="start" x="33" y="-77.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-71 55.5,-92 89.5,-92 89.5,-71 55.5,-71"/>
<text text-anchor="start" x="65.5" y="-77.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-71 89.5,-92 226.5,-92 226.5,-71 89.5,-71"/>
<text text-anchor="start" x="132" y="-77.8" font-family="Times,serif" font-size="14.00">Variant</text>
<polygon fill="none" stroke="black" points="226.5,-71 226.5,-92 329.5,-92 329.5,-71 226.5,-71"/>
<text text-anchor="start" x="248.5" y="-77.8" font-family="Times,serif" font-size="14.00">variants</text>
<polygon fill="none" stroke="black" points="24.5,-50 24.5,-71 329.5,-71 329.5,-50 24.5,-50"/>
<text text-anchor="start" x="59.5" y="-56.8" font-family="Times,serif" font-size="14.00">repeat num_variants.value times</text>
</g>
<!-- variant__seq -->
<g id="node2" class="node">
<title>variant__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="381.5,-112 381.5,-133 412.5,-133 412.5,-112 381.5,-112"/>
<polygon fill="none" stroke="black" points="381.5,-112 381.5,-133 412.5,-133 412.5,-112 381.5,-112"/>
<text text-anchor="start" x="384.5" y="-118.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="412.5,-112 412.5,-133 446.5,-133 446.5,-112 412.5,-112"/>
<polygon fill="none" stroke="black" points="412.5,-112 412.5,-133 446.5,-133 446.5,-112 412.5,-112"/>
<text text-anchor="start" x="415.5" y="-118.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="446.5,-112 446.5,-133 599.5,-133 599.5,-112 446.5,-112"/>
<polygon fill="none" stroke="black" points="446.5,-112 446.5,-133 599.5,-133 599.5,-112 446.5,-112"/>
<text text-anchor="start" x="507" y="-118.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="599.5,-112 599.5,-133 678.5,-133 678.5,-112 599.5,-112"/>
<polygon fill="none" stroke="black" points="599.5,-112 599.5,-133 678.5,-133 678.5,-112 599.5,-112"/>
<text text-anchor="start" x="632" y="-118.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="381.5,-91 381.5,-112 412.5,-112 412.5,-91 381.5,-91"/>
<text text-anchor="start" x="392" y="-97.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="412.5,-91 412.5,-112 446.5,-112 446.5,-91 412.5,-91"/>
<text text-anchor="start" x="422.5" y="-97.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="446.5,-91 446.5,-112 599.5,-112 599.5,-91 446.5,-91"/>
<text text-anchor="start" x="476.5" y="-97.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="599.5,-91 599.5,-112 678.5,-112 678.5,-91 599.5,-91"/>
<text text-anchor="start" x="619" y="-97.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="381.5,-70 381.5,-91 412.5,-91 412.5,-70 381.5,-70"/>
<text text-anchor="start" x="390" y="-76.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="412.5,-70 412.5,-91 446.5,-91 446.5,-70 412.5,-70"/>
<text text-anchor="start" x="422.5" y="-76.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="446.5,-70 446.5,-91 599.5,-91 599.5,-70 446.5,-70"/>
<text text-anchor="start" x="449.5" y="-76.8" font-family="Times,serif" font-size="14.00">MetadataTypeFields</text>
<polygon fill="none" stroke="black" points="599.5,-70 599.5,-91 678.5,-91 678.5,-70 599.5,-70"/>
<text text-anchor="start" x="602.5" y="-76.8" font-family="Times,serif" font-size="14.00">composite</text>
<polygon fill="none" stroke="black" points="381.5,-49 381.5,-70 412.5,-70 412.5,-49 381.5,-49"/>
<text text-anchor="start" x="390" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="412.5,-49 412.5,-70 446.5,-70 446.5,-49 412.5,-49"/>
<text text-anchor="start" x="424.5" y="-55.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="446.5,-49 446.5,-70 599.5,-70 599.5,-49 446.5,-49"/>
<text text-anchor="start" x="513.5" y="-55.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="599.5,-49 599.5,-70 678.5,-70 678.5,-49 599.5,-49"/>
<text text-anchor="start" x="619" y="-55.8" font-family="Times,serif" font-size="14.00">index</text>
<polygon fill="none" stroke="black" points="381.5,-28 381.5,-49 412.5,-49 412.5,-28 381.5,-28"/>
<text text-anchor="start" x="390" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="412.5,-28 412.5,-49 446.5,-49 446.5,-28 412.5,-28"/>
<text text-anchor="start" x="422.5" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="446.5,-28 446.5,-49 599.5,-49 599.5,-28 446.5,-28"/>
<text text-anchor="start" x="463" y="-34.8" font-family="Times,serif" font-size="14.00">Scale::StringList</text>
<polygon fill="none" stroke="black" points="599.5,-28 599.5,-49 678.5,-49 678.5,-28 599.5,-28"/>
<text text-anchor="start" x="622.5" y="-34.8" font-family="Times,serif" font-size="14.00">docs</text>
</g>
<!-- metadata_type_variants__seq&#45;&gt;variant__seq -->
<g id="edge1" class="edge">
<title>metadata_type_variants__seq:variants_type&#45;&gt;variant__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M330.5,-81C341.03,-81 351.87,-81 362.8,-81"/>
<polygon fill="black" stroke="black" stroke-width="2" points="362.86,-84.5 372.86,-81 362.86,-77.5 362.86,-84.5"/>
</g>
<!-- metadata_type_fields__seq -->
<g id="node3" class="node">
<title>metadata_type_fields__seq</title>
<g id="a_node3"><a xlink:href="#metadata_type_fields" xlink:title="MetadataTypeFields">
<text text-anchor="middle" x="803.5" y="-76.3" font-family="Times,serif" font-size="14.00">MetadataTypeFields</text>
</a>
</g>
</g>
<!-- variant__seq&#45;&gt;metadata_type_fields__seq -->
<g id="edge2" class="edge">
<title>variant__seq:composite_type&#45;&gt;metadata_type_fields__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M679.5,-80C689.86,-80 700.7,-80 711.48,-80"/>
<polygon fill="black" stroke="black" stroke-width="2" points="711.78,-83.5 721.78,-80 711.78,-76.5 711.78,-83.5"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 7. Runtime Metadata Variants Type</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-rtm-pallet-metadata"><a class="anchor" href="#sect-rtm-pallet-metadata"></a><a class="link" href="#sect-rtm-pallet-metadata">12.2. Pallet Metadata</a></h3>
<div class="paragraph">
<p>All the metadata about a pallet, part of the main structure
(<a href="#sect-rtm-structure">Section 12.1</a>) and of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$p_i = (n, S, a, e, C, e, i)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is a string representing the pallet name.</p>
</li>
<li>
<p>\$S\$ is an <em>Option</em> type containing the pallet storage metadata
(<a href="#defn-rtm-pallet-storage-metadata">Definition 164</a>).</p>
</li>
<li>
<p>\$a\$ is an <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) containing the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of pallet calls.</p>
</li>
<li>
<p>\$e\$ is an <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) containing the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of pallet events.</p>
</li>
<li>
<p>\$C\$ is an <em>Sequence</em> (<a href="#defn-scale-list">Definition 192</a>) of all pallet constant metadata
(<a href="#defn-rtm-pallet-constants">Definition 169</a>).</p>
</li>
<li>
<p>\$e\$ is an <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) containing the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of the pallet error.</p>
</li>
<li>
<p>\$i\$ is an unsigned 8-bit integers indicating the index of the pallet, which is used for encoding pallet events and calls.</p>
</li>
</ul>
</div>
<div id="metadata_pallet" class="imageblock">
<div class="content">
<svg width="672pt" height="455pt"
 viewBox="0.00 0.00 672.00 455.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 451)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-451 668,-451 668,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata_pallet</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-98 8,-439 656,-439 656,-98 8,-98"/>
<text text-anchor="middle" x="332" y="-423.8" font-family="Times,serif" font-size="14.00">MetadataPallet</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__calls</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="376,-306 376,-395 648,-395 648,-306 376,-306"/>
<text text-anchor="middle" x="512" y="-379.8" font-family="Times,serif" font-size="14.00">MetadataPallet::Calls</text>
</g>
<g id="clust3" class="cluster">
<title>cluster__events</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="376,-209 376,-298 648,-298 648,-209 376,-209"/>
<text text-anchor="middle" x="512" y="-282.8" font-family="Times,serif" font-size="14.00">MetadataPallet::Events</text>
</g>
<g id="clust4" class="cluster">
<title>cluster__errors</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="376,-108 376,-197 648,-197 648,-108 376,-108"/>
<text text-anchor="middle" x="512" y="-181.8" font-family="Times,serif" font-size="14.00">MetadataPallet::Errors</text>
</g>
<!-- metadata_pallet__seq -->
<g id="node1" class="node">
<title>metadata_pallet__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24,-383 24,-404 55,-404 55,-383 24,-383"/>
<polygon fill="none" stroke="black" points="24,-383 24,-404 55,-404 55,-383 24,-383"/>
<text text-anchor="start" x="27" y="-389.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55,-383 55,-404 89,-404 89,-383 55,-383"/>
<polygon fill="none" stroke="black" points="55,-383 55,-404 89,-404 89,-383 55,-383"/>
<text text-anchor="start" x="58" y="-389.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89,-383 89,-404 226,-404 226,-383 89,-383"/>
<polygon fill="none" stroke="black" points="89,-383 89,-404 226,-404 226,-383 89,-383"/>
<text text-anchor="start" x="141.5" y="-389.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226,-383 226,-404 340,-404 340,-383 226,-383"/>
<polygon fill="none" stroke="black" points="226,-383 226,-404 340,-404 340,-383 226,-383"/>
<text text-anchor="start" x="276" y="-389.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-362 24,-383 55,-383 55,-362 24,-362"/>
<text text-anchor="start" x="34.5" y="-368.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55,-362 55,-383 89,-383 89,-362 55,-362"/>
<text text-anchor="start" x="65" y="-368.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-362 89,-383 226,-383 226,-362 89,-362"/>
<text text-anchor="start" x="111" y="-368.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="226,-362 226,-383 340,-383 340,-362 226,-362"/>
<text text-anchor="start" x="263" y="-368.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="24,-341 24,-362 55,-362 55,-341 24,-341"/>
<text text-anchor="start" x="32.5" y="-347.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-341 55,-362 89,-362 89,-341 55,-341"/>
<text text-anchor="start" x="67" y="-347.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-341 89,-362 226,-362 226,-341 89,-341"/>
<text text-anchor="start" x="148" y="-347.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="226,-341 226,-362 340,-362 340,-341 226,-341"/>
<text text-anchor="start" x="240" y="-347.8" font-family="Times,serif" font-size="14.00">has_storage</text>
<polygon fill="none" stroke="black" points="24,-320 24,-341 55,-341 55,-320 24,-320"/>
<text text-anchor="start" x="32.5" y="-326.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-320 55,-341 89,-341 89,-320 55,-320"/>
<text text-anchor="start" x="65" y="-326.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-320 89,-341 226,-341 226,-320 89,-320"/>
<text text-anchor="start" x="109" y="-326.8" font-family="Times,serif" font-size="14.00">PalletStorage</text>
<polygon fill="none" stroke="black" points="226,-320 226,-341 340,-341 340,-320 226,-320"/>
<text text-anchor="start" x="255.5" y="-326.8" font-family="Times,serif" font-size="14.00">storage</text>
<polygon fill="none" stroke="black" points="24,-299 24,-320 55,-320 55,-299 24,-299"/>
<text text-anchor="start" x="32.5" y="-305.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-299 55,-320 89,-320 89,-299 55,-299"/>
<text text-anchor="start" x="67" y="-305.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-299 89,-320 226,-320 226,-299 89,-299"/>
<text text-anchor="start" x="148" y="-305.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="226,-299 226,-320 340,-320 340,-299 226,-299"/>
<text text-anchor="start" x="251" y="-305.8" font-family="Times,serif" font-size="14.00">has_calls</text>
<polygon fill="none" stroke="black" points="24,-278 24,-299 55,-299 55,-278 24,-278"/>
<text text-anchor="start" x="32.5" y="-284.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-278 55,-299 89,-299 89,-278 55,-278"/>
<text text-anchor="start" x="65" y="-284.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-278 89,-299 226,-299 226,-278 89,-278"/>
<text text-anchor="start" x="139.5" y="-284.8" font-family="Times,serif" font-size="14.00">Calls</text>
<polygon fill="none" stroke="black" points="226,-278 226,-299 340,-299 340,-278 226,-278"/>
<text text-anchor="start" x="266.5" y="-284.8" font-family="Times,serif" font-size="14.00">calls</text>
<polygon fill="none" stroke="black" points="24,-257 24,-278 55,-278 55,-257 24,-257"/>
<text text-anchor="start" x="32.5" y="-263.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-257 55,-278 89,-278 89,-257 55,-257"/>
<text text-anchor="start" x="67" y="-263.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-257 89,-278 226,-278 226,-257 89,-257"/>
<text text-anchor="start" x="148" y="-263.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="226,-257 226,-278 340,-278 340,-257 226,-257"/>
<text text-anchor="start" x="243.5" y="-263.8" font-family="Times,serif" font-size="14.00">has_events</text>
<polygon fill="none" stroke="black" points="24,-236 24,-257 55,-257 55,-236 24,-236"/>
<text text-anchor="start" x="32.5" y="-242.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-236 55,-257 89,-257 89,-236 55,-236"/>
<text text-anchor="start" x="65" y="-242.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-236 89,-257 226,-257 226,-236 89,-236"/>
<text text-anchor="start" x="132.5" y="-242.8" font-family="Times,serif" font-size="14.00">Events</text>
<polygon fill="none" stroke="black" points="226,-236 226,-257 340,-257 340,-236 226,-236"/>
<text text-anchor="start" x="259" y="-242.8" font-family="Times,serif" font-size="14.00">events</text>
<polygon fill="none" stroke="black" points="24,-215 24,-236 55,-236 55,-215 24,-215"/>
<text text-anchor="start" x="32.5" y="-221.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-215 55,-236 89,-236 89,-215 55,-215"/>
<text text-anchor="start" x="65" y="-221.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-215 89,-236 226,-236 226,-215 89,-215"/>
<text text-anchor="start" x="92" y="-221.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226,-215 226,-236 340,-236 340,-215 226,-215"/>
<text text-anchor="start" x="229" y="-221.8" font-family="Times,serif" font-size="14.00">num_constants</text>
<polygon fill="none" stroke="black" points="24,-194 24,-215 55,-215 55,-194 24,-194"/>
<text text-anchor="start" x="32.5" y="-200.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-194 55,-215 89,-215 89,-194 55,-194"/>
<text text-anchor="start" x="65" y="-200.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-194 89,-215 226,-215 226,-194 89,-194"/>
<text text-anchor="start" x="104.5" y="-200.8" font-family="Times,serif" font-size="14.00">PalletConstant</text>
<polygon fill="none" stroke="black" points="226,-194 226,-215 340,-215 340,-194 226,-194"/>
<text text-anchor="start" x="248" y="-200.8" font-family="Times,serif" font-size="14.00">constants</text>
<polygon fill="none" stroke="black" points="24,-173 24,-194 340,-194 340,-173 24,-173"/>
<text text-anchor="start" x="59" y="-179.8" font-family="Times,serif" font-size="14.00">repeat num_constants.value times</text>
<polygon fill="none" stroke="black" points="24,-152 24,-173 55,-173 55,-152 24,-152"/>
<text text-anchor="start" x="32.5" y="-158.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-152 55,-173 89,-173 89,-152 55,-152"/>
<text text-anchor="start" x="67" y="-158.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-152 89,-173 226,-173 226,-152 89,-152"/>
<text text-anchor="start" x="148" y="-158.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="226,-152 226,-173 340,-173 340,-152 226,-152"/>
<text text-anchor="start" x="245" y="-158.8" font-family="Times,serif" font-size="14.00">has_errors</text>
<polygon fill="none" stroke="black" points="24,-131 24,-152 55,-152 55,-131 24,-131"/>
<text text-anchor="start" x="32.5" y="-137.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-131 55,-152 89,-152 89,-131 55,-131"/>
<text text-anchor="start" x="65" y="-137.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-131 89,-152 226,-152 226,-131 89,-131"/>
<text text-anchor="start" x="134" y="-137.8" font-family="Times,serif" font-size="14.00">Errors</text>
<polygon fill="none" stroke="black" points="226,-131 226,-152 340,-152 340,-131 226,-131"/>
<text text-anchor="start" x="260.5" y="-137.8" font-family="Times,serif" font-size="14.00">errors</text>
<polygon fill="none" stroke="black" points="24,-110 24,-131 55,-131 55,-110 24,-110"/>
<text text-anchor="start" x="32.5" y="-116.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-110 55,-131 89,-131 89,-110 55,-110"/>
<text text-anchor="start" x="67" y="-116.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89,-110 89,-131 226,-131 226,-110 89,-110"/>
<text text-anchor="start" x="148" y="-116.8" font-family="Times,serif" font-size="14.00">u1</text>
<polygon fill="none" stroke="black" points="226,-110 226,-131 340,-131 340,-110 226,-110"/>
<text text-anchor="start" x="263" y="-116.8" font-family="Times,serif" font-size="14.00">index</text>
</g>
<!-- calls__seq -->
<g id="node2" class="node">
<title>calls__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="392,-339 392,-360 423,-360 423,-339 392,-339"/>
<polygon fill="none" stroke="black" points="392,-339 392,-360 423,-360 423,-339 392,-339"/>
<text text-anchor="start" x="395" y="-345.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="423,-339 423,-360 457,-360 457,-339 423,-339"/>
<polygon fill="none" stroke="black" points="423,-339 423,-360 457,-360 457,-339 423,-339"/>
<text text-anchor="start" x="426" y="-345.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="457,-339 457,-360 594,-360 594,-339 457,-339"/>
<polygon fill="none" stroke="black" points="457,-339 457,-360 594,-360 594,-339 457,-339"/>
<text text-anchor="start" x="509.5" y="-345.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="594,-339 594,-360 632,-360 632,-339 594,-339"/>
<polygon fill="none" stroke="black" points="594,-339 594,-360 632,-360 632,-339 594,-339"/>
<text text-anchor="start" x="606" y="-345.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="392,-318 392,-339 423,-339 423,-318 392,-318"/>
<text text-anchor="start" x="402.5" y="-324.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="423,-318 423,-339 457,-339 457,-318 423,-318"/>
<text text-anchor="start" x="433" y="-324.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="457,-318 457,-339 594,-339 594,-318 457,-318"/>
<text text-anchor="start" x="460" y="-324.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="594,-318 594,-339 632,-339 632,-318 594,-318"/>
<text text-anchor="start" x="597" y="-324.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_pallet__seq&#45;&gt;calls__seq -->
<g id="edge2" class="edge">
<title>metadata_pallet__seq:calls_type&#45;&gt;calls__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M341,-289C357.59,-289 360.21,-296.91 376,-302 385.64,-305.11 395.72,-308.18 405.84,-311.15"/>
<polygon fill="black" stroke="black" stroke-width="2" points="404.97,-314.54 415.55,-313.97 406.92,-307.82 404.97,-314.54"/>
</g>
<!-- events__seq -->
<g id="node3" class="node">
<title>events__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="392,-242 392,-263 423,-263 423,-242 392,-242"/>
<polygon fill="none" stroke="black" points="392,-242 392,-263 423,-263 423,-242 392,-242"/>
<text text-anchor="start" x="395" y="-248.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="423,-242 423,-263 457,-263 457,-242 423,-242"/>
<polygon fill="none" stroke="black" points="423,-242 423,-263 457,-263 457,-242 423,-242"/>
<text text-anchor="start" x="426" y="-248.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="457,-242 457,-263 594,-263 594,-242 457,-242"/>
<polygon fill="none" stroke="black" points="457,-242 457,-263 594,-263 594,-242 457,-242"/>
<text text-anchor="start" x="509.5" y="-248.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="594,-242 594,-263 632,-263 632,-242 594,-242"/>
<polygon fill="none" stroke="black" points="594,-242 594,-263 632,-263 632,-242 594,-242"/>
<text text-anchor="start" x="606" y="-248.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="392,-221 392,-242 423,-242 423,-221 392,-221"/>
<text text-anchor="start" x="402.5" y="-227.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="423,-221 423,-242 457,-242 457,-221 423,-221"/>
<text text-anchor="start" x="433" y="-227.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="457,-221 457,-242 594,-242 594,-221 457,-221"/>
<text text-anchor="start" x="460" y="-227.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="594,-221 594,-242 632,-242 632,-221 594,-221"/>
<text text-anchor="start" x="597" y="-227.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_pallet__seq&#45;&gt;events__seq -->
<g id="edge3" class="edge">
<title>metadata_pallet__seq:events_type&#45;&gt;events__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M341,-246C351.62,-246 362.62,-245.92 373.67,-245.79"/>
<polygon fill="black" stroke="black" stroke-width="2" points="373.88,-249.28 383.83,-245.65 373.78,-242.28 373.88,-249.28"/>
</g>
<!-- errors__seq -->
<g id="node4" class="node">
<title>errors__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="392,-141 392,-162 423,-162 423,-141 392,-141"/>
<polygon fill="none" stroke="black" points="392,-141 392,-162 423,-162 423,-141 392,-141"/>
<text text-anchor="start" x="395" y="-147.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="423,-141 423,-162 457,-162 457,-141 423,-141"/>
<polygon fill="none" stroke="black" points="423,-141 423,-162 457,-162 457,-141 423,-141"/>
<text text-anchor="start" x="426" y="-147.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="457,-141 457,-162 594,-162 594,-141 457,-141"/>
<polygon fill="none" stroke="black" points="457,-141 457,-162 594,-162 594,-141 457,-141"/>
<text text-anchor="start" x="509.5" y="-147.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="594,-141 594,-162 632,-162 632,-141 594,-141"/>
<polygon fill="none" stroke="black" points="594,-141 594,-162 632,-162 632,-141 594,-141"/>
<text text-anchor="start" x="606" y="-147.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="392,-120 392,-141 423,-141 423,-120 392,-120"/>
<text text-anchor="start" x="402.5" y="-126.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="423,-120 423,-141 457,-141 457,-120 423,-120"/>
<text text-anchor="start" x="433" y="-126.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="457,-120 457,-141 594,-141 594,-120 457,-120"/>
<text text-anchor="start" x="460" y="-126.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="594,-120 594,-141 632,-141 632,-120 594,-120"/>
<text text-anchor="start" x="597" y="-126.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- metadata_pallet__seq&#45;&gt;errors__seq -->
<g id="edge5" class="edge">
<title>metadata_pallet__seq:errors_type&#45;&gt;errors__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M341,-141C351.62,-141 362.61,-141 373.67,-141"/>
<polygon fill="black" stroke="black" stroke-width="2" points="373.82,-144.5 383.82,-141 373.82,-137.5 373.82,-144.5"/>
</g>
<!-- pallet_storage__seq -->
<g id="node5" class="node">
<title>pallet_storage__seq</title>
<g id="a_node5"><a xlink:href="#pallet_storage" xlink:title="PalletStorage">
<text text-anchor="middle" x="512" y="-68.3" font-family="Times,serif" font-size="14.00">PalletStorage</text>
</a>
</g>
</g>
<!-- metadata_pallet__seq&#45;&gt;pallet_storage__seq -->
<g id="edge1" class="edge">
<title>metadata_pallet__seq:storage_type&#45;&gt;pallet_storage__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M341,-331C392.04,-331 341.38,-141.5 376,-104 393.59,-84.95 420.27,-76.26 445.27,-72.59"/>
<polygon fill="black" stroke="black" stroke-width="2" points="445.98,-76.03 455.48,-71.34 445.13,-69.08 445.98,-76.03"/>
</g>
<!-- pallet_constant__seq -->
<g id="node6" class="node">
<title>pallet_constant__seq</title>
<g id="a_node6"><a xlink:href="#pallet_constant" xlink:title="PalletConstant">
<text text-anchor="middle" x="512" y="-14.3" font-family="Times,serif" font-size="14.00">PalletConstant</text>
</a>
</g>
</g>
<!-- metadata_pallet__seq&#45;&gt;pallet_constant__seq -->
<g id="edge4" class="edge">
<title>metadata_pallet__seq:constants_type&#45;&gt;pallet_constant__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M341,-204C413.36,-204 324.34,-95.67 376,-45 393.02,-28.31 417.27,-20.52 440.53,-17.24"/>
<polygon fill="black" stroke="black" stroke-width="2" points="441.23,-20.68 450.77,-16.06 440.43,-13.73 441.23,-20.68"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 8. Pallet Metadata</div>
</div>
<div id="defn-rtm-pallet-storage-metadata" class="exampleblock">
<div class="title">Definition 164. <a href="#defn-rtm-pallet-storage-metadata">Pallet Storage Metadata</a></div>
<div class="content">
<div class="paragraph">
<p>The metadata about a pallets storage.</p>
</div>
<div class="stemblock">
<div class="content">
\$S = (p, E)\$
\$E = ( e_0, ... , e_n )\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$p\$ is the string representing the common prefix used by all storage entries.</p>
</li>
<li>
<p>\$E\$ is an array of varying length containing elements of storage entries
(<a href="#defn-rtm-storage-entry-metadata">Definition 165</a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div id="defn-rtm-storage-entry-metadata" class="exampleblock">
<div class="title">Definition 165. <a href="#defn-rtm-storage-entry-metadata">Storage Entry Metadata</a></div>
<div class="content">
<div class="paragraph">
<p>The metadata about a pallets storage entry.</p>
</div>
<div class="stemblock">
<div class="content">
\$e_i = (n, m, y, d, C)\$
\$C = ( c_0, ... , c_n )\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is the string representing the variable name of the storage entry.</p>
</li>
<li>
<p>\$m\$ is an enum type determining the storage entry modifier
(<a href="#defn-rtm-storage-entry-modifier">Definition 166</a>).</p>
</li>
<li>
<p>\$y\$ is the type of the value stored in the entry
(<a href="#defn-rtm-storage-entry-type">Definition 167</a>).</p>
</li>
<li>
<p>\$d\$ is an byte array containing the default value.</p>
</li>
<li>
<p>\$C\$ is an array of varying length of strings containing the documentation.</p>
</li>
</ul>
</div>
<div id="pallet_storage" class="imageblock">
<div class="content">
<svg width="850pt" height="236pt"
 viewBox="0.00 0.00 850.00 236.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 232)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-232 846,-232 846,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__pallet_storage</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-220 679,-220 679,-8 8,-8"/>
<text text-anchor="middle" x="343.5" y="-204.8" font-family="Times,serif" font-size="14.00">PalletStorage</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__item</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="347,-16 347,-189 671,-189 671,-16 347,-16"/>
<text text-anchor="middle" x="509" y="-173.8" font-family="Times,serif" font-size="14.00">PalletStorage::Item</text>
</g>
<!-- pallet_storage__seq -->
<g id="node1" class="node">
<title>pallet_storage__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-144 24.5,-165 55.5,-165 55.5,-144 24.5,-144"/>
<polygon fill="none" stroke="black" points="24.5,-144 24.5,-165 55.5,-165 55.5,-144 24.5,-144"/>
<text text-anchor="start" x="27.5" y="-150.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-144 55.5,-165 89.5,-165 89.5,-144 55.5,-144"/>
<polygon fill="none" stroke="black" points="55.5,-144 55.5,-165 89.5,-165 89.5,-144 55.5,-144"/>
<text text-anchor="start" x="58.5" y="-150.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-144 89.5,-165 226.5,-165 226.5,-144 89.5,-144"/>
<polygon fill="none" stroke="black" points="89.5,-144 89.5,-165 226.5,-165 226.5,-144 89.5,-144"/>
<text text-anchor="start" x="142" y="-150.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226.5,-144 226.5,-165 311.5,-165 311.5,-144 226.5,-144"/>
<polygon fill="none" stroke="black" points="226.5,-144 226.5,-165 311.5,-165 311.5,-144 226.5,-144"/>
<text text-anchor="start" x="262" y="-150.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-123 24.5,-144 55.5,-144 55.5,-123 24.5,-123"/>
<text text-anchor="start" x="35" y="-129.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-123 55.5,-144 89.5,-144 89.5,-123 55.5,-123"/>
<text text-anchor="start" x="65.5" y="-129.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-123 89.5,-144 226.5,-144 226.5,-123 89.5,-123"/>
<text text-anchor="start" x="111.5" y="-129.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="226.5,-123 226.5,-144 311.5,-144 311.5,-123 226.5,-123"/>
<text text-anchor="start" x="248" y="-129.8" font-family="Times,serif" font-size="14.00">prefix</text>
<polygon fill="none" stroke="black" points="24.5,-102 24.5,-123 55.5,-123 55.5,-102 24.5,-102"/>
<text text-anchor="start" x="33" y="-108.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-102 55.5,-123 89.5,-123 89.5,-102 55.5,-102"/>
<text text-anchor="start" x="65.5" y="-108.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-102 89.5,-123 226.5,-123 226.5,-102 89.5,-102"/>
<text text-anchor="start" x="92.5" y="-108.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226.5,-102 226.5,-123 311.5,-123 311.5,-102 226.5,-102"/>
<text text-anchor="start" x="229.5" y="-108.8" font-family="Times,serif" font-size="14.00">num_items</text>
<polygon fill="none" stroke="black" points="24.5,-81 24.5,-102 55.5,-102 55.5,-81 24.5,-81"/>
<text text-anchor="start" x="33" y="-87.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55.5,-81 55.5,-102 89.5,-102 89.5,-81 55.5,-81"/>
<text text-anchor="start" x="65.5" y="-87.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-81 89.5,-102 226.5,-102 226.5,-81 89.5,-81"/>
<text text-anchor="start" x="141" y="-87.8" font-family="Times,serif" font-size="14.00">Item</text>
<polygon fill="none" stroke="black" points="226.5,-81 226.5,-102 311.5,-102 311.5,-81 226.5,-81"/>
<text text-anchor="start" x="249" y="-87.8" font-family="Times,serif" font-size="14.00">items</text>
<polygon fill="none" stroke="black" points="24.5,-60 24.5,-81 311.5,-81 311.5,-60 24.5,-60"/>
<text text-anchor="start" x="59.5" y="-66.8" font-family="Times,serif" font-size="14.00">repeat num_items.value times</text>
</g>
<!-- item__seq -->
<g id="node2" class="node">
<title>item__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="363,-133 363,-154 394,-154 394,-133 363,-133"/>
<polygon fill="none" stroke="black" points="363,-133 363,-154 394,-154 394,-133 363,-133"/>
<text text-anchor="start" x="366" y="-139.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="394,-133 394,-154 428,-154 428,-133 394,-133"/>
<polygon fill="none" stroke="black" points="394,-133 394,-154 428,-154 428,-133 394,-133"/>
<text text-anchor="start" x="397" y="-139.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="428,-133 428,-154 581,-154 581,-133 428,-133"/>
<polygon fill="none" stroke="black" points="428,-133 428,-154 581,-154 581,-133 428,-133"/>
<text text-anchor="start" x="488.5" y="-139.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="581,-133 581,-154 655,-154 655,-133 581,-133"/>
<polygon fill="none" stroke="black" points="581,-133 581,-154 655,-154 655,-133 581,-133"/>
<text text-anchor="start" x="611" y="-139.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="363,-112 363,-133 394,-133 394,-112 363,-112"/>
<text text-anchor="start" x="373.5" y="-118.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="394,-112 394,-133 428,-133 428,-112 394,-112"/>
<text text-anchor="start" x="404" y="-118.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="428,-112 428,-133 581,-133 581,-112 428,-112"/>
<text text-anchor="start" x="458" y="-118.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="581,-112 581,-133 655,-133 655,-112 581,-112"/>
<text text-anchor="start" x="598" y="-118.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="363,-91 363,-112 394,-112 394,-91 363,-91"/>
<text text-anchor="start" x="371.5" y="-97.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="394,-91 394,-112 428,-112 428,-91 394,-91"/>
<text text-anchor="start" x="406" y="-97.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="428,-91 428,-112 581,-112 581,-91 428,-91"/>
<text text-anchor="start" x="431" y="-97.8" font-family="Times,serif" font-size="14.00">u1→StorageModifier</text>
<polygon fill="none" stroke="black" points="581,-91 581,-112 655,-112 655,-91 581,-91"/>
<text text-anchor="start" x="588" y="-97.8" font-family="Times,serif" font-size="14.00">modifier</text>
<polygon fill="none" stroke="black" points="363,-70 363,-91 394,-91 394,-70 363,-70"/>
<text text-anchor="start" x="371.5" y="-76.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="394,-70 394,-91 428,-91 428,-70 394,-70"/>
<text text-anchor="start" x="404" y="-76.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="428,-70 428,-91 581,-91 581,-70 428,-70"/>
<text text-anchor="start" x="441" y="-76.8" font-family="Times,serif" font-size="14.00">StorageDefinition</text>
<polygon fill="none" stroke="black" points="581,-70 581,-91 655,-91 655,-70 581,-70"/>
<text text-anchor="start" x="584" y="-76.8" font-family="Times,serif" font-size="14.00">definition</text>
<polygon fill="none" stroke="black" points="363,-49 363,-70 394,-70 394,-49 363,-49"/>
<text text-anchor="start" x="371.5" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="394,-49 394,-70 428,-70 428,-49 394,-49"/>
<text text-anchor="start" x="404" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="428,-49 428,-70 581,-70 581,-49 428,-49"/>
<text text-anchor="start" x="460.5" y="-55.8" font-family="Times,serif" font-size="14.00">Scale::Bytes</text>
<polygon fill="none" stroke="black" points="581,-49 581,-70 655,-70 655,-49 581,-49"/>
<text text-anchor="start" x="590" y="-55.8" font-family="Times,serif" font-size="14.00">fallback</text>
<polygon fill="none" stroke="black" points="363,-28 363,-49 394,-49 394,-28 363,-28"/>
<text text-anchor="start" x="371.5" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="394,-28 394,-49 428,-49 428,-28 394,-28"/>
<text text-anchor="start" x="404" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="428,-28 428,-49 581,-49 581,-28 428,-28"/>
<text text-anchor="start" x="444.5" y="-34.8" font-family="Times,serif" font-size="14.00">Scale::StringList</text>
<polygon fill="none" stroke="black" points="581,-28 581,-49 655,-49 655,-28 581,-28"/>
<text text-anchor="start" x="601.5" y="-34.8" font-family="Times,serif" font-size="14.00">docs</text>
</g>
<!-- pallet_storage__seq&#45;&gt;item__seq -->
<g id="edge1" class="edge">
<title>pallet_storage__seq:items_type&#45;&gt;item__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M312.5,-91C323.02,-91 333.87,-91 344.8,-91"/>
<polygon fill="black" stroke="black" stroke-width="2" points="344.85,-94.5 354.85,-91 344.85,-87.5 344.85,-94.5"/>
</g>
<!-- storage_definition__seq -->
<g id="node3" class="node">
<title>storage_definition__seq</title>
<g id="a_node3"><a xlink:href="#storage_definition" xlink:title="StorageDefinition">
<text text-anchor="middle" x="770.5" y="-76.3" font-family="Times,serif" font-size="14.00">StorageDefinition</text>
</a>
</g>
</g>
<!-- item__seq&#45;&gt;storage_definition__seq -->
<g id="edge2" class="edge">
<title>item__seq:definition_type&#45;&gt;storage_definition__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M656,-80C666.64,-80 677.83,-80 688.88,-80"/>
<polygon fill="black" stroke="black" stroke-width="2" points="688.96,-83.5 698.96,-80 688.96,-76.5 688.96,-83.5"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 9. Pallet Storage Metadata</div>
</div>
</div>
</div>
<div id="defn-rtm-storage-entry-modifier" class="exampleblock">
<div class="title">Definition 166. <a href="#defn-rtm-storage-entry-modifier">Storage Entry Modifier</a></div>
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This might be incorrect and has to be reviewed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The storage entry modifier is a varying datatype (<a href="#defn-varrying-data-type">Definition 188</a>)
and indicates how the storage entry is returned and how it behaves if the entry
is not present.</p>
</div>
<div class="stemblock">
<div class="content">
\$m = {
	(0,"optional"),
	(1,"default")
:}\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> indicates that the entry returns an <em>Option</em> type and therefore <em>None</em>
if the storage entry is not present. <em>1</em> indicates that the entry returns the
type \$y\$ with default value \$d\$ (in
<a href="#defn-rtm-storage-entry-metadata">Definition 165</a>) if the entry is not present.</p>
</div>
</div>
</div>
<div id="defn-rtm-storage-entry-type" class="exampleblock">
<div class="title">Definition 167. <a href="#defn-rtm-storage-entry-type">Storage Entry Type</a></div>
<div class="content">
<div class="paragraph">
<p>The type of the storage value is a varying datatype
(<a href="#defn-varrying-data-type">Definition 188</a>) that indicates how the entry is stored.</p>
</div>
<div class="stemblock">
<div class="content">
\$y = {
	(0,-&gt;,t,"plain type"),
	(1,-&gt;,(H, k, v),"storage map")
:}\$
</div>
</div>
<div class="paragraph">
<p>where \$t\$, \$k\$ (key) and \$v\$ (value) are all of type Ids
(<a href="#defn-rtm-type-id">Definition 160</a>). \$H\$ is an array of varying length containing the
storage hasher (<a href="#defn-rtm-storage-hasher">Definition 168</a>).</p>
</div>
<div id="storage_definition" class="imageblock">
<div class="content">
<svg width="899pt" height="333pt"
 viewBox="0.00 0.00 899.00 333.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 329)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-329 895,-329 895,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__storage_definition</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-317 883,-317 883,-8 8,-8"/>
<text text-anchor="middle" x="445.5" y="-301.8" font-family="Times,serif" font-size="14.00">StorageDefinition</text>
</g>
<g id="clust2" class="cluster">
<title>cluster__plain</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="575,-197 575,-286 847,-286 847,-197 575,-197"/>
<text text-anchor="middle" x="711" y="-270.8" font-family="Times,serif" font-size="14.00">StorageDefinition::Plain</text>
</g>
<g id="clust3" class="cluster">
<title>cluster__map</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="547,-16 547,-189 875,-189 875,-16 547,-16"/>
<text text-anchor="middle" x="711" y="-173.8" font-family="Times,serif" font-size="14.00">StorageDefinition::Map</text>
</g>
<!-- storage_definition__seq -->
<g id="node1" class="node">
<title>storage_definition__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24.5,-193 24.5,-214 55.5,-214 55.5,-193 24.5,-193"/>
<polygon fill="none" stroke="black" points="24.5,-193 24.5,-214 55.5,-214 55.5,-193 24.5,-193"/>
<text text-anchor="start" x="27.5" y="-199.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55.5,-193 55.5,-214 89.5,-214 89.5,-193 55.5,-193"/>
<polygon fill="none" stroke="black" points="55.5,-193 55.5,-214 89.5,-214 89.5,-193 55.5,-193"/>
<text text-anchor="start" x="58.5" y="-199.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89.5,-193 89.5,-214 216.5,-214 216.5,-193 89.5,-193"/>
<polygon fill="none" stroke="black" points="89.5,-193 89.5,-214 216.5,-214 216.5,-193 89.5,-193"/>
<text text-anchor="start" x="137" y="-199.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="216.5,-193 216.5,-214 271.5,-214 271.5,-193 216.5,-193"/>
<polygon fill="none" stroke="black" points="216.5,-193 216.5,-214 271.5,-214 271.5,-193 216.5,-193"/>
<text text-anchor="start" x="237" y="-199.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24.5,-172 24.5,-193 55.5,-193 55.5,-172 24.5,-172"/>
<text text-anchor="start" x="35" y="-178.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55.5,-172 55.5,-193 89.5,-193 89.5,-172 55.5,-172"/>
<text text-anchor="start" x="67.5" y="-178.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="89.5,-172 89.5,-193 216.5,-193 216.5,-172 89.5,-172"/>
<text text-anchor="start" x="92.5" y="-178.8" font-family="Times,serif" font-size="14.00">u1→StorageType</text>
<polygon fill="none" stroke="black" points="216.5,-172 216.5,-193 271.5,-193 271.5,-172 216.5,-172"/>
<text text-anchor="start" x="228" y="-178.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="24.5,-151 24.5,-172 55.5,-172 55.5,-151 24.5,-151"/>
<text text-anchor="start" x="35" y="-157.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="55.5,-151 55.5,-172 89.5,-172 89.5,-151 55.5,-151"/>
<text text-anchor="start" x="65.5" y="-157.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89.5,-151 89.5,-172 216.5,-172 216.5,-151 89.5,-151"/>
<text text-anchor="start" x="106" y="-157.8" font-family="Times,serif" font-size="14.00">switch (type)</text>
<polygon fill="none" stroke="black" points="216.5,-151 216.5,-172 271.5,-172 271.5,-151 216.5,-151"/>
<text text-anchor="start" x="219.5" y="-157.8" font-family="Times,serif" font-size="14.00">details</text>
</g>
<!-- storage_definition__seq&#45;&gt;storage_definition__seq -->
<g id="edge4" class="edge">
<title>storage_definition__seq:type_type&#45;&gt;storage_definition__seq:details_type</title>
<path fill="none" stroke="#404040" d="M216.41,-192.32C179.39,-211.12 188.75,-236.5 244.5,-236.5 296.49,-236.5 308.14,-201.77 279.44,-177.88"/>
<polygon fill="#404040" stroke="#404040" points="281.44,-175.02 271.27,-172.07 277.39,-180.72 281.44,-175.02"/>
</g>
<!-- storage_definition__seq_details_switch -->
<g id="node2" class="node">
<title>storage_definition__seq_details_switch</title>
<polygon fill="#f0f2e4" stroke="transparent" points="323,-171 323,-192 468,-192 468,-171 323,-171"/>
<polygon fill="none" stroke="black" points="323,-171 323,-192 468,-192 468,-171 323,-171"/>
<text text-anchor="start" x="379.5" y="-177.8" font-family="Times,serif" font-size="14.00">case</text>
<polygon fill="#f0f2e4" stroke="transparent" points="468,-171 468,-192 511,-192 511,-171 468,-171"/>
<polygon fill="none" stroke="black" points="468,-171 468,-192 511,-192 511,-171 468,-171"/>
<text text-anchor="start" x="473.5" y="-177.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="323,-150 323,-171 468,-171 468,-150 323,-150"/>
<text text-anchor="start" x="326" y="-156.8" font-family="Times,serif" font-size="14.00">:storage_type_plain</text>
<polygon fill="none" stroke="black" points="468,-150 468,-171 511,-171 511,-150 468,-150"/>
<text text-anchor="start" x="471" y="-156.8" font-family="Times,serif" font-size="14.00">Plain</text>
<polygon fill="none" stroke="black" points="323,-129 323,-150 468,-150 468,-129 323,-129"/>
<text text-anchor="start" x="328" y="-135.8" font-family="Times,serif" font-size="14.00">:storage_type_map</text>
<polygon fill="none" stroke="black" points="468,-129 468,-150 511,-150 511,-129 468,-129"/>
<text text-anchor="start" x="473.5" y="-135.8" font-family="Times,serif" font-size="14.00">Map</text>
</g>
<!-- storage_definition__seq&#45;&gt;storage_definition__seq_details_switch -->
<g id="edge1" class="edge">
<title>storage_definition__seq:details_type&#45;&gt;storage_definition__seq_details_switch</title>
<path fill="none" stroke="black" stroke-width="2" d="M272.5,-161C282.99,-161 293.91,-161 304.84,-161"/>
<polygon fill="black" stroke="black" stroke-width="2" points="304.87,-164.5 314.87,-161 304.87,-157.5 304.87,-164.5"/>
</g>
<!-- plain__seq -->
<g id="node3" class="node">
<title>plain__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="591,-230 591,-251 622,-251 622,-230 591,-230"/>
<polygon fill="none" stroke="black" points="591,-230 591,-251 622,-251 622,-230 591,-230"/>
<text text-anchor="start" x="594" y="-236.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="622,-230 622,-251 656,-251 656,-230 622,-230"/>
<polygon fill="none" stroke="black" points="622,-230 622,-251 656,-251 656,-230 622,-230"/>
<text text-anchor="start" x="625" y="-236.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="656,-230 656,-251 793,-251 793,-230 656,-230"/>
<polygon fill="none" stroke="black" points="656,-230 656,-251 793,-251 793,-230 656,-230"/>
<text text-anchor="start" x="708.5" y="-236.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="793,-230 793,-251 831,-251 831,-230 793,-230"/>
<polygon fill="none" stroke="black" points="793,-230 793,-251 831,-251 831,-230 793,-230"/>
<text text-anchor="start" x="805" y="-236.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="591,-209 591,-230 622,-230 622,-209 591,-209"/>
<text text-anchor="start" x="601.5" y="-215.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="622,-209 622,-230 656,-230 656,-209 622,-209"/>
<text text-anchor="start" x="632" y="-215.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="656,-209 656,-230 793,-230 793,-209 656,-209"/>
<text text-anchor="start" x="659" y="-215.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="793,-209 793,-230 831,-230 831,-209 793,-209"/>
<text text-anchor="start" x="796" y="-215.8" font-family="Times,serif" font-size="14.00">type</text>
</g>
<!-- storage_definition__seq_details_switch&#45;&gt;plain__seq -->
<g id="edge2" class="edge">
<title>storage_definition__seq_details_switch:case0&#45;&gt;plain__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M512,-160C533.38,-160 528.13,-182.95 547,-193 555.36,-197.46 564.24,-201.38 573.38,-204.83"/>
<polygon fill="black" stroke="black" stroke-width="2" points="572.38,-208.19 582.97,-208.26 574.73,-201.6 572.38,-208.19"/>
</g>
<!-- map__seq -->
<g id="node4" class="node">
<title>map__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="563,-133 563,-154 594,-154 594,-133 563,-133"/>
<polygon fill="none" stroke="black" points="563,-133 563,-154 594,-154 594,-133 563,-133"/>
<text text-anchor="start" x="566" y="-139.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="594,-133 594,-154 628,-154 628,-133 594,-133"/>
<polygon fill="none" stroke="black" points="594,-133 594,-154 628,-154 628,-133 594,-133"/>
<text text-anchor="start" x="597" y="-139.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="628,-133 628,-154 765,-154 765,-133 628,-133"/>
<polygon fill="none" stroke="black" points="628,-133 628,-154 765,-154 765,-133 628,-133"/>
<text text-anchor="start" x="680.5" y="-139.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="765,-133 765,-154 859,-154 859,-133 765,-133"/>
<polygon fill="none" stroke="black" points="765,-133 765,-154 859,-154 859,-133 765,-133"/>
<text text-anchor="start" x="805" y="-139.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="563,-112 563,-133 594,-133 594,-112 563,-112"/>
<text text-anchor="start" x="573.5" y="-118.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="594,-112 594,-133 628,-133 628,-112 594,-112"/>
<text text-anchor="start" x="604" y="-118.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="628,-112 628,-133 765,-133 765,-112 628,-112"/>
<text text-anchor="start" x="631" y="-118.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="765,-112 765,-133 859,-133 859,-112 765,-112"/>
<text text-anchor="start" x="768" y="-118.8" font-family="Times,serif" font-size="14.00">num_hasher</text>
<polygon fill="none" stroke="black" points="563,-91 563,-112 594,-112 594,-91 563,-91"/>
<text text-anchor="start" x="571.5" y="-97.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="594,-91 594,-112 628,-112 628,-91 594,-91"/>
<text text-anchor="start" x="606" y="-97.8" font-family="Times,serif" font-size="14.00">1</text>
<polygon fill="none" stroke="black" points="628,-91 628,-112 765,-112 765,-91 628,-91"/>
<text text-anchor="start" x="638" y="-97.8" font-family="Times,serif" font-size="14.00">u1→HasherType</text>
<polygon fill="none" stroke="black" points="765,-91 765,-112 859,-112 859,-91 765,-91"/>
<text text-anchor="start" x="787.5" y="-97.8" font-family="Times,serif" font-size="14.00">hasher</text>
<polygon fill="none" stroke="black" points="563,-70 563,-91 859,-91 859,-70 563,-70"/>
<text text-anchor="start" x="599" y="-76.8" font-family="Times,serif" font-size="14.00">repeat num_hasher.value times</text>
<polygon fill="none" stroke="black" points="563,-49 563,-70 594,-70 594,-49 563,-49"/>
<text text-anchor="start" x="571.5" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="594,-49 594,-70 628,-70 628,-49 594,-49"/>
<text text-anchor="start" x="604" y="-55.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="628,-49 628,-70 765,-70 765,-49 628,-49"/>
<text text-anchor="start" x="631" y="-55.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="765,-49 765,-70 859,-70 859,-49 765,-49"/>
<text text-anchor="start" x="799.5" y="-55.8" font-family="Times,serif" font-size="14.00">key</text>
<polygon fill="none" stroke="black" points="563,-28 563,-49 594,-49 594,-28 563,-28"/>
<text text-anchor="start" x="571.5" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="594,-28 594,-49 628,-49 628,-28 594,-28"/>
<text text-anchor="start" x="604" y="-34.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="628,-28 628,-49 765,-49 765,-28 628,-28"/>
<text text-anchor="start" x="631" y="-34.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="765,-28 765,-49 859,-49 859,-28 765,-28"/>
<text text-anchor="start" x="792.5" y="-34.8" font-family="Times,serif" font-size="14.00">value</text>
</g>
<!-- storage_definition__seq_details_switch&#45;&gt;map__seq -->
<g id="edge3" class="edge">
<title>storage_definition__seq_details_switch:case1&#45;&gt;map__seq</title>
<path fill="none" stroke="black" stroke-width="2" d="M512,-139C522.76,-139 533.77,-138.32 544.8,-137.13"/>
<polygon fill="black" stroke="black" stroke-width="2" points="545.43,-140.57 554.94,-135.89 544.59,-133.63 545.43,-140.57"/>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 10. Runtime Pallet Storage Definition</div>
</div>
</div>
</div>
<div id="defn-rtm-storage-hasher" class="exampleblock">
<div class="title">Definition 168. <a href="#defn-rtm-storage-hasher">Storage Hasher</a></div>
<div class="content">
<div class="paragraph">
<p>The hashing algorithm used by storage maps.</p>
</div>
<div class="stemblock">
<div class="content">
\${
	(0,"128-bit Blake2 hash"),
	(1,"256-bit Blake2 hash"),
	(2,"Multiple 128-bit Blake2 hashes concatenated"),
	(3,"128-bit XX hash"),
	(4,"256-bit XX hash"),
	(5,"Multiple 64-bit XX hashes concatenated"),
	(6,"Identity hashing")
:}\$
</div>
</div>
</div>
</div>
<div id="defn-rtm-pallet-constants" class="exampleblock">
<div class="title">Definition 169. <a href="#defn-rtm-pallet-constants">Pallet Constants</a></div>
<div class="content">
<div class="paragraph">
<p>The metadata about the pallets constants.</p>
</div>
<div class="stemblock">
<div class="content">
\$c_i = (n, y, v, C)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is a string representing the name of the pallet constant.</p>
</li>
<li>
<p>\$y\$ is the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of the pallet constant.</p>
</li>
<li>
<p>\$v\$ is a byte array containing the value of the constant.</p>
</li>
<li>
<p>\$C\$ is an array of varying length containing string with the documentation.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="pallet_constant" class="imageblock">
<div class="content">
<svg width="304pt" height="177pt"
 viewBox="0.00 0.00 304.00 177.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 173)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-173 300,-173 300,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__pallet_constant</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-161 288,-161 288,-8 8,-8"/>
<text text-anchor="middle" x="148" y="-145.8" font-family="Times,serif" font-size="14.00">PalletConstant</text>
</g>
<!-- pallet_constant__seq -->
<g id="node1" class="node">
<title>pallet_constant__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24,-104 24,-125 55,-125 55,-104 24,-104"/>
<polygon fill="none" stroke="black" points="24,-104 24,-125 55,-125 55,-104 24,-104"/>
<text text-anchor="start" x="27" y="-110.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55,-104 55,-125 89,-125 89,-104 55,-104"/>
<polygon fill="none" stroke="black" points="55,-104 55,-125 89,-125 89,-104 55,-104"/>
<text text-anchor="start" x="58" y="-110.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89,-104 89,-125 226,-125 226,-104 89,-104"/>
<polygon fill="none" stroke="black" points="89,-104 89,-125 226,-125 226,-104 89,-104"/>
<text text-anchor="start" x="141.5" y="-110.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226,-104 226,-125 272,-125 272,-104 226,-104"/>
<polygon fill="none" stroke="black" points="226,-104 226,-125 272,-125 272,-104 226,-104"/>
<text text-anchor="start" x="242" y="-110.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-83 24,-104 55,-104 55,-83 24,-83"/>
<text text-anchor="start" x="34.5" y="-89.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55,-83 55,-104 89,-104 89,-83 55,-83"/>
<text text-anchor="start" x="65" y="-89.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-83 89,-104 226,-104 226,-83 89,-83"/>
<text text-anchor="start" x="111" y="-89.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="226,-83 226,-104 272,-104 272,-83 226,-83"/>
<text text-anchor="start" x="229" y="-89.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="24,-62 24,-83 55,-83 55,-62 24,-62"/>
<text text-anchor="start" x="32.5" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-62 55,-83 89,-83 89,-62 55,-62"/>
<text text-anchor="start" x="65" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-62 89,-83 226,-83 226,-62 89,-62"/>
<text text-anchor="start" x="92" y="-68.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226,-62 226,-83 272,-83 272,-62 226,-62"/>
<text text-anchor="start" x="233" y="-68.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="24,-41 24,-62 55,-62 55,-41 24,-41"/>
<text text-anchor="start" x="32.5" y="-47.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-41 55,-62 89,-62 89,-41 55,-41"/>
<text text-anchor="start" x="65" y="-47.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-41 89,-62 226,-62 226,-41 89,-41"/>
<text text-anchor="start" x="113.5" y="-47.8" font-family="Times,serif" font-size="14.00">Scale::Bytes</text>
<polygon fill="none" stroke="black" points="226,-41 226,-62 272,-62 272,-41 226,-41"/>
<text text-anchor="start" x="229.5" y="-47.8" font-family="Times,serif" font-size="14.00">value</text>
<polygon fill="none" stroke="black" points="24,-20 24,-41 55,-41 55,-20 24,-20"/>
<text text-anchor="start" x="32.5" y="-26.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-20 55,-41 89,-41 89,-20 55,-20"/>
<text text-anchor="start" x="65" y="-26.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-20 89,-41 226,-41 226,-20 89,-20"/>
<text text-anchor="start" x="97.5" y="-26.8" font-family="Times,serif" font-size="14.00">Scale::StringList</text>
<polygon fill="none" stroke="black" points="226,-20 226,-41 272,-41 272,-20 226,-20"/>
<text text-anchor="start" x="232.5" y="-26.8" font-family="Times,serif" font-size="14.00">docs</text>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 11. Pallet Constant Metadata</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-rtm-extrinsic-metadata"><a class="anchor" href="#sect-rtm-extrinsic-metadata"></a><a class="link" href="#sect-rtm-extrinsic-metadata">12.3. Extrinsic Metadata</a></h3>
<div class="paragraph">
<p>The metadata about a pallets extrinsics, part of the main structure
(<a href="#sect-rtm-structure">Section 12.1</a>) and of the following format:</p>
</div>
<div id="defn-rtm-signed-extension-metadata" class="exampleblock">
<div class="title">Definition 170. <a href="#defn-rtm-signed-extension-metadata">Signed Extension Metadata</a></div>
<div class="content">
<div class="paragraph">
<p>The metadata about the additional, signed data required to execute an extrinsic.</p>
</div>
<div class="stemblock">
<div class="content">
\$e_i = (n, y, a)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$n\$ is a string representing the unique signed extension identifier,
which may be different from the type name.</p>
</li>
<li>
<p>\$y\$ is a type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of the signed extension, with the
data to be included in the extrinsic.</p>
</li>
<li>
<p>\$a\$ is the type Id (<a href="#defn-rtm-type-id">Definition 160</a>) of the additional signed data,
with the data to be included in the signed payload.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="metadata_extrinsic" class="imageblock">
<div class="content">
<svg width="336pt" height="155pt"
 viewBox="0.00 0.00 336.00 155.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 332,-151 332,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster__metadata_extrinsic</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="8,-8 8,-139 320,-139 320,-8 8,-8"/>
<text text-anchor="middle" x="164" y="-123.8" font-family="Times,serif" font-size="14.00">MetadataExtrinsic</text>
</g>
<!-- metadata_extrinsic__seq -->
<g id="node1" class="node">
<title>metadata_extrinsic__seq</title>
<polygon fill="#e0ffe0" stroke="transparent" points="24,-83 24,-104 55,-104 55,-83 24,-83"/>
<polygon fill="none" stroke="black" points="24,-83 24,-104 55,-104 55,-83 24,-83"/>
<text text-anchor="start" x="27" y="-89.8" font-family="Times,serif" font-size="14.00">pos</text>
<polygon fill="#e0ffe0" stroke="transparent" points="55,-83 55,-104 89,-104 89,-83 55,-83"/>
<polygon fill="none" stroke="black" points="55,-83 55,-104 89,-104 89,-83 55,-83"/>
<text text-anchor="start" x="58" y="-89.8" font-family="Times,serif" font-size="14.00">size</text>
<polygon fill="#e0ffe0" stroke="transparent" points="89,-83 89,-104 226,-104 226,-83 89,-83"/>
<polygon fill="none" stroke="black" points="89,-83 89,-104 226,-104 226,-83 89,-83"/>
<text text-anchor="start" x="141.5" y="-89.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="#e0ffe0" stroke="transparent" points="226,-83 226,-104 304,-104 304,-83 226,-83"/>
<polygon fill="none" stroke="black" points="226,-83 226,-104 304,-104 304,-83 226,-83"/>
<text text-anchor="start" x="258" y="-89.8" font-family="Times,serif" font-size="14.00">id</text>
<polygon fill="none" stroke="black" points="24,-62 24,-83 55,-83 55,-62 24,-62"/>
<text text-anchor="start" x="34.5" y="-68.8" font-family="Times,serif" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="55,-62 55,-83 89,-83 89,-62 55,-62"/>
<text text-anchor="start" x="65" y="-68.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-62 89,-83 226,-83 226,-62 89,-62"/>
<text text-anchor="start" x="111" y="-68.8" font-family="Times,serif" font-size="14.00">Scale::String</text>
<polygon fill="none" stroke="black" points="226,-62 226,-83 304,-83 304,-62 226,-62"/>
<text text-anchor="start" x="245" y="-68.8" font-family="Times,serif" font-size="14.00">name</text>
<polygon fill="none" stroke="black" points="24,-41 24,-62 55,-62 55,-41 24,-41"/>
<text text-anchor="start" x="32.5" y="-47.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-41 55,-62 89,-62 89,-41 55,-41"/>
<text text-anchor="start" x="65" y="-47.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-41 89,-62 226,-62 226,-41 89,-41"/>
<text text-anchor="start" x="92" y="-47.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226,-41 226,-62 304,-62 304,-41 226,-41"/>
<text text-anchor="start" x="249" y="-47.8" font-family="Times,serif" font-size="14.00">type</text>
<polygon fill="none" stroke="black" points="24,-20 24,-41 55,-41 55,-20 24,-20"/>
<text text-anchor="start" x="32.5" y="-26.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="55,-20 55,-41 89,-41 89,-20 55,-20"/>
<text text-anchor="start" x="65" y="-26.8" font-family="Times,serif" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="89,-20 89,-41 226,-41 226,-20 89,-20"/>
<text text-anchor="start" x="92" y="-26.8" font-family="Times,serif" font-size="14.00">Scale::CompactInt</text>
<polygon fill="none" stroke="black" points="226,-20 226,-41 304,-41 304,-20 226,-20"/>
<text text-anchor="start" x="229" y="-26.8" font-family="Times,serif" font-size="14.00">additional</text>
</g>
</g>
</svg>

</div>
<div class="title">Binary Format 12. Runtime Extrinsic Metadata</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id-cryptography-encoding"><a class="anchor" href="#id-cryptography-encoding"></a><a class="link" href="#id-cryptography-encoding">Appendix A: Cryptography &amp; Encoding</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Appendix chapter containing various protocol details</p>
</div>
<div class="sect2">
<h3 id="chapter-crypto-algos"><a class="anchor" href="#chapter-crypto-algos"></a><a class="link" href="#chapter-crypto-algos">A.1. Cryptographic Algorithms</a></h3>
<div class="sect3">
<h4 id="sect-hash-functions"><a class="anchor" href="#sect-hash-functions"></a><a class="link" href="#sect-hash-functions">A.1.1. Hash Functions</a></h4>
<div class="sect4">
<h5 id="sect-blake2"><a class="anchor" href="#sect-blake2"></a><a class="link" href="#sect-blake2">A.1.1.1. BLAKE2</a></h5>
<div class="paragraph">
<p>BLAKE2 is a collection of cryptographic hash functions known for their high
speed. Their design closely resembles BLAKE which has been a finalist in the
SHA-3 competition.</p>
</div>
<div class="paragraph">
<p>Polkadot is using the Blake2b variant which is optimized for 64-bit platforms.
Unless otherwise specified, the Blake2b hash function with a 256-bit output is
used whenever Blake2b is invoked in this document. The detailed specification
and sample implementations of all variants of Blake2 hash functions can be found
in RFC 7693 [<a href="#saarinen_blake2_2015">1</a>].</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-randomness"><a class="anchor" href="#sect-randomness"></a><a class="link" href="#sect-randomness">A.1.2. Randomness</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sect-vrf"><a class="anchor" href="#sect-vrf"></a><a class="link" href="#sect-vrf">A.1.3. VRF</a></h4>
<div class="paragraph">
<p>A Verifiable Random Function (VRF) is a mathematical operation that takes some
input and produces a random number using a secret key along with a proof of
authenticity that this random number was generated using the submitter&#8217;s secret
key and the given input. The proof can be verified by any challenger to ensure
the random number generation is valid and has not been tampered with (for
example to the benfit of submitter).</p>
</div>
<div class="paragraph">
<p>In Polkadot, VRFs are used for the BABE block production lottery by
<a href="#algo-block-production-lottery">Algorithm 6</a>  and the parachain approval voting mechanism
(<a href="#sect-approval-voting">Section 8.5</a>). The VRF uses mechanism similar to algorithms introduced
in the following papers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://eprint.iacr.org/2017/099.pdf">Making NSEC5 Practical for DNSSEC</a> [<a href="#papadopoulos17">2</a>]</p>
</li>
<li>
<p><a href="https://blog.cloudflare.com/privacy-pass-the-math/#dleqproofs">DLEQ Proofs</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/id/draft-goldbe-vrf-01.html">Verifiable Random Functions (VRFs)</a> [<a href="#goldberg17">3</a>]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It essentially generates a deterministic elliptic curve based Schnorr
signature as a verifiable random value. The elliptic curve group used in the VRF
function is the Ristretto group specified in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://ristretto.group/" class="bare">ristretto.group/</a></p>
</li>
</ul>
</div>
<div id="defn-vrf-proof" class="exampleblock">
<div class="title">Definition 171. <a href="#defn-vrf-proof">VRF Proof</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>VRF proof</strong> proves the correctness for an associated VRF output. The VRF
proof, \$P\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$P = (C,S)\$
\$S = (b_0, ... b_31)\$
</div>
</div>
<div class="paragraph">
<p>where \$C\$ is the challenge and \$S\$ is the 32-byte Schnorr poof. Both
are expressed as Curve25519 scalars as defined in Definition
<a href="#defn-vrf-dleq-prove">Definition 172</a>.</p>
</div>
</div>
</div>
<div id="defn-vrf-dleq-prove" class="exampleblock">
<div class="title">Definition 172. <a href="#defn-vrf-dleq-prove"><code>DLEQ Prove</code></a></div>
<div class="content">
<div class="paragraph">
<p>The \$"dleq_prove"(t, i)\$ function creates a proof for a given input, \$i\$,
based on the provided transcript, \$T\$.</p>
</div>
<div class="paragraph">
<p>First:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 = "append"(t, "'proto-name'", "'DLEQProof'")\$
\$t_2 = "append"(t_1, "'vrf:h'", i)\$
</div>
</div>
<div class="paragraph">
<p>Then the witness scalar is calculated, \$s_w\$, where \$w\$ is the
32-byte secret seed used for nonce generation in the context of sr25519.</p>
</div>
<div class="stemblock">
<div class="content">
\$t_3 = "meta-AD"(t_2, "'proving\\00'", "more=False")\$
\$t_4 = "meta-AD"(t_3, w_l, "more=True")\$
\$t_5 = "KEY"(t_4, w, "more=False")\$
\$t_6 = "meta-AD"(t_5, "'rng'", "more=False")\$
\$t_7 = "KEY"(t_6, r, "more=False")\$
\$t_8 = "meta-AD"(t_7, e_(64), "more=False")\$
\$(phi, s_w) = "PRF"(t_8, "more=False")\$
</div>
</div>
<div class="paragraph">
<p>where \$w_l\$ is length of the witness, encoded as a 32-bit little-endian
integer. \$r\$ is a 32-byte array containing the secret witness scalar.</p>
</div>
<div class="stemblock">
<div class="content">
\$l_1 = "append"(t_2, "'vrf:R=g^r'", s_w)\$
\$l_2 = "append"(l_1, "'vrf:h^r'", s_i)\$
\$l_3 = "append"(l_2, "'vrf:pk'", s_p)\$
\$l_4 = "append"(l_3, "'vrf:h^sk'", "vrf"_o)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$s_i\$ is the compressed Ristretto point of the scalar input.</p>
</li>
<li>
<p>\$s_p\$ is the compressed Ristretto point of the public key.</p>
</li>
<li>
<p>\$s_w\$ is the compressed Ristretto point of the wittness:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the 64-byte challenge:</p>
</div>
<div class="stemblock">
<div class="content">
\$l_5 = "meta-AD"(l_4, "'prove'", "more=False")\$
\$l_6 = "meta-AD"(l_5, e_(64), "more=True")\$
\$C = "PRF"(l_6, "more=False")\$
</div>
</div>
<div class="paragraph">
<p>And the Schnorr proof:</p>
</div>
<div class="stemblock">
<div class="content">
\$S = s_w - (C * p)\$
</div>
</div>
<div class="paragraph">
<p>where \$p\$ is the secret key.</p>
</div>
</div>
</div>
<div id="defn-vrf-dleq-verify" class="exampleblock">
<div class="title">Definition 173. <a href="#defn-vrf-dleq-verify"><code>DLEQ Verify</code></a></div>
<div class="content">
<div class="paragraph">
<p>The \$"dleq_verify"(i, o, P, p_k)\$ function verifiers the VRF input,
\$i\$ against the output, \$o\$, with the associated proof
(<a href="#defn-vrf-proof">Definition 171</a>) and public key, \$p_k\$.</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 = "append"(t, "'proto-name'", "'DLEQProof'")\$
\$t_2 = "append"(t_1, "'vrf:h'", s_i)\$
\$t_3 = "append"(t_2, "'vrf:R=g^r'", R)\$
\$t_4 = "append"(t_3, "'vrf:h^r'", H)\$
\$t_5 = "append"(t_4, "'vrf:pk'", p_k)\$
\$t_6 = "append"(t_5, "'vrf:h^sk'", o)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$R\$ is calculated as:</p>
<div class="stemblock">
<div class="content">
\$R = C in P xx p_k + S in P + B\$
</div>
</div>
<div class="paragraph">
<p>where \$B\$ is the Ristretto basepoint.</p>
</div>
</li>
<li>
<p>\$H\$ is calculated as:</p>
<div class="stemblock">
<div class="content">
\$H = C in P xx o + S in P xx i\$
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The challenge is valid if \$C in P\$ equals \$y\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_7 = "meta-AD"(t_6, "'prove'", "more=False")\$
\$t_8 = "meta-AD"(t_7, e_(64), "more=True")\$
\$y = "PRF"(t_8, "more=False")\$
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="id-transcript"><a class="anchor" href="#id-transcript"></a><a class="link" href="#id-transcript">A.1.3.1. Transcript</a></h5>
<div class="paragraph">
<p>A VRF transcript serves as a domain-specific separator of cryptographic
protocols and is represented as a mathematical object, as defined by Merlin,
which defines how that object is generated and encoded. The usage of the
transcript is implementation specific, such as for certain mechanisms in the
Availability &amp; Validity chapter (<a href="#chapter-anv">Chapter 8</a>), and is therefore described in
more detail in those protocols. The input value used to initiate the
transcript is referred to as a <em>context</em> (<a href="#defn-vrf-context">Definition 174</a>).</p>
</div>
<div id="defn-vrf-context" class="exampleblock">
<div class="title">Definition 174. <a href="#defn-vrf-context">VRF Contex</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>VRF context</strong> is a constant byte array used to initiate VRF transcript. The VRF context is constant for all users of the VRF for the specific context for which the VRF function is used. Context prevents VRF values generated by the same nodes for other purposes to be reused for purposes not meant to. For example, the VRF context for BABE Production lottery defined in <a href="#sect-block-production-lottery">Section 5.2</a> is set to be "substrate-babe-vrf".</p>
</div>
</div>
</div>
<div id="defn-vrf-transcript" class="exampleblock">
<div class="title">Definition 175. <a href="#defn-vrf-transcript">VRF Transcript</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>transcript</strong>, or VRF transcript, is a STROBE object, \$"obj"\$, as defined
in the STROBE documentation, respectively section
<a href="https://strobe.sourceforge.io/specs/#object">"5. State of a STROBE object"</a>.</p>
</div>
<div class="stemblock">
<div class="content">
\$"obj" = ("st","pos","pos"_("begin"),I_0)\$
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The duplex state, \$"st"\$, is a 200-byte array created by the
<a href="https://keccak.team/keccak_specs_summary.html">keccak-f1600 sponge function</a> on
the <a href="https://strobe.sourceforge.io/specs/#object.initial">initial STROBE state</a>.
Specifically, <code>R</code> is of value <code>166</code> and <code>X.Y.Z</code> is of value <code>1.0.2</code>.</p>
</li>
<li>
<p>\$"pos"\$ has the initial value of <code>0</code>.</p>
</li>
<li>
<p>\$"pos"_("begin")\$ has the initial value of <code>0</code>.</p>
</li>
<li>
<p>\$I_0\$ has the initial value of <code>0</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, the <code>meta-AD</code> operation (<a href="#defn-strobe-operations">Definition 176</a>) (where <code>more=False</code>) is
used to add the protocol label <code>Merlin v1.0</code> to \$"obj"\$ followed by
<em>appending</em> (<a href="#sect-vrf-appending-messages">Section A.1.3.1.1</a>) label <code>dom-step</code> and its
corresponding context, \$ctx\$, resulting in the final transcript, \$T\$.</p>
</div>
<div class="stemblock">
<div class="content">
\$t = "meta-AD"(obj, "'Merlin v1.0'", "False")\$
\$T = "append"(t, "'dom-step'", "ctx")\$
</div>
</div>
<div class="paragraph">
<p>\$"ctx"\$ serves as an arbitrary identifier/separator and its value is
defined by the protocol specification individually. This transcript is treated
just like a STROBE object, wherein any operations (<a href="#defn-strobe-operations">Definition 176</a>)
on it modify the values such as \$"pos"\$ and \$"pos"_("begin")\$.</p>
</div>
<div class="paragraph">
<p>Formally, when creating a transcript we refer to it as \$"Transcript"(ctx)\$.</p>
</div>
</div>
</div>
<div id="defn-strobe-operations" class="exampleblock">
<div class="title">Definition 176. <a href="#defn-strobe-operations">STROBE Operations</a></div>
<div class="content">
<div class="paragraph">
<p>STROBE operations are described in the
<a href="https://strobe.sourceforge.io/specs/">STROBE specification</a>, respectively section
<a href="https://strobe.sourceforge.io/specs/#ops">"6. Strobe operations"</a>. Operations are
indicated by their corresponding bitfield, as described in section
<a href="https://strobe.sourceforge.io/specs/#ops.flags">"6.2. Operations and flags"</a> and
implemented as described in section
<a href="https://strobe.sourceforge.io/specs/#ops.impl">"7. Implementation of operations"</a></p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sect-vrf-appending-messages"><a class="anchor" href="#sect-vrf-appending-messages"></a><a class="link" href="#sect-vrf-appending-messages">Appending Messages</a></h6>
<div class="paragraph">
<p>Appending messages, or "data", to the transcript (<a href="#defn-vrf-transcript">Definition 175</a>) first
requires <code>meta-AD</code> operations for a given label of the messages, including the
size of the message, followed by an <code>AD</code> operation on the message itself. The
size of the message is a 4-byte, little-endian encoded integer.</p>
</div>
<div class="stemblock">
<div class="content">
\$T_0 = "meta-AD"(T, l, "False")\$
\$T_1 = "meta-AD"(T_0, m_l, "True")\$
\$T_2 = "AD"(T_1, m, "False")\$
</div>
</div>
<div class="paragraph">
<p>where \$T\$ is the transcript (<a href="#defn-vrf-transcript">Definition 175</a>), \$l\$ is the
given label and \$m\$ the message, respectively \$m_l\$ representing its
size. \$T_2\$ is the resulting transcript with the appended data. STROBE
operations are described in <a href="#defn-strobe-operations">Definition 176</a>.</p>
</div>
<div class="paragraph">
<p>Formally, when appending a message we refer to it as \$"append"(T, l, m)\$.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-cryptographic-keys"><a class="anchor" href="#sect-cryptographic-keys"></a><a class="link" href="#sect-cryptographic-keys">A.1.4. Cryptographic Keys</a></h4>
<div class="paragraph">
<p>Various types of keys are used in Polkadot to prove the identity of the actors
involved in the Polkadot Protocols. To improve the security of the users, each
key type has its own unique function and must be treated differently, as
described by this Section.</p>
</div>
<div id="defn-account-key" class="exampleblock">
<div class="title">Definition 177. <a href="#defn-account-key">Account Key</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Account key \$(sk^a,pk^a)\$</strong> is a key pair of type of either of the schemes in the following
table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. List of the public key scheme which can be used for an account key</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key Scheme</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sr25519</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schnorr signature on Ristretto compressed ed25519 points as implemented in TODO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ed25519</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ed25519 signature complies with [<a href="#josefsson_edwards-curve_2017">4</a>] except for the verification process which adhere to Ed25519 Zebra variant specified in [<a href="#devalence_ed25519zebra_2020">5</a>]. In short, the signature point is not assumed to be on in the prime ordered subgroup group. As such, the verifier must explicitly clear the cofactor during the course of verifying the signature equation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secp256k1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for outgoing transfer transactions.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An account key can be used to sign transactions among other accounts and
balance-related functions. There are two prominent subcategories of account keys
namely "stash keys" and "controller keys", each being used for a different
function. Keys defined in <a href="#defn-account-key">Definition 177</a>, <a href="#defn-stash-key">Definition 178</a>
and <a href="#defn-controller-key">Definition 179</a> are created and managed by the user independent of
the Polkadot implementation. The user notifies the network about the used keys
by submitting a transaction, as defined in
<a href="#sect-creating-controller-key">Section A.1.4.2</a> and <a href="#sect-certifying-keys">Section A.1.4.5</a>
respectively.</p>
</div>
</div>
</div>
<div id="defn-stash-key" class="exampleblock">
<div class="title">Definition 178. <a href="#defn-stash-key">Stash Key</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Stash key</strong> is a type of account key that holds funds bonded for staking
(described in <a href="#sect-staking-funds">Section A.1.4.1</a>) to a particular
controller key (defined in <a href="#defn-controller-key">Definition 179</a>). As a result, one may actively
participate with a stash key keeping the stash key offline in a secure location.
It can also be used to designate a Proxy account to vote in governance
proposals, as described in <a href="#sect-creating-controller-key">Section A.1.4.2</a>. The Stash
key holds the majority of the users’ funds and should neither be shared with
anyone, saved on an online device, nor used to submit extrinsics.</p>
</div>
</div>
</div>
<div id="defn-controller-key" class="exampleblock">
<div class="title">Definition 179. <a href="#defn-controller-key">Controller Key</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Controller key</strong> is a type of account key that acts on behalf of the Stash
account. It signs transactions that make decisions regarding the nomination and
the validation of the other keys. It is a key that will be in direct control of
a user and should mostly be kept offline, used to submit manual extrinsics. It
sets preferences like payout account and commission, as described in
<a href="#sect-controller-settings">Section A.1.4.4</a>. If used for a validator, it certifies the
session keys, as described in <a href="#sect-certifying-keys">Section A.1.4.5</a>. It only needs
the required funds to pay transaction fees [TODO: key needing fund needs to be
defined].</p>
</div>
</div>
</div>
<div id="defn-session-key" class="exampleblock">
<div class="title">Definition 180. <a href="#defn-session-key">Session Keys</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Session keys</strong> are short-lived keys that are used to authenticate validator
operations. Session keys are generated by the Polkadot Host and should be
changed regularly due to security reasons. Nonetheless, no validity period is
enforced by the Polkadot protocol on session keys. Various types of keys used by
the Polkadot Host are presented in <a href="#tabl-session-keys">Table 3</a>:</p>
</div>
<table id="tabl-session-keys" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. List of key schemes which are used for session keys depending on the protocol</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Key scheme</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GRANDPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ED25519</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BABE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SR25519</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">I’m Online</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SR25519</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parachain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SR25519</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Session keys must be accessible by certain Polkadot Host APIs defined in
Appendix <a href="#chap-host-api">Appendix B</a>. Session keys are <em>not</em> meant to control the
majority of the users’ funds and should only be used for their intended purpose.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-staking-funds"><a class="anchor" href="#sect-staking-funds"></a><a class="link" href="#sect-staking-funds">A.1.4.1. Holding and staking funds</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-creating-controller-key"><a class="anchor" href="#sect-creating-controller-key"></a><a class="link" href="#sect-creating-controller-key">A.1.4.2. Creating a Controller key</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-designating-proxy"><a class="anchor" href="#sect-designating-proxy"></a><a class="link" href="#sect-designating-proxy">A.1.4.3. Designating a proxy for voting</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-controller-settings"><a class="anchor" href="#sect-controller-settings"></a><a class="link" href="#sect-controller-settings">A.1.4.4. Controller settings</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-certifying-keys"><a class="anchor" href="#sect-certifying-keys"></a><a class="link" href="#sect-certifying-keys">A.1.4.5. Certifying keys</a></h5>
<div class="paragraph">
<p>Due to security considerations and Runtime upgrades, the session keys are
supposed to  be changed regularly. As such, the new session keys need to be
certified by a controller key before putting them in use. The controller only
needs to create a certificate by signing a session public key and broadcasting
this certificate via an extrinsic. [TODO: spec the detail of the data structure
of the certificate etc.]</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chapter-encoding"><a class="anchor" href="#chapter-encoding"></a><a class="link" href="#chapter-encoding">A.2. Auxiliary Encodings</a></h3>
<div id="defn-unix-time" class="exampleblock">
<div class="title">Definition 181. <a href="#defn-unix-time">Unix Time</a></div>
<div class="content">
<div class="paragraph">
<p>By <strong>Unix time</strong>, we refer to the unsigned, little-endian encoded 64-bit integer
which stores the number of <strong>milliseconds</strong> that have elapsed since the Unix
epoch, that is the time 00:00:00 UTC on 1 January 1970, minus leap seconds. Leap
seconds are ignored, and every day is treated as if it contained exactly 86’400
seconds.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-binary-enconding"><a class="anchor" href="#id-binary-enconding"></a><a class="link" href="#id-binary-enconding">A.2.1. Binary Enconding</a></h4>
<div id="defn-byte-sequence" class="exampleblock">
<div class="title">Definition 182. <a href="#defn-byte-sequence">Sequence of Bytes</a></div>
<div class="content">
<div class="paragraph">
<p>By a <strong>sequences of bytes</strong> or a <strong>byte array</strong>, \$b\$, of length
\$n\$, we refer to</p>
</div>
<div class="stemblock">
<div class="content">
\$b := (b_0, b_1, ..., b_{n - 1}) " such that " 0 &lt;= b_i &lt;= 255\$
</div>
</div>
<div class="paragraph">
<p>We define \$bbb B_n\$ to be the
<strong>set of all byte arrays of length \$n\$</strong>. Furthermore, we
define:</p>
</div>
<div class="stemblock">
<div class="content">
\$bbb B := uuu_(i=0)^infty bbb B_i\$
</div>
</div>
<div class="paragraph">
<p>We represent the concatenation of byte arrays
\$a :=(a_0, ..., a_n)\$ and
\$b :=(b_0, ..., b_m)\$ by:</p>
</div>
<div class="stemblock">
<div class="content">
\$a |\| b :=(a_0, ..., a_n, b_0, ..., b_m)\$
</div>
</div>
</div>
</div>
<div id="defn-bit-rep" class="exampleblock">
<div class="title">Definition 183. <a href="#defn-bit-rep">Bitwise Representation</a></div>
<div class="content">
<div class="paragraph">
<p>For a given byte \$0 &lt;= b &lt;= 255\$ the <strong>bitwise representation</strong> in bits \$b_i in {0, 1}\$ is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$b := b_7 ... b_0\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="stemblock">
<div class="content">
\$b = 2^7 b_7 + 2^6 b_6 + ... + 2^0 b_0\$
</div>
</div>
</div>
</div>
<div id="defn-little-endian" class="exampleblock">
<div class="title">Definition 184. <a href="#defn-little-endian">Little Endian</a></div>
<div class="content">
<div class="paragraph">
<p>By the <strong>little-endian</strong> representation of a non-negative integer, \$I\$,
represented as</p>
</div>
<div class="stemblock">
<div class="content">
\$I = (B_n ... B_0)_256\$
</div>
</div>
<div class="paragraph">
<p>in base 256, we refer to a byte array
\$B = (b_0, b_1, ..., b_n)\$ such that</p>
</div>
<div class="stemblock">
<div class="content">
\$b_i :=B_i\$
</div>
</div>
<div class="paragraph">
<p>Accordingly, we define the function \$sf "Enc"_(sf "LE")\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$sf "Enc"_(sf "LE"): bbb Z^+ -&gt; bbb B; (B_n ... B_0)_256 |-&gt; (B_{0,} B_1, ... , B_n)\$
</div>
</div>
</div>
</div>
<div id="defn-uint32" class="exampleblock">
<div class="title">Definition 185. <a href="#defn-uint32">UINT32</a></div>
<div class="content">
<div class="paragraph">
<p>By <strong>UINT32</strong> we refer to a non-negative integer stored in a byte array of
length \$4\$ using little-endian encoding format.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-scale-codec"><a class="anchor" href="#sect-scale-codec"></a><a class="link" href="#sect-scale-codec">A.2.2. SCALE Codec</a></h4>
<div class="paragraph">
<p>The Polkadot Host uses <em>Simple Concatenated Aggregate Little-Endian” (SCALE)
codec</em> to encode byte arrays as well as other data structures. SCALE provides a
canonical encoding to produce consistent hash values across their
implementation, including the Merkle hash proof for the State Storage.</p>
</div>
<div id="defn-scale-decoding" class="exampleblock">
<div class="title">Definition 186. <a href="#defn-scale-decoding">Decoding</a></div>
<div class="content">
<div class="paragraph">
<p>\$"Dec"_("SC")(d)\$ refers to the decoding of a blob of data. Since the SCALE codec is not
self-describing, it’s up to the decoder to validate whether the blob of data can
be deserialized into the given type or data structure.</p>
</div>
<div class="paragraph">
<p>It&#8217;s accepted behavior for the decoder to partially decode the blob of data.
Meaning, any additional data that does not fit into a datastructure can be
ignored.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Considering that the decoded data is never larger than the encoded
message, this information can serve as a way to validate values that can vary in
sizes, such as sequences (<a href="#defn-scale-list">Definition 192</a>). The decoder should strictly use
the size of the encoded data as an upper bound when decoding in order to prevent
denial of service attacks.
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="defn-scale-tuple" class="exampleblock">
<div class="title">Definition 187. <a href="#defn-scale-tuple">Tuple</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>SCALE codec</strong> for <strong>Tuple</strong>, \$T\$, such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$T := (A_1,... A_n)\$
</div>
</div>
<div class="paragraph">
<p>Where \$A_i\$’s are values of <strong>different types</strong>, is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(T) := "Enc"_("SC")(A_1) "||" "Enc"_("SC")(A_2) "||" ... "||" "Enc"_("SC")(A_n)\$
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In case of a tuple (or a structure), the knowledge of the shape of data is not
encoded even though it is necessary for decoding. The decoder needs to derive
that information from the context where the encoding/decoding is happening.</p>
</div>
<div id="defn-varrying-data-type" class="exampleblock">
<div class="title">Definition 188. <a href="#defn-varrying-data-type">Varying Data Type</a></div>
<div class="content">
<div class="paragraph">
<p>We define a <strong>varying data</strong> type to be an ordered set of data types.</p>
</div>
<div class="stemblock">
<div class="content">
\$cc T = {T_1, ..., T_n}\$
</div>
</div>
<div class="paragraph">
<p>A value \$A\$ of varying date type is a pair \$(A_("Type"),A_("Value"))\$
where \$A_("Type") = T_i\$ for some \$T_i in cc T\$ and
\$A_("Value")\$ is its value of type \$T_i\$, which can be empty. We
define \$"idx"(T_i) = i - 1\$, unless it is explicitly defined as another
value in the definition of a particular varying data type.</p>
</div>
<div class="paragraph">
<p>In particular, we define two specific varying data which are frequently used in
various part of Polkadot protocol: <em>Option</em> (<a href="#defn-option-type">Definition 190</a>) and <em>Result</em>
(<a href="#defn-result-type">Definition 191</a>).</p>
</div>
</div>
</div>
<div id="defn-scale-variable-type" class="exampleblock">
<div class="title">Definition 189. <a href="#defn-scale-variable-type">Encoding of Varying Data Type</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec for value \$A = (A_("Type"), A_("Value"))\$ of varying data
type \$cc T = {T_i, ... T_n}\$, formally referred to as
\$"Enc"_("SC")(A)\$ is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(A) := "Enc"_("SC")("idx"(A_("Type")) "||" "Enc"_("SC")(A_("Value")))\$
</div>
</div>
<div class="paragraph">
<p>Where \$"idx"\$ is a 8-bit integer determining the type of \$A\$. In
particular, for the optional type defined in <a href="#defn-varrying-data-type">Definition 188</a>, we
have:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")("None", phi) := 0_(bbb B_1)\$
</div>
</div>
<div class="paragraph">
<p>The SCALE codec does not encode the correspondence between the value and the
data type it represents; the decoder needs prior knowledge of such
correspondence to decode the data.</p>
</div>
</div>
</div>
<div id="defn-option-type" class="exampleblock">
<div class="title">Definition 190. <a href="#defn-option-type">Option Type</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Option</strong> type is a varying data type of \${"None",T_2}\$ which indicates if
data of \$T_2\$ type is available (referred to as <em>some</em> state) or not
(referred to as <em>empty</em>, <em>none</em> or <em>null</em> state). The presence of type <em>none</em>,
indicated by \$"idx"(T_("None")) = 0\$, implies that the data corresponding
to \$T_2\$ type is not available and contains no additional data. Where as
the presence of type \$T_2\$ indicated by \$"idx"(T_2) = 1\$ implies that
the data is available.</p>
</div>
</div>
</div>
<div id="defn-result-type" class="exampleblock">
<div class="title">Definition 191. <a href="#defn-result-type">Result Type</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Result</strong> type is a varying data type of \${T_1, T_2}\$ which is used to
indicate if a certain operation or function was executed successfully (referred
to as "ok" state) or not (referred to as "error" state). \$T_1\$ implies
success, \$T_2\$ implies failure. Both types can either contain additional
data or are defined as empty type otherwise.</p>
</div>
</div>
</div>
<div id="defn-scale-list" class="exampleblock">
<div class="title">Definition 192. <a href="#defn-scale-list">Sequence</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>SCALE codec</strong> for <strong>sequence</strong> \$S\$ such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$S := A_1, ... A_n\$
</div>
</div>
<div class="paragraph">
<p>where \$A_i\$’s are values of <strong>the same type</strong> (and the decoder is unable to
infer value of \$n\$ from the context) is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(S) := "Enc"_("SC")^("Len")(abs(S)) "||" "Enc"_("SC")(A_2) "||" ... "||" "Enc"_("SC")(A_n)\$
</div>
</div>
<div class="paragraph">
<p>where \$"Enc"_("SC")^("Len")\$ is defined in <a href="#defn-sc-len-encoding">Definition 198</a>.</p>
</div>
<div class="paragraph">
<p>In some cases, the length indicator \$"Enc"_("SC")^("Len")(abs(S))\$ is omitted
if the length of the sequence is fixed and known by the decoder upfront. Such
cases are explicitly stated by the definition of the corresponding type.</p>
</div>
</div>
</div>
<div id="defn-scale-dictionary" class="exampleblock">
<div class="title">Definition 193. <a href="#defn-scale-dictionary">Dictionary</a></div>
<div class="content">
<div class="paragraph">
<p>SCALE codec for <strong>dictionary</strong> or <strong>hashtable</strong> D with key-value pairs \$(k_i,
v_i)\$s such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$D := {(k_1, v_1), ... (k_n, v_n)}\$
</div>
</div>
<div class="paragraph">
<p>is defined the SCALE codec of \$D\$ as a sequence of key value pairs (as
tuples):</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(D) := "Enc"_("SC")^("Size")(abs(D)) "||" "Enc"_("SC")(k_1, v_1) "||"..."||" "Enc"_("SC")(k_n, v_n)\$
</div>
</div>
<div class="paragraph">
<p>where \$"Enc"_("SC")^("Size")\$ is encoded the same way as
\$"Enc"_("SC")^("Len")\$ but argument \$"Size"\$ refers to the number of
key-value pairs rather than the length.</p>
</div>
</div>
</div>
<div id="defn-scale-boolean" class="exampleblock">
<div class="title">Definition 194. <a href="#defn-scale-boolean">Boolean</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec for a <strong>boolean value</strong> \$b\$ defined as a byte as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC"): {"False", "True"} -&gt; bbb B_1\$
\$b -&gt; {(0, b="False"),(1, b="True"):}\$
</div>
</div>
</div>
</div>
<div id="defn-scale-string" class="exampleblock">
<div class="title">Definition 195. <a href="#defn-scale-string">String</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec for a <strong>string value</strong> is an encoded sequence
(<a href="#defn-scale-list">Definition 192</a>) consisting of UTF-8 encoded bytes.</p>
</div>
</div>
</div>
<div id="defn-scale-fixed-length" class="exampleblock">
<div class="title">Definition 196. <a href="#defn-scale-fixed-length">Fixed Length</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec, \$"Enc"_("SC")\$, for other types such as fixed length
integers not defined here otherwise, is equal to little endian encoding of those
values defined in <a href="#defn-little-endian">Definition 184</a>.</p>
</div>
</div>
</div>
<div id="defn-scale-empty" class="exampleblock">
<div class="title">Definition 197. <a href="#defn-scale-empty">Empty</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec, \$"Enc"_("SC")\$, for an empty type is defined to a byte
array of zero length and depicted as \$phi\$.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-sc-length-and-compact-encoding"><a class="anchor" href="#sect-sc-length-and-compact-encoding"></a><a class="link" href="#sect-sc-length-and-compact-encoding">A.2.2.1. Length and Compact Encoding</a></h5>
<div class="paragraph">
<p>SCALE Length encoding is used to encode integer numbers of variying sizes prominently in an encoding length of arrays:</p>
</div>
<div id="defn-sc-len-encoding" class="exampleblock">
<div class="title">Definition 198. <a href="#defn-sc-len-encoding">Length Encoding</a></div>
<div class="content">
<div class="paragraph">
<p><strong>SCALE Length encoding</strong>, \$"Enc"_("SC")^("Len")\$, also known as a <em>compact encoding</em>, of a non-negative number \$n\$ is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")^("Len"): bbb N -&gt; bbb B\$
\$n -&gt; b := {(l_1, 0 &lt;= n &lt; 2^6),(i_1 i_2, 2^6 &lt;= n &lt; 2^14),(j_1 j_2 j_3, 2^14 &lt;= n &lt; 2^30),(k_1 k_2 ... k_m, 2^30&lt;=n):}\$
</div>
</div>
<div class="paragraph">
<p>in where the least significant bits of the first byte of byte array b
are defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$l_1^1 l_1^0 = 00\$
\$i_1^1 i_1^0 = 01\$
\$j_1^1 j_1^0 = 10\$
\$k_1^1 k_1^0 = 11\$
</div>
</div>
<div class="paragraph">
<p>and the rest of the bits of \$b\$ store the value of \$n\$ in
little-endian format in base-2 as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$n := {
	(l_1^7 ... l_1^3 l_1^2, n &lt; 2^6),
	(i_2^7 ... i_2^0 i_1^7 .. i_1^2, 2^6 &lt;= n &lt; 2^14),
	(j_4^7 ... j_4^0 j_3^7 ... j_1^7 ... j_1^2, 2^14 &lt;= n &lt; 2^30),
	(k_2 + k_3 2^8 + k_4 2^(2 xx 8)+...+k_m2^((m-2)8),2^30 &lt;= n)
	:}\$
</div>
</div>
<div class="paragraph">
<p>such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$k_1^7 ... k_1^3 k_1^2 := m-4\$
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-hex-encoding"><a class="anchor" href="#id-hex-encoding"></a><a class="link" href="#id-hex-encoding">A.2.3. Hex Encoding</a></h4>
<div class="paragraph">
<p>Practically, it is more convenient and efficient to store and process data which
is stored in a byte array. On the other hand, the trie keys are broken into
4-bits nibbles. Accordingly, we need a method to encode sequences of 4-bits
nibbles into byte arrays canonically. To this aim, we define
hex encoding function \$"Enc" ("HE")("PK")\$ as follows:</p>
</div>
<div id="defn-hex-encoding" class="exampleblock">
<div class="title">Definition 199. <a href="#defn-hex-encoding">Hex Encoding</a></div>
<div class="content">
<div class="paragraph">
<p>Suppose that \$"PK" = (k_1, ... k_n)\$ is a sequence of nibbles, then:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("HE")("PK") := {("Nibbles"_4,-&gt;, bbb B),("PK" = (k_1, ... k_n),-&gt;,{((16k_1+k_2,...,16k_(2i-1)+k_(2i)),n=2i),((k_1,16k_2+k_3,...,16k_(2i)+k_(2i+1)),n = 2i+1):}):}\$
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chapter-genesis"><a class="anchor" href="#chapter-genesis"></a><a class="link" href="#chapter-genesis">A.3. Genesis State</a></h3>
<div class="paragraph">
<p>The genesis state is a set of key-value pairs representing the initial state of
the Polkadot state storage. It can be retrieved from
<a href="https://github.com/paritytech/polkadot/tree/master/node/service/chain-specs">the Polkadot
repository</a>. While each of those key-value pairs offers important identifiable
information to the Runtime, to the Polkadot Host they are a transparent set of
arbitrary chain- and network-dependent keys and values. The only exception to
this are the <code>:code</code> (<a href="#sect-loading-runtime-code">Section 2.6.2</a>) and <code>:heappages</code>
(<a href="#sect-memory-management">Section 2.6.3.1</a>) keys, which are used by the Polkadot Host to
initialize the WASM environment and its Runtime. The other keys and values are
unspecified and solely depend on the chain and respectively its corresponding
Runtime. On initialization the data should be inserted into the state storage
with the Host API (<a href="#sect-storage-set">Section B.2.1</a>).</p>
</div>
<div class="paragraph">
<p>As such, Polkadot does not define a formal genesis block. Nonetheless for the
compatibility reasons in several algorithms, the Polkadot Host defines the
<em>genesis header</em> (<a href="#defn-genesis-header">Definition 200</a>). By the abuse of terminology,
"genesis block" refers to the hypothetical parent of block number <em>1</em> which
holds genesis header as its header.</p>
</div>
<div id="defn-genesis-header" class="exampleblock">
<div class="title">Definition 200. <a href="#defn-genesis-header">Genesis Header</a></div>
<div class="content">
<div class="paragraph">
<p>The Polkadot genesis header is a data structure conforming to block header
format (<a href="#defn-block-header">Definition 10</a>). It contains the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Block header field</th>
<th class="tableblock halign-left valign-top">Genesis Header Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parent_hash</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>state_root</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merkle hash of the state storage trie (<a href="#defn-merkle-value">Definition 29</a>) after inserting the genesis state in it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extrinsics_root</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>digest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chapter-erasure-encoding"><a class="anchor" href="#chapter-erasure-encoding"></a><a class="link" href="#chapter-erasure-encoding">A.4. Erasure Encoding</a></h3>
<div class="sect3">
<h4 id="sect-erasure-encoding"><a class="anchor" href="#sect-erasure-encoding"></a><a class="link" href="#sect-erasure-encoding">A.4.1. Erasure Encoding</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Erasure Encoding has not been documented yet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-host-api"><a class="anchor" href="#chap-host-api"></a><a class="link" href="#chap-host-api">Appendix B: Host API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Description of the expected environment available for import by the Polkadot Runtime</p>
</div>
<div class="sect2">
<h3 id="id-preliminaries-4"><a class="anchor" href="#id-preliminaries-4"></a><a class="link" href="#id-preliminaries-4">B.1. Preliminaries</a></h3>
<div class="paragraph">
<p>The Polkadot Host API is a set of functions that the Polkadot Host
exposes to Runtime to access external functions needed for various
reasons, such as the Storage of the content, access and manipulation,
memory allocation, and also efficiency. The encoding of each data type
is specified or referenced in this section. If the encoding is not
mentioned, then the default Wasm encoding is used, such as little-endian
byte ordering for integers.</p>
</div>
<div id="defn-host-api-at-state" class="exampleblock">
<div class="title">Definition 201. <a href="#defn-host-api-at-state">Exposed Host API</a></div>
<div class="content">
<div class="paragraph">
<p>By \$"RE"_B\$ we refer to the API exposed by the Polkadot Host which
interact, manipulate and response based on the state storage whose state is set
at the end of the execution of block \$B\$.</p>
</div>
</div>
</div>
<div id="defn-runtime-pointer" class="exampleblock">
<div class="title">Definition 202. <a href="#defn-runtime-pointer">Runtime Pointer</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Runtime pointer</strong> type is an unsigned 32-bit integer representing a pointer
to data in memory. This pointer is the primary way to exchange data of
fixed/known size between the Runtime and Polkadot Host.</p>
</div>
</div>
</div>
<div id="defn-runtime-pointer-size" class="exampleblock">
<div class="title">Definition 203. <a href="#defn-runtime-pointer-size">Runtime Pointer Size</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Runtime pointer-size</strong> type is an unsigned 64-bit integer, representing two
consecutive integers. The least significant is <strong>Runtime pointer</strong> (<a href="#defn-runtime-pointer">Definition 202</a>).
The most significant provides the size of the data in bytes. This representation
is the primary way to exchange data of arbitrary/dynamic sizes between the
Runtime and the Polkadot Host.</p>
</div>
</div>
</div>
<div id="defn-lexicographic-ordering" class="exampleblock">
<div class="title">Definition 204. <a href="#defn-lexicographic-ordering">Lexicographic ordering</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Lexicographic ordering</strong> refers to the ascending ordering of bytes or byte
arrays, such as:</p>
</div>
<div class="stemblock">
<div class="content">
\$[0,0,2]&lt;[0,1,1]&lt;[1]&lt;[1,1,0]&lt;[2]&lt;[...]\$
</div>
</div>
<div class="paragraph">
<p>The functions are specified in each subsequent subsection for each category of
those functions.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-storage-api"><a class="anchor" href="#sect-storage-api"></a><a class="link" href="#sect-storage-api">B.2. Storage</a></h3>
<div class="paragraph">
<p>Interface for accessing the storage from within the runtime.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As of now, the storage API should silently ignore any keys that start
with the <code>:child_storage:default:</code> prefix. This applies to reading and writing.
If the function expects a return value, then <em>None</em> (<a href="#defn-option-type">Definition 190</a>)
should be returned. See
<a href="https://github.com/paritytech/substrate/issues/12461">substrate issue #12461</a>.
</td>
</tr>
</table>
</div>
<div id="defn-state-version" class="exampleblock">
<div class="title">Definition 205. <a href="#defn-state-version">State Version</a></div>
<div class="content">
<div class="paragraph">
<p>The state version, \$v\$, dictates how a merkle root should be constructed.
The datastructure is a varying type of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$v = {(0, "full values"),(1, "node hashes"):}\$
</div>
</div>
<div class="paragraph">
<p>where \$0\$ indicates that the values of the keys should be inserted into the
trie directly and \$1\$ makes use of "node hashes" when calculating the
merkle proof (<a href="#defn-hashed-subvalue">Definition 28</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-storage-set"><a class="anchor" href="#sect-storage-set"></a><a class="link" href="#sect-storage-set">B.2.1. <code>ext_storage_set</code></a></h4>
<div class="paragraph">
<p>Sets the value under a given key into storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype"><a class="anchor" href="#id-version-1-prototype"></a><a class="link" href="#id-version-1-prototype">B.2.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_set_version_1
	(param $key i64) (param $value i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the
value.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_get"><a class="anchor" href="#id-ext_storage_get"></a><a class="link" href="#id-ext_storage_get">B.2.2. <code>ext_storage_get</code></a></h4>
<div class="paragraph">
<p>Retrieves the value associated with the given key from storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-2"><a class="anchor" href="#id-version-1-prototype-2"></a><a class="link" href="#id-version-1-prototype-2">B.2.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_get_version_1
	(param $key i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the key.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) returning the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the value.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_read"><a class="anchor" href="#id-ext_storage_read"></a><a class="link" href="#id-ext_storage_read">B.2.3. <code>ext_storage_read</code></a></h4>
<div class="paragraph">
<p>Gets the given key from storage, placing the value into a buffer and
returning the number of bytes that the entry in storage has beyond the
offset.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-3"><a class="anchor" href="#id-version-1-prototype-3"></a><a class="link" href="#id-version-1-prototype-3">B.2.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_read_version_1
	(param $key i64) (param $value_out i64) (param $offset i32) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the key.</p>
</li>
<li>
<p><code>value_out</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the
buffer to which the value will be written to. This function will never write
more then the length of the buffer, even if the value’s length is bigger.</p>
</li>
<li>
<p><code>offset</code>: an u32 integer (typed as i32 due to wasm types) containing the offset beyond the value should be read
from.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) pointing to a SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing an unsigned 32-bit
integer representing the number of bytes left at supplied <code>offset</code>. Returns
<em>None</em> if the entry does not exists.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_clear"><a class="anchor" href="#id-ext_storage_clear"></a><a class="link" href="#id-ext_storage_clear">B.2.4. <code>ext_storage_clear</code></a></h4>
<div class="paragraph">
<p>Clears the storage of the given key and its value. Non-existent entries are
silently ignored.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-4"><a class="anchor" href="#id-version-1-prototype-4"></a><a class="link" href="#id-version-1-prototype-4">B.2.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_clear_version_1
	(param $key_data i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_exists"><a class="anchor" href="#id-ext_storage_exists"></a><a class="link" href="#id-ext_storage_exists">B.2.5. <code>ext_storage_exists</code></a></h4>
<div class="paragraph">
<p>Checks whether the given key exists in storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-5"><a class="anchor" href="#id-version-1-prototype-5"></a><a class="link" href="#id-version-1-prototype-5">B.2.5.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_exists_version_1
	(param $key_data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the key.</p>
</li>
<li>
<p><code>return</code>: an i32 integer value equal to <em>1</em> if the key exists or a value equal
to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_clear_prefix"><a class="anchor" href="#id-ext_storage_clear_prefix"></a><a class="link" href="#id-ext_storage_clear_prefix">B.2.6. <code>ext_storage_clear_prefix</code></a></h4>
<div class="paragraph">
<p>Clear the storage of each key/value pair where the key starts with the given
prefix.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-6"><a class="anchor" href="#id-version-1-prototype-6"></a><a class="link" href="#id-version-1-prototype-6">B.2.6.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_clear_prefix_version_1
	(param $prefix i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>prefix</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing
the prefix.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype"><a class="anchor" href="#id-version-2-prototype"></a><a class="link" href="#id-version-2-prototype">B.2.6.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_clear_prefix_version_2
	(param $prefix i64) (param $limit i64)
	(return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>prefix</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing
the prefix.</p>
</li>
<li>
<p><code>limit</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an <em>Option</em> type
(<a href="#defn-option-type">Definition 190</a>) containing an unsigned 32-bit integer indicating the
limit on how many keys should be deleted. No limit is applied if this is <em>None</em>.
Any keys created during the current block execution do not count towards the
limit.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the following variant, \$k\$:</p>
<div class="stemblock">
<div class="content">
\$k = {(0,-&gt; c),(1,-&gt; c):}\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> indicates that all keys of the child storage have been removed,
followed by the number of removed keys, \$c\$. The variant <em>1</em> indicates that
there are remaining keys, followed by the number of removed keys.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_append"><a class="anchor" href="#id-ext_storage_append"></a><a class="link" href="#id-ext_storage_append">B.2.7. <code>ext_storage_append</code></a></h4>
<div class="paragraph">
<p>Append the SCALE encoded value to a SCALE encoded sequence (<a href="#defn-scale-list">Definition 192</a>)
at the given key. This function assumes that the existing storage item is either
empty or a SCALE encoded sequence and that the value to append is also SCALE
encoded and of the same type as the items in the existing sequence.</p>
</div>
<div class="paragraph">
<p>To improve performance, this function is allowed to skip decoding the entire
SCALE encoded sequence and instead can just append the new item to the end of
the existing data and increment the length prefix \$"Enc"_("SC")^("Len")\$.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the storage item does not exist or is not SCALE encoded, the storage
item will be set to the specified value, represented as a SCALE encoded byte
array.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-7"><a class="anchor" href="#id-version-1-prototype-7"></a><a class="link" href="#id-version-1-prototype-7">B.2.7.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_append_version_1
	(param $key i64) (param $value i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) containing the
value to be appended.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_root"><a class="anchor" href="#id-ext_storage_root"></a><a class="link" href="#id-ext_storage_root">B.2.8. <code>ext_storage_root</code></a></h4>
<div class="paragraph">
<p>Compute the storage root.</p>
</div>
<div class="sect4">
<h5 id="sect-ext-storage-root-version-1"><a class="anchor" href="#sect-ext-storage-root-version-1"></a><a class="link" href="#sect-ext-storage-root-version-1">B.2.8.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_root_version_1
	(return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to a buffer containing
the 256-bit Blake2 storage root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sect-ext-storage-root-version-2"><a class="anchor" href="#sect-ext-storage-root-version-2"></a><a class="link" href="#sect-ext-storage-root-version-2">B.2.8.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_root_version_2
	(param $version i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the buffer containing the 256-bit Blake2 storage
root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-storage-changes-root"><a class="anchor" href="#sect-ext-storage-changes-root"></a><a class="link" href="#sect-ext-storage-changes-root">B.2.9. <code>ext_storage_changes_root</code></a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is not longer used and only exists for compatibility reasons.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-8"><a class="anchor" href="#id-version-1-prototype-8"></a><a class="link" href="#id-version-1-prototype-8">B.2.9.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_changes_root_version_1
	(param $parent_hash i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>parent_hash</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
SCALE encoded block hash.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an <em>Option</em> type
(<a href="#defn-option-type">Definition 190</a>) that&#8217;s always <em>None</em>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_storage_next_key"><a class="anchor" href="#id-ext_storage_next_key"></a><a class="link" href="#id-ext_storage_next_key">B.2.10. <code>ext_storage_next_key</code></a></h4>
<div class="paragraph">
<p>Get the next key in storage after the given one in lexicographic order
(<a href="#defn-lexicographic-ordering">Definition 204</a>). The key provided to this function may or may
not exist in storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-9"><a class="anchor" href="#id-version-1-prototype-9"></a><a class="link" href="#id-version-1-prototype-9">B.2.10.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_next_key_version_1
	(param $key i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the next key in
lexicographic order.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-storage-start-transaction"><a class="anchor" href="#sect-ext-storage-start-transaction"></a><a class="link" href="#sect-ext-storage-start-transaction">B.2.11. <code>ext_storage_start_transaction</code></a></h4>
<div class="paragraph">
<p>Start a new nested transaction. This allows to either commit or roll back all
changes that are made after this call. For every transaction there must be a
matching call to either <code>ext_storage_rollback_transaction</code>
(<a href="#sect-ext-storage-rollback-transaction">Section B.2.12</a>) or <code>ext_storage_commit_transaction</code>
(<a href="#sect-ext-storage-commit-transaction">Section B.2.13</a>). This is also effective for all values
manipulated using the child storage API (<a href="#sect-child-storage-api">Section B.3</a>). It&#8217;s legal
to call this function multiple times in a row.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is a low level API that is potentially dangerous as it can easily
result in unbalanced transactions. Runtimes should use high level storage
abstractions.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-10"><a class="anchor" href="#id-version-1-prototype-10"></a><a class="link" href="#id-version-1-prototype-10">B.2.11.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_start_transaction_version_1)</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-storage-rollback-transaction"><a class="anchor" href="#sect-ext-storage-rollback-transaction"></a><a class="link" href="#sect-ext-storage-rollback-transaction">B.2.12. <code>ext_storage_rollback_transaction</code></a></h4>
<div class="paragraph">
<p>Rollback the last transaction started by <code>ext_storage_start_transaction</code>
(<a href="#sect-ext-storage-start-transaction">Section B.2.11</a>). Any changes made during that
transaction are discarded. It&#8217;s legal to call this function multiple times in a
row.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Panics if <code>ext_storage_start_transaction</code>
(<a href="#sect-ext-storage-start-transaction">Section B.2.11</a>) was not called.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-11"><a class="anchor" href="#id-version-1-prototype-11"></a><a class="link" href="#id-version-1-prototype-11">B.2.12.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_rollback_transaction_version_1)</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-storage-commit-transaction"><a class="anchor" href="#sect-ext-storage-commit-transaction"></a><a class="link" href="#sect-ext-storage-commit-transaction">B.2.13. <code>ext_storage_commit_transaction</code></a></h4>
<div class="paragraph">
<p>Commit the last transaction started by <code>ext_storage_start_transaction</code>
(<a href="#sect-ext-storage-start-transaction">Section B.2.11</a>). Any changes made during that
transaction are committed to the main state. It&#8217;s legal to call this function
multiple times in a row.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Panics if <code>ext_storage_start_transaction</code>
(<a href="#sect-ext-storage-start-transaction">Section B.2.11</a>) was not called.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-12"><a class="anchor" href="#id-version-1-prototype-12"></a><a class="link" href="#id-version-1-prototype-12">B.2.13.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_storage_commit_transaction_version_1)</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-child-storage-api"><a class="anchor" href="#sect-child-storage-api"></a><a class="link" href="#sect-child-storage-api">B.3. Child Storage</a></h3>
<div class="paragraph">
<p>Interface for accessing the child storage from within the runtime.</p>
</div>
<div id="defn-child-storage-type" class="exampleblock">
<div class="title">Definition 206. <a href="#defn-child-storage-type">Child Storage</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Child storage</strong> key is a unprefixed location of the child trie in the main trie.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_set"><a class="anchor" href="#id-ext_default_child_storage_set"></a><a class="link" href="#id-ext_default_child_storage_set">B.3.1. <code>ext_default_child_storage_set</code></a></h4>
<div class="paragraph">
<p>Sets the value under a given key into the child storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-13"><a class="anchor" href="#id-version-1-prototype-13"></a><a class="link" href="#id-version-1-prototype-13">B.3.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_set_version_1
	(param $child_storage_key i64) (param $key i64) (param $value i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code> : a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the value.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_get"><a class="anchor" href="#id-ext_default_child_storage_get"></a><a class="link" href="#id-ext_default_child_storage_get">B.3.2. <code>ext_default_child_storage_get</code></a></h4>
<div class="paragraph">
<p>Retrieves the value associated with the given key from the child storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-14"><a class="anchor" href="#id-version-1-prototype-14"></a><a class="link" href="#id-version-1-prototype-14">B.3.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_get_version_1
	(param $child_storage_key i64) (param $key i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the value.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_read"><a class="anchor" href="#id-ext_default_child_storage_read"></a><a class="link" href="#id-ext_default_child_storage_read">B.3.3. <code>ext_default_child_storage_read</code></a></h4>
<div class="paragraph">
<p>Gets the given key from storage, placing the value into a buffer and returning
the number of bytes that the entry in storage has beyond the offset.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-15"><a class="anchor" href="#id-version-1-prototype-15"></a><a class="link" href="#id-version-1-prototype-15">B.3.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_read_version_1
	(param $child_storage_key i64) (param $key i64) (param $value_out i64)
	(param $offset i32) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value_out</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the buffer
to which the value will be written to. This function will never write more then
the length of the buffer, even if the value’s length is bigger.</p>
</li>
<li>
<p><code>offset</code>: an u32 integer (typed as i32 due to wasm types) containing the offset beyond the value should be read
from.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the number of bytes
written into the <strong>value_out</strong> buffer. Returns if the entry does not exists.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_clear"><a class="anchor" href="#id-ext_default_child_storage_clear"></a><a class="link" href="#id-ext_default_child_storage_clear">B.3.4. <code>ext_default_child_storage_clear</code></a></h4>
<div class="paragraph">
<p>Clears the storage of the given key and its value from the child storage.
Non-existent entries are silently ignored.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-16"><a class="anchor" href="#id-version-1-prototype-16"></a><a class="link" href="#id-version-1-prototype-16">B.3.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_clear_version_1
	(param $child_storage_key i64) (param $key i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_storage_kill"><a class="anchor" href="#id-ext_default_child_storage_storage_kill"></a><a class="link" href="#id-ext_default_child_storage_storage_kill">B.3.5. <code>ext_default_child_storage_storage_kill</code></a></h4>
<div class="paragraph">
<p>Clears an entire child storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-17"><a class="anchor" href="#id-version-1-prototype-17"></a><a class="link" href="#id-version-1-prototype-17">B.3.5.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_storage_kill_version_1
	(param $child_storage_key i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-2"><a class="anchor" href="#id-version-2-prototype-2"></a><a class="link" href="#id-version-2-prototype-2">B.3.5.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_storage_kill_version_2
	(param $child_storage_key i64) (param $limit i64)
	(return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>limit</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an <em>Option</em> type
(<a href="#defn-option-type">Definition 190</a>) containing an unsigned 32-bit integer indicating the
limit on how many keys should be deleted. No limit is applied if this is <em>None</em>.
Any keys created during the current block execution do not count towards the
limit.</p>
</li>
<li>
<p><code>return</code>: a value equal to <em>1</em> if all the keys of the child storage have been
deleted or a value equal to <em>0</em> if there are remaining keys.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-3-prototype"><a class="anchor" href="#id-version-3-prototype"></a><a class="link" href="#id-version-3-prototype">B.3.5.3. Version 3 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_storage_kill_version_3
	(param $child_storage_key i64) (param $limit i64)
	(return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>limit</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an <em>Option</em> type
(<a href="#defn-option-type">Definition 190</a>) containing an unsigned 32-bit integer indicating the
limit on how many keys should be deleted. No limit is applied if this is <em>None</em>.
Any keys created during the current block execution do not count towards the
limit.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the following variant, \$k\$:</p>
<div class="stemblock">
<div class="content">
\$k = {(0,-&gt; c),(1,-&gt; c):}\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> indicates that all keys of the child storage have been removed,
followed by the number of removed keys, \$c\$. The variant <em>1</em> indicates that
there are remaining keys, followed by the number of removed keys.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_exists"><a class="anchor" href="#id-ext_default_child_storage_exists"></a><a class="link" href="#id-ext_default_child_storage_exists">B.3.6. <code>ext_default_child_storage_exists</code></a></h4>
<div class="paragraph">
<p>Checks whether the given key exists in the child storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-18"><a class="anchor" href="#id-version-1-prototype-18"></a><a class="link" href="#id-version-1-prototype-18">B.3.6.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_exists_version_1
	(param $child_storage_key i64) (param $key i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>return</code>: an i32 integer value equal to <em>1</em> if the key exists or a value equal
to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_clear_prefix"><a class="anchor" href="#id-ext_default_child_storage_clear_prefix"></a><a class="link" href="#id-ext_default_child_storage_clear_prefix">B.3.7. <code>ext_default_child_storage_clear_prefix</code></a></h4>
<div class="paragraph">
<p>Clears the child storage of each key/value pair where the key starts with the
given prefix.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-19"><a class="anchor" href="#id-version-1-prototype-19"></a><a class="link" href="#id-version-1-prototype-19">B.3.7.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_clear_prefix_version_1
	(param $child_storage_key i64) (param $prefix i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>prefix</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
prefix.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-3"><a class="anchor" href="#id-version-2-prototype-3"></a><a class="link" href="#id-version-2-prototype-3">B.3.7.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_clear_prefix_version_2
	(param $child_storage_key i64) (param $prefix i64)
	(param $limit i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>prefix</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
prefix.</p>
</li>
<li>
<p><code>limit</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an <em>Option</em> type
(<a href="#defn-option-type">Definition 190</a>) containing an unsigned 32-bit integer indicating the
limit on how many keys should be deleted. No limit is applied if this is <em>None</em>.
Any keys created during the current block execution do not count towards the
limit.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the following variant, \$k\$:</p>
<div class="stemblock">
<div class="content">
\$k = {(0,-&gt; c),(1,-&gt; c):}\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> indicates that all keys of the child storage have been removed,
followed by the number of removed keys, \$c\$. The variant <em>1</em> indicates that
there are remaining keys, followed by the number of removed keys.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_root"><a class="anchor" href="#id-ext_default_child_storage_root"></a><a class="link" href="#id-ext_default_child_storage_root">B.3.8. <code>ext_default_child_storage_root</code></a></h4>
<div class="paragraph">
<p>Commits all existing operations and computes the resulting child storage
root.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-20"><a class="anchor" href="#id-version-1-prototype-20"></a><a class="link" href="#id-version-1-prototype-20">B.3.8.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_root_version_1
	(param $child_storage_key i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
SCALE encoded storage root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-4"><a class="anchor" href="#id-version-2-prototype-4"></a><a class="link" href="#id-version-2-prototype-4">B.3.8.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_root_version_2
	(param $child_storage_key i64) (param $version i32)
	(return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit Blake2 storage
root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_default_child_storage_next_key"><a class="anchor" href="#id-ext_default_child_storage_next_key"></a><a class="link" href="#id-ext_default_child_storage_next_key">B.3.9. <code>ext_default_child_storage_next_key</code></a></h4>
<div class="paragraph">
<p>Gets the next key in storage after the given one in lexicographic order
(<a href="#defn-lexicographic-ordering">Definition 204</a>).
The key provided to this function may or may not exist in storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-21"><a class="anchor" href="#id-version-1-prototype-21"></a><a class="link" href="#id-version-1-prototype-21">B.3.9.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_default_child_storage_next_key_version_1
	(param $child_storage_key i64) (param $key i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>child_storage_key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
child storage key (<a href="#defn-child-storage-type">Definition 206</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded as defined in <a href="#defn-option-type">Definition 190</a>
containing the next key in lexicographic order. Returns if the entry cannot be
found.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-crypto-api"><a class="anchor" href="#sect-crypto-api"></a><a class="link" href="#sect-crypto-api">B.4. Crypto</a></h3>
<div class="paragraph">
<p>Interfaces for working with crypto related types from within the runtime.</p>
</div>
<div id="defn-key-type-id" class="exampleblock">
<div class="title">Definition 207. <a href="#defn-key-type-id">Key Type Identifier</a></div>
<div class="content">
<div class="paragraph">
<p>Cryptographic keys are stored in separate key stores based on their intended use
case. The separate key stores are identified by a 4-byte ASCII <strong>key type
identifier</strong>. The following known types are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Table of known key type identifiers</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the controlling accounts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">babe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the Babe module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gran</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the Grandpa module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the ImOnline module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">audi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the AuthorityDiscovery module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">para</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the Parachain Validator Key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asgn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key type for the Parachain Assignment Key</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="defn-ecdsa-verify-error" class="exampleblock">
<div class="title">Definition 208. <a href="#defn-ecdsa-verify-error">ECDSA Verify Error</a></div>
<div class="content">
<div class="paragraph">
<p><strong>EcdsaVerifyError</strong> is a varying data type (<a href="#defn-varrying-data-type">Definition 188</a>) that
specifies the error type when using ECDSA recovery functionality. Following
values are possible:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Table of error types in ECDSA recovery</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incorrect value of R or S</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incorrect value of V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invalid signature</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ed25519_public_keys"><a class="anchor" href="#id-ext_crypto_ed25519_public_keys"></a><a class="link" href="#id-ext_crypto_ed25519_public_keys">B.4.1. <code>ext_crypto_ed25519_public_keys</code></a></h4>
<div class="paragraph">
<p>Returns all <em>ed25519</em> public keys for the given key identifier from the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-22"><a class="anchor" href="#id-version-1-prototype-22"></a><a class="link" href="#id-version-1-prototype-22">B.4.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ed25519_public_keys_version_1
	(param $key_type_id i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key type identifier
(<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an SCALE encoded
256-bit public keys.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ed25519_generate"><a class="anchor" href="#id-ext_crypto_ed25519_generate"></a><a class="link" href="#id-ext_crypto_ed25519_generate">B.4.2. <code>ext_crypto_ed25519_generate</code></a></h4>
<div class="paragraph">
<p>Generates an <em>ed25519</em> key for the given key type using an optional BIP-39 seed and stores
it in the keystore.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Panics if the key cannot be generated, such as when an invalid key type
or invalid seed was provided.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-23"><a class="anchor" href="#id-version-1-prototype-23"></a><a class="link" href="#id-version-1-prototype-23">B.4.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ed25519_generate_version_1
	(param $key_type_id i32) (param $seed i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key type identifier
(<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>seed</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE encoded
<em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the BIP-39 seed which must be
valid UTF8.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit public key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ed25519_sign"><a class="anchor" href="#id-ext_crypto_ed25519_sign"></a><a class="link" href="#id-ext_crypto_ed25519_sign">B.4.3. <code>ext_crypto_ed25519_sign</code></a></h4>
<div class="paragraph">
<p>Signs the given message with the <code>ed25519</code> key that corresponds to the given public key
and key type in the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-24"><a class="anchor" href="#id-version-1-prototype-24"></a><a class="link" href="#id-version-1-prototype-24">B.4.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ed25519_sign_version_1
	(param $key_type_id i32) (param $key i32) (param $msg i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key type identifier
(<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be signed.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the 64-byte signature.
This function returns if the public key cannot be found in the key store.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-ed25519-verify"><a class="anchor" href="#sect-ext-crypto-ed25519-verify"></a><a class="link" href="#sect-ext-crypto-ed25519-verify">B.4.4. <code>ext_crypto_ed25519_verify</code></a></h4>
<div class="paragraph">
<p>Verifies an <em>ed25519</em> signature.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-25"><a class="anchor" href="#id-version-1-prototype-25"></a><a class="link" href="#id-version-1-prototype-25">B.4.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ed25519_verify_version_1
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-byte signature.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal to <em>1</em> if the signature is valid or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-ed25519-batch-verify"><a class="anchor" href="#sect-ext-crypto-ed25519-batch-verify"></a><a class="link" href="#sect-ext-crypto-ed25519-batch-verify">B.4.5. <code>ext_crypto_ed25519_batch_verify</code></a></h4>
<div class="paragraph">
<p>Registers a ed25519 signature for batch verification. Batch verification is
enabled by calling <code>ext_crypto_start_batch_verify</code>
(<a href="#sect-ext-crypto-start-batch-verify">Section B.4.20</a>). The result of the verification is
returned by <code>ext_crypto_finish_batch_verify</code>
(<a href="#sect-ext-crypto-finish-batch-verify">Section B.4.21</a>). If batch verification is not enabled,
the signature is verified immediately.</p>
</div>
<div class="sect4">
<h5 id="id-version-1"><a class="anchor" href="#id-version-1"></a><a class="link" href="#id-version-1">B.4.5.1. Version 1</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ed25519_batch_verify_version_1
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-byte signature.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal to <em>1</em> if the signature is valid or
batched or a value equal <em>0</em> to if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_sr25519_public_keys"><a class="anchor" href="#id-ext_crypto_sr25519_public_keys"></a><a class="link" href="#id-ext_crypto_sr25519_public_keys">B.4.6. <code>ext_crypto_sr25519_public_keys</code></a></h4>
<div class="paragraph">
<p>Returns all <em>sr25519</em> public keys for the given key id from the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-26"><a class="anchor" href="#id-version-1-prototype-26"></a><a class="link" href="#id-version-1-prototype-26">B.4.6.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_sr25519_public_keys_version_1
	(param $key_type_id i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key type identifier
(<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
SCALE encoded 256-bit public keys.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_sr25519_generate"><a class="anchor" href="#id-ext_crypto_sr25519_generate"></a><a class="link" href="#id-ext_crypto_sr25519_generate">B.4.7. <code>ext_crypto_sr25519_generate</code></a></h4>
<div class="paragraph">
<p>Generates an <em>sr25519</em> key for the given key type using an optional BIP-39 seed
and stores it in the keystore.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Panics if the key cannot be generated, such as when an invalid key type
or invalid seed was provided.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-27"><a class="anchor" href="#id-version-1-prototype-27"></a><a class="link" href="#id-version-1-prototype-27">B.4.7.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_sr25519_generate_version_1
	(param $key_type_id i32) (param $seed i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key identifier (<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>seed</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE encoded
<em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the BIP-39 seed which must be
valid UTF8.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit public key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_sr25519_sign"><a class="anchor" href="#id-ext_crypto_sr25519_sign"></a><a class="link" href="#id-ext_crypto_sr25519_sign">B.4.8. <code>ext_crypto_sr25519_sign</code></a></h4>
<div class="paragraph">
<p>Signs the given message with the <em>sr25519</em> key that corresponds to the given
public key and key type in the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-28"><a class="anchor" href="#id-version-1-prototype-28"></a><a class="link" href="#id-version-1-prototype-28">B.4.8.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_sr25519_sign_version_1
	(param $key_type_id i32) (param $key i32) (param $msg i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key identifier (<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be signed.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the 64-byte signature.
This function returns <em>None</em> if the public key cannot be found in the key store.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-sr25519-verify"><a class="anchor" href="#sect-ext-crypto-sr25519-verify"></a><a class="link" href="#sect-ext-crypto-sr25519-verify">B.4.9. <code>ext_crypto_sr25519_verify</code></a></h4>
<div class="paragraph">
<p>Verifies an sr25519 signature.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-29"><a class="anchor" href="#id-version-1-prototype-29"></a><a class="link" href="#id-version-1-prototype-29">B.4.9.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_sr25519_verify_version_1
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-byte signature.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal to <em>1</em> if the signature is valid or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-5"><a class="anchor" href="#id-version-2-prototype-5"></a><a class="link" href="#id-version-2-prototype-5">B.4.9.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_sr25519_verify_version_2
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-byte signature.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal to <em>1</em> if the signature is valid or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-sr25519-batch-verify"><a class="anchor" href="#sect-ext-crypto-sr25519-batch-verify"></a><a class="link" href="#sect-ext-crypto-sr25519-batch-verify">B.4.10. <code>ext_crypto_sr25519_batch_verify</code></a></h4>
<div class="paragraph">
<p>Registers a sr25519 signature for batch verification. Batch verification is
enabled by calling <code>ext_crypto_start_batch_verify</code>
(<a href="#sect-ext-crypto-start-batch-verify">Section B.4.20</a>). The result of the verification is
returned by <code>ext_crypto_finish_batch_verify</code>
(<a href="#sect-ext-crypto-finish-batch-verify">Section B.4.21</a>). If batch verification is not enabled,
the signature is verified immediately.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-2"><a class="anchor" href="#id-version-1-2"></a><a class="link" href="#id-version-1-2">B.4.10.1. Version 1</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_sr25519_batch_verify_version_1
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-byte signature.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal to <em>1</em> if the signature is valid or
batched or a value equal <em>0</em> to if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ecdsa_public_keys"><a class="anchor" href="#id-ext_crypto_ecdsa_public_keys"></a><a class="link" href="#id-ext_crypto_ecdsa_public_keys">B.4.11. <code>ext_crypto_ecdsa_public_keys</code></a></h4>
<div class="paragraph">
<p>Returns all <em>ecdsa</em> public keys for the given key id from the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-30"><a class="anchor" href="#id-version-1-prototype-30"></a><a class="link" href="#id-version-1-prototype-30">B.4.11.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_public_key_version_1
	(param $key_type_id i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key type identifier (<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
SCALE encoded 33-byte compressed public keys.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ecdsa_generate"><a class="anchor" href="#id-ext_crypto_ecdsa_generate"></a><a class="link" href="#id-ext_crypto_ecdsa_generate">B.4.12. <code>ext_crypto_ecdsa_generate</code></a></h4>
<div class="paragraph">
<p>Generates an <em>ecdsa</em> key for the given key type using an optional BIP-39 seed
and stores it in the keystore.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Panics if the key cannot be generated, such as when an invalid key type
or invalid seed was provided.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-31"><a class="anchor" href="#id-version-1-prototype-31"></a><a class="link" href="#id-version-1-prototype-31">B.4.12.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_generate_version_1
	(param $key_type_id i32) (param $seed i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key identifier (<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>seed</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE encoded
<em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the BIP-39 seed which must be
valid UTF8.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 33-byte compressed
public key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ecdsa_sign"><a class="anchor" href="#id-ext_crypto_ecdsa_sign"></a><a class="link" href="#id-ext_crypto_ecdsa_sign">B.4.13. <code>ext_crypto_ecdsa_sign</code></a></h4>
<div class="paragraph">
<p>Signs the hash of the given message with the <em>ecdsa</em> key that corresponds to the
given public key and key type in the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-32"><a class="anchor" href="#id-version-1-prototype-32"></a><a class="link" href="#id-version-1-prototype-32">B.4.13.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_sign_version_1
	(param $key_type_id i32) (param $key i32) (param $msg i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the key identifier (<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 33-byte compressed public
key.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be signed.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the signature. The
signature is 65-bytes in size, where the first 512-bits represent the signature
and the other 8 bits represent the recovery ID. This function returns if the
public key cannot be found in the key store.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ecdsa_sign_prehashed"><a class="anchor" href="#id-ext_crypto_ecdsa_sign_prehashed"></a><a class="link" href="#id-ext_crypto_ecdsa_sign_prehashed">B.4.14. <code>ext_crypto_ecdsa_sign_prehashed</code></a></h4>
<div class="paragraph">
<p>Signs the prehashed message with the <em>ecdsa</em> key that corresponds to the given
public key and key type in the keystore.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-33"><a class="anchor" href="#id-version-1-prototype-33"></a><a class="link" href="#id-version-1-prototype-33">B.4.14.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_sign_prehashed_version_1
	(param $key_type_id i32) (param $key i32) (param $msg i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>key_type_id</code>: a pointer-size (<a href="#defn-runtime-pointer">Definition 202</a>) to the key identifier
(<a href="#defn-key-type-id">Definition 207</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 33-byte compressed public key.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be signed.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the signature. The
signature is 65-bytes in size, where the first 512-bits represent the signature
and the other 8 bits represent the recovery ID. This function returns if the
public key cannot be found in the key store.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-ecdsa-verify"><a class="anchor" href="#sect-ext-crypto-ecdsa-verify"></a><a class="link" href="#sect-ext-crypto-ecdsa-verify">B.4.15. <code>ext_crypto_ecdsa_verify</code></a></h4>
<div class="paragraph">
<p>Verifies the hash of the given message against a ECDSA signature.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-34"><a class="anchor" href="#id-version-1-prototype-34"></a><a class="link" href="#id-version-1-prototype-34">B.4.15.1. Version 1 - Prototype</a></h5>
<div class="paragraph">
<p>This function allows the verification of non-standard, overflowing ECDSA signatures, an
implemenation specific mechanism of the Rust
<a href="https://github.com/paritytech/libsecp256k1"><code>libsecp256k1</code> library</a>, specifically
the
<a href="https://docs.rs/libsecp256k1/0.7.0/libsecp256k1/struct.Signature.html#method.parse_overflowing"><code>parse_overflowing</code></a>
function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_verify_version_1
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature. The
signature is 65-bytes in size, where the first 512-bits represent the signature
and the other 8 bits represent the recovery ID.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 33-byte compressed public
key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal <em>1</em> to if the signature is valid or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-6"><a class="anchor" href="#id-version-2-prototype-6"></a><a class="link" href="#id-version-2-prototype-6">B.4.15.2. Version 2 - Prototype</a></h5>
<div class="paragraph">
<p>Does not allow the verification of non-standard, overflowing ECDSA signatures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_verify_version_2
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature. The
signature is 65-bytes in size, where the first 512-bits represent the signature
and the other 8 bits represent the recovery ID.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 33-byte compressed public
key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal <em>1</em> to if the signature is valid or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_ecdsa_verify_prehashed"><a class="anchor" href="#id-ext_crypto_ecdsa_verify_prehashed"></a><a class="link" href="#id-ext_crypto_ecdsa_verify_prehashed">B.4.16. <code>ext_crypto_ecdsa_verify_prehashed</code></a></h4>
<div class="paragraph">
<p>Verifies the prehashed message against a ECDSA signature.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-35"><a class="anchor" href="#id-version-1-prototype-35"></a><a class="link" href="#id-version-1-prototype-35">B.4.16.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_verify_prehashed_version_1
	(param $sig i32) (param $msg i32) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature. The
signature is 65-bytes in size, where the first 512-bits represent the signature
and the other 8 bits represent the recovery ID.</p>
</li>
<li>
<p><code>msg</code>: a pointer to the 32-bit prehashed message to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the 33-byte compressed public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal <em>1</em> to if the signature is valid or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-ecdsa-batch-verify"><a class="anchor" href="#sect-ext-crypto-ecdsa-batch-verify"></a><a class="link" href="#sect-ext-crypto-ecdsa-batch-verify">B.4.17. <code>ext_crypto_ecdsa_batch_verify</code></a></h4>
<div class="paragraph">
<p>Registers a ECDSA signature for batch verification. Batch verification is
enabled by calling <code>ext_crypto_start_batch_verify</code>
(<a href="#sect-ext-crypto-start-batch-verify">Section B.4.20</a>). The result of the verification is
returned by <code>ext_crypto_finish_batch_verify</code>
(<a href="#sect-ext-crypto-finish-batch-verify">Section B.4.21</a>). If batch verification is not enabled,
the signature is verified immediately.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-3"><a class="anchor" href="#id-version-1-3"></a><a class="link" href="#id-version-1-3">B.4.17.1. Version 1</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_ecdsa_batch_verify_version_1
	(param $sig i32) (param $msg i64) (param $key i32) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-byte signature.</p>
</li>
<li>
<p><code>msg</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
message that is to be verified.</p>
</li>
<li>
<p><code>key</code>: a pointer to the buffer containing the 256-bit public key.</p>
</li>
<li>
<p><code>return</code>: a i32 integer value equal to <em>1</em> if the signature is valid or
batched or a value equal <em>0</em> to if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_secp256k1_ecdsa_recover"><a class="anchor" href="#id-ext_crypto_secp256k1_ecdsa_recover"></a><a class="link" href="#id-ext_crypto_secp256k1_ecdsa_recover">B.4.18. <code>ext_crypto_secp256k1_ecdsa_recover</code></a></h4>
<div class="paragraph">
<p>Verify and recover a <em>secp256k1</em> ECDSA signature.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-36"><a class="anchor" href="#id-version-1-prototype-36"></a><a class="link" href="#id-version-1-prototype-36">B.4.18.1. Version 1 - Prototype</a></h5>
<div class="paragraph">
<p>This function can handle non-standard, overflowing ECDSA signatures, an
implemenation specific mechanism of the Rust
<a href="https://github.com/paritytech/libsecp256k1"><code>libsecp256k1</code> library</a>, specifically
the
<a href="https://docs.rs/libsecp256k1/0.7.0/libsecp256k1/struct.Signature.html#method.parse_overflowing"><code>parse_overflowing</code></a>
function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_secp256k1_ecdsa_recover_version_1
	(param $sig i32) (param $msg i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature in RSV
format. V should be either <code>0/1</code> or <code>27/28</code>.</p>
</li>
<li>
<p><code>msg</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit Blake2 hash of
the message.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> (<a href="#defn-result-type">Definition 191</a>). On success it contains the 64-byte
recovered public key or an error type (<a href="#defn-ecdsa-verify-error">Definition 208</a>) on failure.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-7"><a class="anchor" href="#id-version-2-prototype-7"></a><a class="link" href="#id-version-2-prototype-7">B.4.18.2. Version 2 - Prototype</a></h5>
<div class="paragraph">
<p>Does not handle non-standard, overflowing ECDSA signatures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_secp256k1_ecdsa_recover_version_2
	(param $sig i32) (param $msg i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature in RSV
format. V should be either or .</p>
</li>
<li>
<p><code>msg</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit Blake2 hash of
the message.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> (<a href="#defn-result-type">Definition 191</a>). On success it contains the 64-byte
recovered public key or an error type (<a href="#defn-ecdsa-verify-error">Definition 208</a>) on failure.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_crypto_secp256k1_ecdsa_recover_compressed"><a class="anchor" href="#id-ext_crypto_secp256k1_ecdsa_recover_compressed"></a><a class="link" href="#id-ext_crypto_secp256k1_ecdsa_recover_compressed">B.4.19. <code>ext_crypto_secp256k1_ecdsa_recover_compressed</code></a></h4>
<div class="paragraph">
<p>Verify and recover a <em>secp256k1</em> ECDSA signature.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-37"><a class="anchor" href="#id-version-1-prototype-37"></a><a class="link" href="#id-version-1-prototype-37">B.4.19.1. Version 1 - Prototype</a></h5>
<div class="paragraph">
<p>This function can handle non-standard, overflowing ECDSA signatures, an
implemenation specific mechanism of the Rust
<a href="https://github.com/paritytech/libsecp256k1"><code>libsecp256k1</code> library</a>, specifically
the
<a href="https://docs.rs/libsecp256k1/0.7.0/libsecp256k1/struct.Signature.html#method.parse_overflowing"><code>parse_overflowing</code></a>
function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_secp256k1_ecdsa_recover_compressed_version_1
	(param $sig i32) (param $msg i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature in RSV
format. V should be either <code>0/1</code> or <code>27/28</code>.</p>
</li>
<li>
<p><code>msg</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit Blake2 hash of
the message.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <code>Result</code> value (<a href="#defn-result-type">Definition 191</a>). On success it contains the
33-byte recovered public key in compressed form on success or an error type
(<a href="#defn-ecdsa-verify-error">Definition 208</a>) on failure.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-8"><a class="anchor" href="#id-version-2-prototype-8"></a><a class="link" href="#id-version-2-prototype-8">B.4.19.2. Version 2 - Prototype</a></h5>
<div class="paragraph">
<p>Does not handle non-standard, overflowing ECDSA signatures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_secp256k1_ecdsa_recover_compressed_version_2
	(param $sig i32) (param $msg i32) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>sig</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 65-byte signature in RSV
format. V should be either <code>0/1</code> or <code>27/28</code>.</p>
</li>
<li>
<p><code>msg</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit Blake2 hash of
the message.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <code>Result</code> value (<a href="#defn-result-type">Definition 191</a>). On success it contains the
33-byte recovered public key in compressed form on success or an error type
(<a href="#defn-ecdsa-verify-error">Definition 208</a>) on failure.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-start-batch-verify"><a class="anchor" href="#sect-ext-crypto-start-batch-verify"></a><a class="link" href="#sect-ext-crypto-start-batch-verify">B.4.20. <code>ext_crypto_start_batch_verify</code></a></h4>
<div class="paragraph">
<p>Starts the verification extension. The extension is a separate background
process and is used to parallel-verify signatures which are pushed to the batch
with
<code>ext_crypto_ed25519_batch_verify</code>(<a href="#sect-ext-crypto-ed25519-batch-verify">Section B.4.5</a>),
<code>ext_crypto_sr25519_batch_verify</code> (<a href="#sect-ext-crypto-sr25519-batch-verify">Section B.4.10</a>) or
<code>ext_crypto_ecdsa_batch_verify</code> (<a href="#sect-ext-crypto-ecdsa-batch-verify">Section B.4.17</a>).
Verification will start immediately and the Runtime can retrieve the result when
calling <code>ext_crypto_finish_batch_verify</code>
(<a href="#sect-ext-crypto-finish-batch-verify">Section B.4.21</a>).</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-38"><a class="anchor" href="#id-version-1-prototype-38"></a><a class="link" href="#id-version-1-prototype-38">B.4.20.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_start_batch_verify_version_1)</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-crypto-finish-batch-verify"><a class="anchor" href="#sect-ext-crypto-finish-batch-verify"></a><a class="link" href="#sect-ext-crypto-finish-batch-verify">B.4.21. <code>ext_crypto_finish_batch_verify</code></a></h4>
<div class="paragraph">
<p>Finish verifying the batch of signatures since the last call to this function.
Blocks until all the signatures are verified.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Panics if <code>ext_crypto_start_batch_verify</code>
(<a href="#sect-ext-crypto-start-batch-verify">Section B.4.20</a>) was not called.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-39"><a class="anchor" href="#id-version-1-prototype-39"></a><a class="link" href="#id-version-1-prototype-39">B.4.21.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_crypto_finish_batch_verify_version_1
	(return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>return</code>: an i32 integer value equal to <em>1</em> if all the signatures are valid or
a value equal to <em>0</em> if one or more of the signatures are invalid.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-hashing-api"><a class="anchor" href="#sect-hashing-api"></a><a class="link" href="#sect-hashing-api">B.5. Hashing</a></h3>
<div class="paragraph">
<p>Interface that provides functions for hashing with different algorithms.</p>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_keccak_256"><a class="anchor" href="#id-ext_hashing_keccak_256"></a><a class="link" href="#id-ext_hashing_keccak_256">B.5.1. <code>ext_hashing_keccak_256</code></a></h4>
<div class="paragraph">
<p>Conducts a 256-bit Keccak hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-40"><a class="anchor" href="#id-version-1-prototype-40"></a><a class="link" href="#id-version-1-prototype-40">B.5.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_keccak_256_version_1
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_keccak_512"><a class="anchor" href="#id-ext_hashing_keccak_512"></a><a class="link" href="#id-ext_hashing_keccak_512">B.5.2. <code>ext_hashing_keccak_512</code></a></h4>
<div class="paragraph">
<p>Conducts a 512-bit Keccak hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-41"><a class="anchor" href="#id-version-1-prototype-41"></a><a class="link" href="#id-version-1-prototype-41">B.5.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_keccak_512_version_1
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 512-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_sha2_256"><a class="anchor" href="#id-ext_hashing_sha2_256"></a><a class="link" href="#id-ext_hashing_sha2_256">B.5.3. <code>ext_hashing_sha2_256</code></a></h4>
<div class="paragraph">
<p>Conducts a 256-bit Sha2 hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-42"><a class="anchor" href="#id-version-1-prototype-42"></a><a class="link" href="#id-version-1-prototype-42">B.5.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_sha2_256_version_1
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_blake2_128"><a class="anchor" href="#id-ext_hashing_blake2_128"></a><a class="link" href="#id-ext_hashing_blake2_128">B.5.4. <code>ext_hashing_blake2_128</code></a></h4>
<div class="paragraph">
<p>Conducts a 128-bit Blake2 hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-43"><a class="anchor" href="#id-version-1-prototype-43"></a><a class="link" href="#id-version-1-prototype-43">B.5.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_blake2_128_version_1
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 128-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_blake2_256"><a class="anchor" href="#id-ext_hashing_blake2_256"></a><a class="link" href="#id-ext_hashing_blake2_256">B.5.5. <code>ext_hashing_blake2_256</code></a></h4>
<div class="paragraph">
<p>Conducts a 256-bit Blake2 hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-44"><a class="anchor" href="#id-version-1-prototype-44"></a><a class="link" href="#id-version-1-prototype-44">B.5.5.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_blake2_256_version_1
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_twox_64"><a class="anchor" href="#id-ext_hashing_twox_64"></a><a class="link" href="#id-ext_hashing_twox_64">B.5.6. <code>ext_hashing_twox_64</code></a></h4>
<div class="paragraph">
<p>Conducts a 64-bit xxHash hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-45"><a class="anchor" href="#id-version-1-prototype-45"></a><a class="link" href="#id-version-1-prototype-45">B.5.6.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_twox_64_version_1
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 64-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_twox_128"><a class="anchor" href="#id-ext_hashing_twox_128"></a><a class="link" href="#id-ext_hashing_twox_128">B.5.7. <code>ext_hashing_twox_128</code></a></h4>
<div class="paragraph">
<p>Conducts a 128-bit xxHash hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-46"><a class="anchor" href="#id-version-1-prototype-46"></a><a class="link" href="#id-version-1-prototype-46">B.5.7.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_twox_128
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 128-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_hashing_twox_256"><a class="anchor" href="#id-ext_hashing_twox_256"></a><a class="link" href="#id-ext_hashing_twox_256">B.5.8. <code>ext_hashing_twox_256</code></a></h4>
<div class="paragraph">
<p>Conducts a 256-bit xxHash hash.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-47"><a class="anchor" href="#id-version-1-prototype-47"></a><a class="link" href="#id-version-1-prototype-47">B.5.8.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_hashing_twox_256
	(param $data i64) (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the data
to be hashed.</p>
</li>
<li>
<p><code>return</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit hash result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-offchain-api"><a class="anchor" href="#sect-offchain-api"></a><a class="link" href="#sect-offchain-api">B.6. Offchain</a></h3>
<div class="paragraph">
<p>The Offchain Workers allow the execution of long-running and possibly
non-deterministic tasks (e.g. web requests, encryption/decryption and signing of
data, random number generation, CPU-intensive computations,
enumeration/aggregation of on-chain data, etc.) which could otherwise require
longer than the block execution time. Offchain Workers have their own execution
environment. This separation of concerns is to make sure that the block
production is not impacted by the long-running tasks.</p>
</div>
<div class="paragraph">
<p>All data and results generated by Offchain workers are unique per node and
nondeterministic. Information can be propagated to other nodes by submitting a
transaction that should be included in the next block. As Offchain workers runs
on their own execution environment they have access to their own separate
storage. There are two different types of storage available which are defined in
<a href="#defn-offchain-persistent-storage">Definition 209</a> and <a href="#defn-offchain-local-storage">Definition 210</a>.</p>
</div>
<div id="defn-offchain-persistent-storage" class="exampleblock">
<div class="title">Definition 209. <a href="#defn-offchain-persistent-storage">Persisted Storage</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Persistent storage</strong> is non-revertible and not fork-aware. It means that any value
set by the offchain worker is persisted even if that block (at which the worker
is called) is reverted as non-canonical (meaning that the block was surpassed by
a longer chain). The value is available for the worker that is re-run at the new
(different block with the same block number) and future blocks. This storage can
be used by offchain workers to handle forks and coordinate offchain workers
running on different forks.</p>
</div>
</div>
</div>
<div id="defn-offchain-local-storage" class="exampleblock">
<div class="title">Definition 210. <a href="#defn-offchain-local-storage">Local Storage</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Local storage</strong> is revertible and fork-aware. It means that any value set by the
offchain worker triggered at a certain block is reverted if that block is
reverted as non-canonical. The value is NOT available for the worker that is
re-run at the next or any future blocks.</p>
</div>
</div>
</div>
<div id="defn-http-status-code" class="exampleblock">
<div class="title">Definition 211. <a href="#defn-http-status-code">HTTP Status Code</a></div>
<div class="content">
<div class="paragraph">
<p><strong>HTTP status codes</strong> that can get returned by certain Offchain HTTP functions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: the specified request identifier is invalid.</p>
</li>
<li>
<p><code>10</code>: the deadline for the started request was reached.</p>
</li>
<li>
<p><code>20</code>: an error has occurred during the request, e.g. a timeout or the remote
server has closed the connection. On returning this error code, the request is
considered destroyed and must be reconstructed again.</p>
</li>
<li>
<p><code>100</code>-<code>999</code>: the request has finished with the given HTTP status code.</p>
</li>
</ul>
</div>
</div>
</div>
<div id="defn-http-error" class="exampleblock">
<div class="title">Definition 212. <a href="#defn-http-error">HTTP Error</a></div>
<div class="content">
<div class="paragraph">
<p>HTTP error, \$E\$, is a varying data type (<a href="#defn-varrying-data-type">Definition 188</a>) and
specifies the error types of certain HTTP functions. Following values are
possible:</p>
</div>
<div class="stemblock">
<div class="content">
\$E = {(0,"The deadile was reached"),(1,"There was an IO error while processing the request"),(2,"The Id of the request is invalid"):}\$
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_is_validator"><a class="anchor" href="#id-ext_offchain_is_validator"></a><a class="link" href="#id-ext_offchain_is_validator">B.6.1. <code>ext_offchain_is_validator</code></a></h4>
<div class="paragraph">
<p>Check whether the local node is a potential validator. Even if this function
returns <em>1</em>, it does not mean that any keys are configured or that the validator
is registered in the chain.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-48"><a class="anchor" href="#id-version-1-prototype-48"></a><a class="link" href="#id-version-1-prototype-48">B.6.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_is_validator_version_1 (return i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>return</code>: a i32 integer which is equal to <em>1</em> if the local node is a potential
validator or a integer equal to <em>0</em> if it is not.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-ext-offchain-submit-transaction"><a class="anchor" href="#sect-ext-offchain-submit-transaction"></a><a class="link" href="#sect-ext-offchain-submit-transaction">B.6.2. <code>ext_offchain_submit_transaction</code></a></h4>
<div class="paragraph">
<p>Given a SCALE encoded extrinsic, this function submits the extrinsic to the
Host&#8217;s transaction pool, ready to be propagated to remote peers.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-49"><a class="anchor" href="#id-version-1-prototype-49"></a><a class="link" href="#id-version-1-prototype-49">B.6.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_submit_transaction_version_1
	(param $data i64) (return i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the byte array
storing the encoded extrinsic.</p>
</li>
<li>
<p><code>return</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> value (<a href="#defn-result-type">Definition 191</a>). Neither on success or failure is
there any additional data provided. The cause of a failure is implementation
specific.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_network_state"><a class="anchor" href="#id-ext_offchain_network_state"></a><a class="link" href="#id-ext_offchain_network_state">B.6.3. <code>ext_offchain_network_state</code></a></h4>
<div class="paragraph">
<p>Returns the SCALE encoded, opaque information about the local node&#8217;s network state.</p>
</div>
<div id="defn-opaque-network-state" class="exampleblock">
<div class="title">Definition 213. <a href="#defn-opaque-network-state">Opaque Network State</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Opaque network state structure</strong>, \$S\$, is a SCALE encoded blob holding
information about the the <em>libp2p PeerId</em>, \$P_("id")\$, of the local node
and a list of <em>libp2p Multiaddresses</em>, \$(M_0, ... M_n)\$, the node knows it
can be reached at:</p>
</div>
<div class="stemblock">
<div class="content">
\$S = (P_("id"),(M_0, ... M_n))\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="stemblock">
<div class="content">
\$P_("id") = (b_0,... b_n)
M = (b_0, ... b_n)\$
</div>
</div>
<div class="paragraph">
<p>The information contained in this structure is naturally opaque to the caller of
this function.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-50"><a class="anchor" href="#id-version-1-prototype-50"></a><a class="link" href="#id-version-1-prototype-50">B.6.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_network_state_version_1 (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <code>Result</code> value (<a href="#defn-result-type">Definition 191</a>). On success it contains the
<em>Opaque network state</em> structure (<a href="#defn-opaque-network-state">Definition 213</a>). On failure, an
empty value is yielded where its cause is implementation specific.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_timestamp"><a class="anchor" href="#id-ext_offchain_timestamp"></a><a class="link" href="#id-ext_offchain_timestamp">B.6.4. <code>ext_offchain_timestamp</code></a></h4>
<div class="paragraph">
<p>Returns the current timestamp.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-51"><a class="anchor" href="#id-version-1-prototype-51"></a><a class="link" href="#id-version-1-prototype-51">B.6.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_timestamp_version_1 (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>result</code>: an u64 integer (typed as i64 due to wasm types) indicating the
current UNIX timestamp (<a href="#defn-unix-time">Definition 181</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_sleep_until"><a class="anchor" href="#id-ext_offchain_sleep_until"></a><a class="link" href="#id-ext_offchain_sleep_until">B.6.5. <code>ext_offchain_sleep_until</code></a></h4>
<div class="paragraph">
<p>Pause the execution until the <code>deadline</code> is reached.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-52"><a class="anchor" href="#id-version-1-prototype-52"></a><a class="link" href="#id-version-1-prototype-52">B.6.5.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_sleep_until_version_1 (param $deadline i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>deadline</code>: an u64 integer (typed as i64 due to wasm types) specifying the
UNIX timestamp (<a href="#defn-unix-time">Definition 181</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_random_seed"><a class="anchor" href="#id-ext_offchain_random_seed"></a><a class="link" href="#id-ext_offchain_random_seed">B.6.6. <code>ext_offchain_random_seed</code></a></h4>
<div class="paragraph">
<p>Generates a random seed. This is a truly random non deterministic seed generated
by the host environment.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-53"><a class="anchor" href="#id-version-1-prototype-53"></a><a class="link" href="#id-version-1-prototype-53">B.6.6.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_random_seed_version_1 (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit seed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_local_storage_set"><a class="anchor" href="#id-ext_offchain_local_storage_set"></a><a class="link" href="#id-ext_offchain_local_storage_set">B.6.7. <code>ext_offchain_local_storage_set</code></a></h4>
<div class="paragraph">
<p>Sets a value in the local storage. This storage is not part of the consensus,
it&#8217;s only accessible by the offchain worker tasks running on the same machine
and is persisted between runs.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-54"><a class="anchor" href="#id-version-1-prototype-54"></a><a class="link" href="#id-version-1-prototype-54">B.6.7.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_local_storage_set_version_1
	(param $kind i32) (param $key i64) (param $value i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>kind</code>: an i32 integer indicating the storage kind. A value equal to <em>1</em> is
used for a persistent storage (<a href="#defn-offchain-persistent-storage">Definition 209</a>) and a value
equal to <em>2</em> for local storage (<a href="#defn-offchain-local-storage">Definition 210</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the value.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_local_storage_clear"><a class="anchor" href="#id-ext_offchain_local_storage_clear"></a><a class="link" href="#id-ext_offchain_local_storage_clear">B.6.8. <code>ext_offchain_local_storage_clear</code></a></h4>
<div class="paragraph">
<p>Remove a value from the local storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-55"><a class="anchor" href="#id-version-1-prototype-55"></a><a class="link" href="#id-version-1-prototype-55">B.6.8.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_local_storage_clear_version_1
	(param $kind i32) (param $key i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>kind</code>: an i32 integer indicating the storage kind. A value equal to <em>1</em> is
used for a persistent storage (<a href="#defn-offchain-persistent-storage">Definition 209</a>) and a value
equal to <em>2</em> for local storage (<a href="#defn-offchain-local-storage">Definition 210</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_local_storage_compare_and_set"><a class="anchor" href="#id-ext_offchain_local_storage_compare_and_set"></a><a class="link" href="#id-ext_offchain_local_storage_compare_and_set">B.6.9. <code>ext_offchain_local_storage_compare_and_set</code></a></h4>
<div class="paragraph">
<p>Sets a new value in the local storage if the condition matches the current value.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-56"><a class="anchor" href="#id-version-1-prototype-56"></a><a class="link" href="#id-version-1-prototype-56">B.6.9.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(fund $ext_offchain_local_storage_compare_and_set_version_1
	(param $kind i32) (param $key i64) (param $old_value i64)
	(param $new_value i64) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>kind</code>: an i32 integer indicating the storage kind. A value equal to <em>1</em> is
used for a persistent storage (<a href="#defn-offchain-persistent-storage">Definition 209</a>) and a value
equal to <em>2</em> for local storage (<a href="#defn-offchain-local-storage">Definition 210</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>old_value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the old key.</p>
</li>
<li>
<p><code>new_value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the new value.</p>
</li>
<li>
<p><code>result</code>: an i32 integer equal to <em>1</em> if the new value has been set or a value
equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_local_storage_get"><a class="anchor" href="#id-ext_offchain_local_storage_get"></a><a class="link" href="#id-ext_offchain_local_storage_get">B.6.10. <code>ext_offchain_local_storage_get</code></a></h4>
<div class="paragraph">
<p>Gets a value from the local storage.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-57"><a class="anchor" href="#id-version-1-prototype-57"></a><a class="link" href="#id-version-1-prototype-57">B.6.10.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_local_storage_get_version_1
	(param $kind i32) (param $key i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>kind</code>: an i32 integer indicating the storage kind. A value equal to <em>1</em> is
used for a persistent storage (<a href="#defn-offchain-persistent-storage">Definition 209</a>) and a value
equal to <em>2</em> for local storage (<a href="#defn-offchain-local-storage">Definition 210</a>).</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the value or the
corresponding key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_http_request_start"><a class="anchor" href="#id-ext_offchain_http_request_start"></a><a class="link" href="#id-ext_offchain_http_request_start">B.6.11. <code>ext_offchain_http_request_start</code></a></h4>
<div class="paragraph">
<p>Initiates a HTTP request given by the HTTP method and the URL. Returns the Id of
a newly started request.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-58"><a class="anchor" href="#id-version-1-prototype-58"></a><a class="link" href="#id-version-1-prototype-58">B.6.11.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_http_request_start_version_1
  (param $method i64) (param $uri i64) (param $meta i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>method</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the HTTP
method. Possible values are “GET” and “POST”.</p>
</li>
<li>
<p><code>uri</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the URI.</p>
</li>
<li>
<p><code>meta</code>: a future-reserved field containing additional, SCALE encoded
parameters. Currently, an empty array should be passed.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> value (<a href="#defn-result-type">Definition 191</a>) containing the i16 ID of the newly
started request. On failure no additionally data is provided. The cause of
failure is implementation specific.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_http_request_add_header"><a class="anchor" href="#id-ext_offchain_http_request_add_header"></a><a class="link" href="#id-ext_offchain_http_request_add_header">B.6.12. <code>ext_offchain_http_request_add_header</code></a></h4>
<div class="paragraph">
<p>Append header to the request. Returns an error if the request identifier is
invalid, <code>http_response_wait</code> has already been called on the specified request
identifier, the deadline is reached or an I/O error has happened (e.g. the
remote has closed the connection).</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-59"><a class="anchor" href="#id-version-1-prototype-59"></a><a class="link" href="#id-version-1-prototype-59">B.6.12.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_http_request_add_header_version_1
	(param $request_id i32) (param $name i64) (param $value i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>request_id</code>: an i32 integer indicating the ID of the started request.</p>
</li>
<li>
<p><code>name</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the HTTP header name.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the HTTP header value.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> value (<a href="#defn-result-type">Definition 191</a>). Neither on success or failure is
there any additional data provided. The cause of failure is implementation
specific.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_http_request_write_body"><a class="anchor" href="#id-ext_offchain_http_request_write_body"></a><a class="link" href="#id-ext_offchain_http_request_write_body">B.6.13. <code>ext_offchain_http_request_write_body</code></a></h4>
<div class="paragraph">
<p>Writes a chunk of the request body. Returns a non-zero value in case the
deadline is reached or the chunk could not be written.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-60"><a class="anchor" href="#id-version-1-prototype-60"></a><a class="link" href="#id-version-1-prototype-60">B.6.13.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_http_request_write_body_version_1
	(param $request_id i32) (param $chunk i64) (param $deadline i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>request_id</code>: an i32 integer indicating the ID of the started request.</p>
</li>
<li>
<p><code>chunk</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the chunk of
bytes. Writing an empty chunk finalizes the request.</p>
</li>
<li>
<p><code>deadline</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the UNIX timestamp
(<a href="#defn-unix-time">Definition 181</a>). Passing <em>None</em> blocks indefinitely.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> value (<a href="#defn-result-type">Definition 191</a>). On success, no additional data is
provided. On error it contains the HTTP error type (<a href="#defn-http-error">Definition 212</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_http_response_wait"><a class="anchor" href="#id-ext_offchain_http_response_wait"></a><a class="link" href="#id-ext_offchain_http_response_wait">B.6.14. <code>ext_offchain_http_response_wait</code></a></h4>
<div class="paragraph">
<p>Returns an array of request statuses (the length is the same as IDs). Note that
if deadline is not provided the method will block indefinitely, otherwise
unready responses will produce DeadlineReached status.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-61"><a class="anchor" href="#id-version-1-prototype-61"></a><a class="link" href="#id-version-1-prototype-61">B.6.14.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_http_response_wait_version_1
	(param $ids i64) (param $deadline i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>ids</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded array of started request IDs.</p>
</li>
<li>
<p><code>deadline</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the UNIX timestamp
(<a href="#defn-unix-time">Definition 181</a>). Passing None blocks indefinitely.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded array of request statuses (<a href="#defn-http-status-code">Definition 211</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_http_response_headers"><a class="anchor" href="#id-ext_offchain_http_response_headers"></a><a class="link" href="#id-ext_offchain_http_response_headers">B.6.15. <code>ext_offchain_http_response_headers</code></a></h4>
<div class="paragraph">
<p>Read all HTTP response headers. Returns an array of key/value pairs. Response
headers must be read before the response body.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-62"><a class="anchor" href="#id-version-1-prototype-62"></a><a class="link" href="#id-version-1-prototype-62">B.6.15.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_http_response_headers_version_1
	(param $request_id i32) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>request_id</code>: an i32 integer indicating the ID of the started request.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to a SCALE encoded array of key/value pairs.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_offchain_http_response_read_body"><a class="anchor" href="#id-ext_offchain_http_response_read_body"></a><a class="link" href="#id-ext_offchain_http_response_read_body">B.6.16. <code>ext_offchain_http_response_read_body</code></a></h4>
<div class="paragraph">
<p>Reads a chunk of body response to the given buffer. Returns the number of bytes
written or an error in case a deadline is reached or the server closed the
connection. If 0 is returned it means that the response has been fully consumed
and the request_id is now invalid. This implies that response headers must be
read before draining the body.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-63"><a class="anchor" href="#id-version-1-prototype-63"></a><a class="link" href="#id-version-1-prototype-63">B.6.16.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_offchain_http_response_read_body_version_1
	(param $request_id i32) (param $buffer i64) (param $deadline i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>request_id</code>: an i32 integer indicating the ID of the started request.</p>
</li>
<li>
<p><code>buffer</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the buffer
where the body gets written to.</p>
</li>
<li>
<p><code>deadline</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the UNIX timestamp
(<a href="#defn-unix-time">Definition 181</a>). Passing <em>None</em> will block indefinitely.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Result</em> value (<a href="#defn-result-type">Definition 191</a>). On success it contains an i32
integer specifying the number of bytes written or a HTTP error type
(<a href="#defn-http-error">Definition 212</a>) on failure.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-trie-api"><a class="anchor" href="#sect-trie-api"></a><a class="link" href="#sect-trie-api">B.7. Trie</a></h3>
<div class="paragraph">
<p>Interface that provides trie related functionality.</p>
</div>
<div class="sect3">
<h4 id="id-ext_trie_blake2_256_root"><a class="anchor" href="#id-ext_trie_blake2_256_root"></a><a class="link" href="#id-ext_trie_blake2_256_root">B.7.1. <code>ext_trie_blake2_256_root</code></a></h4>
<div class="paragraph">
<p>Compute a 256-bit Blake2 trie root formed from the iterated items.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-64"><a class="anchor" href="#id-version-1-prototype-64"></a><a class="link" href="#id-version-1-prototype-64">B.7.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_blake2_256_root_version_1
	(param $data i64) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
iterated items from which the trie root gets formed. The items consist of a
SCALE encoded array containing arbitrary key/value pairs (tuples).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-9"><a class="anchor" href="#id-version-2-prototype-9"></a><a class="link" href="#id-version-2-prototype-9">B.7.1.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_blake2_256_root_version_2
	(param $data i64) (param $version i32)
	(result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
iterated items from which the trie root gets formed. The items consist of a
SCALE encoded array containing arbitrary key/value pairs (tuples).</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_trie_blake2_256_ordered_root"><a class="anchor" href="#id-ext_trie_blake2_256_ordered_root"></a><a class="link" href="#id-ext_trie_blake2_256_ordered_root">B.7.2. <code>ext_trie_blake2_256_ordered_root</code></a></h4>
<div class="paragraph">
<p>Compute a 256-bit Blake2 trie root formed from the enumerated items.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-65"><a class="anchor" href="#id-version-1-prototype-65"></a><a class="link" href="#id-version-1-prototype-65">B.7.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_blake2_256_ordered_root_version_1
	(param $data i64) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the enumerated
items from which the trie root gets formed. The items consist of a SCALE encoded
array containing only values, where the corresponding key of each value is the
index of the item in the array, starting at 0. The keys are compact encoded
integers (<a href="#defn-sc-len-encoding">Definition 198</a>).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root
result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-10"><a class="anchor" href="#id-version-2-prototype-10"></a><a class="link" href="#id-version-2-prototype-10">B.7.2.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_blake2_256_ordered_root_version_2
	(param $data i64) (param $version i32)
	(result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the enumerated
items from which the trie root gets formed. The items consist of a SCALE encoded
array containing only values, where the corresponding key of each value is the
index of the item in the array, starting at 0. The keys are compact encoded
integers (<a href="#defn-sc-len-encoding">Definition 198</a>).</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root
result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_trie_keccak_256_root"><a class="anchor" href="#id-ext_trie_keccak_256_root"></a><a class="link" href="#id-ext_trie_keccak_256_root">B.7.3. <code>ext_trie_keccak_256_root</code></a></h4>
<div class="paragraph">
<p>Compute a 256-bit Keccak trie root formed from the iterated items.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-66"><a class="anchor" href="#id-version-1-prototype-66"></a><a class="link" href="#id-version-1-prototype-66">B.7.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_keccak_256_root_version_1
	(param $data i64) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
iterated items from which the trie root gets formed. The items consist of a
SCALE encoded array containing arbitrary key/value pairs.</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-11"><a class="anchor" href="#id-version-2-prototype-11"></a><a class="link" href="#id-version-2-prototype-11">B.7.3.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_keccak_256_root_version_2
	(param $data i64) (param $version i32)
	(result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
iterated items from which the trie root gets formed. The items consist of a
SCALE encoded array containing arbitrary key/value pairs.</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_trie_keccak_256_ordered_root"><a class="anchor" href="#id-ext_trie_keccak_256_ordered_root"></a><a class="link" href="#id-ext_trie_keccak_256_ordered_root">B.7.4. <code>ext_trie_keccak_256_ordered_root</code></a></h4>
<div class="paragraph">
<p>Compute a 256-bit Keccak trie root formed from the enumerated items.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-67"><a class="anchor" href="#id-version-1-prototype-67"></a><a class="link" href="#id-version-1-prototype-67">B.7.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_keccak_256_ordered_root_version_1
	(param $data i64) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the enumerated
items from which the trie root gets formed. The items consist of a SCALE encoded
array containing only values, where the corresponding key of each value is the
index of the item in the array, starting at 0. The keys are compact encoded
integers (<a href="#defn-sc-len-encoding">Definition 198</a>).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root
result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-12"><a class="anchor" href="#id-version-2-prototype-12"></a><a class="link" href="#id-version-2-prototype-12">B.7.4.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_keccak_256_ordered_root_version_2
	(param $data i64) (param $version i32)
	(result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the enumerated
items from which the trie root gets formed. The items consist of a SCALE encoded
array containing only values, where the corresponding key of each value is the
index of the item in the array, starting at 0. The keys are compact encoded
integers (<a href="#defn-sc-len-encoding">Definition 198</a>).</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the buffer containing the 256-bit trie root
result.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_trie_blake2_256_verify_proof"><a class="anchor" href="#id-ext_trie_blake2_256_verify_proof"></a><a class="link" href="#id-ext_trie_blake2_256_verify_proof">B.7.5. <code>ext_trie_blake2_256_verify_proof</code></a></h4>
<div class="paragraph">
<p>Verifies a key/value pair against a Blake2 256-bit merkle root.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-68"><a class="anchor" href="#id-version-1-prototype-68"></a><a class="link" href="#id-version-1-prototype-68">B.7.5.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_blake2_256_verify_proof_version_1
	(param $root i32) (param $proof i64)
	(param $key i64) (param $value i64)
	(result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>root</code>: a pointer to the 256-bit merkle root.</p>
</li>
<li>
<p><code>proof</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an array containing
the node proofs.</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the value.</p>
</li>
<li>
<p><code>return</code>: a value equal to <em>1</em> if the proof could be successfully verified or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-13"><a class="anchor" href="#id-version-2-prototype-13"></a><a class="link" href="#id-version-2-prototype-13">B.7.5.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_blake2_256_verify_proof_version_2
	(param $root i32) (param $proof i64)
	(param $key i64) (param $value i64)
	(param $version i32) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>root</code>: a pointer to the 256-bit merkle root.</p>
</li>
<li>
<p><code>proof</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an array containing
the node proofs.</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the value.</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>return</code>: a value equal to <em>1</em> if the proof could be successfully verified or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_trie_keccak_256_verify_proof"><a class="anchor" href="#id-ext_trie_keccak_256_verify_proof"></a><a class="link" href="#id-ext_trie_keccak_256_verify_proof">B.7.6. <code>ext_trie_keccak_256_verify_proof</code></a></h4>
<div class="paragraph">
<p>Verifies a key/value pair against a Keccak 256-bit merkle root.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-69"><a class="anchor" href="#id-version-1-prototype-69"></a><a class="link" href="#id-version-1-prototype-69">B.7.6.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_keccak_256_verify_proof_version_1
	(param $root i32) (param $proof i64)
	(param $key i64) (param $value i64)
	(result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>root</code>: a pointer to the 256-bit merkle root.</p>
</li>
<li>
<p><code>proof</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an array containing
the node proofs.</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the value.</p>
</li>
<li>
<p><code>return</code>: a value equal to <em>1</em> if the proof could be successfully verified or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-version-2-prototype-14"><a class="anchor" href="#id-version-2-prototype-14"></a><a class="link" href="#id-version-2-prototype-14">B.7.6.2. Version 2 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_trie_keccak_256_verify_proof_version_2
	(param $root i32) (param $proof i64)
	(param $key i64) (param $value i64)
	(param $version i32) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>root</code>: a pointer to the 256-bit merkle root.</p>
</li>
<li>
<p><code>proof</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to an array containing
the node proofs.</p>
</li>
<li>
<p><code>key</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the key.</p>
</li>
<li>
<p><code>value</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the value.</p>
</li>
<li>
<p><code>version</code>: the state version (<a href="#defn-state-version">Definition 205</a>).</p>
</li>
<li>
<p><code>return</code>: a value equal to <em>1</em> if the proof could be successfully verified or a
value equal to <em>0</em> if otherwise.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-misc-api"><a class="anchor" href="#sect-misc-api"></a><a class="link" href="#sect-misc-api">B.8. Miscellaneous</a></h3>
<div class="paragraph">
<p>Interface that provides miscellaneous functions for communicating between the
runtime and the node.</p>
</div>
<div class="sect3">
<h4 id="id-ext_misc_print_num"><a class="anchor" href="#id-ext_misc_print_num"></a><a class="link" href="#id-ext_misc_print_num">B.8.1. <code>ext_misc_print_num</code></a></h4>
<div class="paragraph">
<p>Print a number.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-70"><a class="anchor" href="#id-version-1-prototype-70"></a><a class="link" href="#id-version-1-prototype-70">B.8.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_misc_print_num_version_1 (param $value i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>value</code>: the number to be printed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_misc_print_utf8"><a class="anchor" href="#id-ext_misc_print_utf8"></a><a class="link" href="#id-ext_misc_print_utf8">B.8.2. <code>ext_misc_print_utf8</code></a></h4>
<div class="paragraph">
<p>Print a valid UTF8 encoded buffer.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-71"><a class="anchor" href="#id-version-1-prototype-71"></a><a class="link" href="#id-version-1-prototype-71">B.8.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_misc_print_utf8_version_1 (param $data i64))</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Arguments</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to
the valid buffer to be printed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_misc_print_hex"><a class="anchor" href="#id-ext_misc_print_hex"></a><a class="link" href="#id-ext_misc_print_hex">B.8.3. <code>ext_misc_print_hex</code></a></h4>
<div class="paragraph">
<p>Print any buffer in hexadecimal representation.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-72"><a class="anchor" href="#id-version-1-prototype-72"></a><a class="link" href="#id-version-1-prototype-72">B.8.3.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_misc_print_hex_version_1 (param $data i64))</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Arguments</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to
the buffer to be printed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_misc_runtime_version"><a class="anchor" href="#id-ext_misc_runtime_version"></a><a class="link" href="#id-ext_misc_runtime_version">B.8.4. <code>ext_misc_runtime_version</code></a></h4>
<div class="paragraph">
<p>Extract the Runtime version of the given Wasm blob by calling <code>Core_version</code>
(<a href="#defn-rt-core-version">Section C.4.1</a>). Returns the SCALE encoded runtime version or <em>None</em>
(<a href="#defn-option-type">Definition 190</a>) if the call fails. This function gets primarily used when
upgrading Runtimes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Calling this function is very expensive and should only be done very
occasionally. For getting the runtime version, it requires instantiating the
Wasm blob (<a href="#sect-loading-runtime-code">Section 2.6.2</a>) and calling the <code>Core_version</code>
function (<a href="#defn-rt-core-version">Section C.4.1</a>) in this blob.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-73"><a class="anchor" href="#id-version-1-prototype-73"></a><a class="link" href="#id-version-1-prototype-73">B.8.4.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_misc_runtime_version_version_1 (param $data i64) (result i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the Wasm
blob.</p>
</li>
<li>
<p><code>result</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE
encoded <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the Runtime version of
the given Wasm blob which is encoded as a byte array.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-allocator-api"><a class="anchor" href="#sect-allocator-api"></a><a class="link" href="#sect-allocator-api">B.9. Allocator</a></h3>
<div class="paragraph">
<p>The Polkadot Runtime does not include a memory allocator and relies on the Host
API for all heap allocations. The beginning of this heap is marked by the
<code>__heap_base</code> symbol exported by the Polkadot Runtime. No memory should be
allocated below that address, to avoid clashes with the stack and data section.
The same allocator made accessible by this Host API should be used for any other
WASM memory allocations and deallocations outside the runtime e.g. when passing
the SCALE-encoded parameters to Runtime API calls.</p>
</div>
<div class="sect3">
<h4 id="id-ext_allocator_malloc"><a class="anchor" href="#id-ext_allocator_malloc"></a><a class="link" href="#id-ext_allocator_malloc">B.9.1. <code>ext_allocator_malloc</code></a></h4>
<div class="paragraph">
<p>Allocates the given number of bytes and returns the pointer to that memory
location.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-74"><a class="anchor" href="#id-version-1-prototype-74"></a><a class="link" href="#id-version-1-prototype-74">B.9.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_allocator_malloc_version_1 (param $size i32) (result i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>size</code>: the size of the buffer to be allocated.</p>
</li>
<li>
<p><code>result</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the allocated buffer.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_allocator_free"><a class="anchor" href="#id-ext_allocator_free"></a><a class="link" href="#id-ext_allocator_free">B.9.2. <code>ext_allocator_free</code></a></h4>
<div class="paragraph">
<p>Free the given pointer.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-75"><a class="anchor" href="#id-version-1-prototype-75"></a><a class="link" href="#id-version-1-prototype-75">B.9.2.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_allocator_free_version_1 (param $ptr i32))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>ptr</code>: a pointer (<a href="#defn-runtime-pointer">Definition 202</a>) to the memory buffer to be freed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-logging-api"><a class="anchor" href="#sect-logging-api"></a><a class="link" href="#sect-logging-api">B.10. Logging</a></h3>
<div class="paragraph">
<p>Interface that provides functions for logging from within the runtime.</p>
</div>
<div id="defn-logging-log-level" class="exampleblock">
<div class="title">Definition 214. <a href="#defn-logging-log-level">Log Level</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Log Level</strong>, \$L\$, is a varying data type (<a href="#defn-varrying-data-type">Definition 188</a>)
and implies the emergency of the log. Possible log levels and the corresponding
identifier is as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$L = {(0,"Error = 1"),(1,"Warn = 2"),(2,"Info = 3"),(3, "Debug = 4"),(4,"Trace = 5"):}\$
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-ext_logging_log"><a class="anchor" href="#id-ext_logging_log"></a><a class="link" href="#id-ext_logging_log">B.10.1. <code>ext_logging_log</code></a></h4>
<div class="paragraph">
<p>Request to print a log message on the host. Note that this will be only
displayed if the host is enabled to display log messages with given level and
target.</p>
</div>
<div class="sect4">
<h5 id="id-version-1-prototype-76"><a class="anchor" href="#id-version-1-prototype-76"></a><a class="link" href="#id-version-1-prototype-76">B.10.1.1. Version 1 - Prototype</a></h5>
<div class="listingblock">
<div class="content">
<pre>(func $ext_logging_log_version_1
	(param $level i32) (param $target i64) (param $message i64))</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>level</code>: the log level (<a href="#defn-logging-log-level">Definition 214</a>).</p>
</li>
<li>
<p><code>target</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the
string which contains the path, module or location from where the log was
executed.</p>
</li>
<li>
<p><code>message</code>: a pointer-size (<a href="#defn-runtime-pointer-size">Definition 203</a>) to the log
message.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-runtime-api"><a class="anchor" href="#chap-runtime-api"></a><a class="link" href="#chap-runtime-api">Appendix C: Runtime API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Description of how to interact with the Runtime through its exported functions</p>
</div>
<div class="sect2">
<h3 id="id-general-information"><a class="anchor" href="#id-general-information"></a><a class="link" href="#id-general-information">C.1. General Information</a></h3>
<div class="paragraph">
<p>The Polkadot Host assumes that at least the constants and functions
described in this Chapter are implemented in the Runtime Wasm blob.</p>
</div>
<div class="paragraph">
<p>It should be noted that the API can change through the Runtime updates.
Therefore, a host should check the API versions of each module returned
in the <code>api</code> field by <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) after
every Runtime upgrade and warn if an updated API is encountered and that
this might require an update of the host.</p>
</div>
<div class="paragraph">
<p>In this section, we describe all Runtime API functions alongside their
arguments and the return values. The functions are organized into
modules with each being versioned independently.</p>
</div>
<div class="sect3">
<h4 id="sect-json-rpc-api"><a class="anchor" href="#sect-json-rpc-api"></a><a class="link" href="#sect-json-rpc-api">C.1.1. JSON-RPC API for external services</a></h4>
<div class="paragraph">
<p>Polkadot Host implementers are encouraged to implement an API in order
for external, third-party services to interact with the node. The
<a href="https://github.com/w3f/PSPs/blob/master/PSPs/drafts/psp-6.md">JSON-RPC
Interface for Polkadot Nodes</a> (PSP6) is a Polkadot Standard
Proposal for such an API and makes it easier to integrate the node with
existing tools available in the Polkadot ecosystem, such as
<a href="https://polkadot.js.org/">polkadot.js.org</a>. The Runtime API has a few
modules designed specifically for use in the official RPC API.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-runtime-constants"><a class="anchor" href="#id-runtime-constants"></a><a class="link" href="#id-runtime-constants">C.2. Runtime Constants</a></h3>
<div class="sect3">
<h4 id="id-__heap_base"><a class="anchor" href="#id-__heap_base"></a><a class="link" href="#id-__heap_base">C.2.1. <code>__heap_base</code></a></h4>
<div class="paragraph">
<p>This constant indicates the beginning of the heap in memory. The space
below is reserved for the stack and the data section. For more details
please refer to <a href="#sect-memory-management">Section 2.6.3.1</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-runtime-call-convention"><a class="anchor" href="#id-runtime-call-convention"></a><a class="link" href="#id-runtime-call-convention">C.3. Runtime Call Convention</a></h3>
<div id="defn-runtime-api-convention" class="exampleblock">
<div class="title">Definition 215. Runtime API Call Convention</div>
<div class="content">
<div class="paragraph">
<p>The <strong>Runtime API Call Convention</strong> describes that all functions receive and
return SCALE-encoded data and as a result have the following prototype
signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="wat">(func $generic_runtime_entry
  (param $ptr i32) (parm $len i32) (result i64))</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ptr</code> points to the SCALE encoded tuple of the parameters passed to the
function and <code>len</code> is the length of this data, while <code>result</code> is a pointer-size
(Definition <a href="#defn-runtime-pointer-size">Definition 203</a>) to the SCALE-encoded return data.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sect-code-executor">Section 2.6.3</a> for more information about the behavior of the Wasm
Runtime. Also note that any storage changes must be fork-aware
(<a href="#sect-managing-multiple-states">Section 2.4.5</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-core-module"><a class="anchor" href="#sect-runtime-core-module"></a><a class="link" href="#sect-runtime-core-module">C.4. Module Core</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 3</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="defn-rt-core-version"><a class="anchor" href="#defn-rt-core-version"></a><a class="link" href="#defn-rt-core-version">C.4.1. <code>Core_version</code></a></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For newer Runtimes, the version identifiers can be read directly from
the Wasm blob in form of custom sections
(<a href="#sect-runtime-version-custom-section">Section 2.6.3.4</a>). That method of retrieving this data
should be preferred since it involves significantly less overhead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Returns the version identifiers of the Runtime. This function can be used by the
Polkadot Host implementation when it seems appropriate, such as for the JSON-RPC
API as described in <a href="#sect-json-rpc-api">Section C.1.1</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A datastructure of the following format:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Details of the version that the data type returns from the Runtime function.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runtime identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>impl_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the implementation (e.g. C++)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authoring_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the authorship interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the Runtime specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>impl_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the Runtime implementation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApiVersions (<a href="#defn-rt-apisvec">Definition 216</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported APIs along with their version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transaction_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the transaction format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>state_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the trie format</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="defn-rt-apisvec" class="exampleblock">
<div class="title">Definition 216. ApiVersions</div>
<div class="content">
<div class="paragraph">
<p><strong>ApiVersions</strong> is a specialized type for the (<a href="#defn-rt-core-version">Section C.4.1</a>) function entry. It represents an array of tuples, where the first value of the tuple is an array of 8-bytes containing the Blake2b hash of the API name. The second value of the tuple is the version number of the corresponding API.</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
      \mathrm{ApiVersions} :=&amp; (T_0, \ldots, T_n)\\
      T :=&amp; ((b_0, \ldots, b_7), \mathrm{UINT32})
\end{aligned}\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Requires <code>Core_initialize_block</code> to be called beforehand.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-rte-core-execute-block"><a class="anchor" href="#sect-rte-core-execute-block"></a><a class="link" href="#sect-rte-core-execute-block">C.4.2. <code>Core_execute_block</code></a></h4>
<div class="paragraph">
<p>This function executes a full block and all its extrinsics and updates the state accordingly. Additionally, some integrity checks are executed such as validating if the parent hash is correct and that the transaction root represents the transactions. Internally, this function performs an operation similar to the process described in <a href="#algo-build-block">Algorithm 12</a>, by calling <code>Core_initialize_block</code>,<code>BlockBuilder_apply_extrinsics</code> and <code>BlockBuilder_finalize_block</code>.</p>
</div>
<div class="paragraph">
<p>This function should be called when a fully complete block is available
that is not actively being built on, such as blocks received from other
peers. State changes resulted from calling this function are usually
meant to persist when the block is imported successfully.</p>
</div>
<div class="paragraph">
<p>Additionally, the seal digest in the block header, as described in  <a href="#defn-digest">Definition 11</a>, must be removed by the
Polkadot host before submitting the block.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A block represented as a tuple consisting of a block header, as described in <a href="#defn-block-header">Definition 10</a>, and the block body, as described in <a href="#defn-block-body">Definition 13</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rte-core-initialize-block"><a class="anchor" href="#sect-rte-core-initialize-block"></a><a class="link" href="#sect-rte-core-initialize-block">C.4.3. <code>Core_initialize_block</code></a></h4>
<div class="paragraph">
<p>Sets up the environment required for building a new block as described in <a href="#algo-build-block">Algorithm 12</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The header of the new block as defined in <a href="#defn-block-header">Definition 10</a>. The values \(H_r\), \(H_e\) and \(H_d\) are left empty.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-metadata-module"><a class="anchor" href="#sect-runtime-metadata-module"></a><a class="link" href="#sect-runtime-metadata-module">C.5. Module Metadata</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 1</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sect-rte-metadata-metadata"><a class="anchor" href="#sect-rte-metadata-metadata"></a><a class="link" href="#sect-rte-metadata-metadata">C.5.1. <code>Metadata_metadata</code></a></h4>
<div class="paragraph">
<p>Returns native Runtime metadata in an opaque form. This function can be used by the Polkadot Host implementation when it seems appropriate, such as for the JSON-RPC API as described in <a href="#sect-json-rpc-api">Section C.1.1</a>. and returns all the information necessary to build valid transactions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The scale-encoded (<a href="#sect-scale-codec">Section A.2.2</a>) runtime metadata as described in <a href="#sect-metadata">Chapter 12</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-blockbuilder-module"><a class="anchor" href="#sect-runtime-blockbuilder-module"></a><a class="link" href="#sect-runtime-blockbuilder-module">C.6. Module BlockBuilder</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 4</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialize_block</code>
(<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect3">
<h4 id="sect-rte-apply-extrinsic"><a class="anchor" href="#sect-rte-apply-extrinsic"></a><a class="link" href="#sect-rte-apply-extrinsic">C.6.1. <code>BlockBuilder_apply_extrinsic</code></a></h4>
<div class="paragraph">
<p>Apply the extrinsic outside of the block execution function. This does
not attempt to validate anything regarding the block, but it builds a
list of transaction hashes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A byte array of varying size containing the opaque extrinsic.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Returns the varying datatype <em>ApplyExtrinsicResult</em> as defined in <a href="#defn-rte-apply-extrinsic-result">Definition 217</a>.
This structure lets the block builder know whether an extrinsic should
be included into the block or rejected.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="defn-rte-apply-extrinsic-result" class="exampleblock">
<div class="title">Definition 217. ApplyExtrinsicResult</div>
<div class="content">
<div class="paragraph">
<p><strong>ApplyExtrinsicResult</strong> is a varying data type as defined in <a href="#defn-result-type">Definition 191</a>.
This structure can contain multiple nested structures, indicating either module
dispatch outcomes or transaction invalidity errors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Possible values of varying data type <em>ApplyExtrinsicResult</em>.</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 60%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Id</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outcome of dispatching the extrinsic.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>DispatchOutcome</em> (<a href="#defn-rte-dispatch-outcome">Definition 218</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possible errors while checking the validity of a transaction.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TransactionValidityError</em> (<a href="#defn-rte-transaction-validity-error">Definition 221</a>)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As long as a <em>DispatchOutcome</em> (<a href="#defn-rte-dispatch-outcome">Definition 218</a>) is returned,
the extrinsic is always included in the block, even if the outcome is a dispatch
error. Dispatch errors do not invalidate the block and all state changes are
persisted.
</td>
</tr>
</table>
</div>
<div id="defn-rte-dispatch-outcome" class="exampleblock">
<div class="title">Definition 218. DispatchOutcome</div>
<div class="content">
<div class="paragraph">
<p><strong>DispatchOutcome</strong> is the varying data type as defined in <a href="#defn-result-type">Definition 191</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Possible values of varying data type <em>DispatchOutcome</em>.</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 60%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Id</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrinsic is valid and was submitted successfully.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possible errors while dispatching the extrinsic.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>DispatchError</em> (<a href="#defn-rte-dispatch-error">Definition 219</a>)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="defn-rte-dispatch-error" class="exampleblock">
<div class="title">Definition 219. DispatchError</div>
<div class="content">
<div class="paragraph">
<p><strong>DispatchError</strong> is a varying data type as defined in <a href="#defn-varrying-data-type">Definition 188</a>.
Indicates various reasons why a dispatch call failed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Possible values of varying data type <em>DispatchError</em>.</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 40%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Id</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some unknown error occurred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCALE encoded byte array containing a valid UTF-8 sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed to lookup some data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A bad origin.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom error in a module.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CustomModuleError</em> (<a href="#defn-rte-custom-module-error">Definition 220</a>)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="defn-rte-custom-module-error" class="exampleblock">
<div class="title">Definition 220. CustomModuleError</div>
<div class="content">
<div class="paragraph">
<p><strong>CustomModuleError</strong> is a tuple appended after a possible error in as defined in <a href="#defn-rte-dispatch-error">Definition 219</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Possible values of varying data type <em>CustomModuleError</em>.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module index matching the metadata module index.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module specific error value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional error message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Varying data type <em>Option</em> (<a href="#defn-option-type">Definition 190</a>).
The optional value is a SCALE encoded byte array containing a valid UTF-8 sequence.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whenever <em>TransactionValidityError</em> (<a href="#defn-rte-transaction-validity-error">Definition 221</a>)
is returned, the contained error type will indicate whether an extrinsic should
be outright rejected or requested for a later block. This behavior is clarified
further in <a href="#defn-rte-invalid-transaction">Definition 222</a> and respectively <a href="#defn-rte-unknown-transaction">Definition 223</a>.
</td>
</tr>
</table>
</div>
<div id="defn-rte-transaction-validity-error" class="exampleblock">
<div class="title">Definition 221. TransactionValidityError</div>
<div class="content">
<div class="paragraph">
<p><strong>TransactionValidityError</strong> is a varying data type as defined in <a href="#defn-varrying-data-type">Definition 188</a>.
It indicates possible errors that can occur while checking the validity of a transaction.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Possible values of varying data type <em>TransactionValidityError</em>.</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 50%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Id</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction is invalid.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>InvalidTransaction</em> (<a href="#defn-rte-invalid-transaction">Definition 222</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction validity can’t be determined.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UnknownTransaction</em> (<a href="#defn-rte-unknown-transaction">Definition 223</a>)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="defn-rte-invalid-transaction" class="exampleblock">
<div class="title">Definition 222. InvalidTransaction</div>
<div class="content">
<div class="paragraph">
<p><strong>InvalidTransaction</strong> is a varying data type as defined in <a href="#defn-varrying-data-type">Definition 188</a>
and specifies the invalidity of the transaction in more detail.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Possible values of varying data type <em>InvalidTransaction</em>.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Id</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Reject</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call of the transaction is not expected.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General error to do with the inability to pay some fees (e.g. account balance too low).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General error to do with the transaction not yet being valid (e.g. nonce too high).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General error to do with the transaction being outdated (e.g. nonce too low).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General error to do with the transactions’ proof (e.g. signature)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The transaction birth block is ancient.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The transaction would exhaust the resources of the current block.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some unknown error occurred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An extrinsic with mandatory dispatch resulted in an error.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A transaction with a mandatory dispatch (only inherents are allowed to have mandatory dispatch).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="defn-rte-unknown-transaction" class="exampleblock">
<div class="title">Definition 223. UnknownTransaction</div>
<div class="content">
<div class="paragraph">
<p><strong>UnknownTransaction</strong> is a varying data type as defined in <a href="#defn-varrying-data-type">Definition 188</a>
and specifies the unknown invalidity of the transaction in more detail.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Possible values of varying data type <em>UnknownTransaction</em>.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Id</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Reject</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Could not lookup some information that is required to validate the transaction.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No validator found for the given unsigned transaction.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any other custom unknown validity that is not covered by this type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="defn-rt-blockbuilder-finalize-block"><a class="anchor" href="#defn-rt-blockbuilder-finalize-block"></a><a class="link" href="#defn-rt-blockbuilder-finalize-block">C.6.2. <code>BlockBuilder_finalize_block</code></a></h4>
<div class="paragraph">
<p>Finalize the block - it is up to the caller to ensure that all header
fields are valid except for the state root. State changes resulting from
calling this function are usually meant to persist upon successful
execution of the function and appending of the block to the chain.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The header of the new block as defined in <a href="#defn-block-header">Definition 10</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="defn-rt-builder-inherent-extrinsics"><a class="anchor" href="#defn-rt-builder-inherent-extrinsics"></a><a class="link" href="#defn-rt-builder-inherent-extrinsics">C.6.3. <code>BlockBuilder_inherent_extrinisics</code>:</a></h4>
<div class="paragraph">
<p>Generates the inherent extrinsics, which are explained in more detail in
<a href="#sect-inherents">Section 2.3.3</a>. This function takes a SCALE-encoded hash table as defined in
<a href="#defn-scale-list">Definition 192</a> and returns an array of extrinsics. The Polkadot Host must
submit each of those to the <code>BlockBuilder_apply_extrinsic</code>, described in
<a href="#sect-rte-apply-extrinsic">Section C.6.1</a>. This procedure is outlined in <a href="#algo-build-block">Algorithm 12</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A Inherents-Data structure as defined in <a href="#defn-inherent-data">Definition 15</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A byte array of varying size containing extrinisics. Each extrinsic is a byte
array of varying size.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-blockbuilder_check_inherents"><a class="anchor" href="#id-blockbuilder_check_inherents"></a><a class="link" href="#id-blockbuilder_check_inherents">C.6.4. <code>BlockBuilder_check_inherents</code></a></h4>
<div class="paragraph">
<p>Checks whether the provided inherent is valid. This function can be used
by the Polkadot Host when deemed appropriate, e.g. during the
block-building process.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A block represented as a tuple consisting of a block header as described in
<a href="#defn-block-header">Definition 10</a> and the block body as described in <a href="#defn-block-body">Definition 13</a>.</p>
</li>
<li>
<p>A Inherents-Data structure as defined in <a href="#defn-inherent-data">Definition 15</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A data structure of the following format:</p>
<div class="stemblock">
<div class="content">
\[(o, f_e, e)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(o\) is a boolean indicating whether the check was successful.</p>
</li>
<li>
<p>\(f_e\) is a boolean indicating whether a fatal error was encountered.</p>
</li>
<li>
<p>\(e\) is a Inherents-Data structure as defined in <a href="#defn-inherent-data">Definition 15</a>
containing any errors created by this Runtime function.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-blockbuilder_random_seed"><a class="anchor" href="#id-blockbuilder_random_seed"></a><a class="link" href="#id-blockbuilder_random_seed">C.6.5. <code>BlockBuilder_random_seed</code></a></h4>
<div class="paragraph">
<p>Generates a random seed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A 32-byte array containing the random seed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-txqueue-module"><a class="anchor" href="#sect-runtime-txqueue-module"></a><a class="link" href="#sect-runtime-txqueue-module">C.7. Module TaggedTransactionQueue</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 2</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialize_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect3">
<h4 id="sect-rte-validate-transaction"><a class="anchor" href="#sect-rte-validate-transaction"></a><a class="link" href="#sect-rte-validate-transaction">C.7.1. <code>TaggedTransactionQueue_validate_transaction</code></a></h4>
<div class="paragraph">
<p>This entry is invoked against extrinsics submitted through a transaction network
message (<a href="#sect-msg-transactions">Section 4.8.5</a>) or by an offchain worker through the Host API
(<a href="#sect-ext-offchain-submit-transaction">Section B.6.2</a>).</p>
</div>
<div class="paragraph">
<p>It indicates if the submitted blob represents a valid extrinsics, the
order in which it should be applied and if it should be gossiped to
other peers. Furthermore this function gets called internally when
executing blocks with the runtime function as described in <a href="#sect-rte-core-execute-block">Section C.4.2</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The source of the transaction as defined in <a href="#defn-transaction-source">Definition 224</a>.</p>
</li>
<li>
<p>A byte array that contains the transaction.</p>
<div id="defn-transaction-source" class="exampleblock">
<div class="title">Definition 224. TransactionSource</div>
<div class="content">
<div class="paragraph">
<p><strong>TransactionSource</strong> is an enum describing the source of a transaction and can
have one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. The <em>TransactionSource</em> enum</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>InBlock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction is already included in a block.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction is coming from a local source, e.g. off-chain worker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>External</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction has been received externally, e.g. over the network.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This function returns a <em>Result</em> as defined in <a href="#defn-result-type">Definition 191</a> which contains
the type <em>ValidTransaction</em>  as defined in <a href="#defn-valid-transaction">Definition 225</a> on success
and the type <em>TransactionValidityError</em> as defined in
<a href="#defn-rte-transaction-validity-error">Definition 221</a> on failure.</p>
<div id="defn-valid-transaction" class="exampleblock">
<div class="title">Definition 225. ValidTransaction</div>
<div class="content">
<div class="paragraph">
<p><strong>ValidTransaction</strong> is a tuple that contains information concerning a valid transaction.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. The tuple provided by in the case the transaction is judged to be valid.</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 70%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Priority</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the ordering of two transactions that have all their dependencies
(required tags) are satisfied.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Requires</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tags specifying extrinsics which should be applied before the current
exrinsics can be applied.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array containing inner arrays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Provides</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informs Runtime  of the extrinsics depending on the tags in the list that can be
applied after current extrinsics are being applied. Describes the minimum number
of blocks for the validity to be correct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array containing inner arrays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Longevity</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After this period, the transaction should be removed from the pool or revalidated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64-bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Propagate</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A flag indicating if the transaction should be gossiped to other peers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <em>Propagate</em> is set to <code>false</code> the transaction will still be considered for inclusion in blocks that are authored on the current node, but should not be gossiped to other peers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If this function gets called by the Polkadot Host in order to validate a transaction received from peers, the Polkadot Host disregards and rewinds state changes resulting in such a call.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-runtime-offchainapi-module"><a class="anchor" href="#sect-runtime-offchainapi-module"></a><a class="link" href="#sect-runtime-offchainapi-module">C.8. Module OffchainWorkerApi</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 2</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Does not require <code>Core_initialize_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect3">
<h4 id="id-offchainworkerapi_offchain_worker"><a class="anchor" href="#id-offchainworkerapi_offchain_worker"></a><a class="link" href="#id-offchainworkerapi_offchain_worker">C.8.1. <code>OffchainWorkerApi_offchain_worker</code></a></h4>
<div class="paragraph">
<p>Starts an off-chain worker and generates extrinsics. [To do: when is
this called?]</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The block header as defined in <a href="#defn-block-header">Definition 10</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-anv-runtime-api"><a class="anchor" href="#sect-anv-runtime-api"></a><a class="link" href="#sect-anv-runtime-api">C.9. Module ParachainHost</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 1</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sect-rt-api-validators"><a class="anchor" href="#sect-rt-api-validators"></a><a class="link" href="#sect-rt-api-validators">C.9.1. <code>ParachainHost_validators</code></a></h4>
<div class="paragraph">
<p>Returns the validator set at the current state. The specified validators are responsible for backing parachains for the current state.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of public keys representing the validators.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rt-api-validator-groups"><a class="anchor" href="#sect-rt-api-validator-groups"></a><a class="link" href="#sect-rt-api-validator-groups">C.9.2. <code>ParachainHost_validator_groups</code></a></h4>
<div class="paragraph">
<p>Returns the validator groups (<a href="#defn-validator-groups">Definition 136</a>) used during the current
session. The validators in the groups are referred to by the validator set Id
(<a href="#defn-authority-list">Definition 33</a>).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of tuples, \$T\$, of the following format:</p>
<div class="stemblock">
<div class="content">
\$T = (I,G)\$
\$I = (v_n,…v_m)\$
\$G = (B_s,f,B_c)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$I\$ is an array the validator set Ids (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$B_s\$ indicates the block number where the session started.</p>
</li>
<li>
<p>\$f\$ indicates how often groups rotate. 0 means never.</p>
</li>
<li>
<p>\$B_c\$ indicates the current block number.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rt-api-availability-cores"><a class="anchor" href="#sect-rt-api-availability-cores"></a><a class="link" href="#sect-rt-api-availability-cores">C.9.3. <code>ParachainHost_availability_cores</code></a></h4>
<div class="paragraph">
<p>Returns information on all availability cores (<a href="#defn-availability-core">Definition 135</a>).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of core states, S, of the following format:</p>
<div class="stemblock">
<div class="content">
\$S = {(0,-&gt;,C_o),(1,-&gt;,C_s),(2,-&gt;,phi):}\$
\$C_o = (n_u,B_o,B_t,n_t,b,G_i,C_h,C_d)\$
\$C_s = (P_id,C_i)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$S\$ specifies the core state. <em>0</em> indicates that the core is occupied,
<em>1</em> implies it&#8217;s currently free but scheduled and given the opportunity to
occupy and <em>2</em> implies it&#8217;s free and there&#8217;s nothing scheduled.</p>
</li>
<li>
<p>\$n_u\$ is an <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) which can contain a
\$C_s\$ value if the core was freed by the Runtime and indicates the
assignment that is next scheduled on this core. An empty value indicates there
is nothing scheduled.</p>
</li>
<li>
<p>\$B_o\$ indicates the relay chain block number at which the core got occupied.</p>
</li>
<li>
<p>\$B_t\$ indicates the relay chain block number the core will time-out at, if any.</p>
</li>
<li>
<p>\$n_t\$ is an <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) which can contain a
\$C_s\$ value if the core is freed by a time-out and indicates the assignment
that is next scheduled on this core. An empty value indicates there is nothing
scheduled.</p>
</li>
<li>
<p>\$b\$ is a bitfield array (<a href="#defn-bitfield-array">Definition 141</a>). A \$&gt;2/3\$ majority
of assigned validators voting with \$1\$ values means that the core is
available.</p>
</li>
<li>
<p>\$G_i\$ indicates the assigned validator group index
(<a href="#defn-validator-groups">Definition 136</a>) is to distribute availability pieces of this
candidate.</p>
</li>
<li>
<p>\$C_h\$ indicates the hash of the candidate occupying the core.</p>
</li>
<li>
<p>\$C_d\$ is the candidate descriptor (<a href="#defn-candidate-descriptor">Definition 106</a>).</p>
</li>
<li>
<p>\$C_i\$ is an <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) which can contain the
collators public key indicating who should author the block.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rt-api-persisted-validation-data"><a class="anchor" href="#sect-rt-api-persisted-validation-data"></a><a class="link" href="#sect-rt-api-persisted-validation-data">C.9.4. <code>ParachainHost_persisted_validation_data</code></a></h4>
<div class="paragraph">
<p>Returns the persisted validation data for the given parachain Id and a given occupied core assumption.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
<li>
<p>An occupied core assumption (<a href="#defn-occupied-core-assumption">Definition 226</a>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) which can contain the persisted
validation data (<a href="#defn-persisted-validation-data">Definition 227</a>). The value is empty if the
parachain Id is not registered or the core assumption is of index \$2\$,
meaning that the core was freed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="defn-occupied-core-assumption" class="exampleblock">
<div class="title">Definition 226. <a href="#defn-occupied-core-assumption">Occupied Core Assumption</a></div>
<div class="content">
<div class="paragraph">
<p>A occupied core assumption is used for fetching certain pieces of information
about a parachain by using the relay chain API. The assumption indicates how the
Runtime API should compute the result. The assumptions, A, is a varying datatype
of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$A = {(0,-&gt;,phi),(1,-&gt;,phi),(2,-&gt;,phi):}\$
</div>
</div>
<div class="paragraph">
<p>where <em>0</em> indicates that the candidate occupying the core was made available and
included to free the core, <em>1</em> indicates that it timed-out and freed the core
without advancing the parachain and <em>2</em> indicates that the core was not occupied
to begin with.</p>
</div>
</div>
</div>
<div id="defn-persisted-validation-data" class="exampleblock">
<div class="title">Definition 227. <a href="#defn-persisted-validation-data">Persisted Validation Data</a></div>
<div class="content">
<div class="paragraph">
<p>The persisted validation data provides information about how to create the
inputs for the validation of a candidate by calling the Runtime. This
information is derived from the parachain state and will vary from parachain to
parachain, although some of the fields may be the same for every parachain. This
validation data acts as a way to authorize the additional data (such as
messages) the collator needs to pass to the validation function.</p>
</div>
<div class="paragraph">
<p>The persisted validation data, \$D_{pv}\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$D_{pv} = (P_h,H_i,H_r,m_b)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$P_h\$ is the parent head data (<a href="#defn-head-data">Definition 133</a>).</p>
</li>
<li>
<p>\$H_i\$ is the relay chain block number this is in the context of.</p>
</li>
<li>
<p>\$H_r\$ is the relay chain storage root this is in the context of.</p>
</li>
<li>
<p>\$m_b\$ is the maximum legal size of the PoV block, in bytes.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The persisted validation data is fetched via the Runtime API
(<a href="#sect-rt-api-persisted-validation-data">Section C.9.4</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-parachainhost_check_validation_outputs"><a class="anchor" href="#id-parachainhost_check_validation_outputs"></a><a class="link" href="#id-parachainhost_check_validation_outputs">C.9.5. <code>ParachainHost_check_validation_outputs</code></a></h4>
<div class="paragraph">
<p>Checks if the given validation outputs pass the acceptance criteria.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
<li>
<p>The candidate commitments (<a href="#defn-candidate-commitments">Definition 107</a>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A boolean indicating whether the candidate commitments pass the acceptance criteria.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-parachainhost_session_index_for_child"><a class="anchor" href="#id-parachainhost_session_index_for_child"></a><a class="link" href="#id-parachainhost_session_index_for_child">C.9.6. <code>ParachainHost_session_index_for_child</code></a></h4>
<div class="paragraph">
<p>Returns the session index that is expected at the child of a block.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
TODO clarify session index
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A unsigned 32-bit integer representing the session index.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rt-api-validation-code"><a class="anchor" href="#sect-rt-api-validation-code"></a><a class="link" href="#sect-rt-api-validation-code">C.9.7. <code>ParachainHost_validation_code</code></a></h4>
<div class="paragraph">
<p>Fetches the validation code (Runtime) of a parachain by parachain Id.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
<li>
<p>The occupied core assumption (<a href="#defn-occupied-core-assumption">Definition 226</a>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the full validation code
in an byte array. This value is empty if the parachain Id cannot be found or the
assumption is wrong.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rt-api-validation-code-by-hash"><a class="anchor" href="#sect-rt-api-validation-code-by-hash"></a><a class="link" href="#sect-rt-api-validation-code-by-hash">C.9.8. <code>ParachainHost_validation_code_by_hash</code></a></h4>
<div class="paragraph">
<p>Returns the validation code (Runtime) of a parachain by its hash.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The hash value of the validation code.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the full validation code
in an byte array. This value is empty if the parachain Id cannot be found or the
assumption is wrong.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-parachainhost_candidate_pending_availability"><a class="anchor" href="#id-parachainhost_candidate_pending_availability"></a><a class="link" href="#id-parachainhost_candidate_pending_availability">C.9.9. <code>ParachainHost_candidate_pending_availability</code></a></h4>
<div class="paragraph">
<p>Returns the receipt of a candidate pending availability for any parachain
assigned to an occupied availability core.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An <em>Option</em> value (<a href="#defn-option-type">Definition 190</a>) containing the committed candidate
receipt (<a href="#defn-candidate-receipt">Definition 104</a>). This value is empty if the given parachain
Id is not assigned to an occupied availability cores.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-parachainhost_candidate_events"><a class="anchor" href="#id-parachainhost_candidate_events"></a><a class="link" href="#id-parachainhost_candidate_events">C.9.10. <code>ParachainHost_candidate_events</code></a></h4>
<div class="paragraph">
<p>Returns an array of candidate events that occurred within the latest state.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of single candidate events, E, of the following format:</p>
<div class="stemblock">
<div class="content">
\$E = {(0,-&gt;,d),(1,-&gt;,d),(2,-&gt;,(C_r,h,I_c)):}\$
\$d = (C_r,h,I_c,G_i)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$E\$ specifies the the event type of the candidate. <em>0</em> indicates that the
candidate receipt was backed in the latest relay chain block, <em>1</em> indicates that
it was included and became a parachain block at the latest relay chain block and
<em>2</em> indicates that the candidate receipt was not made available and timed-out.</p>
</li>
<li>
<p>\$C_r\$ is the candidate receipt (<a href="#defn-candidate-receipt">Definition 104</a>).</p>
</li>
<li>
<p>\$h\$ is the parachain head data (<a href="#defn-head-data">Definition 133</a>).</p>
</li>
<li>
<p>\$I_c\$ is the index of the availability core as can be retrieved in
<a href="#sect-rt-api-availability-cores">Section C.9.3</a> that the candidate is occupying. If \$E\$
is of variant \$2\$, then this indicates the core index the candidate <em>was</em>
occupying.</p>
</li>
<li>
<p>\$G_i\$ is the group index (<a href="#defn-validator-groups">Definition 136</a>) that is responsible
of backing the candidate.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-rt-api-session-info"><a class="anchor" href="#sect-rt-api-session-info"></a><a class="link" href="#sect-rt-api-session-info">C.9.11. <code>ParachainHost_session_info</code></a></h4>
<div class="paragraph">
<p>Get the session info of the given session, if available.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unsigned 32-bit integer indicating the session index.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An <em>Option</em> type (<a href="#defn-option-type">Definition 190</a>) which can contain the session info
structure, \$S\$, of the following format:</p>
<div class="stemblock">
<div class="content">
\$S = (A,D,K,G,c,z,s,d,x,a)\$
\$A = (v_n,…v_m)\$
\$D = (v_(_n),…v_m)\$
\$K = (v_n,…v_m)\$
\$G = (g_n,…g_m)\$
\$g = (A_n,…A_m)\$
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\$A\$ indicates the validators of the current session, in canonical order.
There might be more validators in the current session than validators
participating in parachain consensus, as returned by the Runtime API
(<a href="#sect-rt-api-validators">Section C.9.1</a>).</p>
</li>
<li>
<p>\$D\$ indicates the validator authority discovery keys for the given
session in canonical order. The first couple of validators are equal to the
corresponding validators participating in the parachain consensus, as returned
by the Runtime API (<a href="#sect-rt-api-validators">Section C.9.1</a>). The remaining authorities are
not participating in the parachain consensus.</p>
</li>
<li>
<p>\$K\$ indicates the assignment keys for validators. There might be more
authorities in the session that validators participating in parachain consensus,
as returned by the Runtime API (<a href="#sect-rt-api-validators">Section C.9.1</a>).</p>
</li>
<li>
<p>\$G\$ indicates the validator groups in shuffled order.</p>
</li>
<li>
<p>\$v_n\$ is public key of the authority.</p>
</li>
<li>
<p>\$A_n\$ is the authority set Id (<a href="#defn-authority-list">Definition 33</a>).</p>
</li>
<li>
<p>\$c\$ is an unsigned 32-bit integer indicating the number of availability
cores used by the protocol during the given session.</p>
</li>
<li>
<p>\$z\$ is an unsigned 32-bit integer indicating the zeroth delay tranche width.</p>
</li>
<li>
<p>\$s\$ is an unsigned 32-bit integer indicating the number of samples an
assigned validator should do for approval voting.</p>
</li>
<li>
<p>\$d\$ is an unsigned 32-bit integer indicating the number of delay tranches in total.</p>
</li>
<li>
<p>\$x\$ is an unsigned 32-bit integer indicating how many BABE slots must
pass before an assignment is considered a “no-show”.</p>
</li>
<li>
<p>\$a\$ is an unsigned 32-bit integer indicating the number of validators
needed to approve a block.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-parachainhost_dmq_contents"><a class="anchor" href="#id-parachainhost_dmq_contents"></a><a class="link" href="#id-parachainhost_dmq_contents">C.9.12. <code>ParachainHost_dmq_contents</code></a></h4>
<div class="paragraph">
<p>Returns all the pending inbound messages in the downward message queue for a given parachain.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of inbound downward messages (<a href="#defn-downward-message">Definition 138</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-parachainhost_inbound_hrmp_channels_contents"><a class="anchor" href="#id-parachainhost_inbound_hrmp_channels_contents"></a><a class="link" href="#id-parachainhost_inbound_hrmp_channels_contents">C.9.13. <code>ParachainHost_inbound_hrmp_channels_contents</code></a></h4>
<div class="paragraph">
<p>Returns the contents of all channels addressed to the given recipient. Channels that have no messages in them are also included.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The parachain Id (<a href="#defn-para-id">Definition 134</a>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of inbound HRMP messages (<a href="#defn-inbound-hrmp-message">Definition 140</a>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-module-grandpaapi"><a class="anchor" href="#id-module-grandpaapi"></a><a class="link" href="#id-module-grandpaapi">C.10. Module GrandpaApi</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 2</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialize_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect3">
<h4 id="sect-rte-grandpa-auth"><a class="anchor" href="#sect-rte-grandpa-auth"></a><a class="link" href="#sect-rte-grandpa-auth">C.10.1. <code>GrandpaApi_grandpa_authorities</code></a></h4>
<div class="paragraph">
<p>This entry fetches the list of GRANDPA authorities according to the
genesis block and is used to initialize an authority list at genesis,
defined in <a href="#defn-authority-list">Definition 33</a>.
Any future authority changes get tracked via Runtime-to-consensus engine
messages, as described in <a href="#sect-consensus-message-digest">Section 3.3.2</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An authority list as defined in <a href="#defn-authority-list">Definition 33</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-grandpaapi_submit_report_equivocation_unsigned_extrinsic"><a class="anchor" href="#sect-grandpaapi_submit_report_equivocation_unsigned_extrinsic"></a><a class="link" href="#sect-grandpaapi_submit_report_equivocation_unsigned_extrinsic">C.10.2. <code>GrandpaApi_submit_report_equivocation_unsigned_extrinsic</code></a></h4>
<div class="paragraph">
<p>A GRANDPA equivocation occurs when a validator votes for multiple blocks
during one voting subround, as described further in <a href="#defn-equivocation">Definition 80</a>. The Polkadot Host is expected to identify equivocators and report those to the Runtime by
calling this function.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The equivocation proof of the following format:</p>
<div class="stemblock">
<div class="content">
\[\begin{aligned}
    G_{\mathrm{Ep}} =&amp; (\mathrm{id}_{\mathbb{V}}, e, r, A_{\mathrm{id}}, B^1_h,
    B^1_n A^1_{\mathrm{sig}}, B^2_h, B^2_n, A^2_{\mathrm{sig}}) \\
    e =&amp; \begin{cases}
      0 &amp;\quad \textrm{Equivocation at prevote stage} \\
      1 &amp;\quad \textrm{Equivocation at precommit stage}
    \end{cases}
\end{aligned}\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(\mathrm{id}_{\mathbb{V}}\) is the authority set id as defined in <a href="#defn-authority-set-id">Definition 73</a>.</p>
</li>
<li>
<p>\(e\) indicates the stage at which the equivocation occurred.</p>
</li>
<li>
<p>\(r\) is the round number the equivocation occurred.</p>
</li>
<li>
<p>\(A_{\mathrm{id}}\) is the public key of the equivocator.</p>
</li>
<li>
<p>\(B^1_h\) is the block hash of the first block the equivocator voted for.</p>
</li>
<li>
<p>\(B^1_n\) is the block number of the first block the equivocator voted for.</p>
</li>
<li>
<p>\(A^1_{\mathrm{sig}}\) is the equivocators signature of the first vote.</p>
</li>
<li>
<p>\(B^2_h\) is the block hash of the second block the equivocator voted for.</p>
</li>
<li>
<p>\(B^2_n\) is the block number of the second block the equivocator voted for.</p>
</li>
<li>
<p>\(A^2_{\mathrm{sig}}\) is the equivocators signature of the second vote.</p>
</li>
<li>
<p>A proof of the key owner in an opaque form as described in <a href="#sect-grandpaapi_generate_key_ownership_proof">Section C.10.3</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SCALE encoded <em>Option</em> as defined in <a href="#defn-option-type">Definition 190</a> containing an empty value on success.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-grandpaapi_generate_key_ownership_proof"><a class="anchor" href="#sect-grandpaapi_generate_key_ownership_proof"></a><a class="link" href="#sect-grandpaapi_generate_key_ownership_proof">C.10.3. <code>GrandpaApi_generate_key_ownership_proof</code></a></h4>
<div class="paragraph">
<p>Generates proof of the membership of a key owner in the specified block
state. The returned value is used to report equivocations as described
in <a href="#sect-grandpaapi_submit_report_equivocation_unsigned_extrinsic">Section C.10.2</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The authority set id as defined in <a href="#defn-authority-set-id">Definition 73</a>.</p>
</li>
<li>
<p>The 256-bit public key of the authority.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SCALE encoded <em>Option</em> as defined in <a href="#defn-option-type">Definition 190</a> containing the proof in an opaque form.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-module-babeapi"><a class="anchor" href="#id-module-babeapi"></a><a class="link" href="#id-module-babeapi">C.11. Module BabeApi</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 2</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialized_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect3">
<h4 id="sect-rte-babeapi-epoch"><a class="anchor" href="#sect-rte-babeapi-epoch"></a><a class="link" href="#sect-rte-babeapi-epoch">C.11.1. <code>BabeApi_configuration</code></a></h4>
<div class="paragraph">
<p>This entry is called to obtain the current configuration of the BABE
consensus protocol.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A tuple containing configuration data used by the Babe consensus
engine.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. The tuple provided by <strong>BabeApi_configuration</strong>.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SlotDuration</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slot duration in milliseconds. Currently, only the value provided by this
type at genesis will be used. Dynamic slot duration may be supported in the future.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>EpochLength</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The duration of epochs in slots.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Constant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A constant value that is used in the threshold calculation formula as defined in <a href="#defn-babe-constant">Definition 59</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tuple containing two unsigned 64bit integers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>GenesisAuthorities</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The authority list for the genesis epoch as defined in <a href="#defn-authority-list">Definition 33</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of tuples containing a 256-bit byte array and a unsigned 64bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Randomness</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The randomness for the genesis epoch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-byte array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SecondarySlot</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether this chain should run with round-robin-style secondary slot and if this secondary slot
requires the inclusion of an auxiliary VRF output (<a href="#sect-block-production-lottery">Section 5.2</a>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A one-byte enum as defined in <a href="#defn-consensus-message-babe">Definition 58</a> as \$2_("nd")\$.</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-babeapi_current_epoch_start"><a class="anchor" href="#id-babeapi_current_epoch_start"></a><a class="link" href="#id-babeapi_current_epoch_start">C.11.2. <code>BabeApi_current_epoch_start</code></a></h4>
<div class="paragraph">
<p>Finds the start slot of the current epoch.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A unsigned 64-bit integer indicating the slot number.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-babeapi_current_epoch"><a class="anchor" href="#sect-babeapi_current_epoch"></a><a class="link" href="#sect-babeapi_current_epoch">C.11.3. <code>BabeApi_current_epoch</code></a></h4>
<div class="paragraph">
<p>Produces information about the current epoch.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A data structure of the following format:</p>
<div class="stemblock">
<div class="content">
\[(e_i, s_s, d, A, r)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(e_i\) is a unsigned 64-bit integer representing the epoch index.</p>
</li>
<li>
<p>\(s_s\) is a unsigned 64-bit integer representing the starting slot of the epoch.</p>
</li>
<li>
<p>\(d\) is a unsigned 64-bit integer representing the duration of the epoch.</p>
</li>
<li>
<p>\(A\) is an authority list as defined in <a href="#defn-authority-list">Definition 33</a>.</p>
</li>
<li>
<p>\(r\) is an 256-bit array containing the randomness for the epoch as defined in <a href="#defn-epoch-randomness">Definition 71</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-babeapi_next_epoch"><a class="anchor" href="#id-babeapi_next_epoch"></a><a class="link" href="#id-babeapi_next_epoch">C.11.4. <code>BabeApi_next_epoch</code></a></h4>
<div class="paragraph">
<p>Produces information about the next epoch.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Returns the same datastructure as described in <a href="#sect-babeapi_current_epoch">Section C.11.3</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-babeapi_generate_key_ownership_proof"><a class="anchor" href="#sect-babeapi_generate_key_ownership_proof"></a><a class="link" href="#sect-babeapi_generate_key_ownership_proof">C.11.5. <code>BabeApi_generate_key_ownership_proof</code></a></h4>
<div class="paragraph">
<p>Generates a proof of the membership of a key owner in the specified
block state. The returned value is used to report equivocations as
described in <a href="#sect-babeapi_submit_report_equivocation_unsigned_extrinsic">Section C.11.6</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unsigned 64-bit integer indicating the slot number.</p>
</li>
<li>
<p>The 256-bit public key of the authority.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SCALE encoded <em>Option</em> as defined in Definition <a href="#defn-option-type">Definition 190</a> containing the
proof in an opaque form.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-babeapi_submit_report_equivocation_unsigned_extrinsic"><a class="anchor" href="#sect-babeapi_submit_report_equivocation_unsigned_extrinsic"></a><a class="link" href="#sect-babeapi_submit_report_equivocation_unsigned_extrinsic">C.11.6. <code>BabeApi_submit_report_equivocation_unsigned_extrinsic</code></a></h4>
<div class="paragraph">
<p>A BABE equivocation occurs when a validator produces more than one block
at the same slot. The proof of equivocation are the given distinct
headers that were signed by the validator and which include the slot
number. The Polkadot Host is expected to identify equivocators and
report those to the Runtime using this function.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there are more than two blocks which cause an equivocation, the
equivocation only needs to be reported once i.e. no additional
equivocations must be reported for the same slot.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The equivocation proof of the following format:</p>
<div class="stemblock">
<div class="content">
\[B_{\mathrm{Ep}} = (A_{\mathrm{id}}, s, h_1, h_2)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(A_{\mathrm{id}}\) is the public key of the equivocator.</p>
</li>
<li>
<p>\(s\) is the slot as described in <a href="#defn-epoch-slot">Definition 54</a> at which the equivocation occurred.</p>
</li>
<li>
<p>\(h_1\) is the block header of the first block produced by the equivocator.</p>
</li>
<li>
<p>\(h_2\) is the block header of the second block produced by the equivocator.</p>
<div class="paragraph">
<p>Unlike during block execution, the Seal in both block headers is not removed before
submission. The block headers are submitted in its full form.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>An proof of the key owner in an opaque form as described in <a href="#sect-babeapi_generate_key_ownership_proof">Section C.11.5</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SCALE encoded <em>Option</em> as defined in <a href="#defn-option-type">Definition 190</a> containing an empty
value on success.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-module-authoritydiscoveryapi"><a class="anchor" href="#id-module-authoritydiscoveryapi"></a><a class="link" href="#id-module-authoritydiscoveryapi">C.11.7. Module AuthorityDiscoveryApi</a></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 1</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require (Section
<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect4">
<h5 id="id-authoritydiscoveryapi_authorities"><a class="anchor" href="#id-authoritydiscoveryapi_authorities"></a><a class="link" href="#id-authoritydiscoveryapi_authorities">C.11.7.1. <code>AuthorityDiscoveryApi_authorities</code></a></h5>
<div class="paragraph">
<p>A function which helps to discover authorities.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A byte array of varying size containing 256-bit pulic keys of the
authorities.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-runtime-sessionkeys-module"><a class="anchor" href="#sect-runtime-sessionkeys-module"></a><a class="link" href="#sect-runtime-sessionkeys-module">C.11.8. Module SessionKeys</a></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 1</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialize_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect4">
<h5 id="id-sessionkeys_generate_session_keys"><a class="anchor" href="#id-sessionkeys_generate_session_keys"></a><a class="link" href="#id-sessionkeys_generate_session_keys">C.11.8.1. <code>SessionKeys_generate_session_keys</code></a></h5>
<div class="paragraph">
<p>Generates a set of session keys with an optional seed. The keys should
be stored within the keystore exposed by the Host Api. The seed needs to
be valid and UTF-8 encoded.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A SCALE-encoded <em>Option</em> as defined in <a href="#defn-option-type">Definition 190</a> containing an array of varying sizes indicating the seed.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A byte array of varying size containing the encoded session keys.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-sessionkeys_decode_session_keys"><a class="anchor" href="#id-sessionkeys_decode_session_keys"></a><a class="link" href="#id-sessionkeys_decode_session_keys">C.11.8.2. <code>SessionKeys_decode_session_keys</code></a></h5>
<div class="paragraph">
<p>Decodes the given public session keys. Returns a list of raw public keys including their key type.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of varying size containing the encoded public session keys.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An array of varying size containing tuple pairs of the following format:</p>
<div class="stemblock">
<div class="content">
\[(k, k_{\mathrm{id}})\]
</div>
</div>
<div class="paragraph">
<p>where \(k\) is an array of varying sizes containing the raw
public key and \(k_{\mathrm{id}}\) is a
4-byte array indicating the key type.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="id-module-accountnonceapi"><a class="anchor" href="#id-module-accountnonceapi"></a><a class="link" href="#id-module-accountnonceapi">C.12. Module AccountNonceApi</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 1</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialize_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect3">
<h4 id="sect-accountnonceapi-account-nonce"><a class="anchor" href="#sect-accountnonceapi-account-nonce"></a><a class="link" href="#sect-accountnonceapi-account-nonce">C.12.1. <code>AccountNonceApi_account_nonce</code></a></h4>
<div class="paragraph">
<p>Get the current nonce of an account. This function can be used by the Polkadot Host implementation when it seems appropriate, such as for the JSON-RPC API as described in <a href="#sect-json-rpc-api">Section C.1.1</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The 256-bit public key of the account.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A 32-bit unsigned integer indicating the nonce of the account.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="id-module-transactionpaymentapi"><a class="anchor" href="#id-module-transactionpaymentapi"></a><a class="link" href="#id-module-transactionpaymentapi">C.12.2. Module TransactionPaymentApi</a></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section describes <strong>Version 1</strong> of this API. Please check <code>Core_version</code> (<a href="#defn-rt-core-version">Section C.4.1</a>) to ensure compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All calls in this module require <code>Core_initialize_block</code> (<a href="#sect-rte-core-initialize-block">Section C.4.3</a>) to be called beforehand.</p>
</div>
<div class="sect4">
<h5 id="id-transactionpaymentapi_query_info"><a class="anchor" href="#id-transactionpaymentapi_query_info"></a><a class="link" href="#id-transactionpaymentapi_query_info">C.12.2.1. <code>TransactionPaymentApi_query_info</code></a></h5>
<div class="paragraph">
<p>Returns information of a given extrinsic. This function is not aware of
the internals of an extrinsic, but only interprets the extrinsic as some
encoded value and accounts for its weight and length, the Runtime’s
extrinsic base weight and the current fee multiplier.</p>
</div>
<div class="paragraph">
<p>This function can be used by the Polkadot Host implementation when it
seems appropriate, such as for the JSON-RPC API as described in <a href="#sect-json-rpc-api">Section C.1.1</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A byte array of varying sizes containing the extrinsic.</p>
</li>
<li>
<p>The length of the extrinsic. [To do: why is this needed?]</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A data structure of the following format:</p>
<div class="stemblock">
<div class="content">
\[(w, c, f)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(w\) is the weight of the extrinsic.</p>
</li>
<li>
<p>\(c\) is the "class" of the extrinsic, where class is a  varying data (<a href="#defn-varrying-data-type">Definition 188</a>) type defined as:</p>
<div class="stemblock">
<div class="content">
\[c = \left\{\begin{array}{l}
       0 \quad \textrm{Normal extrinsic}\\
       1 \quad \textrm{Operational extrinsic}\\
       2 \quad \textrm{Mandatory extrinsic, which is always included}
     \end{array}\right.\]
</div>
</div>
</li>
<li>
<p>\(f\) is the inclusion fee of the extrinsic. This does not
include a tip or anything else that depends on the signature.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="id-transactionpaymentapi_query_fee_details"><a class="anchor" href="#id-transactionpaymentapi_query_fee_details"></a><a class="link" href="#id-transactionpaymentapi_query_fee_details">C.12.2.2. <code>TransactionPaymentApi_query_fee_details</code></a></h5>
<div class="paragraph">
<p>Query the detailed fee of a given extrinsic. This function can be used
by the Polkadot Host implementation when it seems appropriate, such as
for the JSON-RPC API as described in <a href="#sect-json-rpc-api">Section C.1.1</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Arguments</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A byte array of varying sizes containing the extrinsic.</p>
</li>
<li>
<p>The length of the extrinsic.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Return</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A data structure of the following format:</p>
<div class="stemblock">
<div class="content">
\[(f, t)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(f\) is a SCALE encoded as defined in <a href="#defn-option-type">Definition 190</a> containing the following data structure:</p>
<div class="stemblock">
<div class="content">
\[ f = (f_b, f_l, f_a)\]
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">where</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>\(f_b\) is the minimum required fee for an extrinsic.</p>
</li>
<li>
<p>\(f_l\) is the length fee, the amount paid for the encoded length (in bytes) of the extrinsic.</p>
</li>
<li>
<p>\(f_a\) is the &#8220;adjusted weight fee&#8221;, which is a multiplication of the fee multiplier and the weight fee. The fee multiplier varies depending on the usage of the network.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>\(t\) is the tip for the block author.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id-bibliography"><a class="anchor" href="#id-bibliography"></a><a class="link" href="#id-bibliography">Bibliography</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="saarinen_blake2_2015"></a>[1] M. J. Saarinen and J.-P. Aumasson, “The BLAKE2 cryptographic hash and message authentication code (MAC),” -, <a href="https://tools.ietf.org/html/rfc7693" class="bare">tools.ietf.org/html/rfc7693</a>, RFC 7693, 2015. [Online]. Available: <a href="https://tools.ietf.org/html/rfc7693" class="bare">tools.ietf.org/html/rfc7693</a>.</p>
</div>
<div class="paragraph">
<p><a id="papadopoulos17"></a>[2] D. Papadopoulos <em>et al.</em>, “Making NSEC5 Practical for DNSSEC.” Cryptology ePrint Archive, Paper 2017/099, 2017, [Online]. Available: <a href="https://eprint.iacr.org/2017/099" class="bare">eprint.iacr.org/2017/099</a>.</p>
</div>
<div class="paragraph">
<p><a id="goldberg17"></a>[3] S. Goldberg, D. Papadopoulos, and J. Vcelak, “Internet Draft - Verifiable Random Functions (VRFs).” 2017, [Online]. Available: <a href="https://tools.ietf.org/id/draft-goldbe-vrf-01.html" class="bare">tools.ietf.org/id/draft-goldbe-vrf-01.html</a>.</p>
</div>
<div class="paragraph">
<p><a id="josefsson_edwards-curve_2017"></a>[4] S. Josefsson and I. Liusvaara, “Edwards-curve digital signature algorithm (EdDSA),” in <em>Internet Research Task Force, Crypto Forum Research Group, RFC</em>, 2017, vol. 8032.</p>
</div>
<div class="paragraph">
<p><a id="devalence_ed25519zebra_2020"></a>[5] H. de Valence, “Explicitly Defining and Modifying Ed25519 Validation Rules.” 2020, [Online]. Available: <a href="https://github.com/zcash/zips/blob/master/zip-0215.rst" class="bare">github.com/zcash/zips/blob/master/zip-0215.rst</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id-glossary"><a class="anchor" href="#id-glossary"></a><a class="link" href="#id-glossary">Glossary</a></h2>
<div class="sectionbody">
<div class="dlist glossary">
<dl>
<dt>\(P_n\)</dt>
<dd>
<p>A path graph or a path of \(n\) nodes.</p>
</dd>
<dt>\((b_0,b_1,...,b_{n-1})\)</dt>
<dd>
<p>A sequence of bytes or byte array of length \(n\)</p>
</dd>
<dt>\(𝔹_n\)</dt>
<dd>
<p>A set of all byte arrays of length \(n\)</p>
</dd>
<dt>\(I=\left(B_n…B_0\right)_{256}\)</dt>
<dd>
<p>A non-negative interger in base 256</p>
</dd>
<dt>\(B=(b_0,b_1,…,b_n)\)</dt>
<dd>
<p>The little-endian representation of a non-negative interger \(I=(B_n…B_0)_{256}\) such that \(b_i≔B_i\)</p>
</dd>
<dt>\(\textrm{Enc}_{LE}\)</dt>
<dd>
<p>The little-endian encoding function.</p>
</dd>
<dt>\(C\)</dt>
<dd>
<p>A blockchain defined as a directed path graph.</p>
</dd>
<dt>Block</dt>
<dd>
<p>A node of the directed path graph (blockchain) C</p>
</dd>
<dt>Genesis Block</dt>
<dd>
<p>The unique sink of blockchain C</p>
</dd>
<dt>Head</dt>
<dd>
<p>The source of blockchain C</p>
</dd>
<dt>\(P(B)\)</dt>
<dd>
<p>The parent of block \(B\)</p>
</dd>
<dt>UNIX time</dt>
<dd>
<p>The number of milliseconds that have elapsed since the Unix epoch as a 64-bit integer</p>
</dd>
<dt>\(BT\)</dt>
<dd>
<p>The block tree of a blockchain</p>
</dd>
<dt>\(G\)</dt>
<dd>
<p>The genesis block, the root of the block tree BT</p>
</dd>
<dt>\(\textrm{CHAIN}(B)\)</dt>
<dd>
<p>The path graph from \(G\) to \(B\) in \(BT\).</p>
</dd>
<dt>\(Head(C)\)</dt>
<dd>
<p>The head of chain C.</p>
</dd>
<dt>\(|C|\)</dt>
<dd>
<p>The length of chain \(C\) as a path graph</p>
</dd>
<dt>\(\textrm{SubChain}(B',B)\)</dt>
<dd>
<p>The subgraph of \(Chain(B)\) path graph containing both \(B\) and \(B'\).</p>
</dd>
<dt>\(ℂ_B(BT)\)</dt>
<dd>
<p>The set of all subchains of \(BT\) rooted at block \(B\).</p>
</dd>
<dt>\(ℂ, ℂ(BT)\)</dt>
<dd>
<p>\(ℂ_G(BT)\) i.e. the set of all chains of \(BT\) rooted at genesis block</p>
</dd>
<dt>\(\textrm{Longest-Chain}(BT)\)</dt>
<dd>
<p>The longest sub path graph of \(BT\) i.e. \(C : |C| = \max_{C_i ∈ ℂ} |C_i|\)</p>
</dd>
<dt>\(\textrm{Longest-Path}(BT)\)</dt>
<dd>
<p>The longest sub path graph of \((P)BT\) with earliest block arrival time</p>
</dd>
<dt>\(\textrm{Deepest-Leaf}(BT)\)</dt>
<dd>
<p>\(\textrm{Head}(\textrm{Longest-Path}(BT))\) i.e. the head of \(\textrm{Longest-Path}(BT)\)</p>
</dd>
<dt>\(B &gt; B'\)</dt>
<dd>
<p>\(B\) is a descendant of \(B'\) in the block tree</p>
</dd>
<dt>\(\textrm{StoredValue}(k)\)</dt>
<dd>
<p>The function to retrieve the value stored under a specific key in the state storage.</p>
</dd>
<dt>State trie, trie</dt>
<dd>
<p>The Merkle radix-16 Tree which stores hashes of storage enteries.</p>
</dd>
<dt>\(\textrm{KeyEncode}(k)\)</dt>
<dd>
<p>The function to encode keys for labeling branaches of the trie.</p>
</dd>
<dt>\(𝒩\)</dt>
<dd>
<p>The set of all nodes in the Polkadot state trie.</p>
</dd>
<dt>\(N\)</dt>
<dd>
<p>An individual node in the trie.</p>
</dd>
<dt>\(𝒩_b\)</dt>
<dd>
<p>A branch node of the trie which has at least one and at most 16 children</p>
</dd>
<dt>\(𝒩_l\)</dt>
<dd>
<p>A childless leaf node of the trie</p>
</dd>
<dt>\(pk_N^{Agr}\)</dt>
<dd>
<p>The aggregated prefix key of node N</p>
</dd>
<dt>\(pk_N\)</dt>
<dd>
<p>The (suffix) partial key of node N</p>
</dd>
<dt>\(\textrm{Index}_N\)</dt>
<dd>
<p>A function returning an integer in range of {0, . . . ,15} represeting the index of a child node of node \(N\) among the children of \(N\)</p>
</dd>
<dt>\(v_N\)</dt>
<dd>
<p>Node value containing the header of node \(N\), its partial key and the digest of its childern values</p>
</dd>
<dt>\(\textrm{Head}_N\)</dt>
<dd>
<p>The node header of trie node \(N\) storing information about the node&#8217;s type and kay</p>
</dd>
<dt>\(H(N)\)</dt>
<dd>
<p>The Merkle value of node \(N\).</p>
</dd>
<dt>\(\textrm{ChildrenBitmap}\)</dt>
<dd>
<p>The binary function indicating which child of a given node is present in the trie.</p>
</dd>
<dt>\(sv_N\)</dt>
<dd>
<p>The subvalue of a trie node \(N\).</p>
</dd>
<dt>Child storage</dt>
<dd>
<p>A sub storage of the state storage which has the same structure although being stored separately</p>
</dd>
<dt>Child trie</dt>
<dd>
<p>State trie of a child storage</p>
</dd>
<dt>Transaction Queue</dt>
<dd>
<p>See <a href="#defn-transaction-queue">Definition 14</a>.</p>
</dd>
<dt>\(H_p\)</dt>
<dd>
<p>The 32-byte Blake2b hash of the header of the parent of the block.</p>
</dd>
<dt>\(H_i,H_i(B)\)</dt>
<dd>
<p>Block number, the incremental interger index of the current block in the chain.</p>
</dd>
<dt>\(H_r\)</dt>
<dd>
<p>The hash of the root of the Merkle trie of the state storage at a given block</p>
</dd>
<dt>\(H_e\)</dt>
<dd>
<p>An auxileray field in block header used by Runtime to validate the integrity of the extrinsics composing the block body.</p>
</dd>
<dt>\(H_d\), \(H_d(B)\)</dt>
<dd>
<p>A block header used to store any chain-specific auxiliary data.</p>
</dd>
<dt>\(H_h(B)\)</dt>
<dd>
<p>The hash of the header of block \(B\)</p>
</dd>
<dt>\(\textrm{Body}(B)\)</dt>
<dd>
<p>The body of block \(B\) consisting of a set of extrinsics</p>
</dd>
<dt>\(M^{r,stage}_v\)</dt>
<dd>
<p>Vote message broadcasted by the voter v as part of the finality protocol</p>
</dd>
<dt>\(M_v^{r,Fin}(B)\)</dt>
<dd>
<p>The commit message broadcasted by voter \(v\) indicating that they have finalized bock \(B\) in round \(r\)</p>
</dd>
<dt>\(v\)</dt>
<dd>
<p>GRANDPA voter node which casts vote in the finality protocol</p>
</dd>
<dt>\(k_v^{pr}\)</dt>
<dd>
<p>The private key of voter \(v\)</p>
</dd>
<dt>\(v_{id}\)</dt>
<dd>
<p>The public key of voter \(v\)</p>
</dd>
<dt>\(𝕍_B,𝕍\)</dt>
<dd>
<p>The set of all GRANDPA voters for at block \(B\)</p>
</dd>
<dt>\(GS\)</dt>
<dd>
<p>GRANDPA protocol state consisting of the set of voters, number of times voters set has changed and the current round number.</p>
</dd>
<dt>\(r\)</dt>
<dd>
<p>The voting round counter in the finality protocol</p>
</dd>
<dt>\(V_(B)\)</dt>
<dd>
<p>A GRANDPA vote casted in favor of block B</p>
</dd>
<dt>\$V_v^(r,pv)\$</dt>
<dd>
<p>A GRANDPA vote casted by voter \(v\) during the pre-vote stage of round \(r\)</p>
</dd>
<dt>\$V_v^(r,pc)\$</dt>
<dd>
<p>A GRANDPA vote casted by voter \(v\) during the pre-commit stage of round \(r\)</p>
</dd>
<dt>\(J^{r,stage}(B)\)</dt>
<dd>
<p>The justification for pre-committing or committing to block \(B\) in round \(r\) of finality protocol</p>
</dd>
<dt>\(Sign^{r,stage}_{v_i}(B)\)</dt>
<dd>
<p>The signature of voter \(v\) on their voteto block B, broadcasted during the specified stage of finality round \(r\)</p>
</dd>
<dt>\(ℰ^{r,stage}\)</dt>
<dd>
<p>The set of all equivocator voters in sub-round ‘‘stage'' of round \(r\)</p>
</dd>
<dt>\(ℰ^{r,stage}_{obs(v)}\)</dt>
<dd>
<p>The set of all equivocator voters in sub-round ‘‘stage'' of round \(r\) observed by voter \(v\)</p>
</dd>
<dt>\(VD^{r,stage}_{obs(v)}(B)\)</dt>
<dd>
<p>The set of observed direct votes for block B in round \(r\)</p>
</dd>
<dt>\(V^{r,stage}_{obs(v)}\)</dt>
<dd>
<p>The set of total votes observed by voter v in sub-round ‘‘stage'' of round r</p>
</dd>
<dt>\(V^{r,stage}_{obs(v)}(B)\)</dt>
<dd>
<p>The set of all observed votes by \(v\) in the sub-round “stage” of round \(r\) (directly or indirectly) for block \(B\)</p>
</dd>
<dt>\(B^{r,pv}_v\)</dt>
<dd>
<p>The currently pre-voted block in round \(r\). The GRANDPA GHOST of round \(r\)</p>
</dd>
<dt>Account key, \((sk^a,pk^a)\)</dt>
<dd>
<p>A key pair of types accepted by the Polkadot protocol which can be used to sign transactions</p>
</dd>
<dt>\(Enc_{SC}(A)\)</dt>
<dd>
<p>SCALE encoding of value \(A\)</p>
</dd>
<dt>\(T≔(A_1,...,A_n)\)</dt>
<dd>
<p>A tuple of values \(A_i\)'s each of different type</p>
</dd>
<dt>Varying Data Types \(𝒯={T_1,…,T_n}\)</dt>
<dd>
<p>A data type representing any of varying types \(T_1,…,T_n\).</p>
</dd>
<dt>\(S≔A_1,…,A_n\)</dt>
<dd>
<p>Sequence of values \(A_i\) of the same type</p>
</dd>
<dt>\(Enc^{Len}_{SC}(n)\)</dt>
<dd>
<p>SCALE length encoding aka. compact encoding of non-negative interger \(n\) of arbitrary size.</p>
</dd>
<dt>\(Enc_{HE}(PK)\)</dt>
<dd>
<p>Hex encoding</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.2.1<br>
Last updated 2023-02-20 08:22:21 UTC
</div>
</div>

  <script>
    MathJax = {
      loader: {
        load: ['input/asciimath', 'input/tex', 'output/chtml', 'a11y/assistive-mml']
      },
      asciimath: {
        delimiters: [['\\$','\\$']]
      },
      options: {
        ignoreHtmlClass: 'nostem|nolatexmath|noasciimath',
      },
      tex: {
        inlineMath: [[ '\\(', '\\)' ]],
        displayMath: [[ '\\[', '\\]' ]],
        processEscapes: false,
        processEnvironments: false,
        processRefs: false,   
      },
    };
  </script>

<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
</body>
</html>